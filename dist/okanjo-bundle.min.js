/*! okanjo-js v0.1.0 | (c) 2013 Okanjo Partners Inc | https://okanjo.com/ */
!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.okanjo=t()}(this,function(){var okanjo=okanjo||function(){var e={metrics:{trackEvent:function(){},trackPageView:function(){}},routes:{products:"/products",products_id:"/products/:product_id",products_sense:"/products/sense"},getRoute:function(t,n){if(n)for(var r in n)n.hasOwnProperty(r)&&(t=t.replace(":"+r,n[r]+""));return e.config.ads.apiUri+t},exec:function(t,n,r){e.JSONP({url:t,data:n,error:function(t){var n={statusCode:500,error:"Communication Error",message:t.message||"JSONP communication failure."};e.report("core-jsonp",t.error||new Error(n.message)),r(n,null)},success:function(t){var n,o;t?t.error?n=t:o=t:(n={statusCode:500,error:"Invalid Response",message:"Could not interpret the JSONP response."},e.report("core-jsonp",new Error(n.message))),r(n,o)}})},report:function(e,t){var n;"string"==typeof t?n=new Error("[Okanjo"+(e?" "+e:"")+"] "+t):"object"==typeof t&&t instanceof Error&&(n=t),console.error(n)},util:{trim:function(e){(e||"").replace(/^\s+|\s+$/g,"")},empty:function(t){return null===t||void 0===t||"string"==typeof t&&""===e.util.trim(t)},clone:function(e){var t={};e=e||{};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},hash:function(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);t=(t<<5)-t+r}return t.toString(16).replace(/^-/,"n")},data:function(e){var t={};if(e&&e.hasAttributes())for(var n=e.attributes,r=n.length-1;r>=0;r--)0===n[r].name.indexOf("data-")&&(t[n[r].name.substr(5)]=n[r].value);return t},copyIfSet:function(t,n,r,o,i){function s(o){!n||void 0===n[o]||i.stripEmpty&&e.util.empty(n[o])||(t[r]=n[o])}if(o=o||r,i=i||{},"object"==typeof o&&Array.isArray(o))for(var a=0;a<o.length;a++)s(o[a]);else s(o)},copyIfSetMap:function(t,n,r,o){for(var i=Object.keys(r),s=0;s<i.length;s++)e.util.copyIfSet(t,n,i[s],r[i[s]],o)}}};/*! https://github.com/isaacs/inherits/blob/master/inherits_browser.js */
return e.util.inherits="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},e}();/*! Console-polyfill. | MIT license. | https://github.com/paulmillr/console-polyfill */
/*! Okanjo Local Storage Polyfill v1.0.0 | (c) 2013 Okanjo Partners Inc | Based on https://gist.github.com/juliocesar/926500/ddb28fb72903be87cb9044a945c6edbe1aa28b3a */
/*! Okanjo Cookie Helper v1.0.0 | (c) 2013 Okanjo Partners Inc */
return okanjo.config={key:void 0,marketplace:{uri:"https://shop.okanjo.com",apiUri:"https://api.okanjo.com",routerUri:"https://shop.okanjo.com/widgets/router/",balancedMarketplacePath:"/v1/marketplaces/MP6vnNdXY7izEEVPs1gl7jSy",socketIOUri:"https://mke-rt.okanjo.com:13443",analyticsId:"UA-36849843-1"},ads:{apiUri:"https://ads-api.okanjo.com"}},okanjo.configure=function(e){Object.keys(e).every(function(t){return okanjo.config[t]&&"object"==typeof okanjo.config[t]&&"object"==typeof e[t]?Object.keys(e[t]).every(function(n){return okanjo.config[t][n]=e[t][e[n]],!0}):okanjo.config[t]=e[t],!0})},function(e){var t=e.TemplateEngine=function(e){e=e||{templates:{},css:{}},this._templates=e.templates||{},this._css=e.css||{}};t.prototype={constructor:t,registerTemplate:function(t,n,r,o){if("object"==typeof n){if(void 0===n.nodeType)throw new Error("Parameter template must be a string or a DOM element");e.Mustache.parse(n)}else if("string"!=typeof n)throw new Error("Parameter template must be a string or a DOM element");if(3===arguments.length&&"object"==typeof r?(o=r,r=void 0):o=o||{},void 0!==r&&"function"!=typeof r)throw new Error("Parameter viewClosure must be a function");this._templates[t]={markup:n,options:o,viewClosure:r||null}},registerCss:function(e,t,n){if(n=n||{},"object"==typeof t){if(void 0===t.nodeType)throw new Error("Parameter css must be a string or a DOM element")}else if("string"!=typeof t)throw new Error("Parameter css must be a string or a DOM element");this._css[e]={markup:t,options:n}},isTemplateRegistered:function(e){return this._templates[e]?!0:!1},isCssRegistered:function(e){return this._css[e]?!0:!1},ensureCss:function(t){if(this._css[t]){var n=this._css[t],r=void 0===n.markup.nodeType?n.options.id||"okanjo-css-"+t:null;if(r){var o=e.qwery("#"+r);if(0===o.length){var i=e.qwery("head"),s=document.createElement("style");if(s.id=r,s.innerHTML=n.markup,i.length>0)i[0].appendChild(s);else{var a=e.qwery("body");a.length>0&&a[0].appendChild(s)}}}}},render:function(t,n,r){r=r||{};var o=this._templates[t],i=n;if(o.viewClosure&&(i=o.viewClosure(n,r)),i.okanjoConfig=e.config,i.now=function(){return(new Date).getTime()},r.css!==!1&&o.options.css&&o.options.css.length>0)for(var s=0;s<o.options.css.length;s++)this.ensureCss(o.options.css[s]);return e.Mustache.render(o.markup,i)},formats:{currency:function(e,t,n,r){t=isNaN(t=Math.abs(t))?2:t,n=void 0===n?".":n,r=void 0===r?",":r;var o=0>e?"-":"",i=parseInt(e=Math.abs(+e||0).toFixed(t))+"",s=i.length;return s=s>3?s%3:0,o+(s?i.substr(0,s)+r:"")+i.substr(s).replace(/(\d{3})(?=\d)/g,"$1"+r)+(t?n+Math.abs(e-i).toFixed(t).slice(2):"")},product:function(e){if("object"==typeof e&&Array.isArray(e)){for(var t=[],n=0;n<e.length;n++)t.push(this.product(e[n]));return t}return"object"==typeof e?(e.image_url=e.image_urls?e.image_urls[0]:"",e.escaped_buy_url=encodeURIComponent(e.buy_url),e.price=this.currency(e.price),e):null}}},e.mvc=new t}(okanjo,this),function(e){"use strict";for(var t,n,r={},o=function(){},i="memory".split(","),s="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(",");t=i.pop();)void 0===e[t]&&(e[t]=e[t]||r);for(;n=s.pop();)void 0===e[n]&&(e[n]=e[n]||o)}(this.console||{}),function(e,t){function n(){var e="test",n=t.sessionStorage;try{return n.setItem(e,"1"),n.removeItem(e),!0}catch(r){return!1}}var r=null;return r="localStorage"in t&&null!==t.localStorage&&n()?t.localStorage:{_data:{},length:0,_updateLen:function(){this.length=this._data.length},setItem:function(e,t){var n=this._data[e]=String(t);return this._updateLen(),n},getItem:function(e){return this._data.hasOwnProperty(e)?this._data[e]:void 0},removeItem:function(e){var t=delete this._data[e];return this._updateLen(),t},clear:function(){return this._data={}},key:function(e){return Object.keys(this._data)[e]}},e.Cache=r,r}(okanjo||this,this),function(e,t){var n=t.document||{cookie:""};return e.Cookie={set:function(e,t,r){var o=new Date;o.setDate(o.getDate()+r);var i=encodeURI(t)+(r?"; expires="+o.toUTCString()+"; path=/":"");n.cookie=e+"="+i},get:function(e){var t,r,o,i=n.cookie.split(";");for(t=0;t<i.length;t++)if(r=i[t].substr(0,i[t].indexOf("=")),o=i[t].substr(i[t].indexOf("=")+1),r=r.replace(/^\s+|\s+$/g,""),r==e)return decodeURI(o);return null}},e.Cookie}(okanjo||this,this),"object"!=typeof JSON&&(JSON={},function(){"use strict";function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,o,i,s,a=gap,c=t[e];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(c)){for(i=c.length,n=0;i>n;n+=1)s[n]=str(n,c)||"null";return o=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,o}if(rep&&"object"==typeof rep)for(i=rep.length,n=0;i>n;n+=1)"string"==typeof rep[n]&&(r=rep[n],o=str(r,c),o&&s.push(quote(r)+(gap?": ":":")+o));else for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(o=str(r,c),o&&s.push(quote(r)+(gap?": ":":")+o));return o=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,o}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var r;if(gap="",indent="","number"==typeof n)for(r=0;n>r;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,o=e[t];if(o&&"object"==typeof o)for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(r=walk(o,n),void 0!==r?o[n]=r:delete o[n]);return reviver.call(e,t,o)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}()),Array.prototype.every||(Array.prototype.every=function(e,t){"use strict";var n,r;if(null==this)throw new TypeError("this is null or not defined");var o=Object(this),i=o.length>>>0;if("function"!=typeof e)throw new TypeError;for(arguments.length>1&&(n=t),r=0;i>r;){var s;if(r in o){s=o[r];var a=e.call(n,s,r,o);if(!a)return!1}r++}return!0}),function(){/*!
  * @preserve Qwery - A Blazing Fast query selector engine
  * https://github.com/ded/qwery
  * copyright Dustin Diaz 2012
  * MIT License
  */
!function(e,t,n){"undefined"!=typeof module&&module.exports?module.exports=n():"function"==typeof define&&define.amd?define(n):t[e]=n()}("qwery",this,function(){function e(){this.c={}}function t(e){return z.g(e)||z.s(e,"(^|\\s+)"+e+"(\\s+|$)",1)}function n(e,t){for(var n=0,r=e.length;r>n;n++)t(e[n])}function r(e){for(var t=[],n=0,r=e.length;r>n;++n)g(e[n])?t=t.concat(e[n]):t[t.length]=e[n];return t}function o(e){for(var t=0,n=e.length,r=[];n>t;t++)r[t]=e[t];return r}function i(e){for(;(e=e.previousSibling)&&1!=e[E];);return e}function s(e){return e.match(H)}function a(e,n,r,o,i,s,a,c,p,f,l){var d,h,g,m,y;if(1!==this[E])return!1;if(n&&"*"!==n&&this[C]&&this[C].toLowerCase()!==n)return!1;if(r&&(h=r.match(T))&&h[1]!==this.id)return!1;if(r&&(y=r.match(P)))for(d=y.length;d--;)if(!t(y[d].slice(1)).test(this.className))return!1;if(p&&v.pseudos[p]&&!v.pseudos[p](this,l))return!1;if(o&&!a){m=this.attributes;for(g in m)if(Object.prototype.hasOwnProperty.call(m,g)&&(m[g].name||g)==i)return this}return o&&!u(s,Z(this,i)||"",a)?!1:this}function c(e){return G.g(e)||G.s(e,e.replace(q,"\\$1"))}function u(e,t,n){switch(e){case"=":return t==n;case"^=":return t.match(Q.g("^="+n)||Q.s("^="+n,"^"+c(n),1));case"$=":return t.match(Q.g("$="+n)||Q.s("$="+n,c(n)+"$",1));case"*=":return t.match(Q.g(n)||Q.s(n,c(n),1));case"~=":return t.match(Q.g("~="+n)||Q.s("~="+n,"(?:^|\\s+)"+c(n)+"(?:\\s+|$)",1));case"|=":return t.match(Q.g("|="+n)||Q.s("|="+n,"^"+c(n)+"(-|$)",1))}return 0}function p(e,t){var r,o,i,c,u,p,f,d=[],h=[],g=t,m=Y.g(e)||Y.s(e,e.split(K)),v=e.match(B);if(!m.length)return d;if(c=(m=m.slice(0)).pop(),m.length&&(i=m[m.length-1].match(N))&&(g=y(t,i[1])),!g)return d;for(p=s(c),u=g!==t&&9!==g[E]&&v&&/^[+~]$/.test(v[v.length-1])?function(e){for(;g=g.nextSibling;)1==g[E]&&(p[1]?p[1]==g[C].toLowerCase():1)&&(e[e.length]=g);return e}([]):g[x](p[1]||"*"),r=0,o=u.length;o>r;r++)(f=a.apply(u[r],p))&&(d[d.length]=f);return m.length?(n(d,function(e){l(e,m,v)&&(h[h.length]=e)}),h):d}function f(e,t,n){if(d(t))return e==t;if(g(t))return!!~r(t).indexOf(e);for(var o,i,c=t.split(",");t=c.pop();)if(o=Y.g(t)||Y.s(t,t.split(K)),i=t.match(B),o=o.slice(0),a.apply(e,s(o.pop()))&&(!o.length||l(e,o,i,n)))return!0;return!1}function l(e,t,n,r){function o(e,r,c){for(;c=W[n[r]](c,e);)if(d(c)&&a.apply(c,s(t[r]))){if(!r)return c;if(i=o(c,r-1,c))return i}}var i;return(i=o(e,t.length-1,e))&&(!r||X(i,r))}function d(e,t){return e&&"object"==typeof e&&(t=e[E])&&(1==t||9==t)}function h(e){var t,n,r=[];e:for(t=0;t<e.length;++t){for(n=0;n<r.length;++n)if(r[n]==e[t])continue e;r[r.length]=e[t]}return r}function g(e){return"object"==typeof e&&isFinite(e.length)}function m(e){return e?"string"==typeof e?v(e)[0]:!e[E]&&g(e)?e[0]:e:b}function y(e,t,n){return 9===e[E]?e.getElementById(t):e.ownerDocument&&((n=e.ownerDocument.getElementById(t))&&X(n,e)&&n||!X(e,e.ownerDocument)&&w('[id="'+t+'"]',e)[0])}function v(e,t){var n,i,s=m(t);if(!s||!e)return[];if(e===window||d(e))return!t||e!==window&&d(s)&&X(e,s)?[e]:[];if(e&&g(e))return r(e);if(n=e.match(V)){if(n[1])return(i=y(s,n[1]))?[i]:[];if(n[2])return o(s[x](n[2]));if(et&&n[3])return o(s[_](n[3]))}return w(e,s)}function k(e,t){return function(n){var r,o;return M.test(n)?void(9!==e[E]&&((o=r=e.getAttribute("id"))||e.setAttribute("id",o="__qwerymeupscotty"),n='[id="'+o+'"]'+n,t(e.parentNode||e,n,!0),r||e.removeAttribute("id"))):void(n.length&&t(e,n,!1))}}var w,b=document,j=b.documentElement,_="getElementsByClassName",x="getElementsByTagName",O="querySelectorAll",S="useNativeQSA",C="tagName",E="nodeType",T=/#([\w\-]+)/,P=/\.[\w\-]+/g,N=/^#([\w\-]+)$/,I=/^\.([\w\-]+)$/,U=/^([\w\-]+)$/,A=/^([\w]+)?\.([\w\-]+)$/,M=/(^|,)\s*[>~+]/,D=/^\s+|\s*([,\s\+\~>]|$)\s*/g,R=/[\s\>\+\~]/,$=/(?![\s\w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^'"]*\]|[\s\w\+\-]*\))/,q=/([.*+?\^=!:${}()|\[\]\/\\])/g,J=/^(\*|[a-z0-9]+)?(?:([\.\#]+[\w\-\.#]+)?)/,L=/\[([\w\-]+)(?:([\|\^\$\*\~]?\=)['"]?([ \w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^]+)["']?)?\]/,F=/:([\w\-]+)(\(['"]?([^()]+)['"]?\))?/,V=new RegExp(N.source+"|"+U.source+"|"+I.source),B=new RegExp("("+R.source+")"+$.source,"g"),K=new RegExp(R.source+$.source),H=new RegExp(J.source+"("+L.source+")?("+F.source+")?"),W={" ":function(e){return e&&e!==j&&e.parentNode},">":function(e,t){return e&&e.parentNode==t.parentNode&&e.parentNode},"~":function(e){return e&&e.previousSibling},"+":function(e,t,n,r){return e?(n=i(e))&&(r=i(t))&&n==r&&n:!1}};e.prototype={g:function(e){return this.c[e]||void 0},s:function(e,t,n){return t=n?new RegExp(t):t,this.c[e]=t}};var z=new e,G=new e,Q=new e,Y=new e,X="compareDocumentPosition"in j?function(e,t){return 16==(16&t.compareDocumentPosition(e))}:"contains"in j?function(e,t){return t=9===t[E]||t==window?j:t,t!==e&&t.contains(e)}:function(e,t){for(;e=e.parentNode;)if(e===t)return 1;return 0},Z=function(){var e=b.createElement("p");return(e.innerHTML='<a href="#x">x</a>')&&"#x"!=e.firstChild.getAttribute("href")?function(e,t){return"class"===t?e.className:"href"===t||"src"===t?e.getAttribute(t,2):e.getAttribute(t)}:function(e,t){return e.getAttribute(t)}}(),et=!!b[_],tt=b.querySelector&&b[O],nt=function(e,t){var r,i,s=[];try{return 9!==t[E]&&M.test(e)?(n(r=e.split(","),k(t,function(e,t){i=e[O](t),1==i.length?s[s.length]=i.item(0):i.length&&(s=s.concat(o(i)))})),r.length>1&&s.length>1?h(s):s):o(t[O](e))}catch(a){}return rt(e,t)},rt=function(e,r){var o,i,s,a,c,u,f=[];if(e=e.replace(D,"$1"),i=e.match(A)){for(c=t(i[2]),o=r[x](i[1]||"*"),s=0,a=o.length;a>s;s++)c.test(o[s].className)&&(f[f.length]=o[s]);return f}return n(u=e.split(","),k(r,function(e,t,n){for(c=p(t,e),s=0,a=c.length;a>s;s++)(9===e[E]||n||X(c[s],r))&&(f[f.length]=c[s])})),u.length>1&&f.length>1?h(f):f},ot=function(e){"undefined"!=typeof e[S]&&(w=e[S]&&tt?nt:rt)};return ot({useNativeQSA:!0}),v.configure=ot,v.uniq=h,v.is=f,v.pseudos={},v}),/*! onDomReady.js 1.4.0 (c) 2013 Tubal Martin - MIT license | Wrapped in UMD by Okanjo */
function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.onDomReady=t()}(this,function(){"use strict";function e(t){if(!b){if(!s.body)return r(e);for(b=!0;t=j.shift();)r(t)}}function t(t){(k||t.type===c||s[l]===f)&&(n(),e())}function n(){k?(s[v](m,t,u),i[v](c,t,u)):(s[h](y,t),i[h](p,t))}function r(e,t){setTimeout(e,+t>=0?t:1)}function o(e){b?r(e):j.push(e)}var i=window,s=i.document,a=s.documentElement,c="load",u=!1,p="on"+c,f="complete",l="readyState",d="attachEvent",h="detachEvent",g="addEventListener",m="DOMContentLoaded",y="onreadystatechange",v="removeEventListener",k=g in s,w=u,b=u,j=[];if(s[l]===f)r(e);else if(k)s[g](m,t,u),i[g](c,t,u);else{s[d](y,t),i[d](p,t);try{w=null==i.frameElement&&a}catch(_){}w&&w.doScroll&&!function x(){if(!b){try{w.doScroll("left")}catch(t){return r(x,50)}n(),e()}}()}return o.version="1.4.0",o.isReady=function(){return b},o}),function(){var e,t,n,r,o,i,s,a;n=function(e){return window.document.createElement(e)},r=window.encodeURIComponent,s=Math.random,e=function(e){var r,i,s,c,u;if(e=e?e:{},c={data:e.data||{},error:e.error||o,success:e.success||o,beforeSend:e.beforeSend||o,complete:e.complete||o,url:e.url||""},c.computedUrl=t(c),0===c.url.length)throw new Error("MissingUrl");return i=!1,c.beforeSend({},c)!==!1?(r=c.data[e.callbackName||"callback"]="jsonp_"+a(15),window[r]=function(e){c.success(e,c),c.complete(e,c);try{return delete window[r]}catch(t){return void(window[r]=void 0)}},u=n("script"),u.src=t(c),u.async=!0,u.onerror=function(e){return c.error({url:u.src,event:e}),c.complete({url:u.src,event:e},c)},u.onload=u.onreadystatechange=function(){return i||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState?void 0:(i=!0,u.onload=u.onreadystatechange=null,u&&u.parentNode&&u.parentNode.removeChild(u),u=null)},s=s||window.document.getElementsByTagName("head")[0]||window.document.documentElement,s.insertBefore(u,s.firstChild)):void 0},o=function(){return void 0},t=function(e){var t;return t=e.url,t+=e.url.indexOf("?")<0?"?":"&",t+=i(e.data)},a=function(e){var t;for(t="";t.length<e;)t+=s().toString(36)[2];return t},i=function(e){var t,n,o;t=[];for(n in e)o=e[n],t.push(r(n)+"="+r(o));return t.join("&")},"undefined"!=typeof define&&null!==define&&define.amd?define(function(){return e}):"undefined"!=typeof module&&null!==module&&module.exports?module.exports=e:this.JSONP=e}.call(this),/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
function(e,t){"object"==typeof exports&&exports?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Mustache={})}(this,function(e){function t(e){return"function"==typeof e}function n(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function r(e,t){return h.call(e,t)}function o(e){return!r(g,e)}function i(e){return String(e).replace(/[&<>"'\/]/g,function(e){return m[e]})}function s(t,r){function i(){if(j&&!_)for(;m.length;)delete g[m.pop()];else m=[];j=!1,_=!1}function s(e){if("string"==typeof e&&(e=e.split(v,2)),!d(e)||2!==e.length)throw new Error("Invalid tags: "+e);p=new RegExp(n(e[0])+"\\s*"),f=new RegExp("\\s*"+n(e[1])),l=new RegExp("\\s*"+n("}"+e[1]))}if(!t)return[];var p,f,l,h=[],g=[],m=[],j=!1,_=!1;s(r||e.tags);for(var x,O,S,C,E,T,P=new u(t);!P.eos();){if(x=P.pos,S=P.scanUntil(p))for(var N=0,I=S.length;I>N;++N)C=S.charAt(N),o(C)?m.push(g.length):_=!0,g.push(["text",C,x,x+1]),x+=1,"\n"===C&&i();if(!P.scan(p))break;if(j=!0,O=P.scan(b)||"name",P.scan(y),"="===O?(S=P.scanUntil(k),P.scan(k),P.scanUntil(f)):"{"===O?(S=P.scanUntil(l),P.scan(w),P.scanUntil(f),O="&"):S=P.scanUntil(f),!P.scan(f))throw new Error("Unclosed tag at "+P.pos);if(E=[O,S,x,P.pos],g.push(E),"#"===O||"^"===O)h.push(E);else if("/"===O){if(T=h.pop(),!T)throw new Error('Unopened section "'+S+'" at '+x);if(T[1]!==S)throw new Error('Unclosed section "'+T[1]+'" at '+x)}else"name"===O||"{"===O||"&"===O?_=!0:"="===O&&s(S)}if(T=h.pop())throw new Error('Unclosed section "'+T[1]+'" at '+P.pos);return c(a(g))}function a(e){for(var t,n,r=[],o=0,i=e.length;i>o;++o)t=e[o],t&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(r.push(t),n=t));return r}function c(e){for(var t,n,r=[],o=r,i=[],s=0,a=e.length;a>s;++s)switch(t=e[s],t[0]){case"#":case"^":o.push(t),i.push(t),o=t[4]=[];break;case"/":n=i.pop(),n[5]=t[2],o=i.length>0?i[i.length-1][4]:r;break;default:o.push(t)}return r}function u(e){this.string=e,this.tail=e,this.pos=0}function p(e,t){this.view=null==e?{}:e,this.cache={".":this.view},this.parent=t}function f(){this.cache={}}var l=Object.prototype.toString,d=Array.isArray||function(e){return"[object Array]"===l.call(e)},h=RegExp.prototype.test,g=/\S/,m={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},y=/\s*/,v=/\s+/,k=/\s*=/,w=/\s*\}/,b=/#|\^|\/|>|\{|&|=|!/;u.prototype.eos=function(){return""===this.tail},u.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},u.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},p.prototype.push=function(e){return new p(e,this)},p.prototype.lookup=function(e){var n,r=this.cache;if(e in r)n=r[e];else{for(var o,i,s=this;s;){if(e.indexOf(".")>0)for(n=s.view,o=e.split("."),i=0;null!=n&&i<o.length;)n=n[o[i++]];else"object"==typeof s.view&&(n=s.view[e]);if(null!=n)break;s=s.parent}r[e]=n}return t(n)&&(n=n.call(this.view)),n},f.prototype.clearCache=function(){this.cache={}},f.prototype.parse=function(e,t){var n=this.cache,r=n[e];return null==r&&(r=n[e]=s(e,t)),r},f.prototype.render=function(e,t,n){var r=this.parse(e),o=t instanceof p?t:new p(t);return this.renderTokens(r,o,n,e)},f.prototype.renderTokens=function(e,t,n,r){for(var o,i,s,a="",c=0,u=e.length;u>c;++c)s=void 0,o=e[c],i=o[0],"#"===i?s=this._renderSection(o,t,n,r):"^"===i?s=this._renderInverted(o,t,n,r):">"===i?s=this._renderPartial(o,t,n,r):"&"===i?s=this._unescapedValue(o,t):"name"===i?s=this._escapedValue(o,t):"text"===i&&(s=this._rawValue(o)),void 0!==s&&(a+=s);return a},f.prototype._renderSection=function(e,n,r,o){function i(e){return s.render(e,n,r)}var s=this,a="",c=n.lookup(e[1]);if(c){if(d(c))for(var u=0,p=c.length;p>u;++u)a+=this.renderTokens(e[4],n.push(c[u]),r,o);else if("object"==typeof c||"string"==typeof c)a+=this.renderTokens(e[4],n.push(c),r,o);else if(t(c)){if("string"!=typeof o)throw new Error("Cannot use higher-order sections without the original template");c=c.call(n.view,o.slice(e[3],e[5]),i),null!=c&&(a+=c)}else a+=this.renderTokens(e[4],n,r,o);return a}},f.prototype._renderInverted=function(e,t,n,r){var o=t.lookup(e[1]);return!o||d(o)&&0===o.length?this.renderTokens(e[4],t,n,r):void 0},f.prototype._renderPartial=function(e,n,r){if(r){var o=t(r)?r(e[1]):r[e[1]];return null!=o?this.renderTokens(this.parse(o),n,r,o):void 0}},f.prototype._unescapedValue=function(e,t){var n=t.lookup(e[1]);return null!=n?n:void 0},f.prototype._escapedValue=function(t,n){var r=n.lookup(t[1]);return null!=r?e.escape(r):void 0},f.prototype._rawValue=function(e){return e[1]},e.name="mustache.js",e.version="1.1.0",e.tags=["{{","}}"];var j=new f;e.clearCache=function(){return j.clearCache()},e.parse=function(e,t){return j.parse(e,t)},e.render=function(e,t,n){return j.render(e,t,n)},e.to_html=function(n,r,o,i){var s=e.render(n,r,o);return t(i)?void i(s):s},e.escape=i,e.Scanner=u,e.Context=p,e.Writer=f})}.apply(okanjo),function(e,t){var n=e.metrics={_trackers:{},_gaq:[],events:{},addGoogleTracker:function(e,r){var o=t._gaq||n._gaq;r||(r="tracker_"+n._trackers.length),o.push(function(){t._gat._createTracker(e,r)}),o.push([r+"._setDomainName",t.location.host]),o.push([r+"._setAllowLinker",!0])},addDefaultTracker:function(e){n.addTracker(e,function(r){"undefined"==typeof r.type&&(r.type="event"),(t._gaq||n._gaq).push([e+"."+("pageview"==r.type?"_trackPageview":"_trackEvent")].concat(r.args))})},addTracker:function(e,t){n._trackers[e]=t},trackEvent:function(){n.track({type:"event",args:arguments})},trackPageView:function(){this.track({type:"pageview",args:arguments})},track:function(e){for(var t in n._trackers)n._trackers.hasOwnProperty(t)&&n._trackers[t](e)}};!function(){if(!document.getElementById("#okanjo-metrics")){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",t.id="okanjo-metrics",e.qwery("body")[0].appendChild(t),n.addGoogleTracker(e.config.analyticsId,"okanjo")}n.addDefaultTracker("okanjo")}()}(okanjo,this),function(e,t){var n=e.Cache,r=e.Product=function(e,t){if(!e||"object"!=typeof e||void 0===e.nodeType)throw new Error("Invalid element - must be a valid DOM element");if("undefined"!=typeof t&&"object"!=typeof t)throw new Error("Invalid configuration, must be an object or nothing at all, got: "+typeof t);t=t||{},this.items=[],this.element=e,this.config=t||{mode:this.modes.browse,use_cache:!0,cache_ttl:6e4},this.config.nag=void 0===t.nag?!0:t.nag===!0,this.config.use_cache=void 0===t.use_cache?!0:t.use_cache===!0,this.config.cache_ttl=void 0===t.cache_ttl?6e4:t.cache_ttl,t.no_init||this.init()};return r.prototype={cache_key_prefix:"ok_product_block_",modes:{browse:"browse",sense:"sense",single:"single"},templates:{error:"okanjo.error",main:"product.block"},css:{main:"product.block"},cacheKeyAttributes:"mode,url,selectors,text,id,q,marketplace_status,marketplace_id,external_id,sku,sold_by,min_price,max_price,condition,manufacturer,upc,isbn,tags,category,min_donation_percent,max_donation_percent,donation_to,suboptimal,skip,take".split(","),constructor:r,init:function(){if(this.findWidgetKey()){this.ensureTemplates(),this.parseConfiguration(),this.config.id||this.config.mode==this.modes.single?this.config.mode=e.util.empty(this.config.id)?this.modes.browse:this.modes.single:(this.config.url||this.config.text||this.config.mode==this.modes.sense)&&(e.util.empty(this.config.url)&&e.util.empty(this.config.text)&&(this.config.url=this.getCurrentPageUrl()),this.config.mode=this.modes.sense),this.config.use_cache&&this.loadProductsFromCache()||this.getProducts();var n=t.location;e.metrics.trackEvent("Okanjo Product Widget","Loaded",n.protocol+"//"+n.hostname+(n.port?":"+n.port:"")+n.pathname);var r=this;setTimeout(function(){r.cleanCache()},2e3)}},ensureTemplates:function(){var t,n=this.templates,r=this.css;for(t in n)if(n.hasOwnProperty(t)&&!e.mvc.isTemplateRegistered(n[t]))throw new Error("[Okanjo] Missing template: "+n[t]);for(t in r)if(r.hasOwnProperty(t)&&!e.mvc.isCssRegistered(r[t]))throw new Error("[Okanjo] Missing css block: "+r[t])},parseConfiguration:function(){var t=e.util.data(this.element);e.util.copyIfSetMap(this.config,t,{mode:"mode",url:"url",selectors:"selectors",text:"text",id:"id",q:"query",marketplace_status:["marketplace-status"],marketplace_id:["marketplace-id"],external_id:"external-id",sku:"sku",sold_by:"sold-by",min_price:"min-price",max_price:"max-price",condition:"condition",manufacturer:"manufacturer",upc:"upc",isbn:"isbn",tags:"tags",category:"category",min_donation_percent:"min-donation-percent",max_donation_percent:"max-donation-percent",donation_to:"donation-to",suboptimal:"suboptimal",skip:["skip","page-start"],take:["take","page-size"]},{stripEmpty:!0})},getCurrentPageUrl:function(){var e=t.location.href,n=Math.min(e.indexOf("?"),e.indexOf("#")),r=n>0?e.substr(0,n):e;return this.config.nag&&console.info("[Okanjo.Product] No canonical url given for ProductSense. We recommend using a canonical url to ensure page visibility by Okanjo. Using derived url:",r),r},getCacheKey:function(){for(var n=[t.location.host+t.location.pathname],r=this.cacheKeyAttributes,o=0;o<r.length;o++)void 0!==this.config[r[o]]&&n.push(r[o],this.config[r[o]]);return this.cache_key_prefix+e.util.hash(n.join(";"))},cleanCache:function(){try{for(var e=(new Date).getTime(),t=[],r=[],o=0;o<n.length;o++){var i=n.key(o);if(0===i.indexOf(this.cache_key_prefix)&&i.indexOf("_expires")<0){var s=n.getItem(i+"_expires");null!==s&&e<parseInt(s)?r.push(i+"_expires"):(n.removeItem(i),n.removeItem(i+"_expires"))}else i.indexOf("_expires")>=0&&t.push(i)}for(o=0;o<t.length;o++)r.indexOf(t[o])<0&&n.removeItem(t[o])}catch(a){ok.report("Product",a)}},loadProductsFromCache:function(){try{var t=this.getCacheKey(),r=n.getItem(t),o=n.getItem(t+"_expires"),i=(new Date).getTime();if(null!==r&&null!==o&&i<parseInt(o))return this.items=JSON.parse(r),this.showProducts(this.items),!0;n.removeItem(t),n.removeItem(t+"_expires")}catch(s){e.report("Product",s)}return!1},getProducts:function(){var t=this;this.executeSearch(function(r,o){r?(console.error("[Okanjo.Product] Failed to retrieve products.",r),t.element.innerHTML=e.mvc.render(t.templates.error,{message:"Could not retrieve products."})):(t.items=o.data,t.showProducts(t.items),setTimeout(function(){if(t.config.use_cache){var e=t.getCacheKey();n.setItem(e,JSON.stringify(t.items)),n.setItem(e+"_expires",(new Date).getTime()+t.config.cache_ttl)}},100))})},findWidgetKey:function(){return e.util.empty(this.config.key)?e.util.empty(e.key)?e.util.empty(this.key)?(this.config.key=this.key,!0):(this.element.innerHTML=e.mvc.render(this.templates.error,{message:"Missing Okanjo key."}),e.report("Product","Missing key. Define one using okanjo.configure or pass the key parameter as an option in the Product constructor"),!1):(this.key=e.key,this.config.key=this.key,!0):(this.key=this.config.key,this.config.key=this.key,!0)},executeSearch:function(t){this.config.mode===this.modes.sense?e.exec(e.getRoute(e.routes.products_sense),this.config,t):this.config.mode===this.modes.single?e.exec(e.getRoute(e.routes.products_id,{product_id:this.config.id}),this.config,function(e,n){!e&&n&&n.data&&(n.data=[n.data]),t&&t(e,n)}):e.exec(e.getRoute(e.routes.products),this.config,t)},showProducts:function(t){this.element.innerHTML=e.mvc.render(this.templates.main,{products:t||this.items||[],config:this.config})}},e.Product}(okanjo,this),okanjo}),function(e){e.mvc.registerCss("okanjo.core","",{id:"okanjo-core"}),e.mvc.registerTemplate("okanjo.error","<span class=okanjo-error>{{ message }}</span> {{#code}} <span class=okanjo-error-code>Reference: {{ code }}</span> {{/code}}",{css:["okanjo.core"]}),e.mvc.registerCss("product.block",'.okanjo-product-block .okanjo-product-list{list-style-type:none;padding:0}.okanjo-product-block .okanjo-product{width:150px;overflow:hidden;text-align:center;border:1px solid #ccc;padding:.5em;display:inline-block;margin:0 .1em;box-shadow:1px 1px 1px 1px #eee}.okanjo-product-block .okanjo-product-image-container{height:150px}.okanjo-product-block .okanjo-product-image{max-width:100%;max-height:100%}.okanjo-product-block .okanjo-product-title-container{margin:.5em;height:4em;overflow:hidden;vertical-align:middle}.okanjo-product-block .okanjo-product-title-container:before{content:"";display:inline-block;height:100%;vertical-align:middle}.okanjo-product-block .okanjo-product-title{vertical-align:middle;display:inline-block}.okanjo-product-block .okanjo-product-meta{height:0;width:0;text-indent:-100%}',{id:"okanjo-product-block"}),e.mvc.registerTemplate("product.block",'<div class=okanjo-product-block><ul class=okanjo-product-list itemscope="" itemtype=http://schema.org/ItemList>{{#products}}<li class=okanjo-product itemscope="" itemtype=http://schema.org/Product><a href="{{#okanjoConfig}}{{#ads}}{{apiUri}}{{/ads}}{{/okanjoConfig}}/metrics/{{ id }}?c=ps&n={{now}}&u={{ escaped_buy_url }}" itemprop=url><div class=okanjo-product-image-container><img class=okanjo-product-image src="{{ image_url }}" title="{{ name }}" itemprop=image></div><div class=okanjo-product-title-container><span class=okanjo-product-title itemprop=name>{{ name }}</span></div><div class=okanjo-product-price-container itemprop=offers itemscope="" itemtype=http://schema.org/Offer><span itemprop=priceCurrency content="{{ currency }}">$</span><span class=okanjo-product-price itemprop=price>{{ price }}</span></div><div class=okanjo-product-meta><img src="{{#okanjoConfig}}{{#ads}}{{apiUri}}{{/ads}}{{/okanjoConfig}}/metrics/{{ id }}?c=ps&n={{now}}" alt=""> {{! Okanjo impression tracking URL }} {{#impression_url}}<img src="{{ impression_url }}" alt="">{{/impression_url}} {{! Vendor impression tracking URL }} {{#sold_by}}<span itemprop=brand>{{brand}}</span>{{/sold_by}} {{#upc}}<span itemprop=productID>upc:{{upc}}</span>{{/upc}} {{#manufacturer}}<span itemprop=manufacturer>{{manufacturer}}</span>{{/manufacturer}}</div></a></li>{{/products}}</ul></div>',function(t,n){return t=t||{products:[],config:{}},n=e.util.clone(n),n.config=t.config,n.products=e.mvc.formats.product(t.products),n},{css:["product.block"]})}(okanjo);
//# sourceMappingURL=okanjo-bundle.min.js.map