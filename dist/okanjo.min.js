/*! okanjo-js v2.3.1 | (c) 2013 Okanjo Partners Inc | https://okanjo.com/ */
!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.okanjo=t()}(this,function(){function L(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&U(e,t)}function U(e,t){return(U=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function z(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=W(n),t=(e=i?(e=W(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===d(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return o(t)}}function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function W(e){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function D(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,t,n){t&&D(e.prototype,t),n&&D(e,n),Object.defineProperty(e,"prototype",{writable:!1})}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function B(e){return"function"==typeof e||"[object Function]"===H.call(e)}function V(e){return e=function(e){e=Number(e);return isNaN(e)?0:0!==e&&isFinite(e)?(0<e?1:-1)*Math.floor(Math.abs(e)):e}(e),Math.min(Math.max(e,0),N)}Array.from||(Array.from=(H=Object.prototype.toString,N=Math.pow(2,53)-1,function(e){var t=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var n,i=1<arguments.length?arguments[1]:void 0;if(void 0!==i){if(!B(i))throw new TypeError("Array.from: when provided, the second argument must be a function");2<arguments.length&&(n=arguments[2])}for(var r,o=V(t.length),a=B(this)?Object(new this(o)):new Array(o),s=0;s<o;)r=t[s],a[s]=i?void 0===n?i(r,s):i.call(n,r,s):r,s+=1;return a.length=o,a})),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var i=arguments[1],r=0;r<n;){var o=t[r];if(e.call(i,o,r,t))return o;r++}}}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var i=arguments[1],r=0;r<n;){var o=t[r];if(e.call(i,o,r,t))return r;r++}return-1}}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),i=n.length>>>0;if(0==i)return!1;var r,o,t=0|t,a=Math.max(0<=t?t:i-Math.abs(t),0);for(;a<i;){if((r=n[a])===(o=e)||"number"==typeof r&&"number"==typeof o&&isNaN(r)&&isNaN(o))return!0;a++}return!1}}),window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(e,t){t=t||window;for(var n=0;n<this.length;n++)e.call(t,this[n],n,this)}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])}return n},writable:!0,configurable:!0}),s=window,l=document,X=void 0!==s.pageXOffset,$="CSS1Compat"===(l.compatMode||""),G=s.navigator.userAgent,J=/[\s\S](?:\.\.\.)?$/,Y=/(iPhone|iPad|iPod|Android|blackberry)/i,c=s.console,(u={version:"2.3.1",metrics:null,key:(s.okanjo||{}).key||null,report:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i,r=t.find(function(e){return e instanceof Error});r?((i=(new Error).stack.split("\n")).shift(),i.shift(),t.push({reportStack:i.join("\n")}),t=t.filter(function(e){return e!==r})):(i=t.findIndex(function(e){return"string"==typeof e}),r=new Error(t[i]||"Okanjo Error"),0<=i&&t.splice(i,1)),c.error("[Okanjo v".concat(u.version,"]: ").concat(r.stack)),t.length&&c.error.apply(c,["Additional information:"].concat(t))},warn:function(e){var t=new Error(e);c.warn("[Okanjo v".concat(u.version,"]: ").concat(t.stack));for(var n=arguments.length,i=new Array(1<n?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];i.length&&c.warn.apply(c,["Additional information:"].concat(i))},qwery:function(e,t){return"string"!=typeof t||(t=l.querySelector(t))?(t=t||l).querySelectorAll(e):[]}}).lib={},u.net={endpoint:"https://api2.okanjo.com",sandboxEndpoint:"https://sandbox-api2.okanjo.com",routes:{ads:"/content",metrics:"/metrics/:object_type/:event_type",metrics_batch:"/metrics"},getRoute:function(t,n,e){return n&&Object.keys(n).forEach(function(e){t=t.replace(":".concat(e),n[e]+"")}),("sandbox"===(e=e||u.env||"live")?u.net.sandboxEndpoint:u.net.endpoint)+t},request:function(){}},u.util={isEmpty:function(e){return null==e||"string"==typeof e&&0===e.trim().length},isMobile:function(){return Y.test(G)},getPageArguments:function(e){function t(e){var i={};return(e=e||"").split("&").forEach(function(e){var t,n=e.indexOf("="),e=n<0?(t=decodeURIComponent(e),null):(t=decodeURIComponent(e.substring(0,n)),decodeURIComponent(e.substring(n+1)));t&&(i[t]=e)}),i}var n=t(s.location.search.substring(s.location.search.indexOf("?")+1)),i=e?t(s.location.hash.substring(Math.max(s.location.hash.indexOf("#")+1,s.location.hash.indexOf("#!")+2))):{};return Object.keys(i).forEach(function(e){return n[e]=i[e]}),n}},u.util.deepClone=function(t,n){return Array.isArray(t)?n=(n=n||[]).concat(t.map(function(e){return u.util.deepClone(e)})):"object"===d(t)&&null!==t?(n=n||{},Object.keys(t).forEach(function(e){n[e]=u.util.deepClone(t[e])})):n=t,n},u.util.flatten=function(e){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r={};return null!=e&&Object.keys(e).forEach(function(t){var n;e[t]instanceof Date?i.dateToIso?r[t]=e[t].toISOString():r[t]=e[t]:"object"!==d(e[t])||null===e[t]||Array.isArray(e[t])&&!0===i.ignoreArrays?r[t]=e[t]:Array.isArray(e[t])&&!0===i.arrayToCsv?r[t]=e[t].join(","):(n=u.util.flatten(e[t],i),Object.keys(n).forEach(function(e){r[t+"_"+e]=n[e]}))}),r},
/*! based on shortid https://github.com/dylang/shortid */
u.util.shortid=(r=s.crypto||s.msCrypto||"function"==typeof require&&require("crypto"),function(){var e="",t=Math.floor(.001*((new Date).getTime()-1490384907498));return t===Q?F++:(F=0,Q=t),e=e+ve(7)+ve(0),0<F&&(e+=ve(F)),e+=ve(t)}),u.util.getLocation=function(){if(s.location===s.parent.location)return s.location.href;try{return s.parent.location.href}catch(e){}return l.referrer||l.referrer},u.ui={getScrollPosition:function(){return{x:X?s.pageXOffset:($?l.documentElement:l.body).scrollLeft,y:X?s.pageYOffset:($?l.documentElement:l.body).scrollTop}},getElementSize:function(e,t){var n={height:e.offsetHeight,width:e.offsetWidth},e=e.currentStyle||s.getComputedStyle(e);return t&&(n.height+=parseInt(e.marginTop)+parseInt(e.marginBottom),n.width+=parseInt(e.marginLeft)+parseInt(e.marginRight)),n},getPageSize:function(){var e=l.querySelector("body"),t=l.documentElement;return{w:Math.max(e.scrollWidth,e.offsetWidth,t.clientWidth,t.scrollWidth,t.offsetWidth),h:Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight)}},getViewportSize:function(){var e=$?l.documentElement:l.body,t=e.clientWidth,e=e.clientHeight,n=s.innerWidth||0,i=s.innerHeight||0,r=n&&n<t||i&&i<e;return{vw:r?n:t,vh:r?i:e}},getEventPosition:function(e){var t=e.pageX,n=e.pageY,i=l.body,r=l.documentElement,o="scrollLeft",a="scrollTop";return{et:e.__proto__.constructor.name,ex:void 0===t?e.clientX+i[o]+r[o]:t,ey:void 0===n?e.clientY+i[a]+r[a]:n}},getElementPosition:function(t){var n="Could not get position of element. Did you attach the element to the DOM before initializing?";try{var e=t.getBoundingClientRect(),i=l.body.getBoundingClientRect();return l.body.contains(t)||u.report(n,t),{x1:e.left-i.left,y1:e.top-i.top,x2:e.right-i.left,y2:e.bottom-i.top}}catch(e){return u.report(n,{exception:e,element:t}),{x1:0,y1:0,x2:0,y2:0,err:1}}},_getIntersection:function(e,t,n){var i=Math.max(e.x1,t.x),r=Math.min(e.x2,t.x+n.vw),o=Math.max(e.y1,t.y),t=Math.min(e.y2,t.y+n.vh);return{intersectionArea:Math.max(0,r-i)*Math.max(0,t-o),elementArea:(e.x2-e.x1)*(e.y2-e.y1)}},isElementVisible:function(e){return 0<e.offsetWidth&&0<e.offsetHeight},getPercentageInViewport:function(e){var e=u.ui.getElementPosition(e),t=u.ui.getScrollPosition(),n=u.ui.getViewportSize();if(e.err)return 0;e=u.ui._getIntersection(e,t,n),t=e.intersectionArea,n=e.elementArea;return n<=0?0:t/n}},u.ui.ellipsify=function(e,t){function n(e){return s=e.substring(0,e.length-3)+s,"..."}for(var i,t=t||e.parentNode,r=u.ui.getElementSize(t).height,o=void 0!==e.textContent,a=o?e.textContent:e.innerText,s="",c=5e3;u.ui.getElementSize(e).height>r&&0<a.length&&0<c--;)a=(a=o?e.textContent:e.innerText).replace(J,n),o?e.textContent=a:e.innerText=a;0<s.length&&(t=l.createElement("span"),i=l.createElement("span"),t.setAttribute("class","okanjo-ellipses"),i.setAttribute("class","okanjo-visually-hidden"),o?(t.textContent=a.substring(0,a.length-3),i.textContent=s):(t.innerText=a.substring(0,a.length-3),i.innerText=s),e.innerHTML="",e.appendChild(t),e.appendChild(i))},u.ui.fitImages=function(e){"objectFit"in l.documentElement.style||e.querySelectorAll("img.okanjo-fit").forEach(function(e){e.style.display="none";var t=e.parentNode;t.style.backgroundSize="cover",t.style.backgroundImage="url("+e.src+")",t.style.backgroundposition="center center"})};var H,N,s,l,F,Q,r,X,$,G,J,Y,c,u,K,Z,h,f,t,i,p,ee,g,m,te,ne,y,v,_,ie,re,oe,b,k,w,ae,j,x,se,ce,le,C,ue,he,E,O,e,T,de,fe,A,S,pe,P,M,ge,me,I,R,q,ye=s.okanjo=u;function ve(e){for(var t,n=0,i="";!t;)i+="ylZM7VHLvOFcohp01x-fXNr8P_tqin6RkgWGm4SIDdK5s2TAJebzQEBUwuY9j3aC"[e>>4*n&15|function(){if(r&&r.randomBytes)return 48&r.randomBytes(1)[0];if(!r||!r.getRandomValues)return 48&Math.floor(256*Math.random());var e=new Uint8Array(1);return r.getRandomValues(e),48&e[0]}()],t=e<Math.pow(16,n+1),n++;return i}function _e(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}function be(){m.style.height=oe()-80+"px"}function ke(){b(g,"okanjo-modal-fade-out"),setTimeout(function(){k(g,"okanjo-modal-fade-out"),b(g,"okanjo-modal-hidden"),k(p,"okanjo-modal-active"),ie||k(p,"okanjo-modal-margin-fix")},210)}return function(s){function a(e,t){return t?"".concat(t,"[").concat(u(e),"]"):u(e)}var c=/^application\/json/,l=s.okanjo,u=(l.net.request=function(e,t,n,i){"function"==typeof n&&(i=n,n=void 0);function r(e,t){a||(a=!0,i(e,t))}var o=new(s.XMLHttpRequest||s.ActiveXObject)("MSXML2.XMLHTTP.3.0"),a=!1;l.net.request.timeout&&(o.timeout=l.net.request.timeout),o.ontimeout=function(e){r({statusCode:504,error:"Request timed out",message:"Something went wrong",attributes:{event:e,xhr:o}})},o.onreadystatechange=function(e){var t;4===o.readyState&&(0<o.status?(t=c.test(o.getResponseHeader("Content-Type"))?JSON.parse(o.responseText):{statusCode:o.status,data:o.responseText},200<=o.status&&o.status<300?r(null,t):r(t)):r({statusCode:503,error:"Request failed",message:"Something went wrong",attributes:{event:e,xhr:o}}))},o.open(e.toUpperCase(),t),o.withCredentials=!0,["POST","PUT","PATCH"].includes(e.toUpperCase())&&(o.setRequestHeader("Content-Type","application/json; charset=utf-8"),void 0!==n&&(n=JSON.stringify(n))),o.send(n||void 0)},l.net.request.get=l.net.request.bind(this,"GET"),l.net.request.post=l.net.request.bind(this,"POST"),l.net.request.put=l.net.request.bind(this,"PUT"),l.net.request.delete=l.net.request.bind(this,"DELETE"),function(e){return null==e?"":encodeURIComponent(""+e)});l.net.request.stringify=function(i,r){var o=[];return r=r||"",Object.keys(i).forEach(function(t){var e,n=i[t];Array.isArray(n)?n.forEach(function(e){return o.push(a(t,r)+"="+u(e))}):"object"===d(n)&&null!==n?(e=l.net.request.stringify(n,a(t,r)))&&o.push(e):void 0!==n&&o.push(a(t,r)+"="+u(n))}),o.join("&")}}(window),K=window,Z=document,K.okanjo.util.cookie={set:function(e,t,n){var i=new Date,n=(i.setDate(i.getDate()+n),n?" Expires="+i.toUTCString()+";":""),i="https:"===K.location.protocol?" Secure;":"",t="".concat(encodeURI(t),";").concat(n).concat(i," SameSite=None;").concat(" Path=/");Z.cookie=e+"="+t},get:function(n){var i=null;return Z.cookie.split(";").find(function(e){var t=e.substr(0,e.indexOf("=")).trim(),e=e.substr(e.indexOf("=")+1);return t===n&&(i=decodeURI(e),!0)}),i}},I=window,h=document,f=I.okanjo,(I=function(){function e(){a(this,e),this._templates={},this._css={},this.classDetects=""}return n(e,[{key:"registerTemplate",value:function(e,t,n,i){if("object"===d(t)){if(void 0===t.nodeType)throw new Error("Parameter template must be a string or a DOM element");t=t.innerHTML,f.lib.Mustache.parse(t)}else if("string"!=typeof t)throw new Error("Parameter template must be a string or a DOM element");if(3===arguments.length&&"object"===d(n)?(i=n,n=null):i=i||{},n&&"function"!=typeof n)throw new Error("Parameter beforeRender must be a function");this._templates[e]={markup:t,options:i,beforeRender:n}}},{key:"registerCss",value:function(e,t,n){if(n=n||{},"object"===d(t)){if(void 0===t.nodeType)throw new Error("Parameter css must be a string or a DOM element")}else if("string"!=typeof t)throw new Error("Parameter css must be a string or a DOM element");this._css[e]={markup:t,options:n}}},{key:"isTemplateRegistered",value:function(e){return!!this._templates[e]}},{key:"isCssRegistered",value:function(e){return!!this._css[e]}},{key:"ensureCss",value:function(e){var t,n,i,r;this._css[e]?(r=void 0===(t=this._css[e]).markup.nodeType?t.options.id||"okanjo-css-"+e:null)&&!h.querySelector("#"+r.replace(/\./g,"\\."))&&(n=h.head,(i=h.createElement("style")).id=r,i.setAttribute("type","text/css"),i.hasOwnProperty?i.textContent=t.markup:i.styleSheet.cssText=t.markup,n?n.appendChild(i):(r=h.body)?r.appendChild(i):f.report("Cannot add CSS template to document. Does it not have a body or head?")):f.report('Attempted to add CSS template "'+e+'" to the DOM, however it does not appear to be registered?')}},{key:"ensureExternalCss",value:function(e){var t,n,i="okanjo-custom-css-"+e;h.getElementById(i)||(t=h.head,(n=h.createElement("link")).id=i,n.setAttribute("rel","stylesheet"),n.setAttribute("href",e),t?t.appendChild(n):(i=h.body)?i.appendChild(n):f.report("Cannot add custom CSS stylesheet to document. Does it not have a body or head?"))}},{key:"render",value:function(e,t,n){var i=this,e=(n=n||{},this._templates[e]);return(n=e.beforeRender?e.beforeRender.call(t,n):n).okanjo=f,n.okanjoMetricUrl=f.net.endpoint.replace(/^https?:\/\//,""),n.now=function(){return(new Date).getTime()},n.classDetects=this.classDetects,n.blockClasses&&Array.isArray(n.blockClasses)&&(n.classDetects+=" "+n.blockClasses.join(" "),delete n.blockClasses),!1!==n.css&&e.options.css&&0<e.options.css.length&&(e.options.css.forEach(function(e){return i.ensureCss(e)}),delete n.css),f.lib.Mustache.render(e.markup,n)}}]),e}()).formatCurrency=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:2,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:".",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:",",r=e<0?"-":"",o=parseInt(e=Math.abs(+e||0).toFixed(t))+"",a=o.length;return r+((a=3<a?a%3:0)?o.substr(0,a)+i:"")+o.substr(a).replace(/(\d{3})(?=\d)/g,"$1"+i)+(t?n+Math.abs(e-o).toFixed(t).slice(2):"")},f.ui.engine=new I,t=window,i=document,I=t.okanjo,ie=I.util.isMobile(),re=!1,oe=function(){return t.innerHeight||i.documentElement.clientHeight},b=function(e,t){e.className+=" "+t},k=function(e,t){e.className=e.className.replace(new RegExp(" *?"+t),"")},I.ui.modal={show:function(e){re||(re=!0,p=i.documentElement||i.querySelector("html"),ee=i.body||i.querySelector("body"),g=i.createElement("div"),m=i.createElement("div"),te=i.createElement("div"),ne=i.createElement("div"),y=i.createElement("div"),v=i.createElement("div"),_=i.createElement("iframe"),g.setAttribute("class","okanjo-modal-container okanjo-modal-hidden "),m.setAttribute("class","okanjo-modal-window"),te.setAttribute("class","okanjo-modal-window-skin"),ne.setAttribute("class","okanjo-modal-window-outer"),y.setAttribute("class","okanjo-modal-window-inner"),v.setAttribute("class","okanjo-modal-close-button"),_.setAttribute("class","okanjo-inline-buy-frame"),_.setAttribute("frameborder","0"),_.setAttribute("vspace","0"),_.setAttribute("hspace","0"),_.setAttribute("webkitallowfullscreen",""),_.setAttribute("mozallowfullscreen",""),_.setAttribute("allowfullscreen",""),_.setAttribute("scrolling","auto"),v.innerHTML="×",y.appendChild(_),ne.appendChild(y),te.appendChild(ne),m.appendChild(te),m.appendChild(v),g.appendChild(m),ee.appendChild(g),_e(t,"orientationchange",function(){for(var e=0;e<2;e++)setTimeout(be,1e3*e+10)}),_e(t,"resize",function(){setTimeout(be,100)}),_e(g,"click",ke),_e(m,"click",function(e){e.preventDefault(),e.stopPropagation()}),_e(v,"click",function(e){e.preventDefault(),e.stopPropagation(),ke()})),e=e,y.innerHTML="","string"==typeof e?y.innerHTML=e:y.appendChild(e),k(g,"okanjo-modal-hidden"),b(g,"okanjo-modal-fade-out"),be(),b(p,"okanjo-modal-active"),ie||b(p,"okanjo-modal-margin-fix"),setTimeout(function(){k(g,"okanjo-modal-fade-out")},10)},hide:function(){ke()}},I.ui.modal,w=window,ae=document,j=w.okanjo,(x=function(){function r(){a(this,r),this._queue=this._getStoredQueue(),this._processTimeout=null,this.pageId=j.util.shortid(),this.defaultChannel=r.Channel.external,this.sid=null,this.sourceCh=null,this.sourceCx=null,this._checkUrlForReferral()}return n(r,[{key:"_getStoredQueue",value:function(){if(!w.localStorage[r.Params.queue])return[];try{var e=JSON.parse(w.localStorage[r.Params.queue]);return Array.isArray(e)?e:(j.report("Stored queue is not a queue",{queue:e}),[])}catch(e){return j.report("Failed to load metric queue from storage",{err:e}),[]}}},{key:"_saveQueue",value:function(e){var t=this;e?(this._saveQueueTimeout&&clearTimeout(this._saveQueueTimeout),this._saveQueueTimeout=setTimeout(function(){t._saveQueue(!1),t._saveQueueTimeout=null},100)):w.localStorage[r.Params.queue]=JSON.stringify(this._queue)}},{key:"_checkUrlForReferral",value:function(){var e=j.util.getPageArguments(!0),t=e[r.Params.name],n=w.localStorage[r.Params.name]||j.util.cookie.get(r.Params.name),i=e[r.Params.context],e=e[r.Params.channel];t&&n&&t!==n&&this.trackEvent({object_type:r.Object.metric_session,event_type:r.Event.correlation,id:t+"_"+n,ch:this.defaultChannel,_noProcess:!0}),this.sid=n||t||null,this.sourceCh=e||null,this.sourceCx=i||null}},{key:"trackEvent",value:function(e,t){e.object_type&&e.event_type?this._push(e,t):j.report("Invalid metric to track (missing object_type or event_type)",{event:e})}},{key:"trackPageView",value:function(e,t){(e=e||{}).object_type=r.Object.page,e.event_type=r.Event.view,e.id=e.id||j.util.getLocation(),e.ch=e.ch||this.defaultChannel,this.trackEvent(e,t)}},{key:"_push",value:function(e,t){this._queue.push({event:e,callback:t}),this._saveQueue(!0),e._noProcess?delete e._noProcess:this._processQueue()}},{key:"_processQueue",value:function(){var i=this;!this._processTimeout&&0<this._queue.length&&(this._processTimeout=setTimeout(function(){var e=i._queue.splice(0,255);i._saveQueue(!1),i._batchSend(e,function(t,n){n&&n.data&&n.data.sid&&i._updateSid(n.data.sid),i._processTimeout=null,i._processQueue(),e.forEach(function(e){e.callback&&e.callback(t,n)})})},0))}},{key:"_batchSend",value:function(n,i){var t=this,e={events:n.map(function(e){return t._normalizeEvent(e.event),delete e.event.sid,delete e.event.win,e.event}),win:j.util.getLocation()},r=j.net.getRoute(j.net.routes.metrics_batch);this.sid&&(e.sid=this.sid),j.net.request.post(r,e,function(e,t){e&&j.report("Failed to send metrics batch",{err:e,res:t,items:n,route:r}),i&&i(e,t)})}},{key:"_normalizeEvent",value:function(t){t.m=t.m||{},t.key=t.key||t.m.key||j.key||void 0,this.sid&&(t.sid=this.sid),t.m=Object.assign({},t.m),Object.keys(r.Meta.exclude).forEach(function(e){return delete t.m[e]}),this.sourceCh&&(t.m.ref_ch=this.sourceCh),this.sourceCx&&(t.m.ref_cx=this.sourceCx),t.m.pgid=this.pageId,t.m.ok_ver=j.version,t.m=j.util.flatten(t.m,{arrayToCsv:!0}),Object.keys(t.m).forEach(function(e){"string"==typeof t.m[e]&&(t.m[e]=t.m[e].substr(0,255))}),ae.referrer&&(t.ref=ae.referrer),t.win=j.util.getLocation()}},{key:"_updateSid",value:function(e){!e||this.sid&&this.sid===e||(this.sid=e,w.localStorage[r.Params.name]=e,j.util.cookie.set(r.Params.name,e,r.Params.ttl))}},{key:"create",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.create.apply(null,t)}}],[{key:"addElementInfo",value:function(e,t){var n=j.ui.getPageSize(),e=j.ui.getElementPosition(e);return(t=t||{}).m=t.m||{},t.m.pw=n.w,t.m.ph=n.h,t.m.x1=e.x1,t.m.y1=e.y1,t.m.x2=e.x2,t.m.y2=e.y2,t}},{key:"addWidgetInfo",value:function(e,t){function n(e,t){return void 0===t||e<t?e:t}function i(e,t){return void 0===t||t<e?e:t}function r(e,t){return void 0===e?t:e}var o,a,s,c,l,u=j.ui.getElementPosition(e),e=((t=t||{}).m=t.m||{},t.m.wox1=u.x1,t.m.woy1=u.y1,t.m.wox2=u.x2,t.m.woy2=u.y2,j.qwery(".okanjo-resource, .okanjo-adx-container",e)),h=[];return e.forEach(function(e){o=j.ui.getElementPosition(e),a=n(o.x1,a),s=n(o.y1,s),c=i(o.x2,c),l=i(o.y2,l),h.push(o.x1,o.y1,o.x2,o.y2)}),t.m.wix1=r(a,u.x1),t.m.wiy1=r(s,u.y1),t.m.wix2=r(c,u.x2),t.m.wiy2=r(l,u.y2),t.m.wrps=h.map(function(e){return Math.floor(e)}).join(","),t}},{key:"addViewportInfo",value:function(e){var t=j.ui.getViewportSize(),n=j.ui.getScrollPosition();return(e=e||{}).m=e.m||{},e.m.vx1=n.x,e.m.vy1=n.y,e.m.vx2=n.x+t.vw,e.m.vy2=n.y+t.vh,e}},{key:"addEventInfo",value:function(e,t){e=j.ui.getEventPosition(e);return(t=t||{}).m=t.m||{},t.m.et=e.et,t.m.ex=e.ex,t.m.ey=e.ey,t}},{key:"addEventMeta",value:function(e){(e=e||{}).m=e.m||{};for(var t=arguments.length,n=new Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return e.m=Object.assign.apply(Object,[e.m].concat(n)),e}},{key:"create",value:function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return new se(e,n)}}]),r}()).Params={queue:"_ok_q",name:"ok_msid",channel:"ok_ch",context:"ok_cx",ttl:1460},x.Meta={exclude:["key","callback","metrics_channel_context","metrics_context","mode"]},x.Event={view:"vw",impression:"imp",interaction:"int",correlation:"cor"},x.Action={click:"click",inline_click:"inline_click"},x.Object={article:"am",thirdparty_ad:"ta",cart:"ct",page:"pg",widget:"wg",product:"pr",store:"st",cause:"ca",marketplace:"mp",order:"or",order_item:"oi",user:"ur",metric_session:"mt"},x.Channel={placement:"pw",marketplace:"mp",external:"ex",product_widget:"pw",ad_widget:"aw",store_widget:"sw"},x.Environment={live:"live",testing:"testing"},se=function(){function i(e,t){var n=this;a(this,i),this.data(e=e||{}),Array.isArray(t)&&t.forEach(function(e){n.data(e)})}return n(i,[{key:"data",value:function(e){return Object.assign(this,j.util.deepClone(e)),this}},{key:"event",value:function(e){return x.addEventInfo(e,this),this}},{key:"viewport",value:function(){return x.addViewportInfo(this),this}},{key:"element",value:function(e){return x.addElementInfo(e,this),this}},{key:"widget",value:function(e){return x.addWidgetInfo(e,this),this}},{key:"meta",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return x.addEventMeta.apply(null,[this].concat(t)),this}},{key:"type",value:function(e,t){return this.object_type=e,this.event_type=t,this}},{key:"send",value:function(e){j.metrics.trackEvent(this,e)}},{key:"toUrl",value:function(){var e=Object.assign({},this),t=e.object_type,n=e.event_type;return delete e.object_type,delete e.event_type,j.metrics._normalizeEvent(e),j.net.getRoute(j.net.routes.metrics,{object_type:t,event_type:n})+"?"+j.net.request.stringify(e)}}]),i}(),j.metrics=new x,(ce=window.okanjo).metrics.trackPageView({_noProcess:!0}),setTimeout(function(){ce.metrics._processQueue()},1e3),I=window,q=function(){function e(){a(this,e),this._events={}}return n(e,[{key:"on",value:function(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t)}},{key:"removeListener",value:function(e,t){this._events[e]&&0<=(t=this._events[e].indexOf(t))&&this._events[e].splice(t,1)}},{key:"emit",value:function(e){var t,n,i,r=[].slice.call(arguments,1);if(this._events[e])for(i=(n=this._events[e].slice()).length,t=0;t<i;t++)n[t].apply(this,r)}},{key:"once",value:function(n,i){var r=arguments,o=this;this.on(n,function e(){var t=[].slice.call(r,1);o.removeListener(n,e),i.apply(o,t)})}}]),e}(),I.okanjo._EventEmitter=q,le=window,C=le.okanjo,ue=/^data-(.+)$/,he=/-/g,(I=function(){L(r,C._EventEmitter);var i=z(r);function r(e,t){var n;if(a(this,r),n=i.call(this),e&&null!==e&&void 0!==e.nodeType)return t=t&&"object"!==d(t)?(C.report("Invalid widget options. Expected object, got: "+d(t),{widget:o(n),element:e,options:t}),{}):t||{},n.name="Widget",n.element=e,n.instanceId=C.util.shortid(),n.config=Object.assign({},t),n;throw C.report("Invalid or missing element on widget construction",{widget:o(n),element:e,options:t}),new Error("Okanjo: Invalid element - make sure to pass a valid DOM element when constructing Okanjo Widgets.")}return n(r,[{key:"init",value:function(){this._applyConfiguration(),this._setCompatibilityOptions(),this._ensurePlacementKey()&&this.load()}},{key:"_setCompatibilityOptions",value:function(){}},{key:"getSettings",value:function(){return{}}},{key:"load",value:function(){}},{key:"_applyConfiguration",value:function(){var n=this,i=this.getDataAttributes(),r=this.getSettings();Object.keys(i).forEach(function(e){var t=e.replace(he,"_"),e=i[e];r[t]&&(e=r[t].value(e,!1)),C.util.isEmpty(e)||(n.config[t]=e)}),Object.keys(r).forEach(function(e){void 0===n.config[e]&&void 0!==r[e]._default&&(n.config[e]=r[e].value(void 0,!1))})}},{key:"getConfig",value:function(){var r=this,o=this.getSettings(),a={};return Object.keys(this.config).forEach(function(e){var t=r.config[e],n=null,i=(o[e]&&(t=o[e].value(t),n=o[e].getGroup()),a);n&&(i[n]=i[n]||{},i=i[n]),null===t?i[e]="":void 0!==t&&(i[e]=t)}),a}},{key:"_ensurePlacementKey",value:function(){return!!this.config.key||(C.key?(this.config.key=C.key,!0):(C.report("No key provided on widget",{widget:this}),this.showError("Error: Missing placement key."),!1))}},{key:"showError",value:function(e){this.setMarkup(C.ui.engine.render("okanjo.error",this,{message:e}))}},{key:"setMarkup",value:function(e){this.element.innerHTML=e,this.setFlexClasses()}},{key:"setFlexClasses",value:function(){var e=this.config.align,t=this.config.justify;e&&this.element.classList.add("okanjo-align-"+e),t&&this.element.classList.add("okanjo-justify-"+t)}},{key:"getDataAttributes",value:function(){var n={};return Array.from(this.element.attributes).forEach(function(e){var t=ue.exec(e.name);t&&(n[t[1]]=e.value)}),n}}],[{key:"getCurrentPageUrl",value:function(){return le.location.href.replace(/([?#].*)$/,"")}}]),r}()).Field=function(){function t(){a(this,t),this._convert=null,this._strip=!1,this._default=void 0,this._group=null}return n(t,[{key:"array",value:function(t){return this._convert=function(e){return Array.isArray(e)?t?e.map(function(e){return t(e)}):e:(e=e.replace(/\\,/g,"\0")).split(",").map(function(e){e=e.trim().replace("\0",",");return e=t?t(e):e})},this}},{key:"string",value:function(){return this._convert=function(e){return null==e?e:""+e},this}},{key:"bool",value:function(){return this._convert=function(e){return"string"==typeof e?"1"===e||"true"===e.toLowerCase():!!e},this}},{key:"strip",value:function(){return this._strip=!0,this}},{key:"int",value:function(){return this._convert=function(e){return parseInt(e)},this}},{key:"float",value:function(){return this._convert=function(e){return parseFloat(e)},this}},{key:"default",value:function(e){return this._default=e,this}},{key:"group",value:function(e){return this._group=e,this}},{key:"getGroup",value:function(){return this._group}},{key:"value",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(!this._strip||!t)return void 0!==(e=void 0!==e&&this._convert?this._convert(e):e)?e:this._default}}],[{key:"array",value:function(e){return(new t).array(e)}},{key:"string",value:function(){return(new t).string()}},{key:"bool",value:function(){return(new t).bool()}},{key:"strip",value:function(){return(new t).strip()}},{key:"int",value:function(){return(new t).int()}},{key:"float",value:function(){return(new t).float()}}]),t}(),C._Widget=I,E=window,O=E.okanjo,q=O._Widget.Field,e=q.string,T=q.array,de=q.float,fe=q.int,A=q.bool,S=O.metrics.constructor,pe=O.ui.engine.constructor,P="filters",M="display",ge="article_meta",(q=function(){L(l,O._Widget);var i=z(l);function l(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return a(this,l),n=O.util.flatten(n,{ignoreArrays:!0}),(t=i.call(this,e,n)).name="Placement",t._metricBase={},t._response=null,t._viewWatcherIv=null,t._viewedWatchers=[],n.no_init||t.init(),t}return n(l,[{key:"getSettings",value:function(){return{type:e().group(P),ids:T().group(P),q:e().group(P),url:e().group(P),url_referrer:e().group(P).strip(),url_selectors:e().group(P),url_paths:T().group(P),not_url_paths:T().group(P),organization_id:e().group(P),property_id:e().group(P),store_id:e().group(P),organization_name:e().group(P),property_name:e().group(P),store_name:e().group(P),external_id:e().group(P),sku:e().group(P),external_store_id:e().group(P),condition:e().group(P),manufacturer:e().group(P),upc:e().group(P),isbn:e().group(P),tags:T().group(P),category:T().group(P),pools:T().group(P),min_price:de().group(P),max_price:de().group(P),min_donation_percent:de().group(P),max_donation_percent:de().group(P),donation_to:e().group(P),sort_by:e().group(P),sort_direction:e().group(P),skip:fe().group(P),take:fe().group(P),placement_tests_only:A(),size:e().group(M),template_name:e().group(M),template_layout:e().group(M),template_theme:e().group(M),template_variant:e().group(M),template_cta_style:e().group(M),template_cta_text:e().group(M),template_cta_color:e().group(M),adx_unit_path:e().group(M),align:e().group(M),justify:e().group(M),custom_css_url:e().group(M),custom_css:e().group(M),url_category:T().group(ge),url_keywords:T().group(ge),key:e().strip(),no_init:A().strip(),no_css:A().strip(),verbose_click_data:A().strip().default(!1),utm_click_data:A().strip().default(!0),proxy_url:e().strip(),expandable:A().strip().default(!0),disable_inline_buy:A().strip().default(!1),disable_popup:A().strip().default(!1),backwards:e().strip(),testing:A().strip()}}},{key:"getConfig",value:function(){var s=this,c=this.getSettings(),l={filters:{},display:{},backfill:{},shortfill:{},article_meta:{}},u=/^backfill_(.+)$/,h=/^shortfill_(.+)$/;return Object.keys(this.config).forEach(function(e){var t=s.config[e],n=e,i=!1,r=!1,o=null,a=u.exec(e),e=(a?(n=a[1],i=!0):(a=h.exec(e))&&(n=a[1],r=!0),c[n]&&(t=c[n].value(t),o=c[n].getGroup()),l);i?e=l.backfill:r&&(e=l.shortfill),!r&&o&&(e[o]=e[o]||{},e=e[o]),null===t?e[n]="":void 0!==t&&(e[n]=t)}),l}},{key:"load",value:function(){var t=this;this._setMetricBase(),this._fetchContent(function(e){e?t._reportWidgetLoad("fetch failed: "+e.statusCode||e.toString()):(t._mergeResponseSettings(),t._updateBaseMetaFromResponse(),t._showContent())})}},{key:"_setMetricBase",value:function(){var e=this._metricBase;e.ch=S.Channel.placement,e.cx=this.config.backwards||"auto",e.key=this.config.key,e.m=e.m||{},e.m.wgid=this.instanceId,this.config.testing&&(e.env=S.Environment.testing)}},{key:"_reportWidgetLoad",value:function(e){var t=this,n=(this._response||{}).data||{results:[]};this._metricBase.m.decl=e||"0",this._metricBase.m.res_bf=n.backfilled?1:0,this._metricBase.m.res_sf=n.shortfilled?1:0,this._metricBase.m.res_spltfl=n.splitfilled?1:0,this._metricBase.m.res_total=n.total||0,this._metricBase.m.res_type=n.type,this._metricBase.m.res_length=n.results.length,O.metrics.create(this._metricBase).type(S.Object.widget,S.Event.impression).meta(this.getConfig()).element(this.element).viewport().widget(this.element).send(),this._addOnceViewedHandler(this.element,function(){O.metrics.create(t._metricBase).type(S.Object.widget,S.Event.view).meta(t.getConfig()).element(t.element).viewport().widget(t.element).send()})}},{key:"_fetchContent",value:function(n){var i=this,e=this.getConfig(),t=this.config.key;O.metrics.sid&&(e.sid=O.metrics.sid),e.filters.url_referrer=this.config.url_referrer||E.location.href,e.wgid=this.instanceId,e.pgid=O.metrics.pageId,O.net.request.post("".concat(O.net.getRoute(O.net.routes.ads,null,this.config.sandbox?"sandbox":"live"),"?key=").concat(encodeURIComponent(t)),e,function(e,t){e?(O.report("Failed to retrieve placement content",e,{placement:i}),i.setMarkup(""),i.emit("error",e),n&&n(e)):(i._response=t,i.emit("data"),n&&n())})}},{key:"_mergeResponseSettings",value:function(){var t=this,n=(this._response.data||{}).settings||{};n.filters&&Object.keys(n.filters).forEach(function(e){t.config[e]=n.filters[e]}),n.display&&Object.keys(n.display).forEach(function(e){t.config[e]=n.display[e]})}},{key:"_updateBaseMetaFromResponse",value:function(){var e=(this._response||{}).data||{},t=(this._metricBase.m=this._metricBase.m||{},this._metricBase.m);e.article&&(t.aid=e.article.id),e.test&&e.test.enabled?(t.pten=1,t.ptid=e.test.id,t.ptseed=e.test.seed):t.pten=0}},{key:"_showContent",value:function(){var e=(this._response||{}).data||{};e.type===l.ContentTypes.products?this._showProducts():e.type===l.ContentTypes.articles?this._showArticles():e.type===l.ContentTypes.adx?this._showADX():(e="Unknown response content type: "+e.type,O.report(e,{placement:this}),this.setMarkup(""),this.emit("error",e),this._reportWidgetLoad(e))}},{key:"_getClickThroughURL",value:function(e,t,n){var i=0<=t.indexOf("?")?"&":"?";return(n=n||{}).ok_msid=O.metrics.sid||"unknown",this.config.verbose_click_data&&(n.ok_ch=this._metricBase.ch,n.ok_cx=this._metricBase.cx,n._okjr=btoa(E.location.href.split(/[?#]/)[0])),this.config.utm_click_data&&(n.utm_source="okanjo",n.utm_medium="smartserve"),t+=i+Object.keys(n).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(n[e])}).join("&"),this.config.proxy_url&&(t=this.config.proxy_url+encodeURIComponent(t)),e.data({u:t}),e.toUrl()}},{key:"_handleResourceMouseDown",value:function(e,t,n){var i=t._cid,r=O.metrics.create(this._metricBase,{id:t.id}).type(e,S.Event.interaction).meta(this.getConfig()).meta({cid:i}).meta({bf:t.backfill?1:0,sf:t.shortfill?1:0,spltfl_seg:t.splitfill_segment||null}).event(n).element(n.currentTarget).viewport().widget(this.element),o="url_track_param",a="url",e=(e===S.Object.product&&(o="buy_url_track_param",a="buy_url"),{ok_cid:i});t[o]&&(e[t[o]]=i),r.data({ea:S.Action.click}),n.currentTarget.href=this._getClickThroughURL(r,t[a],e),t._clickId=i,t._event=r,t._additionalParams=e}},{key:"_getTemplate",value:function(e,t){var n=this.config.template_name;return n&&O.ui.engine.isTemplateRegistered("".concat(e,".").concat(n))||(n=t),"".concat(e,".").concat(n)}},{key:"_enforceLayoutOptions",value:function(){"leaderboard"===this.config.size||"large_mobile_banner"===this.config.size?(this.config.template_layout="list",this.config.template_cta_style="link"):"half_page"!==this.config.size&&"auto"!==this.config.size||(this.config.template_layout="list")}},{key:"_enforceSlabLayoutOptions",value:function(){"medium_rectangle"===this.config.size||"billboard"===this.config.size?(this.config.template_layout="grid","button"===this.config.template_cta_style&&(this.config.template_cta_style="link")):"half_page"===this.config.size?this.config.template_layout="grid":"leaderboard"===this.config.size||"large_mobile_banner"===this.config.size?(this.config.template_layout="list","button"===this.config.template_cta_style&&(this.config.template_cta_style="link")):"auto"===this.config.size?this.config.template_layout="list":"responsive"===this.config.size&&"button"===this.config.template_cta_style&&(this.config.template_cta_style="link")}},{key:"_registerCustomBranding",value:function(){var e=this.config.template_cta_color,t="okanjo-wgid-"+this.instanceId,n="";e&&(n="\n                    .okanjo-block2.".concat(t," .okanjo-resource-cta-button, .okanjo-block2.").concat(t," .okanjo-resource-buy-button { color: ").concat(e," !important; } \n                    .okanjo-block2.").concat(t,".okanjo-cta-style-button .okanjo-resource-cta-button, .okanjo-block2.").concat(t,".okanjo-cta-style-button .okanjo-resource-buy-button { border-color: ").concat(e," !important; } \n                    .okanjo-block2.").concat(t,".okanjo-cta-style-button .okanjo-resource-cta-button:hover, .okanjo-block2.").concat(t,".okanjo-cta-style-button .okanjo-resource-buy-button:hover { background: ").concat(e," !important; color: #fff !important; } \n                ")),this.config.custom_css&&(n+="\n\n"+this.config.custom_css),this.config.custom_css_url&&O.ui.engine.ensureExternalCss(this.config.custom_css_url),n&&(O.ui.engine.registerCss(t,n,{id:t}),O.ui.engine.ensureCss(t))}},{key:"_addOnceViewedHandler",value:function(e,t){this._viewedWatchers.push({element:e,successfulCount:0,handler:t}),this._toggleViewWatcher(!0)}},{key:"_checkViewWatchers",value:function(){for(var e,t=0;t<this._viewedWatchers.length;t++)e=this._viewedWatchers[t],O.ui.isElementVisible(e.element)&&.5<=O.ui.getPercentageInViewport(e.element)&&e.successfulCount++,2<=e.successfulCount&&(e.handler(),this._viewedWatchers.splice(t,1),t--);0===this._viewedWatchers.length&&this._toggleViewWatcher(!1)}},{key:"_toggleViewWatcher",value:function(e){e?null===this._viewWatcherIv&&(this._viewWatcherIv=setInterval(this._checkViewWatchers.bind(this),500)):(clearInterval(this._viewWatcherIv),this._viewWatcherIv=null)}},{key:"_showProducts",value:function(){var r=this,e=(this._response||{data:{results:[]}}).data||{results:[]},t=this._getTemplate(l.ContentTypes.products,l.DefaultTemplates.products),n=(e.results.forEach(function(e,t){r.config.disable_inline_buy&&(e.inline_buy_url=null),e.inline_buy_url&&(e._escaped_inline_buy_url=encodeURIComponent(e.inline_buy_url)),e._image_url=e.image_urls?e.image_urls[0]:"",e._escaped_buy_url=encodeURIComponent(e.buy_url),e._price_formatted=pe.formatCurrency(e.price),e._index=t}),{css:!this.config.no_css});this.setMarkup(O.ui.engine.render(t,this,n)),0===e.results.length?(this.emit("empty"),this._reportWidgetLoad("empty")):this._reportWidgetLoad(),this.element.querySelectorAll("a").forEach(function(e){var t,n=e.getAttribute("data-id"),i=e.getAttribute("data-index");n&&0<=i&&((t=r._response.data.results[i])&&(e.addEventListener("mousedown",r._handleResourceMouseDown.bind(r,S.Object.product,t)),e.addEventListener("click",r._handleProductClick.bind(r,t)),O.metrics.create(r._metricBase,{id:t.id}).type(S.Object.product,S.Event.impression).meta(r.getConfig()).meta({bf:t.backfill?1:0,sf:t.shortfill?1:0,spltfl_seg:t.splitfill_segment||null}).element(e).viewport().widget(r.element).send(),r._addOnceViewedHandler(e,function(){O.metrics.create(r._metricBase,{id:t.id}).type(S.Object.product,S.Event.view).meta(r.getConfig()).meta({bf:t.backfill?1:0,sf:t.shortfill?1:0,spltfl_seg:t.splitfill_segment||null}).element(e).viewport().widget(r.element).send()})))}),this.element.querySelectorAll(".okanjo-resource-title").forEach(function(e){O.ui.ellipsify(e)}),O.ui.fitImages(this.element),this.emit("load")}},{key:"_handleProductClick",value:function(e,t){e._event&&e._additionalParams&&e._clickId||this._handleResourceMouseDown(S.Object.product,e,t);var n,i,r,o=e._event,a=e._additionalParams,s=(o.event(t),!!e.inline_buy_url);!this.config.disable_popup&&s&&O.util.isMobile()?(t.preventDefault(),o.data({ea:S.Action.inline_click}).meta({popup:"true"}),r=this._getClickThroughURL(o,e.inline_buy_url,a),this._popupFrame=E.open(r,"okanjo-inline-buy-frame","width=400,height=400,location=yes,resizable=yes,scrollbars=yes"),this._popupFrame||(O.report("Popup blocker stopped buy experience from showing",{placement:this}),E.location.href=r)):s?(t.preventDefault(),n=document.createElement("iframe"),i={class:"okanjo-inline-buy-frame",frameborder:0,vspace:0,hspace:0,webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:"",scrolling:"auto"},Object.keys(i).forEach(function(e){return n.setAttribute(e,i[e])}),a.ok_expandable=this.config.expandable?1:0,this.config.expandable||(r=this.element.querySelector(".okanjo-expansion-root"))&&(n.className+=" okanjo-ad-in-unit",n.setAttribute("height","100%"),n.setAttribute("width","100%"),r.appendChild(n),s=O.ui.getElementSize(r),a.ok_frame_height=s.height,a.ok_frame_width=s.width,this.config.size&&(a.ok_ad_size=this.config.size)),o.data({ea:S.Action.inline_click}).meta({expandable:this.config.expandable?"true":"false"}),n.src=this._getClickThroughURL(o,e.inline_buy_url,a),n.parentNode||O.ui.modal.show(n)):t.currentTarget.href=this._getClickThroughURL(o,e.buy_url,a)}},{key:"_showArticles",value:function(){var r=this,e=(this._response||{data:{results:[]}}).data||{results:[]},t=this._getTemplate(l.ContentTypes.articles,l.DefaultTemplates.articles),n=(e.results.forEach(function(e,t){e._escaped_url=encodeURIComponent(e.url),e._index=t}),{css:!this.config.no_css});this.setMarkup(O.ui.engine.render(t,this,n)),0===e.results.length?(this.emit("empty"),this._reportWidgetLoad("empty")):this._reportWidgetLoad(),this.element.querySelectorAll("a").forEach(function(e){var t,n=e.getAttribute("data-id"),i=e.getAttribute("data-index");n&&0<=i&&((t=r._response.data.results[i])&&(e.addEventListener("mousedown",r._handleResourceMouseDown.bind(r,S.Object.article,t)),e.addEventListener("click",r._handleArticleClick.bind(r,t)),O.metrics.create(r._metricBase,{id:t.id}).type(S.Object.article,S.Event.impression).meta(r.getConfig()).meta({bf:t.backfill?1:0,sf:t.shortfill?1:0,spltfl_seg:t.splitfill_segment||null}).element(e).viewport().widget(r.element).send(),r._addOnceViewedHandler(e,function(){O.metrics.create(r._metricBase,{id:t.id}).type(S.Object.article,S.Event.view).meta(r.getConfig()).meta({bf:t.backfill?1:0,sf:t.shortfill?1:0,spltfl_seg:t.splitfill_segment||null}).element(e).viewport().widget(r.element).send()})))}),this.element.querySelectorAll(".okanjo-resource-title").forEach(function(e){O.ui.ellipsify(e)}),O.ui.fitImages(this.element),this.emit("load")}},{key:"_handleArticleClick",value:function(e,t){e._event&&e._additionalParams&&e._clickId||this._handleResourceMouseDown(S.Object.article,e,t);var n=e._event,i=e._additionalParams;n.event(t),t.currentTarget.href=this._getClickThroughURL(n,e.url,i)}},{key:"_showADX",value:function(){var e,t,n,i=this,r=(this._response||{data:{settings:{}}}).data||{settings:{}},o=this._getTemplate(l.ContentTypes.adx,l.DefaultTemplates.adx),a=null,s=(this.config.size&&(l.Sizes[this.config.size]?a=l.Sizes[this.config.size]:(c=/^([0-9]+)x([0-9]+)$/i.exec(this.config.size))&&(a={width:c[1],height:c[2]})),a=a||l.Sizes.default,"/90447967/okanjo:<publisher>"),c=(r.settings.display&&r.settings.display.adx_unit_path&&(s=r.settings.display.adx_unit_path,e="custom_ad_unit"),{css:!this.config.no_css,size:a,adUnitPath:s}),r=(this.setMarkup(O.ui.engine.render(o,this,c)),this._reportWidgetLoad(e),this.element.querySelector(".okanjo-adx-container"));r&&(t=document.createElement("iframe"),n={class:"okanjo-adx-frame",frameborder:0,vspace:0,hspace:0,webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:"",scrolling:"auto",width:a.width,height:a.height},Object.keys(n).forEach(function(e){return t.setAttribute(e,n[e])}),r.appendChild(t),o=O.metrics.create(this._metricBase).type(S.Object.thirdparty_ad,S.Event.interaction).meta(this.getConfig()).meta({ta_s:s,ta_w:a.width,ta_h:a.height}).element(t).viewport().widget(this.element).toUrl(),t.contentWindow.trackImpression=function(){O.metrics.create(i._metricBase).type(S.Object.thirdparty_ad,S.Event.impression).meta(i.getConfig()).meta({ta_s:s,ta_w:a.width,ta_h:a.height}).element(t).viewport().widget(i.element).send(),i._addOnceViewedHandler(t,function(){O.metrics.create(i._metricBase).type(S.Object.thirdparty_ad,S.Event.view).meta(i.getConfig()).meta({ta_s:s,ta_w:a.width,ta_h:a.height}).element(t).viewport().widget(i.element).send()})},t.contentWindow.document.open(),t.contentWindow.document.write('<html><head><style type="text/css">html,body {margin: 0; padding: 0;}</style></head><body><div id="gpt-passback">\n<'+'script type="text/javascript" src="https://securepubads.g.doubleclick.net/tag/js/gpt.js">\n    \n    window.googletag = window.googletag || {cmd: []};\n    googletag.cmd.push(function() {\n        \n        // Define the slot\n        googletag.defineSlot("'.concat(s.replace(/"/g,'\\"'),'", [[').concat(a.width,", ").concat(a.height,"]], 'gpt-passback')\n            .setClickUrl(\"").concat(o,"&u=\")     // Track click event on the okanjo side\n            .addService(googletag.pubads())    // Service the ad\n        ;\n        \n        // Track load/view events\n        googletag.pubads().addEventListener('slotRenderEnded', function(e) { \n            trackImpression(e);\n        });\n        \n        // Go time\n        googletag.enableServices();\n        googletag.display('gpt-passback');\n    });\n    \n<")+"/script></div>\n</body></html>"),t.contentWindow.document.close()),this.emit("load")}}]),l}()).Sizes={medium_rectangle:{width:300,height:250},leaderboard:{width:728,height:90},large_mobile_banner:{width:320,height:100},half_page:{width:300,height:600},billboard:{width:970,height:250},button_2:{width:120,height:60},micro_bar:{width:88,height:31},portrait:{width:300,height:1050},rectangle:{width:180,height:150},super_leaderboard:{width:970,height:90},wide_skyscraper:{width:160,height:600},mobile_leaderboard:{width:320,height:50},small_square:{width:200,height:200},button_1:{width:120,height:90},full_banner:{width:468,height:60},half_banner:{width:234,height:60},large_rectangle:{width:336,height:280},pop_under:{width:720,height:300},three_to_one_rectangle:{width:300,height:100},skyscraper:{width:120,height:600},square:{width:250,height:250},square_button:{width:125,height:125},vertical_banner:{width:120,height:240},vertical_rectangle:{width:240,height:400}},q.Sizes.default=q.Sizes.medium_rectangle,q.ContentTypes={products:"products",articles:"articles",adx:"adx"},q.DefaultTemplates={products:"block2",articles:"block2",adx:"block2"},O.Placement=q,me=window.okanjo,I=function(){L(r,me.Placement);var i=z(r);function r(e,t){a(this,r);var n=(t=t||{}).no_init;return t.no_init=!0,e=i.call(this,e,t),me.warn("Product widget has been deprecated. Use Placement instead (may require configuration changes)",{widget:o(e)}),n||(delete e.config.no_init,e.init()),e}return n(r,[{key:"_setCompatibilityOptions",value:function(){this.config.backwards="Product",this.config.type=me.Placement.ContentTypes.products,"sense"===this.config.mode?(this.config.url=this.config.url||"referrer",this.config.take=this.config.take||5):"single"===this.config.mode?(this.config.url=null,this.config.id&&(this.config.ids=[this.config.id]),this.config.take=1,delete this.config.id):(this.config.url=null,this.config.take=this.config.take||25),delete this.config.mode,this.config.sold_by&&(this.config.store_name=this.config.sold_by,delete this.config.sold_by),this.config.selectors&&(this.config.url_selectors=this.config.selectors,delete this.config.selectors),this.config.marketplace_id&&(this.config.property_id=this.config.marketplace_id,delete this.config.marketplace_id),"testing"===this.config.marketplace_status&&(this.config.sandbox=!0),delete this.config.marketplace_status,delete this.config.suboptimal,delete this.config.text}}]),r}(),me.Product=I,R=window.okanjo,q=function(){L(r,R.Placement);var i=z(r);function r(e,t){a(this,r);var n=(t=t||{}).no_init;return t.no_init=!0,e=i.call(this,e,t),R.warn("Ad widget has been deprecated. Use Placement instead (may require configuration changes)",{widget:o(e)}),n||(delete e.config.no_init,e.init()),e}return n(r,[{key:"_setCompatibilityOptions",value:function(){this.config.backwards="Ad",this.config.type=R.Placement.ContentTypes.products,this.config.url=null,this.config.id?this.config.ids=[this.config.id]:R.warn("Ad widget should have parameter `id` set."),this.config.take=1,delete this.config.id,delete this.config.content}}]),r}(),R.Ad=q,function(){var e,t;e=this,t=function(){"use strict";
/*!
     * mustache.js - Logic-less {{mustache}} templates with JavaScript
     * http://github.com/janl/mustache.js
     */var t=Object.prototype.toString,P=Array.isArray||function(e){return"[object Array]"===t.call(e)};function u(e){return"function"==typeof e}function M(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function h(e,t){return null!=e&&"object"===d(e)&&t in e}var n=RegExp.prototype.test;var i=/\S/;function I(e){return!n.call(i,e)}var r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};var R=/\s*/,q=/\s+/,L=/\s*=/,U=/\s*\}/,z=/#|\^|\/|>|\{|&|=|!/;function a(e,t){if(!e)return[];var n,i,r,o=!1,a=[],s=[],c=[],l=!1,u=!1,h="",d=0;function f(){if(l&&!u)for(;c.length;)delete s[c.pop()];else c=[];u=l=!1}function p(e){if("string"==typeof e&&(e=e.split(q,2)),!P(e)||2!==e.length)throw new Error("Invalid tags: "+e);n=new RegExp(M(e[0])+"\\s*"),i=new RegExp("\\s*"+M(e[1])),r=new RegExp("\\s*"+M("}"+e[1]))}p(t||D.tags);for(var g,m,y,v,_,b,k=new W(e);!k.eos();){if(g=k.pos,y=k.scanUntil(n))for(var w=0,j=y.length;w<j;++w)I(v=y.charAt(w))?(c.push(s.length),h+=v):(o=u=!0,h+=" "),s.push(["text",v,g,g+1]),g+=1,"\n"===v&&(f(),h="",d=0,o=!1);if(!k.scan(n))break;if(l=!0,m=k.scan(z)||"name",k.scan(R),"="===m?(y=k.scanUntil(L),k.scan(L),k.scanUntil(i)):"{"===m?(y=k.scanUntil(r),k.scan(U),k.scanUntil(i),m="&"):y=k.scanUntil(i),!k.scan(i))throw new Error("Unclosed tag at "+k.pos);if(_=">"==m?[m,y,g,k.pos,h,d,o]:[m,y,g,k.pos],d++,s.push(_),"#"===m||"^"===m)a.push(_);else if("/"===m){if(!(b=a.pop()))throw new Error('Unopened section "'+y+'" at '+g);if(b[1]!==y)throw new Error('Unclosed section "'+b[1]+'" at '+g)}else"name"===m||"{"===m||"&"===m?u=!0:"="===m&&p(y)}if(f(),b=a.pop())throw new Error('Unclosed section "'+b[1]+'" at '+k.pos);for(var x,C=function(e){for(var t,n,i=[],r=0,o=e.length;r<o;++r)(t=e[r])&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(i.push(t),n=t));return i}(s),E=[],O=E,T=[],A=0,S=C.length;A<S;++A)switch((x=C[A])[0]){case"#":case"^":O.push(x),T.push(x),O=x[4]=[];break;case"/":T.pop()[5]=x[2],O=0<T.length?T[T.length-1][4]:E;break;default:O.push(x)}return E}function W(e){this.string=e,this.tail=e,this.pos=0}function o(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function e(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}W.prototype.eos=function(){return""===this.tail},W.prototype.scan=function(e){e=this.tail.match(e);if(!e||0!==e.index)return"";e=e[0];return this.tail=this.tail.substring(e.length),this.pos+=e.length,e},W.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},o.prototype.push=function(e){return new o(e,this)},o.prototype.lookup=function(e){var t,n,i,r=this.cache;if(r.hasOwnProperty(e))t=r[e];else{for(var o,a,s,c=this,l=!1;c;){if(0<e.indexOf("."))for(o=c.view,a=e.split("."),s=0;null!=o&&s<a.length;)s===a.length-1&&(l=h(o,a[s])||(n=o,i=a[s],null!=n&&"object"!==d(n)&&n.hasOwnProperty&&n.hasOwnProperty(i))),o=o[a[s++]];else o=c.view[e],l=h(c.view,e);if(l){t=o;break}c=c.parent}r[e]=t}return t=u(t)?t.call(this.view):t},e.prototype.clearCache=function(){void 0!==this.templateCache&&this.templateCache.clear()},e.prototype.parse=function(e,t){var n=this.templateCache,i=e+":"+(t||D.tags).join(":"),r=void 0!==n,o=r?n.get(i):void 0;return null==o&&(o=a(e,t),r&&n.set(i,o)),o},e.prototype.render=function(e,t,n,i){var r=this.getConfigTags(i),r=this.parse(e,r),t=t instanceof o?t:new o(t,void 0);return this.renderTokens(r,t,n,e,i)},e.prototype.renderTokens=function(e,t,n,i,r){for(var o,a,s,c="",l=0,u=e.length;l<u;++l)s=void 0,"#"===(a=(o=e[l])[0])?s=this.renderSection(o,t,n,i,r):"^"===a?s=this.renderInverted(o,t,n,i,r):">"===a?s=this.renderPartial(o,t,n,r):"&"===a?s=this.unescapedValue(o,t):"name"===a?s=this.escapedValue(o,t,r):"text"===a&&(s=this.rawValue(o)),void 0!==s&&(c+=s);return c},e.prototype.renderSection=function(e,t,n,i,r){var o=this,a="",s=t.lookup(e[1]);if(s){if(P(s))for(var c=0,l=s.length;c<l;++c)a+=this.renderTokens(e[4],t.push(s[c]),n,i,r);else if("object"===d(s)||"string"==typeof s||"number"==typeof s)a+=this.renderTokens(e[4],t.push(s),n,i,r);else if(u(s)){if("string"!=typeof i)throw new Error("Cannot use higher-order sections without the original template");null!=(s=s.call(t.view,i.slice(e[3],e[5]),function(e){return o.render(e,t,n,r)}))&&(a+=s)}else a+=this.renderTokens(e[4],t,n,i,r);return a}},e.prototype.renderInverted=function(e,t,n,i,r){var o=t.lookup(e[1]);if(!o||P(o)&&0===o.length)return this.renderTokens(e[4],t,n,i,r)},e.prototype.indentPartial=function(e,t,n){for(var i=t.replace(/[^ \t]/g,""),r=e.split("\n"),o=0;o<r.length;o++)r[o].length&&(0<o||!n)&&(r[o]=i+r[o]);return r.join("\n")},e.prototype.renderPartial=function(e,t,n,i){var r,o,a,s,c;if(n)return r=this.getConfigTags(i),o=u(n)?n(e[1]):n[e[1]],null!=o?(a=e[6],c=e[5],e=e[4],s=o,0==c&&e&&(s=this.indentPartial(o,e,a)),c=this.parse(s,r),this.renderTokens(c,t,n,s,i)):void 0},e.prototype.unescapedValue=function(e,t){t=t.lookup(e[1]);if(null!=t)return t},e.prototype.escapedValue=function(e,t,n){n=this.getConfigEscape(n)||D.escape,t=t.lookup(e[1]);if(null!=t)return("number"==typeof t&&n===D.escape?String:n)(t)},e.prototype.rawValue=function(e){return e[1]},e.prototype.getConfigTags=function(e){return P(e)?e:e&&"object"===d(e)?e.tags:void 0},e.prototype.getConfigEscape=function(e){if(e&&"object"===d(e)&&!P(e))return e.escape};var D={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){s.templateCache=e},get templateCache(){return s.templateCache}},s=new e;return D.clearCache=function(){return s.clearCache()},D.parse=function(e,t){return s.parse(e,t)},D.render=function(e,t,n,i){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+(P(r=e)?"array":d(r))+'" was given as the first argument for mustache#render(template, view, partials)');var r;return s.render(e,t,n,i)},D.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,function(e){return r[e]})},D.Scanner=W,D.Context=o,D.Writer=e,D},"object"===("undefined"==typeof exports?"undefined":d(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Mustache=t()}.apply(ye.lib),ye});
//# sourceMappingURL=okanjo.min.js.map
