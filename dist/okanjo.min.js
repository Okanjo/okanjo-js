/*! okanjo-js v1.5.2 | (c) 2013 Okanjo Partners Inc | https://okanjo.com/ */
!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.okanjo=t()}(this,function(){function e(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function t(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Array.from||(Array.from=function(){var e=Object.prototype.toString,t=function(t){return"function"==typeof t||"[object Function]"===e.call(t)},n=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t},i=Math.pow(2,53)-1,r=function(e){var t=n(e);return Math.min(Math.max(t,0),i)};return function(e){var n=this,i=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var o,a=arguments.length>1?arguments[1]:void 0;if("undefined"!=typeof a){if(!t(a))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(o=arguments[2])}for(var s,u=r(i.length),c=t(n)?Object(new n(u)):new Array(u),l=0;l<u;)s=i[l],a?c[l]="undefined"==typeof o?a(s,l):a.call(o,s,l):c[l]=s,l+=1;return c.length=u,c}}()),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var i=arguments[1],r=0;r<n;){var o=t[r];if(e.call(i,o,r,t))return o;r++}}}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var i=arguments[1],r=0;r<n;){var o=t[r];if(e.call(i,o,r,t))return r;r++}return-1}}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){function n(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)}if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),r=i.length>>>0;if(0===r)return!1;for(var o=0|t,a=Math.max(o>=0?o:r-Math.abs(o),0);a<r;){if(n(i[a],e))return!0;a++}return!1}}),window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(e,t){t=t||window;for(var n=0;n<this.length;n++)e.call(t,this[n],n,this)}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])}return n},writable:!0,configurable:!0});var o=function(e,t){var n=void 0!==e.pageXOffset,i="CSS1Compat"===(t.compatMode||""),o=e.navigator.userAgent,a=/[\s\S](?:\.\.\.)?$/,s=/(iPhone|iPad|iPod|Android|blackberry)/i,u=function(){},c=e.console,l=e.okanjo||{},d={version:"1.5.2",metrics:null,key:l.key||null,report:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t.find(function(e){return e instanceof Error});if(i){var r=(new Error).stack.split("\n");r.shift(),r.shift(),t.push({reportStack:r.join("\n")}),t=t.filter(function(e){return e!==i})}else{var o=t.findIndex(function(e){return"string"==typeof e});i=new Error(t[o]||"Okanjo Error"),o>=0&&t.splice(o,1)}c.error("[Okanjo v"+d.version+"]: "+i.stack),t.length&&c.error.apply(c,["Additional information:"].concat(t))},warn:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var r=new Error(e);c.warn("[Okanjo v"+d.version+"]: "+r.stack),n.length&&c.warn.apply(c,["Additional information:"].concat(n))},qwery:function(e,n){return"string"!=typeof n||(n=t.querySelector(n))?(n||(n=t),n.querySelectorAll(e)):[]}};/*! based on shortid https://github.com/dylang/shortid */
return d.lib={},d.net={endpoint:"https://api2.okanjo.com",sandboxEndpoint:"https://sandbox-api2.okanjo.com",routes:{ads:"/content",metrics:"/metrics/:object_type/:event_type",metrics_batch:"/metrics"},getRoute:function(e,t,n){return t&&Object.keys(t).forEach(function(n){e=e.replace(":"+n,t[n]+"")}),n=n||d.env||"live",("sandbox"===n?d.net.sandboxEndpoint:d.net.endpoint)+e},request:u},d.util={isEmpty:function(e){return null===e||void 0===e||"string"==typeof e&&0===e.trim().length},isMobile:function(){return s.test(o)},getPageArguments:function(t){var n=function(e){e=e||"";var t={},n=e.split("&");return n.forEach(function(e){var n=e.indexOf("="),i=void 0,r=void 0;n<0?(i=decodeURIComponent(e),r=null):(i=decodeURIComponent(e.substring(0,n)),r=decodeURIComponent(e.substring(n+1))),i&&(t[i]=r)}),t},i=n(e.location.search.substring(e.location.search.indexOf("?")+1)),r=t?n(e.location.hash.substring(Math.max(e.location.hash.indexOf("#")+1,e.location.hash.indexOf("#!")+2))):{};return Object.keys(r).forEach(function(e){return i[e]=r[e]}),i}},d.util.deepClone=function(e,t){return Array.isArray(e)?(t=t||[],t=t.concat(e.map(function(e){return d.util.deepClone(e)}))):"object"===("undefined"==typeof e?"undefined":r(e))&&null!==e?(t=t||{},Object.keys(e).forEach(function(n){t[n]=d.util.deepClone(e[n])})):t=e,t},d.util.flatten=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};return void 0!==e&&null!==e&&Object.keys(e).forEach(function(i){if(e[i]instanceof Date)t.dateToIso?n[i]=e[i].toISOString():n[i]=e[i];else if("object"===r(e[i])&&null!==e[i])if(Array.isArray(e[i])&&t.ignoreArrays===!0)n[i]=e[i];else if(Array.isArray(e[i])&&t.arrayToCsv===!0)n[i]=e[i].join(",");else{var o=d.util.flatten(e[i],t);Object.keys(o).forEach(function(e){n[i+"_"+e]=o[e]})}else n[i]=e[i]}),n},d.util.shortid=function(t){var n="ylZM7VHLvOFcohp01x-fXNr8P_tqin6RkgWGm4SIDdK5s2TAJebzQEBUwuY9j3aC",i=e.crypto||e.msCrypto||"function"==typeof require&&require("crypto"),r=function(){if(i&&i.randomBytes)return 48&i.randomBytes(1)[0];if(!i||!i.getRandomValues)return 48&Math.floor(256*Math.random());var e=new Uint8Array(1);return i.getRandomValues(e),48&e[0]},o=function(e){for(var t=0,i=void 0,o="";!i;)o+=n[e>>4*t&15|r()],i=e<Math.pow(16,t+1),t++;return o},a=1490384907498,s=7,u=void 0,c=void 0;return t=t||0,function(){var e="",n=Math.floor(.001*((new Date).getTime()-a));return n===c?u++:(u=0,c=n),e=e+o(s)+o(t),u>0&&(e+=o(u)),e+=o(n)}}(),d.ui={getScrollPosition:function(){return{x:n?e.pageXOffset:i?t.documentElement.scrollLeft:t.body.scrollLeft,y:n?e.pageYOffset:i?t.documentElement.scrollTop:t.body.scrollTop}},getElementSize:function(t,n){var i={height:t.offsetHeight,width:t.offsetWidth},r=t.currentStyle||e.getComputedStyle(t);return n&&(i.height+=parseInt(r.marginTop)+parseInt(r.marginBottom),i.width+=parseInt(r.marginLeft)+parseInt(r.marginRight)),i},getPageSize:function(){var e=t.querySelector("body"),n=t.documentElement;return{w:Math.max(e.scrollWidth,e.offsetWidth,n.clientWidth,n.scrollWidth,n.offsetWidth),h:Math.max(e.scrollHeight,e.offsetHeight,n.clientHeight,n.scrollHeight,n.offsetHeight)}},getViewportSize:function(){var n=i?t.documentElement:t.body,r=n.clientWidth,o=n.clientHeight,a=e.innerWidth||0,s=e.innerHeight||0,u=a&&r>a||s&&o>s;return{vw:u?a:r,vh:u?s:o}},getEventPosition:function(e){var n=e.pageX,i=e.pageY,r=t.body,o=t.documentElement,a="scrollLeft",s="scrollTop",u=e.__proto__.constructor.name;return{et:u,ex:void 0===n?e.clientX+r[a]+o[a]:n,ey:void 0===i?e.clientY+r[s]+o[s]:i}},getElementPosition:function(e){var n="Could not get position of element. Did you attach the element to the DOM before initializing?";try{var i=e.getBoundingClientRect(),r=d.ui.getScrollPosition();return t.body.contains(e)||d.report(n,e),{x1:i.left+r.x,y1:i.top+r.y,x2:i.right+r.x,y2:i.bottom+r.y}}catch(o){return d.report(n,{exception:o,element:e}),{x1:0,y1:0,x2:0,y2:0,err:1}}},_getIntersection:function(e,t,n){var i=Math.max(e.x1,t.x),r=Math.min(e.x2,t.x+n.vw),o=Math.max(e.y1,t.y),a=Math.min(e.y2,t.y+n.vh),s=Math.max(0,r-i)*Math.max(0,a-o),u=(e.x2-e.x1)*(e.y2-e.y1);return{intersectionArea:s,elementArea:u}},getPercentageInViewport:function(e){var t=d.ui.getElementPosition(e),n=d.ui.getScrollPosition(),i=d.ui.getViewportSize();if(t.err)return 0;var r=d.ui._getIntersection(t,n,i),o=r.intersectionArea,a=r.elementArea;return a<=0?0:o/a}},d.ui.ellipsify=function(e,n){for(var i=n||e.parentNode,r=d.ui.getElementSize(i).height,o=void 0!==e.textContent,s=o?e.textContent:e.innerText,u="",c=5e3,l=function(e){return u=e.substr(0,e.length-3)+u,"..."};d.ui.getElementSize(e).height>r&&s.length>0&&c-- >0;)s=o?e.textContent:e.innerText,s=s.replace(a,l),o?e.textContent=s:e.innerText=s;if(u.length>0){var h=t.createElement("span"),f=t.createElement("span");h.setAttribute("class","okanjo-ellipses"),f.setAttribute("class","okanjo-visually-hidden"),o?(h.textContent=s.substr(0,s.length-3),f.textContent=u):(h.innerText=s.substr(0,s.length-3),f.innerText=u),e.innerHTML="",e.appendChild(h),e.appendChild(f)}},e.okanjo=d}(window,document);return function(e){var t=/^application\/json/,n=e.okanjo;n.net.request=function(i,r,o,a){"function"==typeof o&&(a=o,o=void 0);var s=new(e.XMLHttpRequest||e.ActiveXObject)("MSXML2.XMLHTTP.3.0"),u=!1,c=function(e,t){u||(u=!0,a(e,t))};n.net.request.timeout&&(s.timeout=n.net.request.timeout),s.ontimeout=function(e){c({statusCode:504,error:"Request timed out",message:"Something went wrong",attributes:{event:e,xhr:s}})},s.onreadystatechange=function(e){if(4===s.readyState)if(s.status>0){var n=void 0;n=t.test(s.getResponseHeader("Content-Type"))?JSON.parse(s.responseText):{statusCode:s.status,data:s.responseText},s.status>=200&&s.status<300?c(null,n):c(n)}else c({statusCode:503,error:"Request failed",message:"Something went wrong",attributes:{event:e,xhr:s}})},s.open(i.toUpperCase(),r),s.withCredentials=!0,["POST","PUT","PATCH"].includes(i.toUpperCase())&&(s.setRequestHeader("Content-Type","application/json; charset=utf-8"),void 0!==o&&(o=JSON.stringify(o))),s.send(o||void 0)},n.net.request.get=n.net.request.bind(this,"GET"),n.net.request.post=n.net.request.bind(this,"POST"),n.net.request.put=n.net.request.bind(this,"PUT"),n.net.request["delete"]=n.net.request.bind(this,"DELETE");var i=function(e){return null===e||void 0===e?"":encodeURIComponent(""+e)},o=function(e,t){return t?t+"["+i(e)+"]":i(e)};n.net.request.stringify=function(e,t){var a=[];return t=t||"",Object.keys(e).forEach(function(s){var u=e[s];if(Array.isArray(u))u.forEach(function(e){return a.push(o(s,t)+"="+i(e))});else if("object"===("undefined"==typeof u?"undefined":r(u))&&null!==u){var c=n.net.request.stringify(u,o(s,t));c&&a.push(c)}else void 0!==u&&a.push(o(s,t)+"="+i(u))}),a.join("&")}}(window),function(e,t){e.okanjo.util.cookie={set:function(e,n,i){var r=new Date;r.setDate(r.getDate()+i);var o=i?" Expires="+r.toUTCString()+";":"",a=" Path=/",s=encodeURI(n)+";"+o+a;t.cookie=e+"="+s},get:function(e){var n=null;return t.cookie.split(";").find(function(t){var i=t.substr(0,t.indexOf("=")).trim(),r=t.substr(t.indexOf("=")+1);return i===e&&(n=decodeURI(r),!0)}),n}}}(window,document),function(e,t){var o=e.okanjo,a=function(){function e(){n(this,e),this._templates={},this._css={},this.classDetects=""}return i(e,[{key:"registerTemplate",value:function(e,t,n,i){if("object"===("undefined"==typeof t?"undefined":r(t))){if(void 0===t.nodeType)throw new Error("Parameter template must be a string or a DOM element");t=t.innerHTML,o.lib.Mustache.parse(t)}else if("string"!=typeof t)throw new Error("Parameter template must be a string or a DOM element");if(3===arguments.length&&"object"===("undefined"==typeof n?"undefined":r(n))?(i=n,n=null):i=i||{},n&&"function"!=typeof n)throw new Error("Parameter beforeRender must be a function");this._templates[e]={markup:t,options:i,beforeRender:n}}},{key:"registerCss",value:function(e,t,n){if(n=n||{},"object"===("undefined"==typeof t?"undefined":r(t))){if(void 0===t.nodeType)throw new Error("Parameter css must be a string or a DOM element")}else if("string"!=typeof t)throw new Error("Parameter css must be a string or a DOM element");this._css[e]={markup:t,options:n}}},{key:"isTemplateRegistered",value:function(e){return!!this._templates[e]}},{key:"isCssRegistered",value:function(e){return!!this._css[e]}},{key:"ensureCss",value:function(e){if(this._css[e]){var n=this._css[e],i=void 0===n.markup.nodeType?n.options.id||"okanjo-css-"+e:null;if(i){var r=t.querySelector("#"+i.replace(/\./g,"\\."));if(!r){var a=t.head,s=t.createElement("style");if(s.id=i,s.setAttribute("type","text/css"),s.hasOwnProperty?s.innerHTML=n.markup:s.styleSheet.cssText=n.markup,a)a.appendChild(s);else{var u=t.body;u?u.appendChild(s):o.report("Cannot add CSS template to document. Does it not have a body or head?")}}}}else o.report('Attempted to add CSS template "'+e+'" to the DOM, however it does not appear to be registered?')}},{key:"render",value:function(e,t,n){var i=this;n=n||{};var r=this._templates[e];return r.beforeRender&&(n=r.beforeRender.call(t,n)),n.okanjo=o,n.okanjoMetricUrl=o.net.endpoint.replace(/^https?:\/\//,""),n.now=function(){return(new Date).getTime()},n.classDetects=this.classDetects,n.blockClasses&&Array.isArray(n.blockClasses)&&(n.classDetects+=" "+n.blockClasses.join(" "),delete n.blockClasses),n.css!==!1&&r.options.css&&r.options.css.length>0&&(r.options.css.forEach(function(e){return i.ensureCss(e)}),delete n.css),o.lib.Mustache.render(r.markup,n)}}]),e}();a.formatCurrency=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:",",r=e<0?"-":"",o=parseInt(e=Math.abs(+e||0).toFixed(t))+"",a=o.length;return a=a>3?a%3:0,r+(a?o.substr(0,a)+i:"")+o.substr(a).replace(/(\d{3})(?=\d)/g,"$1"+i)+(t?n+Math.abs(e-o).toFixed(t).slice(2):"")},o.ui.engine=new a}(window,document),function(e,t){var n=e.okanjo,i=n.util.isMobile(),r=!1,o=void 0,a=void 0,s=void 0,u=void 0,c=void 0,l=void 0,d=void 0,h=void 0,f=void 0,p=function(){o=t.documentElement||t.querySelector("html"),a=t.body||t.querySelector("body"),s=t.createElement("div"),u=t.createElement("div"),c=t.createElement("div"),l=t.createElement("div"),d=t.createElement("div"),h=t.createElement("div"),f=t.createElement("iframe"),s.setAttribute("class","okanjo-modal-container okanjo-modal-hidden "),u.setAttribute("class","okanjo-modal-window"),c.setAttribute("class","okanjo-modal-window-skin"),l.setAttribute("class","okanjo-modal-window-outer"),d.setAttribute("class","okanjo-modal-window-inner"),h.setAttribute("class","okanjo-modal-close-button"),f.setAttribute("class","okanjo-inline-buy-frame"),f.setAttribute("frameborder","0"),f.setAttribute("vspace","0"),f.setAttribute("hspace","0"),f.setAttribute("webkitallowfullscreen",""),f.setAttribute("mozallowfullscreen",""),f.setAttribute("allowfullscreen",""),f.setAttribute("scrolling","auto"),h.innerHTML="Ã—",d.appendChild(f),l.appendChild(d),c.appendChild(l),u.appendChild(c),u.appendChild(h),s.appendChild(u),a.appendChild(s)},g=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},m=function(){return e.innerHeight||t.documentElement.clientHeight},v=function(){u.style.height=m()-80+"px"},y=function(){g(e,"orientationchange",function(){for(var e=0;e<2;e++)setTimeout(v,1e3*e+10)}),g(e,"resize",function(){setTimeout(v,100)}),g(s,"click",w),g(u,"click",function(e){e.preventDefault(),e.stopPropagation()}),g(h,"click",function(e){e.preventDefault(),e.stopPropagation(),w()})},_=function(e,t){e.className+=" "+t},b=function(e,t){e.className=e.className.replace(new RegExp(" *?"+t),"")},k=function(){b(s,"okanjo-modal-hidden"),_(s,"okanjo-modal-fade-out"),v(),_(o,"okanjo-modal-active"),i||_(o,"okanjo-modal-margin-fix"),setTimeout(function(){b(s,"okanjo-modal-fade-out")},10)},w=function(){_(s,"okanjo-modal-fade-out"),setTimeout(function(){b(s,"okanjo-modal-fade-out"),_(s,"okanjo-modal-hidden"),b(o,"okanjo-modal-active"),i||b(o,"okanjo-modal-margin-fix")},210)},j=function(e){d.innerHTML="","string"==typeof e?d.innerHTML=e:d.appendChild(e)};return n.ui.modal={show:function(e){r||(r=!0,p(),y()),j(e),k()},hide:function(){w()}},n.ui.modal}(window,document),function(e,t){var r=e.okanjo,o=function(){function o(){n(this,o),this._queue=this._getStoredQueue(),this._processTimeout=null,this.pageId=r.util.shortid(),this.defaultChannel=o.Channel.external,this.sid=null,this.sourceCh=null,this.sourceCx=null,this._checkUrlForReferral()}return i(o,[{key:"_getStoredQueue",value:function(){if(!e.localStorage[o.Params.queue])return[];try{var t=JSON.parse(e.localStorage[o.Params.queue]);return Array.isArray(t)?t:(r.report("Stored queue is not a queue",{queue:t}),[])}catch(n){return r.report("Failed to load metric queue from storage",{err:n}),[]}}},{key:"_saveQueue",value:function(t){var n=this;t?(this._saveQueueTimeout&&clearTimeout(this._saveQueueTimeout),this._saveQueueTimeout=setTimeout(function(){n._saveQueue(!1),n._saveQueueTimeout=null},100)):e.localStorage[o.Params.queue]=JSON.stringify(this._queue)}},{key:"_checkUrlForReferral",value:function(){var t=r.util.getPageArguments(!0),n=t[o.Params.name],i=e.localStorage[o.Params.name]||r.util.cookie.get(o.Params.name),a=t[o.Params.context],s=t[o.Params.channel];n&&i&&n!==i&&this.trackEvent({object_type:o.Object.metric_session,event_type:o.Event.correlation,id:n+"_"+i,ch:this.defaultChannel,_noProcess:!0}),this.sid=i||n||null,this.sourceCh=s||null,this.sourceCx=a||null}},{key:"trackEvent",value:function(e,t){return e.object_type&&e.event_type?void this._push(e,t):void r.report("Invalid metric to track (missing object_type or event_type)",{event:e})}},{key:"trackPageView",value:function(t,n){t=t||{},t.object_type=o.Object.page,t.event_type=o.Event.view,t.id=t.id||e.location.href,t.ch=t.ch||this.defaultChannel,this.trackEvent(t,n)}},{key:"_push",value:function(e,t){this._queue.push({event:e,callback:t}),this._saveQueue(!0),e._noProcess?delete e._noProcess:this._processQueue()}},{key:"_processQueue",value:function(){var e=this;!this._processTimeout&&this._queue.length>0&&(this._processTimeout=setTimeout(function(){var t=e._queue.splice(0,255);e._saveQueue(!1),e._batchSend(t,function(n,i){i&&i.data&&i.data.sid&&e._updateSid(i.data.sid),e._processTimeout=null,e._processQueue(),t.forEach(function(e){e.callback&&e.callback(n,i)})})},0))}},{key:"_batchSend",value:function(t,n){var i=this,o=t.map(function(e){return i._normalizeEvent(e.event),delete e.event.sid,delete e.event.win,e.event}),a={events:o,win:e.location.href},s=r.net.getRoute(r.net.routes.metrics_batch);this.sid&&(a.sid=this.sid),r.net.request.post(s,a,function(e,i){e&&r.report("Failed to send metrics batch",{err:e,res:i,items:t,route:s}),n&&n(e,i)})}},{key:"_normalizeEvent",value:function(n){n.m=n.m||{},n.key=n.key||n.m.key||r.key||void 0,this.sid&&(n.sid=this.sid),n.m=Object.assign({},n.m),Object.keys(o.Meta.exclude).forEach(function(e){return delete n.m[e]}),this.sourceCh&&(n.m.ref_ch=this.sourceCh),this.sourceCx&&(n.m.ref_cx=this.sourceCx),n.m.pgid=this.pageId,n.m.ok_ver=r.version,n.m=r.util.flatten(n.m,{arrayToCsv:!0}),Object.keys(n.m).forEach(function(e){"string"==typeof n.m[e]&&(n.m[e]=n.m[e].substr(0,255))}),t.referrer&&(n.ref=t.referrer),n.win=e.location.href}},{key:"_updateSid",value:function(t){!this.sid&&t&&(this.sid=t,e.localStorage[o.Params.name]=t,r.util.cookie.set(o.Params.name,t,o.Params.ttl))}},{key:"create",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return o.create.apply(null,t)}}],[{key:"addElementInfo",value:function(e,t){var n=r.ui.getPageSize(),i=r.ui.getElementPosition(e);return t=t||{},t.m=t.m||{},t.m.pw=n.w,t.m.ph=n.h,t.m.x1=i.x1,t.m.y1=i.y1,t.m.x2=i.x2,t.m.y2=i.y2,t}},{key:"addViewportInfo",value:function(e){var t=r.ui.getViewportSize(),n=r.ui.getScrollPosition();return e=e||{},e.m=e.m||{},e.m.vx1=n.x,e.m.vy1=n.y,e.m.vx2=n.x+t.vw,e.m.vy2=n.y+t.vh,e}},{key:"addEventInfo",value:function(e,t){var n=r.ui.getEventPosition(e);return t=t||{},t.m=t.m||{},t.m.et=n.et,t.m.ex=n.ex,t.m.ey=n.ey,t}},{key:"addEventMeta",value:function(e){e=e||{},e.m=e.m||{};for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return e.m=Object.assign.apply(Object,[e.m].concat(n)),e}},{key:"create",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return new a(e,n)}}]),o}();o.Params={queue:"_ok_q",name:"ok_msid",channel:"ok_ch",context:"ok_cx",ttl:1460},o.Meta={exclude:["key","callback","metrics_channel_context","metrics_context","mode"]},o.Event={view:"vw",impression:"imp",interaction:"int",correlation:"cor"},o.Action={click:"click",inline_click:"inline_click"},o.Object={article:"am",thirdparty_ad:"ta",cart:"ct",page:"pg",widget:"wg",product:"pr",store:"st",cause:"ca",marketplace:"mp",order:"or",order_item:"oi",user:"ur",metric_session:"mt"},o.Channel={placement:"pw",marketplace:"mp",external:"ex",product_widget:"pw",ad_widget:"aw",store_widget:"sw"},o.Environment={live:"live",testing:"testing"};var a=function(){function e(t,i){var r=this;n(this,e),t=t||{},this.data(t),Array.isArray(i)&&i.forEach(function(e){r.data(e)})}return i(e,[{key:"data",value:function(e){return Object.assign(this,r.util.deepClone(e)),this}},{key:"event",value:function(e){return o.addEventInfo(e,this),this}},{key:"viewport",value:function(){return o.addViewportInfo(this),this}},{key:"element",value:function(e){return o.addElementInfo(e,this),this}},{key:"meta",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return o.addEventMeta.apply(null,[this].concat(t)),this}},{key:"type",value:function(e,t){return this.object_type=e,this.event_type=t,this}},{key:"send",value:function(e){r.metrics.trackEvent(this,e)}},{key:"toUrl",value:function(){var e=Object.assign({},this),t=e.object_type,n=e.event_type;return delete e.object_type,delete e.event_type,r.metrics._normalizeEvent(e),r.net.getRoute(r.net.routes.metrics,{object_type:t,event_type:n})+"?"+r.net.request.stringify(e)}}]),e}();r.metrics=new o}(window,document),function(e){var t=e.okanjo;t.metrics.trackPageView({_noProcess:!0}),setTimeout(function(){t.metrics._processQueue()},1e3)}(window),function(e){var t=function(){function e(){n(this,e),this._events={}}return i(e,[{key:"on",value:function(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t)}},{key:"removeListener",value:function(e,t){if(this._events[e]){var n=this._events[e].indexOf(t);n>=0&&this._events[e].splice(n,1)}}},{key:"emit",value:function(e){var t=void 0,n=void 0,i=void 0,r=[].slice.call(arguments,1);if(this._events[e])for(n=this._events[e].slice(),i=n.length,t=0;t<i;t++)n[t].apply(this,r)}},{key:"once",value:function(e,t){var n=arguments,i=this,r=function o(){var r=[].slice.call(n,1);i.removeListener(e,o),t.apply(i,r)};this.on(e,r)}}]),e}();return e.okanjo._EventEmitter=t,t}(window),function(o){var a=o.okanjo,s=/^data-(.+)$/,u=/-/g,c=function(c){function l(t,i){n(this,l);var o=e(this,(l.__proto__||Object.getPrototypeOf(l)).call(this));if(!t||null===t||void 0===t.nodeType)throw a.report("Invalid or missing element on widget construction",{widget:o,element:t,options:i}),new Error("Okanjo: Invalid element - make sure to pass a valid DOM element when constructing Okanjo Widgets.");return i&&"object"!==("undefined"==typeof i?"undefined":r(i))?(a.report("Invalid widget options. Expected object, got: "+("undefined"==typeof i?"undefined":r(i)),{widget:o,element:t,options:i}),i={}):i=i||{},o.name="Widget",o.element=t,o.instanceId=a.util.shortid(),o.config=Object.assign({},i),o}return t(l,c),i(l,[{key:"init",value:function(){this._applyConfiguration(),this._setCompatibilityOptions(),this._ensurePlacementKey()&&this.load()}},{key:"_setCompatibilityOptions",value:function(){}},{key:"getSettings",value:function(){return{}}},{key:"load",value:function(){}},{key:"_applyConfiguration",value:function(){var e=this,t=this.getDataAttributes(),n=this.getSettings();Object.keys(t).forEach(function(i){var r=i.replace(u,"_"),o=t[i];n[r]&&(o=n[r].value(o,!1)),a.util.isEmpty(o)||(e.config[r]=o)}),Object.keys(n).forEach(function(t){void 0===e.config[t]&&void 0!==n[t]._default&&(e.config[t]=n[t].value(void 0,!1))})}},{key:"getConfig",value:function(){var e=this,t=this.getSettings(),n={};return Object.keys(this.config).forEach(function(i){var r=e.config[i],o=i,a=null;t[o]&&(r=t[o].value(r),a=t[o].getGroup());var s=n;a&&(s[a]=s[a]||{},s=s[a]),null===r?s[o]="":void 0!==r&&(s[o]=r)}),n}},{key:"_ensurePlacementKey",value:function(){return!!this.config.key||(a.key?(this.config.key=a.key,!0):(a.report("No key provided on widget",{widget:this}),this.showError("Error: Missing placement key."),!1))}},{key:"showError",value:function(e){this.setMarkup(a.ui.engine.render("okanjo.error",this,{message:e}))}},{key:"setMarkup",value:function(e){this.element.innerHTML=e}},{key:"getDataAttributes",value:function(){var e={};return Array.from(this.element.attributes).forEach(function(t){var n=s.exec(t.name);n&&(e[n[1]]=t.value)}),e}}],[{key:"getCurrentPageUrl",value:function(){return o.location.href.replace(/([?#].*)$/,"")}}]),l}(a._EventEmitter);return c.Field=function(){function e(){n(this,e),this._convert=null,this._strip=!1,this._default=void 0,this._group=null}return i(e,[{key:"array",value:function(e){return this._convert=function(t){return Array.isArray(t)?e?t.map(function(t){return e(t)}):t:(t=t.replace(/\\,/g,"\0"),t.split(",").map(function(t){var n=t.trim().replace("\0",",");return e&&(n=e(n)),n}))},this}},{key:"string",value:function(){return this._convert=function(e){return null===e||void 0===e?e:""+e},this}},{key:"bool",value:function(){return this._convert=function(e){return"string"==typeof e?"1"===e||"true"===e.toLowerCase():!!e},this}},{key:"strip",value:function(){return this._strip=!0,this}},{key:"int",value:function(){return this._convert=function(e){return parseInt(e)},this}},{key:"float",value:function(){return this._convert=function(e){return parseFloat(e)},this}},{key:"default",value:function(e){return this._default=e,this}},{key:"group",value:function(e){return this._group=e,this}},{key:"getGroup",value:function(){return this._group}},{key:"value",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._strip||!t)return void 0!==e&&this._convert&&(e=this._convert(e)),void 0!==e?e:this._default}}],[{key:"array",value:function(t){return(new e).array(t)}},{key:"string",value:function(){return(new e).string()}},{key:"bool",value:function(){return(new e).bool()}},{key:"strip",value:function(){return(new e).strip()}},{key:"int",value:function(){return(new e)["int"]()}},{key:"float",value:function(){return(new e)["float"]()}}]),e}(),a._Widget=c}(window),function(r){var o=r.okanjo,a=o._Widget.Field,s=a.string,u=a.array,c=a["float"],l=a["int"],d=a.bool,h=o.metrics.constructor,f=o.ui.engine.constructor,p="filters",g="display",m="article_meta",v=.5,y=1e3,_=2,b=function(a){function b(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n(this,b),i=o.util.flatten(i,{ignoreArrays:!0});var r=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,t,i));return r.name="Placement",r._metricBase={},r._response=null,r._viewWatcherIv=null,r._viewedWatchers=[],i.no_init||r.init(),r}return t(b,a),i(b,[{key:"getSettings",value:function(){return{type:s().group(p),ids:u().group(p),q:s().group(p),url:s().group(p),url_referrer:s().group(p).strip(),url_selectors:s().group(p),organization_id:s().group(p),property_id:s().group(p),store_id:s().group(p),organization_name:s().group(p),property_name:s().group(p),store_name:s().group(p),external_id:s().group(p),sku:s().group(p),external_store_id:s().group(p),condition:s().group(p),manufacturer:s().group(p),upc:s().group(p),isbn:s().group(p),tags:u().group(p),category:u().group(p),pools:u().group(p),min_price:c().group(p),max_price:c().group(p),min_donation_percent:c().group(p),max_donation_percent:c().group(p),donation_to:s().group(p),sort_by:s().group(p),sort_direction:s().group(p),skip:l().group(p),take:l().group(p),placement_tests_only:d(),size:s().group(g),template_name:s().group(g),template_layout:s().group(g),template_theme:s().group(g),template_cta_style:s().group(g),template_cta_text:s().group(g),template_cta_color:s().group(g),adx_unit_path:s().group(g),url_category:u().group(m),url_keywords:u().group(m),key:s().strip(),no_init:d().strip(),proxy_url:s().strip(),expandable:d().strip()["default"](!0),disable_inline_buy:d().strip()["default"](!1),disable_popup:d().strip()["default"](!1),backwards:s().strip()}}},{key:"getConfig",value:function(){var e=this,t=this.getSettings(),n={filters:{},display:{},backfill:{},article_meta:{}},i=/^backfill_(.+)$/;return Object.keys(this.config).forEach(function(r){var o=e.config[r],a=r,s=!1,u=null,c=i.exec(r);c&&(a=c[1],s=!0),t[a]&&(o=t[a].value(o),u=t[a].getGroup());var l=s?n.backfill:n;u&&(l[u]=l[u]||{},l=l[u]),null===o?l[a]="":void 0!==o&&(l[a]=o)}),n}},{key:"load",value:function(){var e=this;this._setMetricBase(),this._fetchContent(function(t){t?e._reportWidgetLoad("fetch failed: "+t.statusCode||t.toString()):(e._mergeResponseSettings(),e._updateBaseMetaFromResponse(),e._showContent())})}},{key:"_setMetricBase",value:function(){var e=this._metricBase;e.ch=h.Channel.placement,e.cx=this.config.backwards||"auto",e.key=this.config.key,e.m=e.m||{},e.m.wgid=this.instanceId}},{key:"_reportWidgetLoad",value:function(e){var t=this,n=this._response||{},i=n.data||{results:[]};this._metricBase.m.decl=e||"0",this._metricBase.m.res_bf=i.backfilled?1:0,this._metricBase.m.res_total=i.total||0,this._metricBase.m.res_type=i.type,this._metricBase.m.res_length=i.results.length,o.metrics.create(this._metricBase).type(h.Object.widget,h.Event.impression).meta(this.getConfig()).element(this.element).viewport().send(),this._addOnceViewedHandler(this.element,function(){o.metrics.create(t._metricBase).type(h.Object.widget,h.Event.view).meta(t.getConfig()).element(t.element).viewport().send()})}},{key:"_fetchContent",value:function(e){var t=this,n=this.getConfig(),i=this.config.key;o.metrics.sid&&(n.sid=o.metrics.sid),n.filters.url_referrer=this.config.url_referrer||r.location.href,n.wgid=this.instanceId,n.pgid=o.metrics.pageId,o.net.request.post(o.net.getRoute(o.net.routes.ads,null,this.config.sandbox?"sandbox":"live")+"?key="+encodeURIComponent(i),n,function(n,i){n?(o.report("Failed to retrieve placement content",n,{placement:t}),t.setMarkup(""),t.emit("error",n),e&&e(n)):(t._response=i,t.emit("data"),e&&e())})}},{key:"_mergeResponseSettings",value:function(){var e=this,t=this._response,n=t.data||{},i=n.settings||{};i.filters&&Object.keys(i.filters).forEach(function(t){e.config[t]=i.filters[t]}),i.display&&Object.keys(i.display).forEach(function(t){e.config[t]=i.display[t]})}},{key:"_updateBaseMetaFromResponse",value:function(){var e=(this._response||{}).data||{};this._metricBase.m=this._metricBase.m||{};var t=this._metricBase.m;e.article&&(t.aid=e.article.id),e.test&&e.test.enabled?(t.pten=1,t.ptid=e.test.id,t.ptseed=e.test.seed):t.pten=0}},{key:"_showContent",value:function(){var e=(this._response||{}).data||{};if(e.type===b.ContentTypes.products)this._showProducts();else if(e.type===b.ContentTypes.articles)this._showArticles();else if(e.type===b.ContentTypes.adx)this._showADX();else{var t="Unknown response content type: "+e.type;o.report(t,{placement:this}),this.setMarkup(""),this.emit("error",t),this._reportWidgetLoad(t)}}},{key:"_getClickThroughURL",value:function(e,t,n){var i=t.indexOf("?")>=0?"&":"?";return n=n||{},n.ok_msid=o.metrics.sid||"unknown",n.ok_ch=this._metricBase.ch,n.ok_cx=this._metricBase.cx,n.utm_source="okanjo",n.utm_campaign="smartserve",t+=i+Object.keys(n).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(n[e])}).join("&"),this.config.proxy_url&&(t=this.config.proxy_url+encodeURIComponent(t)),e.data({u:t}),e.toUrl()}},{key:"_handleResourceMouseDown",value:function(e,t,n){var i=o.util.shortid(),r=o.metrics.create(this._metricBase,{id:t.id}).type(e,h.Event.interaction).meta(this.getConfig()).meta({cid:i}).meta({bf:t.backfill?1:0}).event(n).element(n.currentTarget).viewport(),a="url_track_param",s="url";e===h.Object.product&&(a="buy_url_track_param",s="buy_url");var u={ok_cid:i};t[a]&&(u[t[a]]=(o.metrics.sid||"unknown")+":"+i),r.data({ea:h.Action.click}),n.currentTarget.href=this._getClickThroughURL(r,t[s],u),t._clickId=i,t._event=r,t._additionalParams=u}},{key:"_getTemplate",value:function(e,t){var n=this.config.template_name;return n&&o.ui.engine.isTemplateRegistered(e+"."+n)||(n=t),e+"."+n}},{key:"_enforceLayoutOptions",value:function(){"leaderboard"===this.config.size||"large_mobile_banner"===this.config.size?(this.config.template_layout="list",this.config.template_cta_style="link"):"half_page"!==this.config.size&&"auto"!==this.config.size||(this.config.template_layout="list")}},{key:"_registerCustomBranding",value:function(e,t){var n=this.config.template_cta_color;if(n){var i=void 0,r="okanjo-wgid-"+this.instanceId;i="\n                    "+e+"-block2."+r+" "+e+"-"+t+" { color: "+n+";} \n                    "+e+"-block2."+r+".okanjo-cta-style-button "+e+"-"+t+" { border: 1px solid "+n+"; } \n                    "+e+"-block2."+r+".okanjo-cta-style-button "+e+"-"+t+":hover { background: "+n+"; } \n                ",o.ui.engine.registerCss(r,i,{id:r}),o.ui.engine.ensureCss(r)}}},{key:"_addOnceViewedHandler",value:function(e,t){var n={element:e,successfulCount:0,handler:t};this._viewedWatchers.push(n),this._toggleViewWatcher(!0)}},{key:"_checkViewWatchers",value:function(){for(var e,t=0;t<this._viewedWatchers.length;t++)e=this._viewedWatchers[t],o.ui.getPercentageInViewport(e.element)>=v&&e.successfulCount++,e.successfulCount>=_&&(e.handler(),this._viewedWatchers.splice(t,1),t--);0===this._viewedWatchers.length&&this._toggleViewWatcher(!1)}},{key:"_toggleViewWatcher",value:function(e){e?null===this._viewWatcherIv&&(this._viewWatcherIv=setInterval(this._checkViewWatchers.bind(this),y/_)):(clearInterval(this._viewWatcherIv),this._viewWatcherIv=null)}},{key:"_showProducts",value:function(){var e=this,t=(this._response||{data:{results:[]}}).data||{results:[]},n=this._getTemplate(b.ContentTypes.products,b.DefaultTemplates.products);t.results.forEach(function(t,n){e.config.disable_inline_buy&&(t.inline_buy_url=null),t.inline_buy_url&&(t._escaped_inline_buy_url=encodeURIComponent(t.inline_buy_url)),t._image_url=t.image_urls?t.image_urls[0]:"",t._escaped_buy_url=encodeURIComponent(t.buy_url),t._price_formatted=f.formatCurrency(t.price),t._index=n}),this.setMarkup(o.ui.engine.render(n,this)),0===t.results.length?(this.emit("empty"),this._reportWidgetLoad("empty")):this._reportWidgetLoad(),this.element.querySelectorAll("a").forEach(function(t){var n=t.getAttribute("data-id"),i=t.getAttribute("data-index");if(n&&i>=0){var r=e._response.data.results[i];r&&(t.addEventListener("mousedown",e._handleResourceMouseDown.bind(e,h.Object.product,r)),t.addEventListener("click",e._handleProductClick.bind(e,r)),o.metrics.create(e._metricBase,{id:r.id}).type(h.Object.product,h.Event.impression).meta(e.getConfig()).meta({bf:r.backfill?1:0}).element(t).viewport().send(),e._addOnceViewedHandler(t,function(){o.metrics.create(e._metricBase,{id:r.id}).type(h.Object.product,h.Event.view).meta(e.getConfig()).meta({bf:r.backfill?1:0}).element(t).viewport().send()}))}}),this.element.querySelectorAll(".okanjo-resource-title").forEach(function(e){o.ui.ellipsify(e)}),this.emit("load")}},{key:"_handleProductClick",value:function(e,t){e._event&&e._additionalParams&&e._clickId||this._handleResourceMouseDown(h.Object.product,e,t);var n=e._event,i=e._additionalParams;n.event(t);var a=!!e.inline_buy_url,s=!this.config.disable_popup&&a&&o.util.isMobile();if(s){t.preventDefault(),n.data({ea:h.Action.inline_click}).meta({popup:"true"});var u=this._getClickThroughURL(n,e.inline_buy_url,i);this._popupFrame=r.open(u,"okanjo-inline-buy-frame","width=400,height=400,location=yes,resizable=yes,scrollbars=yes"),
this._popupFrame||(o.report("Popup blocker stopped buy experience from showing",{placement:this}),r.location.href=u)}else if(a){t.preventDefault();var c=document.createElement("iframe"),l={"class":"okanjo-inline-buy-frame",frameborder:0,vspace:0,hspace:0,webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:"",scrolling:"auto"};if(Object.keys(l).forEach(function(e){return c.setAttribute(e,l[e])}),i.expandable=this.config.expandable?1:0,!this.config.expandable){var d=this.element.querySelector(".okanjo-expansion-root");if(d){c.className+=" okanjo-ad-in-unit",c.setAttribute("height","100%"),c.setAttribute("width","100%"),d.appendChild(c);var f=o.ui.getElementSize(d);i.frame_height=f.height,i.frame_width=f.width,this.config.size&&(i.ad_size=this.config.size)}}n.data({ea:h.Action.inline_click}).meta({expandable:this.config.expandable?"true":"false"}),c.src=this._getClickThroughURL(n,e.inline_buy_url,i),c.parentNode||o.ui.modal.show(c)}else t.currentTarget.href=this._getClickThroughURL(n,e.buy_url,i)}},{key:"_showArticles",value:function(){var e=this,t=(this._response||{data:{results:[]}}).data||{results:[]},n=this._getTemplate(b.ContentTypes.articles,b.DefaultTemplates.articles);t.results.forEach(function(e,t){e._escaped_url=encodeURIComponent(e.url),e._index=t}),this.setMarkup(o.ui.engine.render(n,this)),0===t.results.length?(this.emit("empty"),this._reportWidgetLoad("empty")):this._reportWidgetLoad(),this.element.querySelectorAll("a").forEach(function(t){var n=t.getAttribute("data-id"),i=t.getAttribute("data-index");if(n&&i>=0){var r=e._response.data.results[i];r&&(t.addEventListener("mousedown",e._handleResourceMouseDown.bind(e,h.Object.article,r)),t.addEventListener("click",e._handleArticleClick.bind(e,r)),o.metrics.create(e._metricBase,{id:r.id}).type(h.Object.article,h.Event.impression).meta(e.getConfig()).meta({bf:r.backfill?1:0}).element(t).viewport().send(),e._addOnceViewedHandler(t,function(){o.metrics.create(e._metricBase,{id:r.id}).type(h.Object.article,h.Event.view).meta(e.getConfig()).meta({bf:r.backfill?1:0}).element(t).viewport().send()}))}}),this.element.querySelectorAll(".okanjo-resource-title").forEach(function(e){o.ui.ellipsify(e)}),this.emit("load")}},{key:"_handleArticleClick",value:function(e,t){e._event&&e._additionalParams&&e._clickId||this._handleResourceMouseDown(h.Object.article,e,t);var n=e._event,i=e._additionalParams;n.event(t),t.currentTarget.href=this._getClickThroughURL(n,e.url,i)}},{key:"_showADX",value:function(){var e=this,t=(this._response||{data:{settings:{}}}).data||{settings:{}},n=this._getTemplate(b.ContentTypes.adx,b.DefaultTemplates.adx),i=null;if(this.config.size)if(b.Sizes[this.config.size])i=b.Sizes[this.config.size];else{var r=/^([0-9]+)x([0-9]+)$/i.exec(this.config.size);r&&(i={width:r[1],height:r[2]})}i||(i=b.Sizes["default"]);var a="/90447967/okanjo:<publisher>",s=void 0;t.settings.display&&t.settings.display.adx_unit_path&&(a=t.settings.display.adx_unit_path,s="custom_ad_unit");var u={size:i,adUnitPath:a};this.setMarkup(o.ui.engine.render(n,this,u)),this._reportWidgetLoad(s);var c=this.element.querySelector(".okanjo-adx-container");if(c){var l=document.createElement("iframe"),d={"class":"okanjo-adx-frame",frameborder:0,vspace:0,hspace:0,webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:"",scrolling:"auto",width:i.width,height:i.height};Object.keys(d).forEach(function(e){return l.setAttribute(e,d[e])}),c.appendChild(l);var f=o.metrics.create(this._metricBase).type(h.Object.thirdparty_ad,h.Event.interaction).meta(this.getConfig()).meta({ta_s:a,ta_w:i.width,ta_h:i.height}).element(l).viewport().toUrl();l.contentWindow.trackImpression=function(){o.metrics.create(e._metricBase).type(h.Object.thirdparty_ad,h.Event.impression).meta(e.getConfig()).meta({ta_s:a,ta_w:i.width,ta_h:i.height}).element(l).viewport().send(),e._addOnceViewedHandler(l,function(){o.metrics.create(e._metricBase).type(h.Object.thirdparty_ad,h.Event.view).meta(e.getConfig()).meta({ta_s:a,ta_w:i.width,ta_h:i.height}).element(l).viewport().send()})},l.contentWindow.document.open(),l.contentWindow.document.write('<html><head><style type="text/css">html,body {margin: 0; padding: 0;}</style></head><body>\n<'+('script type="text/javascript" src="https://www.googletagservices.com/tag/js/gpt.js">\n    googletag.pubads().addEventListener(\'slotRenderEnded\', function(e) { \n        trackImpression(e);\n    });\n    googletag.pubads()\n        .definePassback("'+a.replace(/"/g,'\\"')+'", [['+i.width+", "+i.height+']])\n        .setClickUrl("'+f+'&u=")\n        .display();\n<')+"/script>\n</body></html>"),l.contentWindow.document.close()}this.emit("load")}}]),b}(o._Widget);return b.Sizes={medium_rectangle:{width:300,height:250},leaderboard:{width:728,height:90},large_mobile_banner:{width:320,height:100},half_page:{width:300,height:600},billboard:{width:970,height:250},button_2:{width:120,height:60},micro_bar:{width:88,height:31},portrait:{width:300,height:1050},rectangle:{width:180,height:150},super_leaderboard:{width:970,height:90},wide_skyscraper:{width:160,height:600},mobile_leaderboard:{width:320,height:50},small_square:{width:200,height:200},button_1:{width:120,height:90},full_banner:{width:468,height:60},half_banner:{width:234,height:60},large_rectangle:{width:336,height:280},pop_under:{width:720,height:300},three_to_one_rectangle:{width:300,height:100},skyscraper:{width:120,height:600},square:{width:250,height:250},square_button:{width:125,height:125},vertical_banner:{width:120,height:240},vertical_rectangle:{width:240,height:400}},b.Sizes["default"]=b.Sizes.medium_rectangle,b.ContentTypes={products:"products",articles:"articles",adx:"adx"},b.DefaultTemplates={products:"block2",articles:"block2",adx:"block2"},o.Placement=b}(window),function(r){var o=r.okanjo,a=function(r){function a(t,i){n(this,a),i=i||{};var r=i.no_init;i.no_init=!0;var s=e(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,t,i));return o.warn("Product widget has been deprecated. Use Placement instead (may require configuration changes)",{widget:s}),r||(delete s.config.no_init,s.init()),s}return t(a,r),i(a,[{key:"_setCompatibilityOptions",value:function(){this.config.backwards="Product",this.config.type=o.Placement.ContentTypes.products,"sense"===this.config.mode?(this.config.url=this.config.url||"referrer",this.config.take=this.config.take||5):"single"===this.config.mode?(this.config.url=null,this.config.id&&(this.config.ids=[this.config.id]),this.config.take=1,delete this.config.id):(this.config.url=null,this.config.take=this.config.take||25),delete this.config.mode,this.config.sold_by&&(this.config.store_name=this.config.sold_by,delete this.config.sold_by),this.config.selectors&&(this.config.url_selectors=this.config.selectors,delete this.config.selectors),this.config.marketplace_id&&(this.config.property_id=this.config.marketplace_id,delete this.config.marketplace_id),"testing"===this.config.marketplace_status&&(this.config.sandbox=!0),delete this.config.marketplace_status,delete this.config.suboptimal,delete this.config.text}}]),a}(o.Placement);return o.Product=a}(window),function(r){var o=r.okanjo,a=function(r){function a(t,i){n(this,a),i=i||{};var r=i.no_init;i.no_init=!0;var s=e(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,t,i));return o.warn("Ad widget has been deprecated. Use Placement instead (may require configuration changes)",{widget:s}),r||(delete s.config.no_init,s.init()),s}return t(a,r),i(a,[{key:"_setCompatibilityOptions",value:function(){this.config.backwards="Ad",this.config.type=o.Placement.ContentTypes.products,this.config.url=null,this.config.id?this.config.ids=[this.config.id]:o.warn("Ad widget should have parameter `id` set."),this.config.take=1,delete this.config.id,delete this.config.content}}]),a}(o.Placement);return o.Ad=a}(window),function(){/*!
     * mustache.js - Logic-less {{mustache}} templates with JavaScript
     * http://github.com/janl/mustache.js
     */
!function(e,t){"object"===("undefined"==typeof exports?"undefined":r(exports))&&exports&&"string"!=typeof exports.nodeName?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):(e.Mustache={},t(e.Mustache))}(this,function(e){function t(e){return"function"==typeof e}function n(e){return m(e)?"array":"undefined"==typeof e?"undefined":r(e)}function i(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(e,t){return null!=e&&"object"===("undefined"==typeof e?"undefined":r(e))&&t in e}function a(e,t){return v.call(e,t)}function s(e){return!a(y,e)}function u(e){return String(e).replace(/[&<>"'`=\/]/g,function(e){return _[e]})}function c(t,n){function r(){if(v&&!y)for(;g.length;)delete p[g.pop()];else g=[];v=!1,y=!1}function o(e){if("string"==typeof e&&(e=e.split(k,2)),!m(e)||2!==e.length)throw new Error("Invalid tags: "+e);a=new RegExp(i(e[0])+"\\s*"),u=new RegExp("\\s*"+i(e[1])),c=new RegExp("\\s*"+i("}"+e[1]))}if(!t)return[];var a,u,c,f=[],p=[],g=[],v=!1,y=!1;o(n||e.tags);for(var _,E,C,O,T,A,P=new h(t);!P.eos();){if(_=P.pos,C=P.scanUntil(a))for(var S=0,M=C.length;S<M;++S)O=C.charAt(S),s(O)?g.push(p.length):y=!0,p.push(["text",O,_,_+1]),_+=1,"\n"===O&&r();if(!P.scan(a))break;if(v=!0,E=P.scan(x)||"name",P.scan(b),"="===E?(C=P.scanUntil(w),P.scan(w),P.scanUntil(u)):"{"===E?(C=P.scanUntil(c),P.scan(j),P.scanUntil(u),E="&"):C=P.scanUntil(u),!P.scan(u))throw new Error("Unclosed tag at "+P.pos);if(T=[E,C,_,P.pos],p.push(T),"#"===E||"^"===E)f.push(T);else if("/"===E){if(A=f.pop(),!A)throw new Error('Unopened section "'+C+'" at '+_);if(A[1]!==C)throw new Error('Unclosed section "'+A[1]+'" at '+_)}else"name"===E||"{"===E||"&"===E?y=!0:"="===E&&o(C)}if(A=f.pop())throw new Error('Unclosed section "'+A[1]+'" at '+P.pos);return d(l(p))}function l(e){for(var t,n,i=[],r=0,o=e.length;r<o;++r)t=e[r],t&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(i.push(t),n=t));return i}function d(e){for(var t,n,i=[],r=i,o=[],a=0,s=e.length;a<s;++a)switch(t=e[a],t[0]){case"#":case"^":r.push(t),o.push(t),r=t[4]=[];break;case"/":n=o.pop(),n[5]=t[2],r=o.length>0?o[o.length-1][4]:i;break;default:r.push(t)}return i}function h(e){this.string=e,this.tail=e,this.pos=0}function f(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function p(){this.cache={}}var g=Object.prototype.toString,m=Array.isArray||function(e){return"[object Array]"===g.call(e)},v=RegExp.prototype.test,y=/\S/,_={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},b=/\s*/,k=/\s+/,w=/\s*=/,j=/\s*\}/,x=/#|\^|\/|>|\{|&|=|!/;h.prototype.eos=function(){return""===this.tail},h.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},h.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},f.prototype.push=function(e){return new f(e,this)},f.prototype.lookup=function(e){var n,i=this.cache;if(i.hasOwnProperty(e))n=i[e];else{for(var r,a,s=this,u=!1;s;){if(e.indexOf(".")>0)for(n=s.view,r=e.split("."),a=0;null!=n&&a<r.length;)a===r.length-1&&(u=o(n,r[a])),n=n[r[a++]];else n=s.view[e],u=o(s.view,e);if(u)break;s=s.parent}i[e]=n}return t(n)&&(n=n.call(this.view)),n},p.prototype.clearCache=function(){this.cache={}},p.prototype.parse=function(e,t){var n=this.cache,i=n[e];return null==i&&(i=n[e]=c(e,t)),i},p.prototype.render=function(e,t,n){var i=this.parse(e),r=t instanceof f?t:new f(t);return this.renderTokens(i,r,n,e)},p.prototype.renderTokens=function(e,t,n,i){for(var r,o,a,s="",u=0,c=e.length;u<c;++u)a=void 0,r=e[u],o=r[0],"#"===o?a=this.renderSection(r,t,n,i):"^"===o?a=this.renderInverted(r,t,n,i):">"===o?a=this.renderPartial(r,t,n,i):"&"===o?a=this.unescapedValue(r,t):"name"===o?a=this.escapedValue(r,t):"text"===o&&(a=this.rawValue(r)),void 0!==a&&(s+=a);return s},p.prototype.renderSection=function(e,n,i,o){function a(e){return s.render(e,n,i)}var s=this,u="",c=n.lookup(e[1]);if(c){if(m(c))for(var l=0,d=c.length;l<d;++l)u+=this.renderTokens(e[4],n.push(c[l]),i,o);else if("object"===("undefined"==typeof c?"undefined":r(c))||"string"==typeof c||"number"==typeof c)u+=this.renderTokens(e[4],n.push(c),i,o);else if(t(c)){if("string"!=typeof o)throw new Error("Cannot use higher-order sections without the original template");c=c.call(n.view,o.slice(e[3],e[5]),a),null!=c&&(u+=c)}else u+=this.renderTokens(e[4],n,i,o);return u}},p.prototype.renderInverted=function(e,t,n,i){var r=t.lookup(e[1]);if(!r||m(r)&&0===r.length)return this.renderTokens(e[4],t,n,i)},p.prototype.renderPartial=function(e,n,i){if(i){var r=t(i)?i(e[1]):i[e[1]];return null!=r?this.renderTokens(this.parse(r),n,i,r):void 0}},p.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(null!=n)return n},p.prototype.escapedValue=function(t,n){var i=n.lookup(t[1]);if(null!=i)return e.escape(i)},p.prototype.rawValue=function(e){return e[1]},e.name="mustache.js",e.version="2.3.0",e.tags=["{{","}}"];var E=new p;return e.clearCache=function(){return E.clearCache()},e.parse=function(e,t){return E.parse(e,t)},e.render=function(e,t,i){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+n(e)+'" was given as the first argument for mustache#render(template, view, partials)');return E.render(e,t,i)},e.to_html=function(n,i,r,o){var a=e.render(n,i,r);return t(o)?void o(a):a},e.escape=u,e.Scanner=h,e.Context=f,e.Writer=p,e})}.apply(o.lib),o});
//# sourceMappingURL=okanjo.min.js.map
