/*! okanjo-js v0.6.9 | (c) 2013 Okanjo Partners Inc | https://okanjo.com/ */
!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.okanjo=t()}(this,function(){var okanjo=function(e){function t(e){for(var t,n,i,o,r={},s=e.split("&"),a=0;a<s.length;a++)t=s[a],o=t.indexOf("="),0>o?(n=decodeURIComponent(t),i=null):(n=decodeURIComponent(t.substring(0,o)),i=decodeURIComponent(t.substring(o+1))),n&&(r[n]=i);return r}var n=void 0!==window.pageXOffset,i="CSS1Compat"===(document.compatMode||""),o=window.navigator.userAgent,r=function(){},s=e||{};s.qwery=r,s.metrics={trackEvent:r,trackPageView:r},s.routes={products:"/products",products_id:"/products/:product_id",products_sense:"/products/sense",metrics:"/metrics/:object_type/:event_type"},s.getRoute=function(e,t){if(t)for(var n in t)t.hasOwnProperty(n)&&(e=e.replace(":"+n,t[n]+""));return s.config.ads.apiUri+e},s.exec=function(e,t,n){t=t||{},s.JSONP({url:e,data:t,error:function(e){var t={statusCode:500,error:"Communication Error",message:e.message||"JSONP communication failure."};s.report("core-jsonp",e.error||new Error(t.message)),n(t,null)},success:function(e){var t,i;e?e.error?t=e:i=e:(t={statusCode:500,error:"Invalid Response",message:"Could not interpret the JSONP response."},s.report("core-jsonp",new Error(t.message))),n(t,i)}})},s.report=function(e,t){var n;"string"==typeof t?n=new Error("[Okanjo"+(e?" "+e:"")+"] "+t):"object"==typeof t&&t instanceof Error&&(n=t),console.error(n)};var a=s.util=s.util||{};/*! https://github.com/isaacs/inherits/blob/master/inherits_browser.js */
return a.trim=function(e){return(e||"").replace(/^\s+|\s+$/g,"")},a.empty=function(e){return null===e||void 0===e||"string"==typeof e&&""===a.trim(e)},a.clone=function(e){var t={};e=e||{};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},a.hash=function(e){var t=0;if(0===e.length)return""+t;for(var n=0;n<e.length;n++){var i=e.charCodeAt(n);t=(t<<5)-t+i}return t.toString(16).replace(/^-/,"n")},a.data=function(e){var t={};if(e)for(var n=e.attributes,i=n.length-1;i>=0;i--)0===n[i].name.indexOf("data-")&&(t[n[i].name.substr(5)]=n[i].value);return t},a.copyIfSet=function(e,t,n,i,o){function r(i){!t||void 0===t[i]||o.stripEmpty&&a.empty(t[i])||(e[n]=t[i])}if(i=i||n,o=o||{},"object"==typeof i&&Array.isArray(i))for(var s=0;s<i.length;s++)r(i[s]);else r(i)},a.copyIfSetMap=function(e,t,n,i){for(var o=Object.keys(n),r=0;r<o.length;r++)a.copyIfSet(e,t,o[r],n[o[r]],i)},a.inherits=function(e,t){if("function"==typeof Object.create)e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}});else{e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},a.getScrollPosition=function(){return{x:n?window.pageXOffset:i?document.documentElement.scrollLeft:document.body.scrollLeft,y:n?window.pageYOffset:i?document.documentElement.scrollTop:document.body.scrollTop}},a.getElementSize=function(e,t){var n,i={height:e.offsetHeight,width:e.offsetWidth};return t&&(n=e.currentStyle||getComputedStyle(e),i.height+=parseInt(n.marginTop)+parseInt(n.marginBottom),i.width+=parseInt(n.marginLeft)+parseInt(n.marginRight)),i},a.getElementPosition=function(e){var t,n,i="[Okanjo Core] Could not get position of element. Did you attach the element to the DOM before initializing?";try{return t=e.getBoundingClientRect(),n=a.getScrollPosition(),document.contains(e)||console.warn(i),{x1:t.left+n.x,y1:t.top+n.y,x2:t.right+n.x,y2:t.bottom+n.y}}catch(o){return console.warn(i,o),{x1:0,y1:0,x2:0,y2:0}}},a.getPageSize=function(){var e=s.qwery("body")[0],t=document.documentElement;return{w:Math.max(e.scrollWidth,e.offsetWidth,t.clientWidth,t.scrollWidth,t.offsetWidth),h:Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight)}},a.getViewportSize=function(){var e=document,t=window,n=e.compatMode&&"CSS1Compat"===e.compatMode?e.documentElement:e.body,i=n.clientWidth,o=n.clientHeight,r=t.innerWidth||0,s=t.innerHeight||0,a=r&&i>r||s&&o>s;return{vw:a?r:i,vh:a?s:o}},a.ellipsify=function(e,t){for(var n=t||e.parentNode,i=a.getElementSize(n).height,o=void 0!==e.textContent,r=o?e.textContent:e.innerText,s="",c=5e3,u=function(e){return s=e.substr(0,e.length-3)+s,"..."};a.getElementSize(e).height>i&&r.length>0&&c-->0;)r=o?e.textContent:e.innerText,r=r.replace(/[\s\S](?:\.\.\.)?$/,u),o?e.textContent=r:e.innerText=r;if(s.length>0){var l=document.createElement("span"),h=document.createElement("span");l.setAttribute("class","okanjo-ellipses"),h.setAttribute("class","okanjo-visually-hidden"),o?(l.textContent=r.substr(0,r.length-3),h.textContent=s):(l.innerText=r.substr(0,r.length-3),h.innerText=s),e.innerHTML="",e.appendChild(l),e.appendChild(h)}},a.detectClasses=function(){var e=[];return-1!=navigator.appVersion.indexOf("MSIE 9.")?e.push("lt-ie10"):-1!=navigator.appVersion.indexOf("MSIE 8.")?e.push("lt-ie9"):-1!=navigator.appVersion.indexOf("MSIE 7.")?e.push("lt-ie8"):-1!=navigator.appVersion.indexOf("MSIE 6.")&&e.push("lt-ie7"),e},a.isFramed=function(){return window.top!==window.self},a.isiOS=function(){return/(iPhone|iPad|iPod)/i.test(o)},a.isAndroid=function(){return/Android/.test(o)},a.isMobile=function(){return a.isiOS()||a.isAndroid()},a.getPageArguments=function(e){var n=t(window.location.search.substring(window.location.search.indexOf("?")+1));if(e){var i=t(window.location.hash.substring(Math.max(window.location.hash.indexOf("#")+1,window.location.hash.indexOf("#!")+2)));for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])}return n},a.deepClone=function(e,t){var n,i=0;if(Array.isArray(e))for(t=t||[];i<e.length;i++)t.push(a.deepClone(e[i]));else if("object"==typeof e){t=t||{};for(n in e)e.hasOwnProperty(n)&&(t[n]=a.deepClone(e[n]))}else t=e;return t},s}(okanjo||window.okanjo),config=okanjo.config=okanjo.config||{};/*! Console-polyfill. | MIT license. | https://github.com/paulmillr/console-polyfill */
/*! Okanjo Local Storage Polyfill v1.0.0 | (c) 2013 Okanjo Partners Inc | Based on https://gist.github.com/juliocesar/926500/ddb28fb72903be87cb9044a945c6edbe1aa28b3a */
/*! Okanjo Cookie Helper v1.0.0 | (c) 2013 Okanjo Partners Inc */
return config.key=config.key||void 0,config.marketplace={uri:"https://shop.okanjo.com",apiUri:"https://api.okanjo.com",routerUri:"https://shop.okanjo.com/widgets/router/",balancedMarketplacePath:"/v1/marketplaces/MP6vnNdXY7izEEVPs1gl7jSy",socketIOUri:"https://mke-rt.okanjo.com:13443"},config.ads={apiUri:"https://ads-api.okanjo.com"},okanjo.configure=function(e){Object.keys(e).every(function(t){return config[t]&&"object"==typeof config[t]&&"object"==typeof e[t]?Object.keys(e[t]).every(function(n){return config[t][n]=e[t][e[n]],!0}):config[t]=e[t],!0})},function(e,t){var n=e.TemplateEngine=function(t){t=t||{templates:{},css:{}},this._templates=t.templates||{},this._css=t.css||{},this.classDetects=e.util.detectClasses(),this.classDetects=this.classDetects.join(" ")};n.prototype={constructor:n,registerTemplate:function(t,n,i,o){if("object"==typeof n){if(void 0===n.nodeType)throw new Error("Parameter template must be a string or a DOM element");e.Mustache.parse(n)}else if("string"!=typeof n)throw new Error("Parameter template must be a string or a DOM element");if(3===arguments.length&&"object"==typeof i?(o=i,i=void 0):o=o||{},void 0!==i&&"function"!=typeof i)throw new Error("Parameter viewClosure must be a function");this._templates[t]={markup:n,options:o,viewClosure:i||null}},registerCss:function(e,t,n){if(n=n||{},"object"==typeof t){if(void 0===t.nodeType)throw new Error("Parameter css must be a string or a DOM element")}else if("string"!=typeof t)throw new Error("Parameter css must be a string or a DOM element");this._css[e]={markup:t,options:n}},isTemplateRegistered:function(e){return this._templates[e]?!0:!1},isCssRegistered:function(e){return this._css[e]?!0:!1},ensureCss:function(t){if(this._css[t]){var n=this._css[t],i=void 0===n.markup.nodeType?n.options.id||"okanjo-css-"+t:null;if(i){var o=e.qwery("#"+i);if(0===o.length){var r=e.qwery("head"),s=document.createElement("style");if(s.id=i,s.setAttribute("type","text/css"),s.hasOwnProperty?s.innerHTML=n.markup:s.styleSheet.cssText=n.markup,r.length>0)r[0].appendChild(s);else{var a=e.qwery("body");a.length>0&&a[0].appendChild(s)}}}}else console.warn('[Okanjo.Template] Attempted to add CSS template "'+t+'" to the DOM, however it does not appear to be registered?')},render:function(t,n,i,o){o=o||{};var r=this._templates[t],s=i;if(r.viewClosure&&(s=r.viewClosure.call(n,i,o)),s.okanjoConfig=e.config,s.okanjoMetricUrl=e.config.ads.apiUri.replace(/^https?:\/\//,""),s.now=function(){return(new Date).getTime()},s.classDetects=this.classDetects,o.blockClasses&&Array.isArray(o.blockClasses)&&(s.classDetects=s.classDetects+=" "+o.blockClasses.join(" ")),o.css!==!1&&r.options.css&&r.options.css.length>0)for(var a=0;a<r.options.css.length;a++)this.ensureCss(r.options.css[a]);return e.Mustache.render(r.markup,s)},formats:{currency:function(e,t,n,i){t=isNaN(t=Math.abs(t))?2:t,n=void 0===n?".":n,i=void 0===i?",":i;var o=0>e?"-":"",r=parseInt(e=Math.abs(+e||0).toFixed(t))+"",s=r.length;return s=s>3?s%3:0,o+(s?r.substr(0,s)+i:"")+r.substr(s).replace(/(\d{3})(?=\d)/g,"$1"+i)+(t?n+Math.abs(e-r).toFixed(t).slice(2):"")},product:function(t){if("object"==typeof t&&Array.isArray(t)){for(var n=[],i=0;i<t.length;i++)n.push(this.product(t[i]));return n}return"object"==typeof t?(t.image_url=t.image_urls?t.image_urls[0]:"",t.escaped_buy_url=encodeURIComponent(t.buy_url),t.escaped_inline_buy_url=e.util.empty(t.inline_buy_url)?"":encodeURIComponent(t.inline_buy_url),t.price_formatted=this.currency(t.price),t):null}}},e.mvc=new n}(okanjo,this),function(){if(!this.JSONP){var e,t,n,i,o,r,s;n=window.encodeURIComponent,i=function(){return void 0},t=function(e){var t;return t=e.url,t+=e.url.indexOf("?")<0?"?":"&",t+=o(e.data)},r=function(){return e.requestCounter+=1,(new Date).getTime()+"_"+e.requestCounter},o=function(e){var t,i,o;t=[];for(i in e)if(e.hasOwnProperty(i))if(o=e[i],Array.isArray(o))for(var r=0;r<o.length;r++)t.push(n(i)+"[]="+n(o[r]));else if("object"==typeof o)for(var s in o)o.hasOwnProperty(s)&&t.push(n(i)+"["+n(s)+"]="+n(o[s]));else t.push(n(i)+"="+n(o));return t.join("&")},e=function(e){e=e?e:{};var n,o,a,c,u,l;if(a={data:e.data||{},error:e.error||i,success:e.success||i,beforeSend:e.beforeSend||i,complete:e.complete||i,url:e.url||"",timeout:e.timeout||3e4},a.computedUrl=t(a),0===a.url.length)throw new Error("MissingUrl");return o=!1,a.beforeSend({},a)!==!1?(n=a.data[e.callbackName||"callback"]="_okanjo_jsonp_"+r(),window[n]=function(e){u&&clearTimeout(u),u=null,a.success(e,a),a.complete(e,a),l()},l=function(){try{return delete window[n]}catch(e){return void(window[n]=void 0)}},c=window.document.createElement("script"),c.src=t(a),c.async=!0,u=setTimeout(function(){u=null;var e=new Error("JSONP request did not respond in time!");return e.url=c&&c.src||null,a.error(e),l(),a.complete(e,a)},a.timeout),c.onerror=function(e){return u&&clearTimeout(u),a.error({url:c.src,event:e}),a.complete({url:c.src,event:e},a)},c.onload=c.onreadystatechange=function(){return o||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState?void 0:(o=!0,c.onload=c.onreadystatechange=null,c&&c.parentNode&&c.parentNode.removeChild(c),c=null)},s=s||window.document.getElementsByTagName("head")[0]||window.document.documentElement,s.insertBefore(c,s.firstChild)):void 0},e.requestCounter=0,e.makeUrl=t,e.objectToURI=o,"undefined"!=typeof define&&null!==define&&define.amd?define(function(){return e}):"undefined"!=typeof module&&null!==module&&module.exports?module.exports=e:this.JSONP=e}}.call(okanjo),Object.keys||(Object.keys=function(){"use strict";var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],i=n.length;return function(o){if("object"!=typeof o&&("function"!=typeof o||null===o))throw new TypeError("Object.keys called on non-object");var r,s,a=[];for(r in o)e.call(o,r)&&a.push(r);if(t)for(s=0;i>s;s++)e.call(o,n[s])&&a.push(n[s]);return a}}()),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n;if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),o=i.length>>>0;if(0===o)return-1;var r=+t||0;if(Math.abs(r)===1/0&&(r=0),r>=o)return-1;for(n=Math.max(r>=0?r:o-Math.abs(r),0);o>n;){if(n in i&&i[n]===e)return n;n++}return-1}),Array.prototype.every||(Array.prototype.every=function(e,t){"use strict";var n,i;if(null==this)throw new TypeError("this is null or not defined");var o=Object(this),r=o.length>>>0;if("function"!=typeof e)throw new TypeError;for(arguments.length>1&&(n=t),i=0;r>i;){var s;if(i in o){s=o[i];var a=e.call(n,s,i,o);if(!a)return!1}i++}return!0}),Array.prototype.filter||(Array.prototype.filter=function(e){"use strict";if(void 0===this||null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var i=[],o=arguments.length>=2?arguments[1]:void 0,r=0;n>r;r++)if(r in t){var s=t[r];e.call(o,s,r,t)&&i.push(s)}return i}),function(){if(Event.prototype.preventDefault||(Event.prototype.preventDefault=function(){this.returnValue=!1}),Event.prototype.stopPropagation||(Event.prototype.stopPropagation=function(){this.cancelBubble=!0}),!Element.prototype.addEventListener){var e=[],t=function(t,n){var i=this,o=function(e){e.target=e.srcElement,e.currentTarget=i,n.handleEvent?n.handleEvent(e):n.call(i,e)};if("DOMContentLoaded"==t){var r=function(e){"complete"==document.readyState&&o(e)};if(document.attachEvent("onreadystatechange",r),e.push({object:this,type:t,listener:n,wrapper:r}),"complete"==document.readyState){var s=new Event;s.srcElement=window,r(s)}}else this.attachEvent("on"+t,o),e.push({object:this,type:t,listener:n,wrapper:o})},n=function(t,n){for(var i=0;i<e.length;){var o=e[i];if(o.object==this&&o.type==t&&o.listener==n){"DOMContentLoaded"==t?this.detachEvent("onreadystatechange",o.wrapper):this.detachEvent("on"+t,o.wrapper),e.splice(i,1);break}++i}};Element.prototype.addEventListener=t,Element.prototype.removeEventListener=n,HTMLDocument&&(HTMLDocument.prototype.addEventListener=t,HTMLDocument.prototype.removeEventListener=n),Window&&(Window.prototype.addEventListener=t,Window.prototype.removeEventListener=n)}}(),function(e){"use strict";var t,n,i=e.console||{},o={},r=function(){},s="memory".split(","),a="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(",");for(e.console=i;t=s.pop();)void 0===i[t]&&(i[t]=i[t]||o);for(;n=a.pop();)void 0===i[n]&&(i[n]=i[n]||r)}(this||{}),function(e,t){function n(){var e="test",n=t.sessionStorage;try{return n.setItem(e,"1"),n.removeItem(e),!0}catch(i){return!1}}var i=null;return i="localStorage"in t&&null!==t.localStorage&&n()?t.localStorage:{_data:{},length:0,_updateLen:function(){this.length=this._data.length},setItem:function(e,t){var n=this._data[e]=String(t);return this._updateLen(),n},getItem:function(e){return this._data.hasOwnProperty(e)?this._data[e]:void 0},removeItem:function(e){var t=delete this._data[e];return this._updateLen(),t},clear:function(){return this._data={}},key:function(e){return Object.keys(this._data)[e]}},e.Cache=i,i}(okanjo||this,this),function(e,t){var n=t.document||{cookie:""};return e.Cookie={set:function(e,t,i){var o=new Date;o.setDate(o.getDate()+i);var r=encodeURI(t)+(i?"; Expires="+o.toUTCString()+"; Path=/":"");n.cookie=e+"="+r},get:function(e){var t,i,o,r=n.cookie.split(";");for(t=0;t<r.length;t++)if(i=r[t].substr(0,r[t].indexOf("=")),o=r[t].substr(r[t].indexOf("=")+1),i=i.replace(/^\s+|\s+$/g,""),i==e)return decodeURI(o);return null}},e.Cookie}(okanjo||this,this),"object"!=typeof JSON&&(JSON={},function(){"use strict";function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,o,r,s,a=gap,c=t[e];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(c)){for(r=c.length,n=0;r>n;n+=1)s[n]=str(n,c)||"null";return o=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,o}if(rep&&"object"==typeof rep)for(r=rep.length,n=0;r>n;n+=1)"string"==typeof rep[n]&&(i=rep[n],o=str(i,c),o&&s.push(quote(i)+(gap?": ":":")+o));else for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(o=str(i,c),o&&s.push(quote(i)+(gap?": ":":")+o));return o=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,o}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;n>i;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,i,o=e[t];if(o&&"object"==typeof o)for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(i=walk(o,n),void 0!==i?o[n]=i:delete o[n]);return reviver.call(e,t,o)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}()),function(){/*!
  * @preserve Qwery - A Blazing Fast query selector engine
  * https://github.com/ded/qwery
  * copyright Dustin Diaz 2012
  * MIT License
  */
!function(e,t,n){"undefined"!=typeof module&&module.exports?module.exports=n():"function"==typeof define&&define.amd?define(n):t[e]=n()}("qwery",this,function(){function e(){this.c={}}function t(e){return K.g(e)||K.s(e,"(^|\\s+)"+e+"(\\s+|$)",1)}function n(e,t){for(var n=0,i=e.length;i>n;n++)t(e[n])}function i(e){for(var t=[],n=0,i=e.length;i>n;++n)m(e[n])?t=t.concat(e[n]):t[t.length]=e[n];return t}function o(e){for(var t=0,n=e.length,i=[];n>t;t++)i[t]=e[t];return i}function r(e){for(;(e=e.previousSibling)&&1!=e[T];);return e}function s(e){return e.match(F)}function a(e,n,i,o,r,s,a,c,l,h,d){var p,f,m,g,y;if(1!==this[T])return!1;if(n&&"*"!==n&&this[O]&&this[O].toLowerCase()!==n)return!1;if(i&&(f=i.match(S))&&f[1]!==this.id)return!1;if(i&&(y=i.match(P)))for(p=y.length;p--;)if(!t(y[p].slice(1)).test(this.className))return!1;if(l&&v.pseudos[l]&&!v.pseudos[l](this,d))return!1;if(o&&!a){g=this.attributes;for(m in g)if(Object.prototype.hasOwnProperty.call(g,m)&&(g[m].name||m)==r)return this}return o&&!u(s,G(this,r)||"",a)?!1:this}function c(e){return Q.g(e)||Q.s(e,e.replace(q,"\\$1"))}function u(e,t,n){switch(e){case"=":return t==n;case"^=":return t.match(X.g("^="+n)||X.s("^="+n,"^"+c(n),1));case"$=":return t.match(X.g("$="+n)||X.s("$="+n,c(n)+"$",1));case"*=":return t.match(X.g(n)||X.s(n,c(n),1));case"~=":return t.match(X.g("~="+n)||X.s("~="+n,"(?:^|\\s+)"+c(n)+"(?:\\s+|$)",1));case"|=":return t.match(X.g("|="+n)||X.s("|="+n,"^"+c(n)+"(-|$)",1))}return 0}function l(e,t){var i,o,r,c,u,l,h,p=[],f=[],m=t,g=Y.g(e)||Y.s(e,e.split(V)),v=e.match(J);if(!g.length)return p;if(c=(g=g.slice(0)).pop(),g.length&&(r=g[g.length-1].match(A))&&(m=y(t,r[1])),!m)return p;for(l=s(c),u=m!==t&&9!==m[T]&&v&&/^[+~]$/.test(v[v.length-1])?function(e){for(;m=m.nextSibling;)1==m[T]&&(l[1]?l[1]==m[O].toLowerCase():1)&&(e[e.length]=m);return e}([]):m[j](l[1]||"*"),i=0,o=u.length;o>i;i++)(h=a.apply(u[i],l))&&(p[p.length]=h);return g.length?(n(p,function(e){d(e,g,v)&&(f[f.length]=e)}),f):p}function h(e,t,n){if(p(t))return e==t;if(m(t))return!!~i(t).indexOf(e);for(var o,r,c=t.split(",");t=c.pop();)if(o=Y.g(t)||Y.s(t,t.split(V)),r=t.match(J),o=o.slice(0),a.apply(e,s(o.pop()))&&(!o.length||d(e,o,r,n)))return!0;return!1}function d(e,t,n,i){function o(e,i,c){for(;c=B[n[i]](c,e);)if(p(c)&&a.apply(c,s(t[i]))){if(!i)return c;if(r=o(c,i-1,c))return r}}var r;return(r=o(e,t.length-1,e))&&(!i||Z(r,i))}function p(e,t){return e&&"object"==typeof e&&(t=e[T])&&(1==t||9==t)}function f(e){var t,n,i=[];e:for(t=0;t<e.length;++t){for(n=0;n<i.length;++n)if(i[n]==e[t])continue e;i[i.length]=e[t]}return i}function m(e){return"object"==typeof e&&isFinite(e.length)}function g(e){return e?"string"==typeof e?v(e)[0]:!e[T]&&m(e)?e[0]:e:b}function y(e,t,n){return 9===e[T]?e.getElementById(t):e.ownerDocument&&((n=e.ownerDocument.getElementById(t))&&Z(n,e)&&n||!Z(e,e.ownerDocument)&&w('[id="'+t+'"]',e)[0])}function v(e,t){var n,r,s=g(t);if(!s||!e)return[];if(e===window||p(e))return!t||e!==window&&p(s)&&Z(e,s)?[e]:[];if(e&&m(e))return i(e);if(n=e.match(H)){if(n[1])return(r=y(s,n[1]))?[r]:[];if(n[2])return o(s[j](n[2]));if(ee&&n[3])return o(s[x](n[3]))}return w(e,s)}function _(e,t){return function(n){var i,o;return L.test(n)?void(9!==e[T]&&((o=i=e.getAttribute("id"))||e.setAttribute("id",o="__qwerymeupscotty"),n='[id="'+o+'"]'+n,t(e.parentNode||e,n,!0),i||e.removeAttribute("id"))):void(n.length&&t(e,n,!1))}}var w,b=document,k=b.documentElement,x="getElementsByClassName",j="getElementsByTagName",E="querySelectorAll",C="useNativeQSA",O="tagName",T="nodeType",S=/#([\w\-]+)/,P=/\.[\w\-]+/g,A=/^#([\w\-]+)$/,N=/^\.([\w\-]+)$/,I=/^([\w\-]+)$/,M=/^([\w]+)?\.([\w\-]+)$/,L=/(^|,)\s*[>~+]/,D=/^\s+|\s*([,\s\+\~>]|$)\s*/g,U=/[\s\>\+\~]/,R=/(?![\s\w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^'"]*\]|[\s\w\+\-]*\))/,q=/([.*+?\^=!:${}()|\[\]\/\\])/g,z=/^(\*|[a-z0-9]+)?(?:([\.\#]+[\w\-\.#]+)?)/,W=/\[([\w\-]+)(?:([\|\^\$\*\~]?\=)['"]?([ \w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^]+)["']?)?\]/,$=/:([\w\-]+)(\(['"]?([^()]+)['"]?\))?/,H=new RegExp(A.source+"|"+I.source+"|"+N.source),J=new RegExp("("+U.source+")"+R.source,"g"),V=new RegExp(U.source+R.source),F=new RegExp(z.source+"("+W.source+")?("+$.source+")?"),B={" ":function(e){return e&&e!==k&&e.parentNode},">":function(e,t){return e&&e.parentNode==t.parentNode&&e.parentNode},"~":function(e){return e&&e.previousSibling},"+":function(e,t,n,i){return e?(n=r(e))&&(i=r(t))&&n==i&&n:!1}};e.prototype={g:function(e){return this.c[e]||void 0},s:function(e,t,n){return t=n?new RegExp(t):t,this.c[e]=t}};var K=new e,Q=new e,X=new e,Y=new e,Z="compareDocumentPosition"in k?function(e,t){return 16==(16&t.compareDocumentPosition(e))}:"contains"in k?function(e,t){return t=9===t[T]||t==window?k:t,t!==e&&t.contains(e)}:function(e,t){for(;e=e.parentNode;)if(e===t)return 1;return 0},G=function(){var e=b.createElement("p");return(e.innerHTML='<a href="#x">x</a>')&&"#x"!=e.firstChild.getAttribute("href")?function(e,t){return"class"===t?e.className:"href"===t||"src"===t?e.getAttribute(t,2):e.getAttribute(t)}:function(e,t){return e.getAttribute(t)}}(),ee=!!b[x],te=b.querySelector&&b[E],ne=function(e,t){var i,r,s=[];try{return 9!==t[T]&&L.test(e)?(n(i=e.split(","),_(t,function(e,t){r=e[E](t),1==r.length?s[s.length]=r.item(0):r.length&&(s=s.concat(o(r)))})),i.length>1&&s.length>1?f(s):s):o(t[E](e))}catch(a){}return ie(e,t)},ie=function(e,i){var o,r,s,a,c,u,h=[];if(e=e.replace(D,"$1"),r=e.match(M)){for(c=t(r[2]),o=i[j](r[1]||"*"),s=0,a=o.length;a>s;s++)c.test(o[s].className)&&(h[h.length]=o[s]);return h}return n(u=e.split(","),_(i,function(e,t,n){for(c=l(t,e),s=0,a=c.length;a>s;s++)(9===e[T]||n||Z(c[s],i))&&(h[h.length]=c[s])})),u.length>1&&h.length>1?f(h):h},oe=function(e){"undefined"!=typeof e[C]&&(w=e[C]&&te?ne:ie)};return oe({useNativeQSA:!0}),v.configure=oe,v.uniq=f,v.is=h,v.pseudos={},v}),/*! onDomReady.js 1.4.0 (c) 2013 Tubal Martin - MIT license | Wrapped in UMD by Okanjo */
function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.onDomReady=t()}(this,function(){"use strict";function e(t){if(!b){if(!s.body)return i(e);for(b=!0;t=k.shift();)i(t)}}function t(t){(_||t.type===c||s[d]===h)&&(n(),e())}function n(){_?(s[v](g,t,u),r[v](c,t,u)):(s[f](y,t),r[f](l,t))}function i(e,t){setTimeout(e,+t>=0?t:1)}function o(e){b?i(e):k.push(e)}var r=window,s=r.document,a=s.documentElement,c="load",u=!1,l="on"+c,h="complete",d="readyState",p="attachEvent",f="detachEvent",m="addEventListener",g="DOMContentLoaded",y="onreadystatechange",v="removeEventListener",_=m in s,w=u,b=u,k=[];if(s[d]===h)i(e);else if(_)s[m](g,t,u),r[m](c,t,u);else{s[p](y,t),r[p](l,t);try{w=null==r.frameElement&&a}catch(x){}w&&w.doScroll&&!function j(){if(!b){try{w.doScroll("left")}catch(t){return i(j,50)}n(),e()}}()}return o.version="1.4.0",o.isReady=function(){return b},o}),/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
function(e,t){"object"==typeof exports&&exports?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Mustache={})}(this,function(e){function t(e){return"function"==typeof e}function n(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(e,t){return f.call(e,t)}function o(e){return!i(m,e)}function r(e){return String(e).replace(/[&<>"'\/]/g,function(e){return g[e]})}function s(t,i){function r(){if(k&&!x)for(;g.length;)delete m[g.pop()];else g=[];k=!1,x=!1}function s(e){if("string"==typeof e&&(e=e.split(v,2)),!p(e)||2!==e.length)throw new Error("Invalid tags: "+e);l=new RegExp(n(e[0])+"\\s*"),h=new RegExp("\\s*"+n(e[1])),d=new RegExp("\\s*"+n("}"+e[1]))}if(!t)return[];var l,h,d,f=[],m=[],g=[],k=!1,x=!1;s(i||e.tags);for(var j,E,C,O,T,S,P=new u(t);!P.eos();){if(j=P.pos,C=P.scanUntil(l))for(var A=0,N=C.length;N>A;++A)O=C.charAt(A),o(O)?g.push(m.length):x=!0,m.push(["text",O,j,j+1]),j+=1,"\n"===O&&r();if(!P.scan(l))break;if(k=!0,E=P.scan(b)||"name",P.scan(y),"="===E?(C=P.scanUntil(_),P.scan(_),P.scanUntil(h)):"{"===E?(C=P.scanUntil(d),P.scan(w),P.scanUntil(h),E="&"):C=P.scanUntil(h),!P.scan(h))throw new Error("Unclosed tag at "+P.pos);if(T=[E,C,j,P.pos],m.push(T),"#"===E||"^"===E)f.push(T);else if("/"===E){if(S=f.pop(),!S)throw new Error('Unopened section "'+C+'" at '+j);if(S[1]!==C)throw new Error('Unclosed section "'+S[1]+'" at '+j)}else"name"===E||"{"===E||"&"===E?x=!0:"="===E&&s(C)}if(S=f.pop())throw new Error('Unclosed section "'+S[1]+'" at '+P.pos);return c(a(m))}function a(e){for(var t,n,i=[],o=0,r=e.length;r>o;++o)t=e[o],t&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(i.push(t),n=t));return i}function c(e){for(var t,n,i=[],o=i,r=[],s=0,a=e.length;a>s;++s)switch(t=e[s],t[0]){case"#":case"^":o.push(t),r.push(t),o=t[4]=[];break;case"/":n=r.pop(),n[5]=t[2],o=r.length>0?r[r.length-1][4]:i;break;default:o.push(t)}return i}function u(e){this.string=e,this.tail=e,this.pos=0}function l(e,t){this.view=null==e?{}:e,this.cache={".":this.view},this.parent=t}function h(){this.cache={}}var d=Object.prototype.toString,p=Array.isArray||function(e){return"[object Array]"===d.call(e)},f=RegExp.prototype.test,m=/\S/,g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},y=/\s*/,v=/\s+/,_=/\s*=/,w=/\s*\}/,b=/#|\^|\/|>|\{|&|=|!/;u.prototype.eos=function(){return""===this.tail},u.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},u.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},l.prototype.push=function(e){return new l(e,this)},l.prototype.lookup=function(e){var n,i=this.cache;if(e in i)n=i[e];else{for(var o,r,s=this;s;){if(e.indexOf(".")>0)for(n=s.view,o=e.split("."),r=0;null!=n&&r<o.length;)n=n[o[r++]];else"object"==typeof s.view&&(n=s.view[e]);if(null!=n)break;s=s.parent}i[e]=n}return t(n)&&(n=n.call(this.view)),n},h.prototype.clearCache=function(){this.cache={}},h.prototype.parse=function(e,t){var n=this.cache,i=n[e];return null==i&&(i=n[e]=s(e,t)),i},h.prototype.render=function(e,t,n){var i=this.parse(e),o=t instanceof l?t:new l(t);return this.renderTokens(i,o,n,e)},h.prototype.renderTokens=function(e,t,n,i){for(var o,r,s,a="",c=0,u=e.length;u>c;++c)s=void 0,o=e[c],r=o[0],"#"===r?s=this._renderSection(o,t,n,i):"^"===r?s=this._renderInverted(o,t,n,i):">"===r?s=this._renderPartial(o,t,n,i):"&"===r?s=this._unescapedValue(o,t):"name"===r?s=this._escapedValue(o,t):"text"===r&&(s=this._rawValue(o)),void 0!==s&&(a+=s);return a},h.prototype._renderSection=function(e,n,i,o){function r(e){return s.render(e,n,i)}var s=this,a="",c=n.lookup(e[1]);if(c){if(p(c))for(var u=0,l=c.length;l>u;++u)a+=this.renderTokens(e[4],n.push(c[u]),i,o);else if("object"==typeof c||"string"==typeof c)a+=this.renderTokens(e[4],n.push(c),i,o);else if(t(c)){if("string"!=typeof o)throw new Error("Cannot use higher-order sections without the original template");c=c.call(n.view,o.slice(e[3],e[5]),r),null!=c&&(a+=c)}else a+=this.renderTokens(e[4],n,i,o);return a}},h.prototype._renderInverted=function(e,t,n,i){var o=t.lookup(e[1]);return!o||p(o)&&0===o.length?this.renderTokens(e[4],t,n,i):void 0},h.prototype._renderPartial=function(e,n,i){if(i){var o=t(i)?i(e[1]):i[e[1]];return null!=o?this.renderTokens(this.parse(o),n,i,o):void 0}},h.prototype._unescapedValue=function(e,t){var n=t.lookup(e[1]);return null!=n?n:void 0},h.prototype._escapedValue=function(t,n){var i=n.lookup(t[1]);return null!=i?e.escape(i):void 0},h.prototype._rawValue=function(e){return e[1]},e.name="mustache.js",e.version="1.1.0",e.tags=["{{","}}"];var k=new h;e.clearCache=function(){return k.clearCache()},e.parse=function(e,t){return k.parse(e,t)},e.render=function(e,t,n){return k.render(e,t,n)},e.to_html=function(n,i,o,r){var s=e.render(n,i,o);return t(r)?void r(s):s},e.escape=r,e.Scanner=u,e.Context=l,e.Writer=h})}.apply(okanjo),function(e,t){function n(){this.default_channel=this.channel.external,this._queue=[];var t=e.util.getPageArguments(!0),n=t[this.msid_key],i=e.Cookie.get(this.msid_key),o=t[this.source_cx],r=t[this.source_ch];n&&i&&n!=i&&(this.trackEvent(this.object_type.metric_session,this.event_type.correlation,{id:n+"_"+i,ch:this.default_channel,_noProcess:!0}),e.Cookie.set(this.msid_key,n,this.msid_ttl)),this.sid=n||i||null,this.sourceCh=r||null,this.sourceCx=o||null,this._lastKey=void 0}n.prototype={msid_key:"ok_msid",source_cx:"ok_cx",source_ch:"ok_ch",msid_ttl:1460,strip_meta:["key","callback","metrics_channel_context","metrics_context","mode"],constructor:n,event_type:{view:"vw",impression:"imp",interaction:"int",correlation:"cor"},action:{click:"click",inline_click:"inline_click"},object_type:{page:"pg",widget:"wg",product:"pr",store:"st",cause:"ca",marketplace:"mp",order:"or",order_item:"oi",user:"ur",metric_session:"mt"},channel:{product_widget:"pw",ad_widget:"aw",store_widget:"sw",marketplace:"mp",external:"ex"},environment:{live:"live",testing:"testing"},trackEvent:function(t,n,i,o){i=i||{},i.object_type=t,i.event_type=n,this._lastKey=i.key||i.key||i.m&&i.m.key||e.key||this._lastKey||void 0,this.push(i,o)},trackPageView:function(e,n){e=e||{},e.id=e.id||t.location.href,e.ch=e.ch||this.default_channel,this.trackEvent(this.object_type.page,this.event_type.view,e,n)},track:function(t,n){if(!t||"object"!=typeof t)return void console.warn("[Okanjo.Metrics] event object data required");if(!t.object_type)return void console.warn("[Okanjo.Metrics] object_type required");if(!t.event_type)return void console.warn("[Okanjo.Metrics] event_type required");var i=t.object_type,o=t.event_type;if(delete t.object_type,delete t.event_type,t.key=t.key||t.m&&t.m.key||e.key||this._lastKey||void 0,this.sid&&(t.sid=this.sid),t.m){var r={};for(var s in t.m)t.m.hasOwnProperty(s)&&this.strip_meta.indexOf(s)<0&&(r[s]=t.m[s]);t.m=r}(this.sourceCh||this.sourceCx)&&(t.m||(t.m={}),this.sourceCh&&(t.m.ref_ch=this.sourceCh),this.sourceCx&&(t.m.ref_cx=this.sourceCx)),document.referrer&&(t.ref=document.referrer),e.exec(e.getRoute(e.routes.metrics,{object_type:i,event_type:o}),t,function(e,t){e&&console.warn("[Okanjo.Metrics] Reporting failed",e,t),n&&n(e,t)})},updateSid:function(t){!this.sid&&t&&(this.sid=t,e.Cookie.set(this.msid_key,t,this.msid_ttl))},push:function(e,t){this._queue.push({event:e,callback:t}),e._noProcess?delete e._noProcess:this._processQueue()},_processQueue:function(){if(!this._processTimeout&&this._queue.length>0){var e=this;this._processTimeout=setTimeout(function(){var t=e._queue.shift();void 0===t?e._processTimeout=null:e.track(t.event,function(n,i){i&&i.data&&i.data.sid&&e.updateSid(i.data.sid),e._processTimeout=null,e._processQueue(),t.callback&&t.callback(n,i)})},0)}},includeElementInfo:function(t,n){var i=e.util.getPageSize(),o=e.util.getElementPosition(t);return n=n||{},n.pw=i.w,n.ph=i.h,n.x1=o.x1,n.y1=o.y1,n.x2=o.x2,n.y2=o.y2,n},includeViewportInfo:function(t){var n=e.util.getViewportSize(),i=e.util.getScrollPosition();return t=t||{},t.vx1=i.x,t.vy1=i.y,t.vx2=t.vx1+n.vw,t.vy2=t.vy1+n.vh,t}},e.metrics=new n}(okanjo,this),function(e,t){e.metrics.trackPageView({_noProcess:!0}),setTimeout(function(){e.metrics._processQueue()},1e3)}(okanjo||this),function(e,t){var n=function(e,t){return e.indexOf(t)},i=function(){this.events={}};return i.prototype.on=function(e,t){"object"!=typeof this.events[e]&&(this.events[e]=[]),this.events[e].push(t)},i.prototype.removeListener=function(e,t){var i;"object"==typeof this.events[e]&&(i=n(this.events[e],t),i>-1&&this.events[e].splice(i,1))},i.prototype.emit=function(e){var t,n,i,o=[].slice.call(arguments,1);if("object"==typeof this.events[e])for(n=this.events[e].slice(),i=n.length,t=0;i>t;t++)n[t].apply(this,o)},i.prototype.once=function(e,t){this.on(e,function n(){this.removeListener(e,n),t.apply(this,arguments)})},e._EventEmitter=i,i}(okanjo,this),function(e,t){var n=e.Cache,i=e._Widget=function(t,n){if(e._EventEmitter.call(this),!t||"object"!=typeof t||void 0===t.nodeType)throw new Error("Invalid element - must be a valid DOM element");if("undefined"!=typeof n&&"object"!=typeof n)throw new Error("Invalid configuration, must be an object or nothing at all, got: "+typeof n);n=n||{},this.element=t,this.config=n||{},this.configMap={},this.templates={error:"okanjo.error"},this.css={}};e.util.inherits(i,e._EventEmitter);var o=i.prototype;return o.widgetName="BaseWidget",o.config=null,o.use_cache=!1,o.cache_key_prefix="ok_widget_",o.cache_ttl=6e4,o.cacheKeyAttributes="id".split(","),o.init=function(){this.parseConfiguration(),this.processTemplateOverrides(),this.ensureTemplates(),this.findWidgetKey()&&this.load()&&this.autoCleanCache()},o.findWidgetKey=function(){return e.util.empty(this.config.key)?e.util.empty(e.key)?e.util.empty(this.key)?(this.config.key=this.key,!0):(this.element.innerHTML=e.mvc.render(this.templates.error,this,{message:"Missing Okanjo key."}),e.report(this.widgetName,"Missing key. Define one using okanjo.configure or pass the key parameter as an option in the "+this.widgetName+" constructor"),!1):(this.key=e.key,this.config.key=this.key,!0):(this.key=this.config.key,this.config.key=this.key,!0)},o.processTemplateOverrides=function(){var e;for(var t in this.config)this.config.hasOwnProperty(t)&&(e=t.match(/^template_(.+)$/),null!==e&&this.templates.hasOwnProperty(e[1])?this.templates[e[1]]=this.config[t]:(e=t.match(/^css_(.+)$/),null!==e&&this.css.hasOwnProperty(e[1])&&(this.css[e[1]]=this.config[t])))},o.ensureTemplates=function(){var t,n=this.templates,i=this.css;for(t in n)if(n.hasOwnProperty(t)&&!e.mvc.isTemplateRegistered(n[t]))throw new Error("[Okanjo."+this.widgetName+"] Missing template: "+n[t]+". Did you forget to include the template?");for(t in i)if(i.hasOwnProperty(t)&&!e.mvc.isCssRegistered(i[t]))throw new Error("[Okanjo."+this.widgetName+"] Missing css block: "+i[t]+". Did you forget to include the css template?")},o.parseConfiguration=function(){var t=e.util.data(this.element);e.util.copyIfSetMap(this.config,t,this.configMap,{stripEmpty:!0})},o.load=function(){return!0},o.autoCleanCache=function(){if(this.use_cache){var e=this;setTimeout(function(){e.cleanCache()},2e3)}},o.getCurrentPageUrl=function(){var e=t.location.href,n=[e.indexOf("?"),e.indexOf("#")].filter(function(e){return e>=0}),i=n.length>0?Math.min.apply(null,n):-1;return i>0?e.substr(0,i):e},o.getCacheKey=function(){for(var n=[t.location.host+t.location.pathname],i=this.cacheKeyAttributes,o=0;o<i.length;o++)void 0!==this.config[i[o]]&&n.push(i[o],this.config[i[o]]);return this.cache_key_prefix+e.util.hash(n.join(";"))},o.cleanCache=function(){try{for(var t=(new Date).getTime(),i=[],o=[],r=0;r<n.length;r++){var s=n.key(r);if(0===s.indexOf(this.cache_key_prefix)&&s.indexOf("_expires")<0){var a=n.getItem(s+"_expires");null!==a&&t<parseInt(a)?o.push(s+"_expires"):(n.removeItem(s),n.removeItem(s+"_expires"))}else s.indexOf("_expires")>=0&&i.push(s)}for(r=0;r<i.length;r++)o.indexOf(i[r])<0&&n.removeItem(i[r])}catch(c){e.report(this.widgetName,c)}},o.loadFromCache=function(t){try{var i=n.getItem(t),o=n.getItem(t+"_expires"),r=(new Date).getTime();if(null!==i&&null!==o&&r<parseInt(o))return JSON.parse(i);n.removeItem(t),n.removeItem(t+"_expires")}catch(s){e.report(this.widgetName,s)}return null},o.saveInCache=function(e,t){var i=this;setTimeout(function(){n.setItem(e,JSON.stringify(t)),n.setItem(e+"_expires",(new Date).getTime()+i.cache_ttl)},100)},e._Widget}(okanjo,this),function(e,t){var n,i,o,r,s,a,c,u,l,h=!1,d=null,p=!!navigator.userAgent.match(/iphone|android|blackberry/gi)||!1,f=function(){n=e.qwery("html")[0],i=e.qwery("body")[0]||document.body,o=document.createElement("div"),r=document.createElement("div"),s=document.createElement("div"),a=document.createElement("div"),c=document.createElement("div"),u=document.createElement("div"),l=document.createElement("iframe"),o.setAttribute("class","okanjo-modal-container okanjo-modal-hidden "+e.util.detectClasses().join(" ")),r.setAttribute("class","okanjo-modal-window"),s.setAttribute("class","okanjo-modal-window-skin"),a.setAttribute("class","okanjo-modal-window-outer"),c.setAttribute("class","okanjo-modal-window-inner"),u.setAttribute("class","okanjo-modal-close-button"),l.setAttribute("class","okanjo-inline-buy-frame"),l.setAttribute("frameborder","0"),l.setAttribute("vspace","0"),l.setAttribute("hspace","0"),l.setAttribute("webkitallowfullscreen",""),l.setAttribute("mozallowfullscreen",""),l.setAttribute("allowfullscreen",""),l.setAttribute("scrolling","auto"),u.innerHTML="Ã—",c.appendChild(l),a.appendChild(c),s.appendChild(a),r.appendChild(s),r.appendChild(u),o.appendChild(r),i.appendChild(o)},m=function(){g(t,"orientationchange",function(){for(var e=0;2>e;e++)setTimeout(w,1e3*e+10)}),g(t,"resize",function(){setTimeout(w,100)}),g(o,"click",k),g(r,"click",function(e){e.preventDefault(),e.stopPropagation()}),g(u,"click",function(e){e.preventDefault(),e.stopPropagation(),k()})},g=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},y=function(e,t){e.className+=" "+t},v=function(e,t){e.className=e.className.replace(new RegExp(" *?"+t),"")},_=function(){return t.innerHeight||document.documentElement.clientHeight},w=function(){d=e.util.getScrollPosition().y,r.style.height=_()-80+"px"},b=function(){d=document.body.scrollTop,v(o,"okanjo-modal-hidden"),y(o,"okanjo-modal-fade-out"),w(),y(n,"okanjo-modal-active"),p||y(n,"okanjo-modal-margin-fix"),setTimeout(function(){v(o,"okanjo-modal-fade-out")},10)},k=function(){y(o,"okanjo-modal-fade-out"),setTimeout(function(){v(o,"okanjo-modal-fade-out"),y(o,"okanjo-modal-hidden"),v(n,"okanjo-modal-active"),p||v(n,"okanjo-modal-margin-fix")},210)},x=function(e){c.innerHTML="","string"==typeof e?c.innerHTML=e:c.appendChild(e)};return e.modal={show:function(e){h||(h=!0,f(),m()),x(e),b()},hide:function(){k()}},e.modal}(okanjo,this),function(e,t){function n(t,i){e._Widget.call(this,t,i),this.items=[],this.config=i=i||{mode:n.contentTypes.browse,use_cache:!0,cache_ttl:6e4},this.config.nag=void 0===i.nag?!0:i.nag===!0,this.config.use_cache=void 0===i.use_cache?!0:i.use_cache===!0,this.config.cache_ttl=void 0===i.cache_ttl?6e4:i.cache_ttl,this.use_cache=this.config.use_cache,this.cache_ttl=this.config.cache_ttl,this.proxy_url=null,this.config.metrics_context=void 0===i.metrics_context?"pw":i.metrics_context,this.config.metrics_channel_context=void 0===i.metrics_channel_context?null:i.metrics_channel_context,this.disable_inline_buy=void 0===this.config.disable_inline_buy?!1:i.disable_inline_buy===!0,this.cache_key_prefix="ok_product_block_",this.templates={product_error:"okanjo.error",product_main:"product.block"},this.css={product_main:"product.block",product_modal:"okanjo.modal"},this.configMap={key:"key",mode:"mode",disable_inline_buy:"disable-inline-buy",proxy_url:"proxy-url",url:"url",selectors:"selectors",text:"text",id:"id",q:"q",marketplace_status:["marketplace-status"],marketplace_id:["marketplace-id"],pools:"pools",external_id:"external-id",sku:"sku",sold_by:"sold-by",external_store_id:"external-store-id",min_price:"min-price",max_price:"max-price",condition:"condition",manufacturer:"manufacturer",upc:"upc",isbn:"isbn",tags:"tags",category:"category",min_donation_percent:"min-donation-percent",max_donation_percent:"max-donation-percent",donation_to:"donation-to",suboptimal:"suboptimal",skip:["skip","page-start"],take:["take","page-size"],expandable:"expandable",template_product_main:"template-product-main",template_product_error:"template-product-error",size:"size",template_layout:"template-layout",template_theme:"template-theme",template_cta_style:"template-cta-style",template_cta_text:"template-cta-text",template_cta_color:"template-cta-color"},i.no_init||this.init()}function i(e,t,n,i){var o,r=[],s=t.indexOf("?")<0?"?":"&";for(o in i)i.hasOwnProperty(o)&&r.push(o+"="+encodeURIComponent(i[o]));var a=e+"&n="+(new Date).getTime()+"&u=",c=t+(r.length>0?s+r.join("&"):"");return n?a+encodeURIComponent(n+encodeURIComponent(c)):a+encodeURIComponent(c)}e.util.inherits(n,e._Widget),n.contentTypes={browse:"browse",sense:"sense",single:"single"};var o=n.prototype;return o.widgetName="Product",o.cacheKeyAttributes="mode,url,selectors,text,id,q,marketplace_status,marketplace_id,external_id,sku,sold_by,min_price,max_price,condition,manufacturer,upc,isbn,tags,category,min_donation_percent,max_donation_percent,donation_to,suboptimal,skip,take".split(","),o.load=function(){return this.config.id||this.config.mode==n.contentTypes.single?e.util.empty(this.config.id)?this.config.mode=n.contentTypes.browse:this.config.mode=n.contentTypes.single:this.config.url||this.config.text||this.config.mode==n.contentTypes.sense?(e.util.empty(this.config.url)&&e.util.empty(this.config.text)&&(this.config.url=this.getCurrentPageUrl(),this.config.nag&&console.info("[Okanjo."+this.widgetName+"] No canonical url given for ProductSense. We recommend using a canonical url to ensure page visibility by Okanjo. Using derived url:",this.config.url)),this.config.mode=n.contentTypes.sense):this.config.mode=e.util.empty(this.config.mode)?n.contentTypes.browse:this.config.mode,function(e){for(var t=0;t<e.length;t++){var n=this.config[e[t]];n&&"string"==typeof n&&(this.config[e[t]]=n.split(","))}}.call(this,["pools","tags","category"]),null===this.config.metrics_channel_context&&(this.config.metrics_channel_context=this.config.mode),this.config.proxy_url&&(this.proxy_url=this.config.proxy_url,delete this.config.proxy_url),this.config.use_cache&&this.loadProductsFromCache()?this.emit("load",{fromCache:!0}):this.getProducts(),this.config.disable_inline_buy&&"string"==typeof this.config.disable_inline_buy&&(this.disable_inline_buy="true"===this.config.disable_inline_buy.toLowerCase()),this.config.metrics_context==e.metrics.channel.product_widget&&e.metrics.trackEvent(e.metrics.object_type.widget,e.metrics.event_type.impression,{ch:this.config.metrics_context,cx:this.config.metrics_channel_context||this.config.mode,m:e.util.deepClone(this.config,e.metrics.includeElementInfo(this.element))}),!0},o.loadProductsFromCache=function(){var e=this.loadFromCache(this.getCacheKey());return null!==e?(this.items=e,this.showProducts(this.items),!0):!1},o.getProducts=function(){var t=this;this.executeSearch(function(n,i){if(n)console.error("[Okanjo."+t.widgetName+"] Failed to retrieve products.",n),t.element.innerHTML=e.mvc.render(t.templates.product_error,t,{message:"Could not retrieve products."}),t.emit("error",n);else{if(t.items=i.data,t.numFound=i.numFound,t.emit("data",i),t.showProducts(t.items),t.use_cache){var o=t.getCacheKey();t.saveInCache(o,t.items)}t.emit("load",{fromCache:!1})}})},o.executeSearch=function(t){this.config.mode===n.contentTypes.sense?e.exec(e.getRoute(e.routes.products_sense),this.config,t):this.config.mode===n.contentTypes.single?e.exec(e.getRoute(e.routes.products_id,{product_id:this.config.id}),this.config,function(e,n){!e&&n&&n.data&&(n.data=[n.data]),t&&t(e,n)}):e.exec(e.getRoute(e.routes.products),this.config,t)},o.handleInlineBuyOption=function(){if(this.disable_inline_buy)for(var e=0;e<this.items.length;e++)this.items[e].inline_buy_url=null},o.showProducts=function(t){this.handleInlineBuyOption(),this.element.innerHTML=e.mvc.render(this.templates.product_main,this,{products:t||this.items||[],config:this.config}),this.bindEvents()},n.interactTile=function(n,o){var r=this.getAttribute("data-inline-buy-url"),s=this.getAttribute("data-expandable"),a=!e.util.empty(r),c=e.util.isMobile()&&a,u=this.getAttribute("href"),l={},h=!1,d={m:e.metrics.includeViewportInfo(e.metrics.includeElementInfo(this))},p=(this.getAttribute("id"),this.getAttribute("data-buy-url")),f=this.getAttribute("data-metric-url")+"&sid="+e.metrics.sid+"&"+e.JSONP.objectToURI(d),m=this.getAttribute("data-proxy-url"),g="ok_msid="+e.metrics.sid+"&ok_ch="+this.getAttribute("data-channel")+"&ok_cx="+this.getAttribute("data-context"),y=p+(p.indexOf("?")<0?"?":"&")+g,v=r+(r.indexOf("?")<0?"?":"&")+g;if(c)f+="&ea="+e.metrics.action.inline_click+"&m[popup]=true",u=i(f,v,m,{popup:1}),e.active_frame=t.open(u,"okanjo-inline-buy-frame","width=400,height=400,location=yes,resizable=yes,scrollbars=yes"),e.active_frame?n.preventDefault():(console.error("Popup blocker prevented new inline-buy experience from being displayed"),this.href=u);else if(a){n.preventDefault();var _=document.createElement("iframe"),w={"class":"okanjo-inline-buy-frame",frameborder:0,vspace:0,hspace:0,webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:"",scrolling:"auto"};for(var b in w)w.hasOwnProperty(b)&&_.setAttribute(b,w[b]);if(l.expandable=1,void 0!==s&&"false"===s.toLowerCase()){for(var k=this,x=null;k;)k=k.parentNode,k&&k.className&&k.className.indexOf("okanjo-expansion-root")>=0&&(x=k);if(x){_.className+=" okanjo-ad-in-unit",_.setAttribute("height","100%"),_.setAttribute("width","100%"),x.appendChild(_),h=!0;var j=e.util.getElementSize(x);l.expandable=0,l.frame_height=j.height,l.frame_width=j.width,l.ad_size=x.getAttribute("data-size")||"undefined"}}f+="&ea="+e.metrics.action.inline_click+"&m[expandable]="+(1===l.expandable?"true":"false"),u=i(f,v,m,l),_.src=u,h||e.modal.show(_)}else o?(f+="&ea="+e.metrics.action.click,this.href=i(f,y,m,{}),this.click()):(f+="&ea="+e.metrics.action.click,this.href=i(f,y,m,{}))},o.bindEvents=function(){var t=this;e.qwery("a",this.element).every(function(i){return i.addEventListener?i.addEventListener("click",n.interactTile):i.attachEvent("onclick",function(e){n.interactTile.call(i,e)}),t.config.metrics_context==e.metrics.channel.product_widget&&e.metrics.trackEvent(e.metrics.object_type.product,e.metrics.event_type.impression,{id:i.getAttribute("data-id"),ch:t.config.metrics_context,cx:t.config.metrics_channel_context||t.config.mode,m:e.util.deepClone(t.config,e.metrics.includeElementInfo(i.parentNode))}),!0}),e.qwery(".okanjo-product-title",this.element).every(function(t){return e.util.ellipsify(t),!0})},e.Product=n,n}(okanjo,this),function(e,t){function n(t,n){e._Widget.call(this,t,n),this.config=n=n||{},this.templates={ad_error:"okanjo.error",ad_main:"ad.block"},this.css={ad_main:"ad.block"},this.disable_inline_buy=void 0===this.config.disable_inline_buy?!1:n.disable_inline_buy===!0,this.proxy_url=null,this.configMap={key:"key",proxy_url:"proxy-url",content:"content",size:"size",expandable:"expandable",type:"type",id:"id",template_ad_main:"template-ad-main",template_ad_error:"template-ad-error",disable_inline_buy:"disable-inline-buy",template_product_main:"template-product-main",template_product_error:"template-product-error"},n.no_init||this.init()}e.util.inherits(n,e._Widget),n.contentTypes={creative:"creative",dynamic:"dynamic"},n.types={product:"product"},n.sizes={billboard:{width:970,height:250},button_2:{width:120,height:60},half_page:{width:300,height:600},leaderboard:{width:728,height:90},medium_rectangle:{width:300,height:250},micro_bar:{width:88,height:31},portrait:{width:300,height:1050},rectangle:{width:180,height:150},super_leaderboard:{width:970,height:90},wide_skyscraper:{width:160,height:600},large_mobile_banner:{width:320,height:100},mobile_leaderboard:{width:320,height:50},small_square:{width:200,height:200},button_1:{width:120,height:90},full_banner:{width:468,height:60},half_banner:{width:234,height:60},large_rectangle:{width:336,height:280},pop_under:{width:720,height:300},three_to_one_rectangle:{width:300,height:100},skyscraper:{width:120,height:600},square:{width:250,height:250},square_button:{width:125,height:125},vertical_banner:{width:120,height:240},vertical_rectangle:{width:240,height:400}};var i=n.prototype;return i.widgetName="Ad",i.load=function(){if(e.util.empty(this.config.content))this.hasCreativeContent()?this.config.content=n.contentTypes.creative:this.config.content=n.contentTypes.dynamic;else if(this.config.content!==n.contentTypes.creative||this.hasCreativeContent()){if(this.config.content===n.contentTypes.dynamic&&this.hasCreativeContent())console.warn("[Okanjo.Ad] Ad content is dynamic, but ad placement contains markup. Markup will be clobbered!");else if(!n.contentTypes.hasOwnProperty(this.config.content))return this.element.innerHTML=e.mvc.render(this.templates.ad_error,this,{message:"Invalid ad content: "+this.config.content}),e.report(this.widgetName,"Invalid ad content: "+this.config.content),!1}else console.warn("[Okanjo.Ad] Ad content is creative, but ad placement does not contain creative markup. Switching to dynamic!"),this.config.content=n.contentTypes.dynamic;if(e.util.empty(this.config.type)?this.config.type=n.types.product:n.types.hasOwnProperty(this.config.type)||(console.warn("[Okanjo."+this.widgetName+"] Unknown type",this.config.type,"given, using type `product` instead"),this.config.type=n.types.product),!e.util.empty(this.config.size)&&n.sizes.hasOwnProperty(this.config.size)&&this.setElementSize(n.sizes[this.config.size]),this.config.disable_inline_buy&&"string"==typeof this.config.disable_inline_buy&&(this.disable_inline_buy="true"===this.config.disable_inline_buy.toLowerCase()),this.config.proxy_url&&(this.proxy_url=this.config.proxy_url,delete this.config.proxy_url),e.metrics.trackEvent(e.metrics.object_type.widget,e.metrics.event_type.impression,{ch:e.metrics.channel.ad_widget,cx:this.config.content,m:e.util.deepClone(this.config,e.metrics.includeElementInfo(this.element))}),this.config.type===n.types.product){if(e.util.empty(this.config.id))return this.element.innerHTML=e.mvc.render(this.templates.ad_error,this,{message:"Missing ad product id"}),e.report(this.widgetName,"Missing ad product id"),!1;if(this.config.content==n.contentTypes.dynamic)this.insertProductWidget();else{if(this.config.content!=n.contentTypes.creative)return this.element.innerHTML=e.mvc.render(this.templates.ad_error,this,{message:"Cannot render ad in content: "+this.config.content}),e.report(this.widgetName,"Cannot render ad in content: "+this.config.content),!1;this.insertCreativeWidget()}}return!0},i.render=function(){var t,i=document.createElement("div"),o=[],r=this.config.content==n.contentTypes.dynamic&&!e.util.empty(this.config.size);for(i.innerHTML=e.mvc.render(this.templates.ad_main,this,{config:this.config},{blockClasses:r?["okanjo-ad-fit"]:[]}),t=0;t<this.element.childNodes.length;t++)1===this.element.childNodes[t].nodeType&&o.push(this.element.childNodes[t]);for(t=0;t<i.childNodes.length;t++)1===i.childNodes[t].nodeType&&this.element.appendChild(i.childNodes[t]);var s=e.qwery(".okanjo-ad-container",this.element)[0];for(t=0;t<o.length;t++)s.appendChild(o[t]);e.metrics.trackEvent(e.metrics.object_type.product,e.metrics.event_type.impression,{id:this.config.id,ch:e.metrics.channel.ad_widget,cx:this.config.content,m:e.util.deepClone(this.config,e.metrics.includeElementInfo(this.element))})},i.interact=function(t){var n=e.qwery("a",this.productWidget.element);if(n.length>0)this._waitingOnProductLoad=!1,e.Product.interactTile.call(n[0],t,!0);else if(!this._waitingOnProductLoad){this._waitingOnProductLoad=!0;var i=this,o=setInterval(function(){i._waitingOnProductLoad?i.interact(t):clearInterval(o)},250);console.warn("Waiting for Okanjo Product widget to load...")}},i.insertCreativeWidget=function(){this.insertProductWidget({hidden:!0});var e=this;this.element.addEventListener?this.element.addEventListener("click",function(t){e.interact(t)}):this.element.attachEvent("onclick",function(t){e.interact(t)})},i.insertProductWidget=function(t){t=t||{};var n=document.createElement("div");n.className="okanjo-ad-dynamic-product",t.hidden&&(n.style.display="none"),this.element.appendChild(n),this.render();var i={id:this.config.id,key:this.key,mode:e.Product.contentTypes.single,disable_inline_buy:this.disable_inline_buy,proxy_url:this.proxy_url,expandable:void 0===this.config.expandable||("boolean"==typeof this.config.expandable?this.config.expandable:"true"===(""+this.config.expandable).toLowerCase()),metrics_context:e.metrics.channel.ad_widget,metrics_channel_context:this.config.content,template_product_main:"product.single"};return this.config.template_product_main&&(i.template_product_main=this.config.template_product_main),this.config.template_product_error&&(i.template_product_error=this.config.template_product_error),this.productWidget=new e.Product(n,i),this.productWidget},i.setElementSize=function(e){this.element.style.display="block",this.element.style.overflow="hidden",this.element.style.width=e.width+"px",this.element.style.height=e.height+"px"},i.hasCreativeContent=function(){if(this.element.childElementCount&&this.element.childElementCount>0)return!0;for(var e=0;e<this.element.childNodes.length;e++)if(1===this.element.childNodes[e].nodeType)return!0},e.Ad=n,n}(okanjo,this),okanjo});
//# sourceMappingURL=okanjo.min.js.map