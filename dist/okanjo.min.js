/*! okanjo-js v0.3.6 | (c) 2013 Okanjo Partners Inc | https://okanjo.com/ */
!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.okanjo=t()}(this,function(){var okanjo=okanjo||window.okanjo||function(e){var t={metrics:{trackEvent:function(){},trackPageView:function(){}},moat:{insert:function(){}},routes:{products:"/products",products_id:"/products/:product_id",products_sense:"/products/sense"},getRoute:function(e,n){if(n)for(var i in n)n.hasOwnProperty(i)&&(e=e.replace(":"+i,n[i]+""));return t.config.ads.apiUri+e},exec:function(e,n,i){n=n||{},t.JSONP({url:e,data:n,error:function(e){var n={statusCode:500,error:"Communication Error",message:e.message||"JSONP communication failure."};t.report("core-jsonp",e.error||new Error(n.message)),i(n,null)},success:function(e){var n,r;e?e.error?n=e:r=e:(n={statusCode:500,error:"Invalid Response",message:"Could not interpret the JSONP response."},t.report("core-jsonp",new Error(n.message))),i(n,r)}})},report:function(e,t){var n;"string"==typeof t?n=new Error("[Okanjo"+(e?" "+e:"")+"] "+t):"object"==typeof t&&t instanceof Error&&(n=t),console.error(n)},util:{trim:function(e){return(e||"").replace(/^\s+|\s+$/g,"")},empty:function(e){return null===e||void 0===e||"string"==typeof e&&""===t.util.trim(e)},clone:function(e){var t={};e=e||{};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},hash:function(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n++){var i=e.charCodeAt(n);t=(t<<5)-t+i}return t.toString(16).replace(/^-/,"n")},data:function(e){var t={};if(e)for(var n=e.attributes,i=n.length-1;i>=0;i--)0===n[i].name.indexOf("data-")&&(t[n[i].name.substr(5)]=n[i].value);return t},copyIfSet:function(e,n,i,r,o){function s(r){!n||void 0===n[r]||o.stripEmpty&&t.util.empty(n[r])||(e[i]=n[r])}if(r=r||i,o=o||{},"object"==typeof r&&Array.isArray(r))for(var a=0;a<r.length;a++)s(r[a]);else s(r)},copyIfSetMap:function(e,n,i,r){for(var o=Object.keys(i),s=0;s<o.length;s++)t.util.copyIfSet(e,n,o[s],i[o[s]],r)},/*! https://github.com/isaacs/inherits/blob/master/inherits_browser.js */
inherits:function(e,t){if("function"==typeof Object.create)e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}});else{e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}}};if(e){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n]);return e}return t}(okanjo||window.okanjo);/*! Console-polyfill. | MIT license. | https://github.com/paulmillr/console-polyfill */
/*! Okanjo Local Storage Polyfill v1.0.0 | (c) 2013 Okanjo Partners Inc | Based on https://gist.github.com/juliocesar/926500/ddb28fb72903be87cb9044a945c6edbe1aa28b3a */
/*! Okanjo Cookie Helper v1.0.0 | (c) 2013 Okanjo Partners Inc */
return okanjo.config={key:void 0,analyticsId:"UA-36849843-6",marketplace:{uri:"https://shop.okanjo.com",apiUri:"https://api.okanjo.com",routerUri:"https://shop.okanjo.com/widgets/router/",balancedMarketplacePath:"/v1/marketplaces/MP6vnNdXY7izEEVPs1gl7jSy",socketIOUri:"https://mke-rt.okanjo.com:13443"},ads:{apiUri:"https://ads-api.okanjo.com"},moat:{tag:"okanjo969422799577",clientLevels:["MoatTest","MoatTest","MoatTest","MoatTest"],clientSlicers:["MoatTest","MoatTest"]}},okanjo.configure=function(e){Object.keys(e).every(function(t){return okanjo.config[t]&&"object"==typeof okanjo.config[t]&&"object"==typeof e[t]?Object.keys(e[t]).every(function(n){return okanjo.config[t][n]=e[t][e[n]],!0}):okanjo.config[t]=e[t],!0})},function(e){var t=e.TemplateEngine=function(e){e=e||{templates:{},css:{}},this._templates=e.templates||{},this._css=e.css||{},this.classDetects=[],-1!=navigator.appVersion.indexOf("MSIE 9.")?this.classDetects.push("lt-ie10"):-1!=navigator.appVersion.indexOf("MSIE 8.")?this.classDetects.push("lt-ie9"):-1!=navigator.appVersion.indexOf("MSIE 7.")?this.classDetects.push("lt-ie8"):-1!=navigator.appVersion.indexOf("MSIE 6.")&&this.classDetects.push("lt-ie7"),this.classDetects=this.classDetects.join(" ")};t.prototype={constructor:t,registerTemplate:function(t,n,i,r){if("object"==typeof n){if(void 0===n.nodeType)throw new Error("Parameter template must be a string or a DOM element");e.Mustache.parse(n)}else if("string"!=typeof n)throw new Error("Parameter template must be a string or a DOM element");if(3===arguments.length&&"object"==typeof i?(r=i,i=void 0):r=r||{},void 0!==i&&"function"!=typeof i)throw new Error("Parameter viewClosure must be a function");this._templates[t]={markup:n,options:r,viewClosure:i||null}},registerCss:function(e,t,n){if(n=n||{},"object"==typeof t){if(void 0===t.nodeType)throw new Error("Parameter css must be a string or a DOM element")}else if("string"!=typeof t)throw new Error("Parameter css must be a string or a DOM element");this._css[e]={markup:t,options:n}},isTemplateRegistered:function(e){return this._templates[e]?!0:!1},isCssRegistered:function(e){return this._css[e]?!0:!1},ensureCss:function(t){if(this._css[t]){var n=this._css[t],i=void 0===n.markup.nodeType?n.options.id||"okanjo-css-"+t:null;if(i){var r=e.qwery("#"+i);if(0===r.length){var o=e.qwery("head"),s=document.createElement("style");if(s.id=i,s.setAttribute("type","text/css"),s.hasOwnProperty?s.innerHTML=n.markup:s.styleSheet.cssText=n.markup,o.length>0)o[0].appendChild(s);else{var a=e.qwery("body");a.length>0&&a[0].appendChild(s)}}}}},render:function(t,n,i){i=i||{};var r=this._templates[t],o=n;if(r.viewClosure&&(o=r.viewClosure(n,i)),o.okanjoConfig=e.config,o.okanjoMetricUrl=e.config.ads.apiUri.replace(/^https?:\/\//,""),o.now=function(){return(new Date).getTime()},o.classDetects=this.classDetects,i.blockClasses&&Array.isArray(i.blockClasses)&&(o.classDetects=o.classDetects+=" "+i.blockClasses.join(" ")),i.css!==!1&&r.options.css&&r.options.css.length>0)for(var s=0;s<r.options.css.length;s++)this.ensureCss(r.options.css[s]);return e.Mustache.render(r.markup,o)},formats:{currency:function(e,t,n,i){t=isNaN(t=Math.abs(t))?2:t,n=void 0===n?".":n,i=void 0===i?",":i;var r=0>e?"-":"",o=parseInt(e=Math.abs(+e||0).toFixed(t))+"",s=o.length;return s=s>3?s%3:0,r+(s?o.substr(0,s)+i:"")+o.substr(s).replace(/(\d{3})(?=\d)/g,"$1"+i)+(t?n+Math.abs(e-o).toFixed(t).slice(2):"")},product:function(t){if("object"==typeof t&&Array.isArray(t)){for(var n=[],i=0;i<t.length;i++)n.push(this.product(t[i]));return n}return"object"==typeof t?(t.image_url=t.image_urls?t.image_urls[0]:"",t.escaped_buy_url=encodeURIComponent(t.buy_url),t.escaped_inline_buy_url=e.util.empty(t.inline_buy_url)?"":encodeURIComponent(t.inline_buy_url),t.price=this.currency(t.price),t):null}}},e.mvc=new t}(okanjo,this),function(){if(!this.JSONP){var e,t,n,i,r,o,s;n=window.encodeURIComponent,i=function(){return void 0},t=function(e){var t;return t=e.url,t+=e.url.indexOf("?")<0?"?":"&",t+=r(e.data)},o=function(){return e.requestCounter+=1,(new Date).getTime()+"_"+e.requestCounter},r=function(e){var t,i,r;t=[];for(i in e)if(e.hasOwnProperty(i))if(r=e[i],Array.isArray(r))for(var o=0;o<r.length;o++)t.push(n(i)+"[]="+n(r[o]));else t.push(n(i)+"="+n(r));return t.join("&")},e=function(e){e=e?e:{};var n,r,a,c,u,l;if(a={data:e.data||{},error:e.error||i,success:e.success||i,beforeSend:e.beforeSend||i,complete:e.complete||i,url:e.url||"",timeout:e.timeout||3e4},a.computedUrl=t(a),0===a.url.length)throw new Error("MissingUrl");return r=!1,a.beforeSend({},a)!==!1?(n=a.data[e.callbackName||"callback"]="_okanjo_jsonp_"+o(),window[n]=function(e){u&&clearTimeout(u),u=null,a.success(e,a),a.complete(e,a),l()},l=function(){try{return delete window[n]}catch(e){return void(window[n]=void 0)}},c=window.document.createElement("script"),c.src=t(a),c.async=!0,u=setTimeout(function(){u=null;var e=new Error("JSONP request did not respond in time!");return e.url=c&&c.src||null,a.error(e),l(),a.complete(e,a)},a.timeout),c.onerror=function(e){return u&&clearTimeout(u),a.error({url:c.src,event:e}),a.complete({url:c.src,event:e},a)},c.onload=c.onreadystatechange=function(){return r||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState?void 0:(r=!0,c.onload=c.onreadystatechange=null,c&&c.parentNode&&c.parentNode.removeChild(c),c=null)},s=s||window.document.getElementsByTagName("head")[0]||window.document.documentElement,s.insertBefore(c,s.firstChild)):void 0},e.requestCounter=0,"undefined"!=typeof define&&null!==define&&define.amd?define(function(){return e}):"undefined"!=typeof module&&null!==module&&module.exports?module.exports=e:this.JSONP=e}}.call(okanjo),Object.keys||(Object.keys=function(){"use strict";var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],i=n.length;return function(r){if("object"!=typeof r&&("function"!=typeof r||null===r))throw new TypeError("Object.keys called on non-object");var o,s,a=[];for(o in r)e.call(r,o)&&a.push(o);if(t)for(s=0;i>s;s++)e.call(r,n[s])&&a.push(n[s]);return a}}()),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n;if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),r=i.length>>>0;if(0===r)return-1;var o=+t||0;if(1/0===Math.abs(o)&&(o=0),o>=r)return-1;for(n=Math.max(o>=0?o:r-Math.abs(o),0);r>n;){if(n in i&&i[n]===e)return n;n++}return-1}),Array.prototype.every||(Array.prototype.every=function(e,t){"use strict";var n,i;if(null==this)throw new TypeError("this is null or not defined");var r=Object(this),o=r.length>>>0;if("function"!=typeof e)throw new TypeError;for(arguments.length>1&&(n=t),i=0;o>i;){var s;if(i in r){s=r[i];var a=e.call(n,s,i,r);if(!a)return!1}i++}return!0}),function(e){"use strict";for(var t,n,i={},r=function(){},o="memory".split(","),s="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(",");t=o.pop();)void 0===e[t]&&(e[t]=e[t]||i);for(;n=s.pop();)void 0===e[n]&&(e[n]=e[n]||r)}(this.console||{}),function(e,t){function n(){var e="test",n=t.sessionStorage;try{return n.setItem(e,"1"),n.removeItem(e),!0}catch(i){return!1}}var i=null;return i="localStorage"in t&&null!==t.localStorage&&n()?t.localStorage:{_data:{},length:0,_updateLen:function(){this.length=this._data.length},setItem:function(e,t){var n=this._data[e]=String(t);return this._updateLen(),n},getItem:function(e){return this._data.hasOwnProperty(e)?this._data[e]:void 0},removeItem:function(e){var t=delete this._data[e];return this._updateLen(),t},clear:function(){return this._data={}},key:function(e){return Object.keys(this._data)[e]}},e.Cache=i,i}(okanjo||this,this),function(e,t){var n=t.document||{cookie:""};return e.Cookie={set:function(e,t,i){var r=new Date;r.setDate(r.getDate()+i);var o=encodeURI(t)+(i?"; expires="+r.toUTCString()+"; path=/":"");n.cookie=e+"="+o},get:function(e){var t,i,r,o=n.cookie.split(";");for(t=0;t<o.length;t++)if(i=o[t].substr(0,o[t].indexOf("=")),r=o[t].substr(o[t].indexOf("=")+1),i=i.replace(/^\s+|\s+$/g,""),i==e)return decodeURI(r);return null}},e.Cookie}(okanjo||this,this),"object"!=typeof JSON&&(JSON={},function(){"use strict";function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,r,o,s,a=gap,c=t[e];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(c)){for(o=c.length,n=0;o>n;n+=1)s[n]=str(n,c)||"null";return r=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,r}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;o>n;n+=1)"string"==typeof rep[n]&&(i=rep[n],r=str(i,c),r&&s.push(quote(i)+(gap?": ":":")+r));else for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(r=str(i,c),r&&s.push(quote(i)+(gap?": ":":")+r));return r=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,r}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;n>i;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,i,r=e[t];if(r&&"object"==typeof r)for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(i=walk(r,n),void 0!==i?r[n]=i:delete r[n]);return reviver.call(e,t,r)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}()),function(){/*!
  * @preserve Qwery - A Blazing Fast query selector engine
  * https://github.com/ded/qwery
  * copyright Dustin Diaz 2012
  * MIT License
  */
!function(e,t,n){"undefined"!=typeof module&&module.exports?module.exports=n():"function"==typeof define&&define.amd?define(n):t[e]=n()}("qwery",this,function(){function e(){this.c={}}function t(e){return K.g(e)||K.s(e,"(^|\\s+)"+e+"(\\s+|$)",1)}function n(e,t){for(var n=0,i=e.length;i>n;n++)t(e[n])}function i(e){for(var t=[],n=0,i=e.length;i>n;++n)g(e[n])?t=t.concat(e[n]):t[t.length]=e[n];return t}function r(e){for(var t=0,n=e.length,i=[];n>t;t++)i[t]=e[t];return i}function o(e){for(;(e=e.previousSibling)&&1!=e[T];);return e}function s(e){return e.match(F)}function a(e,n,i,r,o,s,a,c,l,d,h){var f,p,g,m,y;if(1!==this[T])return!1;if(n&&"*"!==n&&this[E]&&this[E].toLowerCase()!==n)return!1;if(i&&(p=i.match(S))&&p[1]!==this.id)return!1;if(i&&(y=i.match(N)))for(f=y.length;f--;)if(!t(y[f].slice(1)).test(this.className))return!1;if(l&&v.pseudos[l]&&!v.pseudos[l](this,h))return!1;if(r&&!a){m=this.attributes;for(g in m)if(Object.prototype.hasOwnProperty.call(m,g)&&(m[g].name||g)==o)return this}return r&&!u(s,Z(this,o)||"",a)?!1:this}function c(e){return G.g(e)||G.s(e,e.replace(R,"\\$1"))}function u(e,t,n){switch(e){case"=":return t==n;case"^=":return t.match(Q.g("^="+n)||Q.s("^="+n,"^"+c(n),1));case"$=":return t.match(Q.g("$="+n)||Q.s("$="+n,c(n)+"$",1));case"*=":return t.match(Q.g(n)||Q.s(n,c(n),1));case"~=":return t.match(Q.g("~="+n)||Q.s("~="+n,"(?:^|\\s+)"+c(n)+"(?:\\s+|$)",1));case"|=":return t.match(Q.g("|="+n)||Q.s("|="+n,"^"+c(n)+"(-|$)",1))}return 0}function l(e,t){var i,r,o,c,u,l,d,f=[],p=[],g=t,m=Y.g(e)||Y.s(e,e.split(H)),v=e.match(B);if(!m.length)return f;if(c=(m=m.slice(0)).pop(),m.length&&(o=m[m.length-1].match(M))&&(g=y(t,o[1])),!g)return f;for(l=s(c),u=g!==t&&9!==g[T]&&v&&/^[+~]$/.test(v[v.length-1])?function(e){for(;g=g.nextSibling;)1==g[T]&&(l[1]?l[1]==g[E].toLowerCase():1)&&(e[e.length]=g);return e}([]):g[x](l[1]||"*"),i=0,r=u.length;r>i;i++)(d=a.apply(u[i],l))&&(f[f.length]=d);return m.length?(n(f,function(e){h(e,m,v)&&(p[p.length]=e)}),p):f}function d(e,t,n){if(f(t))return e==t;if(g(t))return!!~i(t).indexOf(e);for(var r,o,c=t.split(",");t=c.pop();)if(r=Y.g(t)||Y.s(t,t.split(H)),o=t.match(B),r=r.slice(0),a.apply(e,s(r.pop()))&&(!r.length||h(e,r,o,n)))return!0;return!1}function h(e,t,n,i){function r(e,i,c){for(;c=V[n[i]](c,e);)if(f(c)&&a.apply(c,s(t[i]))){if(!i)return c;if(o=r(c,i-1,c))return o}}var o;return(o=r(e,t.length-1,e))&&(!i||X(o,i))}function f(e,t){return e&&"object"==typeof e&&(t=e[T])&&(1==t||9==t)}function p(e){var t,n,i=[];e:for(t=0;t<e.length;++t){for(n=0;n<i.length;++n)if(i[n]==e[t])continue e;i[i.length]=e[t]}return i}function g(e){return"object"==typeof e&&isFinite(e.length)}function m(e){return e?"string"==typeof e?v(e)[0]:!e[T]&&g(e)?e[0]:e:k}function y(e,t,n){return 9===e[T]?e.getElementById(t):e.ownerDocument&&((n=e.ownerDocument.getElementById(t))&&X(n,e)&&n||!X(e,e.ownerDocument)&&b('[id="'+t+'"]',e)[0])}function v(e,t){var n,o,s=m(t);if(!s||!e)return[];if(e===window||f(e))return!t||e!==window&&f(s)&&X(e,s)?[e]:[];if(e&&g(e))return i(e);if(n=e.match(z)){if(n[1])return(o=y(s,n[1]))?[o]:[];if(n[2])return r(s[x](n[2]));if(et&&n[3])return r(s[j](n[3]))}return b(e,s)}function w(e,t){return function(n){var i,r;return I.test(n)?void(9!==e[T]&&((r=i=e.getAttribute("id"))||e.setAttribute("id",r="__qwerymeupscotty"),n='[id="'+r+'"]'+n,t(e.parentNode||e,n,!0),i||e.removeAttribute("id"))):void(n.length&&t(e,n,!1))}}var b,k=document,_=k.documentElement,j="getElementsByClassName",x="getElementsByTagName",O="querySelectorAll",C="useNativeQSA",E="tagName",T="nodeType",S=/#([\w\-]+)/,N=/\.[\w\-]+/g,M=/^#([\w\-]+)$/,L=/^\.([\w\-]+)$/,P=/^([\w\-]+)$/,A=/^([\w]+)?\.([\w\-]+)$/,I=/(^|,)\s*[>~+]/,D=/^\s+|\s*([,\s\+\~>]|$)\s*/g,q=/[\s\>\+\~]/,U=/(?![\s\w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^'"]*\]|[\s\w\+\-]*\))/,R=/([.*+?\^=!:${}()|\[\]\/\\])/g,$=/^(\*|[a-z0-9]+)?(?:([\.\#]+[\w\-\.#]+)?)/,W=/\[([\w\-]+)(?:([\|\^\$\*\~]?\=)['"]?([ \w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^]+)["']?)?\]/,J=/:([\w\-]+)(\(['"]?([^()]+)['"]?\))?/,z=new RegExp(M.source+"|"+P.source+"|"+L.source),B=new RegExp("("+q.source+")"+U.source,"g"),H=new RegExp(q.source+U.source),F=new RegExp($.source+"("+W.source+")?("+J.source+")?"),V={" ":function(e){return e&&e!==_&&e.parentNode},">":function(e,t){return e&&e.parentNode==t.parentNode&&e.parentNode},"~":function(e){return e&&e.previousSibling},"+":function(e,t,n,i){return e?(n=o(e))&&(i=o(t))&&n==i&&n:!1}};e.prototype={g:function(e){return this.c[e]||void 0},s:function(e,t,n){return t=n?new RegExp(t):t,this.c[e]=t}};var K=new e,G=new e,Q=new e,Y=new e,X="compareDocumentPosition"in _?function(e,t){return 16==(16&t.compareDocumentPosition(e))}:"contains"in _?function(e,t){return t=9===t[T]||t==window?_:t,t!==e&&t.contains(e)}:function(e,t){for(;e=e.parentNode;)if(e===t)return 1;return 0},Z=function(){var e=k.createElement("p");return(e.innerHTML='<a href="#x">x</a>')&&"#x"!=e.firstChild.getAttribute("href")?function(e,t){return"class"===t?e.className:"href"===t||"src"===t?e.getAttribute(t,2):e.getAttribute(t)}:function(e,t){return e.getAttribute(t)}}(),et=!!k[j],tt=k.querySelector&&k[O],nt=function(e,t){var i,o,s=[];try{return 9!==t[T]&&I.test(e)?(n(i=e.split(","),w(t,function(e,t){o=e[O](t),1==o.length?s[s.length]=o.item(0):o.length&&(s=s.concat(r(o)))})),i.length>1&&s.length>1?p(s):s):r(t[O](e))}catch(a){}return it(e,t)},it=function(e,i){var r,o,s,a,c,u,d=[];if(e=e.replace(D,"$1"),o=e.match(A)){for(c=t(o[2]),r=i[x](o[1]||"*"),s=0,a=r.length;a>s;s++)c.test(r[s].className)&&(d[d.length]=r[s]);return d}return n(u=e.split(","),w(i,function(e,t,n){for(c=l(t,e),s=0,a=c.length;a>s;s++)(9===e[T]||n||X(c[s],i))&&(d[d.length]=c[s])})),u.length>1&&d.length>1?p(d):d},rt=function(e){"undefined"!=typeof e[C]&&(b=e[C]&&tt?nt:it)};return rt({useNativeQSA:!0}),v.configure=rt,v.uniq=p,v.is=d,v.pseudos={},v}),/*! onDomReady.js 1.4.0 (c) 2013 Tubal Martin - MIT license | Wrapped in UMD by Okanjo */
function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.onDomReady=t()}(this,function(){"use strict";function e(t){if(!k){if(!s.body)return i(e);for(k=!0;t=_.shift();)i(t)}}function t(t){(w||t.type===c||s[h]===d)&&(n(),e())}function n(){w?(s[v](m,t,u),o[v](c,t,u)):(s[p](y,t),o[p](l,t))}function i(e,t){setTimeout(e,+t>=0?t:1)}function r(e){k?i(e):_.push(e)}var o=window,s=o.document,a=s.documentElement,c="load",u=!1,l="on"+c,d="complete",h="readyState",f="attachEvent",p="detachEvent",g="addEventListener",m="DOMContentLoaded",y="onreadystatechange",v="removeEventListener",w=g in s,b=u,k=u,_=[];if(s[h]===d)i(e);else if(w)s[g](m,t,u),o[g](c,t,u);else{s[f](y,t),o[f](l,t);try{b=null==o.frameElement&&a}catch(j){}b&&b.doScroll&&!function x(){if(!k){try{b.doScroll("left")}catch(t){return i(x,50)}n(),e()}}()}return r.version="1.4.0",r.isReady=function(){return k},r}),/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
function(e,t){"object"==typeof exports&&exports?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Mustache={})}(this,function(e){function t(e){return"function"==typeof e}function n(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(e,t){return p.call(e,t)}function r(e){return!i(g,e)}function o(e){return String(e).replace(/[&<>"'\/]/g,function(e){return m[e]})}function s(t,i){function o(){if(_&&!j)for(;m.length;)delete g[m.pop()];else m=[];_=!1,j=!1}function s(e){if("string"==typeof e&&(e=e.split(v,2)),!f(e)||2!==e.length)throw new Error("Invalid tags: "+e);l=new RegExp(n(e[0])+"\\s*"),d=new RegExp("\\s*"+n(e[1])),h=new RegExp("\\s*"+n("}"+e[1]))}if(!t)return[];var l,d,h,p=[],g=[],m=[],_=!1,j=!1;s(i||e.tags);for(var x,O,C,E,T,S,N=new u(t);!N.eos();){if(x=N.pos,C=N.scanUntil(l))for(var M=0,L=C.length;L>M;++M)E=C.charAt(M),r(E)?m.push(g.length):j=!0,g.push(["text",E,x,x+1]),x+=1,"\n"===E&&o();if(!N.scan(l))break;if(_=!0,O=N.scan(k)||"name",N.scan(y),"="===O?(C=N.scanUntil(w),N.scan(w),N.scanUntil(d)):"{"===O?(C=N.scanUntil(h),N.scan(b),N.scanUntil(d),O="&"):C=N.scanUntil(d),!N.scan(d))throw new Error("Unclosed tag at "+N.pos);if(T=[O,C,x,N.pos],g.push(T),"#"===O||"^"===O)p.push(T);else if("/"===O){if(S=p.pop(),!S)throw new Error('Unopened section "'+C+'" at '+x);if(S[1]!==C)throw new Error('Unclosed section "'+S[1]+'" at '+x)}else"name"===O||"{"===O||"&"===O?j=!0:"="===O&&s(C)}if(S=p.pop())throw new Error('Unclosed section "'+S[1]+'" at '+N.pos);return c(a(g))}function a(e){for(var t,n,i=[],r=0,o=e.length;o>r;++r)t=e[r],t&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(i.push(t),n=t));return i}function c(e){for(var t,n,i=[],r=i,o=[],s=0,a=e.length;a>s;++s)switch(t=e[s],t[0]){case"#":case"^":r.push(t),o.push(t),r=t[4]=[];break;case"/":n=o.pop(),n[5]=t[2],r=o.length>0?o[o.length-1][4]:i;break;default:r.push(t)}return i}function u(e){this.string=e,this.tail=e,this.pos=0}function l(e,t){this.view=null==e?{}:e,this.cache={".":this.view},this.parent=t}function d(){this.cache={}}var h=Object.prototype.toString,f=Array.isArray||function(e){return"[object Array]"===h.call(e)},p=RegExp.prototype.test,g=/\S/,m={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},y=/\s*/,v=/\s+/,w=/\s*=/,b=/\s*\}/,k=/#|\^|\/|>|\{|&|=|!/;u.prototype.eos=function(){return""===this.tail},u.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},u.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},l.prototype.push=function(e){return new l(e,this)},l.prototype.lookup=function(e){var n,i=this.cache;if(e in i)n=i[e];else{for(var r,o,s=this;s;){if(e.indexOf(".")>0)for(n=s.view,r=e.split("."),o=0;null!=n&&o<r.length;)n=n[r[o++]];else"object"==typeof s.view&&(n=s.view[e]);if(null!=n)break;s=s.parent}i[e]=n}return t(n)&&(n=n.call(this.view)),n},d.prototype.clearCache=function(){this.cache={}},d.prototype.parse=function(e,t){var n=this.cache,i=n[e];return null==i&&(i=n[e]=s(e,t)),i},d.prototype.render=function(e,t,n){var i=this.parse(e),r=t instanceof l?t:new l(t);return this.renderTokens(i,r,n,e)},d.prototype.renderTokens=function(e,t,n,i){for(var r,o,s,a="",c=0,u=e.length;u>c;++c)s=void 0,r=e[c],o=r[0],"#"===o?s=this._renderSection(r,t,n,i):"^"===o?s=this._renderInverted(r,t,n,i):">"===o?s=this._renderPartial(r,t,n,i):"&"===o?s=this._unescapedValue(r,t):"name"===o?s=this._escapedValue(r,t):"text"===o&&(s=this._rawValue(r)),void 0!==s&&(a+=s);return a},d.prototype._renderSection=function(e,n,i,r){function o(e){return s.render(e,n,i)}var s=this,a="",c=n.lookup(e[1]);if(c){if(f(c))for(var u=0,l=c.length;l>u;++u)a+=this.renderTokens(e[4],n.push(c[u]),i,r);else if("object"==typeof c||"string"==typeof c)a+=this.renderTokens(e[4],n.push(c),i,r);else if(t(c)){if("string"!=typeof r)throw new Error("Cannot use higher-order sections without the original template");c=c.call(n.view,r.slice(e[3],e[5]),o),null!=c&&(a+=c)}else a+=this.renderTokens(e[4],n,i,r);return a}},d.prototype._renderInverted=function(e,t,n,i){var r=t.lookup(e[1]);return!r||f(r)&&0===r.length?this.renderTokens(e[4],t,n,i):void 0},d.prototype._renderPartial=function(e,n,i){if(i){var r=t(i)?i(e[1]):i[e[1]];return null!=r?this.renderTokens(this.parse(r),n,i,r):void 0}},d.prototype._unescapedValue=function(e,t){var n=t.lookup(e[1]);return null!=n?n:void 0},d.prototype._escapedValue=function(t,n){var i=n.lookup(t[1]);return null!=i?e.escape(i):void 0},d.prototype._rawValue=function(e){return e[1]},e.name="mustache.js",e.version="1.1.0",e.tags=["{{","}}"];var _=new d;e.clearCache=function(){return _.clearCache()},e.parse=function(e,t){return _.parse(e,t)},e.render=function(e,t,n){return _.render(e,t,n)},e.to_html=function(n,i,r,o){var s=e.render(n,i,r);return t(o)?void o(s):s},e.escape=o,e.Scanner=u,e.Context=l,e.Writer=d}),function(e){function t(e,t){var i=document,r=e.nodeType||e===window?e:i.createElement(e),o=[];t&&(r.className=t);var s=n(),a=n(),c=function(e,t){r.addEventListener?r.addEventListener(e,t,!1):r.attachEvent("on"+e,t),o.push({event:e,handler:t})},u=function(e,t){r.removeEventListener?r.removeEventListener(e,t):r.detachEvent("on"+e,t);for(var n,i=o.length;i-->0;)if(n=o[i],n.event===e&&n.handler===t){o.splice(i,1);break}},l=function(e){"ontouchend"in document.documentElement?c("touchstart",e):c("click",e)},d=function(e){r&&(r.style.display="block",s.fire(e))},h=function(e){r&&(r.style.display="none",a.fire(e))},f=function(){return r.style&&"block"===r.style.display},p=function(e){r&&(r.innerHTML=e)},g=function(e){r&&(p(""),r.appendChild(i.createTextNode(e)))},m=function(){if(r.parentNode){for(var e,t=o.length;t-->0;)e=o[t],u(e.event,e.handler);r.parentNode.removeChild(r),s.removeAllListeners(),a.removeAllListeners()}},y=function(e){var t=e.el||e;r.appendChild(t)};return{el:r,addListener:c,addClickListener:l,onShowEvent:s,onHideEvent:a,show:d,hide:h,isShowing:f,html:p,text:g,remove:m,add:y}}function n(){var e={},t=0,n=function(n){return e[t]=n,t++},i=function(t){t&&delete e[t]},r=function(){e={}},o=function(){for(var n=0,i=t;i>n;++n)e[n]&&e[n].apply(null,arguments)};return{addListener:n,removeListener:i,removeAllListeners:r,fire:o}}var i=function(){function n(i,r,o,s,a,c){if(void 0!==i){r=r||{};var u,l=t("div","okanjoModal okanjoModalOverride "+(r.classes||"")),d=t("div","okanjoModalContent"),h=t("div","okanjoModalButtons");l.add(d),l.add(h),l.el.style.display="none";var f,p=[];r.buttons=r.buttons||[{text:"Close",handler:"hide",primary:!0}];var g=function(){for(var e=p.length;e-->0;){var t=p[e];t.remove()}p=[]},m=function(){l.el.style.marginLeft=-l.el.clientWidth/2+"px",s.el.style.marginLeft=l.el.style.marginLeft},y=function(){for(var t=e.qwery(".okanjoModal"),n=t.length;n-->0;)if("none"!==t[n].style.display)return!0;return!1},v=function(){l.isShowing()||(n.resizeOverlay(),o.show(o),s.show(s),l.show(f),m())},w=function(){l.isShowing()&&(l.hide(f),y()||(o.hide(o),s.hide(s)),r.autoRemove&&f.remove())},b=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t};return f={modal:l,overlay:o,overlayButton:s,show:function(){return a?a(v,f):v(),f},hide:function(){return c?c(w,f):w(),f},onShow:function(e){return l.onShowEvent.addListener(function(){e(f)}),f},onHide:function(e){return l.onHideEvent.addListener(function(){e(f)}),f},remove:function(){o.onRequestHide.removeListener(u),u=null,g(),l.remove()},setButtons:function(e){var n,i,r,o=e.length,s=function(e,t){var n=b(f);e.addClickListener(function(e){n.event=e||window.event,t.handler(n)})};if(g(),0===o)h.hide();else for(h.show();o-->0;)n=e[o],r="okanjoModalBtn",n.primary&&(r+=" okanjoModalBtnPrimary"),r+=n.classes?" "+n.classes:"",i=t("button",r),"hide"===n.handler?i.addClickListener(f.hide):n.handler&&s(i,n),i.text(n.text),h.add(i),p.push(i);return m(),f},setContent:function(e){return e.nodeType?(d.html(""),d.add(e)):d.html(e),m(),i=e,f},getContent:function(){return i}},u=o.onRequestHide.addListener(function(){r.overlayClose!==!1&&l.isShowing()&&f.hide()}),f.setContent(i).setButtons(r.buttons),document.body.appendChild(l.el),f}}var i=document,r=function(e){var t=i.documentElement,n="scroll"+e,r="offset"+e;return Math.max(i.body[n],t[n],i.body[r],t[r],t["client"+e])},o=function(e){e.style.marginLeft=-e.clientWidth/2+"px"};return n.resizeOverlay=function(){var t,n=i.getElementById("okanjoModalOverlay"),s=e.qwery(".okanjoModal"),a=e.qwery(".okanjoOverlayCloseButton");for(n.style.width=r("Width")+"px",n.style.height=r("Height")+"px",t=0;t<s.length;t++)o(s[t]);for(t=0;t<a.length;t++)o(a[t])},n}(),r=function(){function r(){if(0===e.qwery("#okanjoModalOverlay").length){o=t("div","okanjoModalOverlay okanjoModalOverride"),o.el.id="okanjoModalOverlay",s=t("button","okanjoOverlayCloseButton"),s.el.setAttribute("title","Close (Esc)"),s.el.setAttribute("type","button"),s.el.innerHTML="Ã—",a.body.appendChild(s.el),a.body.appendChild(o.el),o.onRequestHide=n();var r=function(){o.onRequestHide.fire()};o.addClickListener(r),s.addClickListener(r),t(a).addListener("keydown",function(e){var t=e.which||e.keyCode;27===t&&r()});var c,u=t(window);u.addListener("resize",function(){c&&clearTimeout(c),c=setTimeout(i.resizeOverlay,100)}),u.addListener("orientationchange",function(){for(var e=0;3>e;++e)setTimeout(i.resizeOverlay,1e3*e+200)})}}var o,s,a=document;document.body&&r();var c=function(e,t){return r(),i(e,t,o,s,c.customShow,c.customHide)};return c.resizeOverlay=i.resizeOverlay,c}();e.modal=r}(this)}.apply(okanjo),function(e,t){var n=e.metrics={_trackers:{},events:{},addGoogleTracker:function(e,i){t._gaq=t._gaq||[];var r=t._gaq;i||(i="tracker_"+Object.keys(n._trackers).length),r.push(function(){t._gat._createTracker(e,i)}),r.push([i+"._setDomainName",t.location.host]),r.push([i+"._setAllowLinker",!0])},addDefaultTracker:function(e){n.addTracker(e,function(n){"undefined"==typeof n.type&&(n.type="event"),t._gaq.push([e+"."+("pageview"==n.type?"_trackPageview":"_trackEvent")].concat(n.args))})},addTracker:function(e,t){n._trackers[e]=t},trackEvent:function(){n.track({type:"event",args:arguments})},trackPageView:function(){this.track({type:"pageview",args:arguments})},track:function(e){for(var t in n._trackers)n._trackers.hasOwnProperty(t)&&n._trackers[t](e)}};!function(){e.onDomReady(function(){if(!document.getElementById("#okanjo-metrics")){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",t.id="okanjo-metrics",e.qwery("body")[0].appendChild(t),n.addGoogleTracker(e.config.analyticsId,"okanjo")}n.addDefaultTracker("okanjo")})}()}(okanjo,this),function(e){var t=document,n=function(e,t,n){for(var i=0;i<e.length;i++)null!==e[i]&&t.push(n+(i+1)+"="+e[i])};e.moat={enabled:!1,insert:function(i){if(e.moat.enabled){var r=i||t.getElementsByTagName("body")[0],o=t.createElement("script"),s=[],a=e.config.moat;n(a.clientLevels,s,"moatClientLevel"),n(a.clientSlicers,s,"moatClientSlicer"),s=s.join("&"),o.type="text/javascript",o.async=!0,o.src="//js.moatads.com/"+a.tag+"/moatad.js#"+s,r.appendChild(o)}}}}(okanjo,this),function(e,t){var n=e.Cache,i=e._Widget=function(e,t){if(!e||"object"!=typeof e||void 0===e.nodeType)throw new Error("Invalid element - must be a valid DOM element");if("undefined"!=typeof t&&"object"!=typeof t)throw new Error("Invalid configuration, must be an object or nothing at all, got: "+typeof t);t=t||{},this.element=e,this.config=t||{},this.configMap={},this.templates={error:"okanjo.error"},this.css={}};return i.prototype={widgetName:"BaseWidget",config:null,use_cache:!1,cache_key_prefix:"ok_widget_",cache_ttl:6e4,cacheKeyAttributes:"id".split(","),constructor:i,init:function(){this.ensureTemplates(),this.parseConfiguration(),this.findWidgetKey()&&this.load()&&(this.trackLoad(),this.autoCleanCache())},findWidgetKey:function(){return e.util.empty(this.config.key)?e.util.empty(e.key)?e.util.empty(this.key)?(this.config.key=this.key,!0):(this.element.innerHTML=e.mvc.render(this.templates.error,{message:"Missing Okanjo key."}),e.report(this.widgetName,"Missing key. Define one using okanjo.configure or pass the key parameter as an option in the "+this.widgetName+" constructor"),!1):(this.key=e.key,this.config.key=this.key,!0):(this.key=this.config.key,this.config.key=this.key,!0)},ensureTemplates:function(){var t,n=this.templates,i=this.css;for(t in n)if(n.hasOwnProperty(t)&&!e.mvc.isTemplateRegistered(n[t]))throw new Error("[Okanjo."+this.widgetName+"] Missing template: "+n[t]);for(t in i)if(i.hasOwnProperty(t)&&!e.mvc.isCssRegistered(i[t]))throw new Error("[Okanjo."+this.widgetName+"] Missing css block: "+i[t])},parseConfiguration:function(){var t=e.util.data(this.element);e.util.copyIfSetMap(this.config,t,this.configMap,{stripEmpty:!0})},load:function(){return!0},trackLoad:function(){var n=t.location;e.metrics.trackEvent("Okanjo "+this.widgetName+" Widget","Loaded",n.protocol+"//"+n.hostname+(n.port?":"+n.port:"")+n.pathname)},trackMoat:function(){e.moat.insert(this.element)},autoCleanCache:function(){if(this.use_cache){var e=this;setTimeout(function(){e.cleanCache()},2e3)}},getCurrentPageUrl:function(){var e=t.location.href,n=Math.min(e.indexOf("?"),e.indexOf("#"));return n>0?e.substr(0,n):e},getCacheKey:function(){for(var n=[t.location.host+t.location.pathname],i=this.cacheKeyAttributes,r=0;r<i.length;r++)void 0!==this.config[i[r]]&&n.push(i[r],this.config[i[r]]);return this.cache_key_prefix+e.util.hash(n.join(";"))},cleanCache:function(){try{for(var t=(new Date).getTime(),i=[],r=[],o=0;o<n.length;o++){var s=n.key(o);if(0===s.indexOf(this.cache_key_prefix)&&s.indexOf("_expires")<0){var a=n.getItem(s+"_expires");null!==a&&t<parseInt(a)?r.push(s+"_expires"):(n.removeItem(s),n.removeItem(s+"_expires"))}else s.indexOf("_expires")>=0&&i.push(s)}for(o=0;o<i.length;o++)r.indexOf(i[o])<0&&n.removeItem(i[o])}catch(c){e.report(this.widgetName,c)}},loadFromCache:function(t){try{var i=n.getItem(t),r=n.getItem(t+"_expires"),o=(new Date).getTime();if(null!==i&&null!==r&&o<parseInt(r))return JSON.parse(i);n.removeItem(t),n.removeItem(t+"_expires")}catch(s){e.report(this.widgetName,s)}return null},saveInCache:function(e,t){var i=this;setTimeout(function(){n.setItem(e,JSON.stringify(t)),n.setItem(e+"_expires",(new Date).getTime()+i.cache_ttl)},100)}},e._Widget}(okanjo,this),function(e){function t(n,i){e._Widget.call(this,n,i),this.items=[],this.config=i=i||{mode:t.contentTypes.browse,use_cache:!0,cache_ttl:6e4},this.config.nag=void 0===i.nag?!0:i.nag===!0,this.config.use_cache=void 0===i.use_cache?!0:i.use_cache===!0,this.config.cache_ttl=void 0===i.cache_ttl?6e4:i.cache_ttl,this.use_cache=this.config.use_cache,this.cache_ttl=this.config.cache_ttl,this.disable_inline_buy=void 0===this.config.disable_inline_buy?!1:i.disable_inline_buy===!0,this.cache_key_prefix="ok_product_block_",this.templates={error:"okanjo.error",main:"product.block"},this.css={main:"product.block",modal:"okanjo.modal"},this.configMap={key:"key",mode:"mode",disable_inline_buy:"disable-inline-buy",url:"url",selectors:"selectors",text:"text",id:"id",q:"query",marketplace_status:["marketplace-status"],marketplace_id:["marketplace-id"],pools:"pools",external_id:"external-id",sku:"sku",sold_by:"sold-by",min_price:"min-price",max_price:"max-price",condition:"condition",manufacturer:"manufacturer",upc:"upc",isbn:"isbn",tags:"tags",category:"category",min_donation_percent:"min-donation-percent",max_donation_percent:"max-donation-percent",donation_to:"donation-to",suboptimal:"suboptimal",skip:["skip","page-start"],take:["take","page-size"],expandable:"expandable"},i.no_init||this.init()}e.util.inherits(t,e._Widget),t.contentTypes={browse:"browse",sense:"sense",single:"single"};var n=t.prototype;return n.widgetName="Product",n.cacheKeyAttributes="mode,url,selectors,text,id,q,marketplace_status,marketplace_id,external_id,sku,sold_by,min_price,max_price,condition,manufacturer,upc,isbn,tags,category,min_donation_percent,max_donation_percent,donation_to,suboptimal,skip,take".split(","),n.load=function(){return this.config.id||this.config.mode==t.contentTypes.single?this.config.mode=e.util.empty(this.config.id)?t.contentTypes.browse:t.contentTypes.single:this.config.url||this.config.text||this.config.mode==t.contentTypes.sense?(e.util.empty(this.config.url)&&e.util.empty(this.config.text)&&(this.config.url=this.getCurrentPageUrl(),this.config.nag&&console.info("[Okanjo."+this.widgetName+"] No canonical url given for ProductSense. We recommend using a canonical url to ensure page visibility by Okanjo. Using derived url:",this.config.url)),this.config.mode=t.contentTypes.sense):this.config.mode=e.util.empty(this.config.mode)?t.contentTypes.browse:this.config.mode,this.config.pools&&"string"==typeof this.config.pools&&this.config.pools.indexOf(",")>=0&&(this.config.pools=this.config.pools.split(",")),this.config.use_cache&&this.loadProductsFromCache()||this.getProducts(),this.config.disable_inline_buy&&"string"==typeof this.config.disable_inline_buy&&(this.disable_inline_buy="true"===this.config.disable_inline_buy.toLowerCase()),!0},n.loadProductsFromCache=function(){var e=this.loadFromCache(this.getCacheKey());return null!==e?(this.items=e,this.showProducts(this.items),!0):!1},n.getProducts=function(){var t=this;this.executeSearch(function(n,i){if(n)console.error("[Okanjo."+t.widgetName+"] Failed to retrieve products.",n),t.element.innerHTML=e.mvc.render(t.templates.error,{message:"Could not retrieve products."});else if(t.items=i.data,t.showProducts(t.items),t.use_cache){var r=t.getCacheKey();t.saveInCache(r,t.items)}})},n.executeSearch=function(n){this.config.mode===t.contentTypes.sense?e.exec(e.getRoute(e.routes.products_sense),this.config,n):this.config.mode===t.contentTypes.single?e.exec(e.getRoute(e.routes.products_id,{product_id:this.config.id}),this.config,function(e,t){!e&&t&&t.data&&(t.data=[t.data]),n&&n(e,t)}):e.exec(e.getRoute(e.routes.products),this.config,n)},n.handleInlineBuyOption=function(){if(this.disable_inline_buy)for(var e=0;e<this.items.length;e++)this.items[e].inline_buy_url=null},n.showProducts=function(t){this.handleInlineBuyOption(),this.element.innerHTML=e.mvc.render(this.templates.main,{products:t||this.items||[],config:this.config}),this.bindEvents(),this.trackMoat()},t.interactTile=function(t,n){var i=this.getAttribute("data-inline-buy-url"),r=this.getAttribute("data-inline-buy-url-base"),o=this.getAttribute("data-expandable");if(e.util.empty(i))n&&this.click();else{t.preventDefault?t.preventDefault():t.returnValue=!1;var s=document.createElement("iframe");if(s.className="okanjo-ad-inline-buy-frame",s.setAttribute("frameborder","0"),s.setAttribute("allowFullscreen",""),s.src=r+"&n="+(new Date).getTime()+"&u="+encodeURIComponent(i),void 0!==o&&"false"===o.toLowerCase()){s.className+=" okanjo-ad-in-unit",s.setAttribute("height","100%"),s.setAttribute("width","100%");for(var a=this.parentNode;a&&"okanjo-ad-container"!=a.className;)a=a.parentNode;a&&a.appendChild(s)}else{var c=e.modal(s,{autoRemove:!0,buttons:[],classes:"adModal"});c.show()}}},n.bindEvents=function(){e.qwery("a",this.element).every(function(e){return e.addEventListener?e.addEventListener("click",t.interactTile):e.attachEvent("onclick",function(n){t.interactTile.call(e,n)}),!0})},e.Product=t,t}(okanjo,this),function(e){function t(t,n){e._Widget.call(this,t,n),this.config=n=n||{},this.templates={error:"okanjo.error",main:"ad.block"},this.css={main:"ad.block"},this.disable_inline_buy=void 0===this.config.disable_inline_buy?!1:n.disable_inline_buy===!0,this.configMap={key:"key",content:"content",size:"size",expandable:"expandable",type:"type",id:"id",disable_inline_buy:"disable-inline-buy"},n.no_init||this.init()}e.util.inherits(t,e._Widget),t.contentTypes={creative:"creative",dynamic:"dynamic"},t.types={product:"product"},t.sizes={billboard:{width:970,height:250},button_2:{width:120,height:60},half_page:{width:300,height:600},leaderboard:{width:728,height:90},medium_rectangle:{width:300,height:250},micro_bar:{width:88,height:31},portrait:{width:300,height:1050},rectangle:{width:180,height:150},super_leaderboard:{width:970,height:90},wide_skyscraper:{width:160,height:600},large_mobile_banner:{width:320,height:100},mobile_leaderboard:{width:320,height:50},small_square:{width:200,height:200},button_1:{width:120,height:90},full_banner:{width:468,height:60},half_banner:{width:234,height:60},large_rectangle:{width:336,height:280},pop_under:{width:720,height:300},three_to_one_rectangle:{width:300,height:100},skyscraper:{width:120,height:600},square:{width:250,height:250},square_button:{width:125,height:125},vertical_banner:{width:120,height:240},vertical_rectangle:{width:240,height:400}};var n=t.prototype;return n.widgetName="Ad",n.load=function(){if(e.util.empty(this.config.content))this.config.content=this.hasCreativeContent()?t.contentTypes.creative:t.contentTypes.dynamic;else if(this.config.content!==t.contentTypes.creative||this.hasCreativeContent()){if(this.config.content===t.contentTypes.dynamic&&this.hasCreativeContent())console.warn("[Okanjo.Ad] Ad content is dynamic, but ad placement contains markup. Markup will be clobbered!");else if(!t.contentTypes.hasOwnProperty(this.config.content))return this.element.innerHTML=e.mvc.render(this.templates.error,{message:"Invalid ad content: "+this.config.content}),e.report(this.widgetName,"Invalid ad content: "+this.config.content),!1}else console.warn("[Okanjo.Ad] Ad content is creative, but ad placement does not contain creative markup. Switching to dynamic!"),this.config.content=t.contentTypes.dynamic;if(e.util.empty(this.config.type)?this.config.type=t.types.product:t.types.hasOwnProperty(this.config.type)||(console.warn("[Okanjo."+this.widgetName+"] Unknown type",this.config.type,"given, using type `product` instead"),this.config.type=t.types.product),!e.util.empty(this.config.size)&&t.sizes.hasOwnProperty(this.config.size)&&this.setElementSize(t.sizes[this.config.size]),this.config.disable_inline_buy&&"string"==typeof this.config.disable_inline_buy&&(this.disable_inline_buy="true"===this.config.disable_inline_buy.toLowerCase()),this.config.type===t.types.product){if(e.util.empty(this.config.id))return this.element.innerHTML=e.mvc.render(this.templates.error,{message:"Missing ad product id"}),e.report(this.widgetName,"Missing ad product id"),!1;if(this.config.content==t.contentTypes.dynamic)this.insertProductWidget();else{if(this.config.content!=t.contentTypes.creative)return this.element.innerHTML=e.mvc.render(this.templates.error,{message:"Cannot render ad in content: "+this.config.content}),e.report(this.widgetName,"Cannot render ad in content: "+this.config.content),!1;this.insertCreativeWidget()}}return!0},n.render=function(){var n,i=document.createElement("div"),r=[],o=this.config.content==t.contentTypes.dynamic&&!e.util.empty(this.config.size);for(i.innerHTML=e.mvc.render(this.templates.main,{config:this.config},{blockClasses:o?["okanjo-ad-fit"]:[]}),n=0;n<this.element.childNodes.length;n++)1===this.element.childNodes[n].nodeType&&r.push(this.element.childNodes[n]);for(n=0;n<i.childNodes.length;n++)1===i.childNodes[n].nodeType&&this.element.appendChild(i.childNodes[n]);var s=e.qwery(".okanjo-ad-container",this.element)[0];for(n=0;n<r.length;n++)s.appendChild(r[n]);this.trackMoat()},n.interact=function(t){var n=e.qwery("a",this.productWidget.element);if(n.length>0)this._waitingOnProductLoad=!1,e.Product.interactTile.call(n[0],t,!0);else if(!this._waitingOnProductLoad){this._waitingOnProductLoad=!0;var i=this,r=setInterval(function(){i._waitingOnProductLoad?i.interact(t):clearInterval(r)},250);console.warn("Waiting for Okanjo Product widget to load...")}},n.insertCreativeWidget=function(){this.insertProductWidget({hidden:!0});var e=this;this.element.addEventListener?this.element.addEventListener("click",function(t){e.interact(t)}):this.element.attachEvent("onclick",function(t){e.interact(t)})},n.insertProductWidget=function(t){t=t||{};var n=document.createElement("div");return n.className="okanjo-ad-dynamic-product",t.hidden&&(n.style.display="none"),this.element.appendChild(n),this.render(),this.productWidget=new e.Product(n,{id:this.config.id,key:this.key,mode:e.Product.contentTypes.single,disable_inline_buy:this.disable_inline_buy,expandable:void 0===this.config.expandable||"true"===this.config.expandable.toLowerCase()}),this.productWidget},n.setElementSize=function(e){this.element.style.display="block",this.element.style.overflow="hidden",this.element.style.width=e.width+"px",this.element.style.height=e.height+"px"},n.hasCreativeContent=function(){if(this.element.childElementCount&&this.element.childElementCount>0)return!0;for(var e=0;e<this.element.childNodes.length;e++)if(1===this.element.childNodes[e].nodeType)return!0},e.Ad=t,t}(okanjo,this),okanjo});
//# sourceMappingURL=okanjo.min.js.map