{"version":3,"sources":["core.js","config.js","okanjo.js","template.js","jsonp.js","ie.js","console.js","cache.js","cookie.js","json2.js","vendor.js","metrics.js","pageview.js","emitter.js","widget.js","modal.js","product.js","ad.js"],"names":["root","factory","define","amd","exports","module","okanjo","this","ok","splitArguments","query","temp","key","value","eqIndex","params","ampSplit","split","i","length","indexOf","decodeURIComponent","substring","e","console","error","supportPageOffset","undefined","window","pageXOffset","isCSS1Compatible","document","compatMode","agent","navigator","userAgent","noop","version","qwery","metrics","trackEvent","trackPageView","routes","products","products_id","products_sense","getRoute","route","hasOwnProperty","replace","config","ads","apiUri","exec","url","data","callback","JSONP","err","statusCode","message","report","Error","success","res","context","mixed","util","trim","val","empty","clone","obj","k","hash","str","char","charCodeAt","toString","element","attrs","attributes","name","substr","copyIfSet","target","source","targetKey","sourceKey","options","doCopy","stripEmpty","Array","isArray","copyIfSetMap","map","keys","Object","inherits","ctor","superCtor","create","super_","prototype","constructor","enumerable","writable","configurable","TempCtor","getScrollPosition","x","documentElement","scrollLeft","body","y","pageYOffset","scrollTop","getElementSize","el","includeMargin","style","size","height","offsetHeight","width","offsetWidth","currentStyle","getComputedStyle","parseInt","marginTop","marginBottom","marginLeft","marginRight","getElementPosition","rect","pos","errMsg","getBoundingClientRect","contains","warn","x1","left","y1","top","x2","right","y2","bottom","getPageSize","html","w","Math","max","scrollWidth","clientWidth","h","scrollHeight","clientHeight","getViewportSize","doc","win","inWidth","innerWidth","inHeight","innerHeight","mobileZoom","vw","vh","getEventPosition","ex","pageX","ey","pageY","clientX","clientY","ellipsify","container","parent","parentNode","targetHeight","useTextContent","textContent","text","innerText","replacedText","safety","replacer","match","content","createElement","span","setAttribute","innerHTML","appendChild","detectClasses","classDetects","appVersion","push","isFramed","self","isiOS","test","isAndroid","isMobile","getPageArguments","includeHashArguments","queryArgs","location","search","hashArgs","deepClone","out","flatten","flatObject","toReturn","shortid","clusterWorkerId","counter","previousSeconds","shuffled","crypto","require","msCrypto","randomByte","randomBytes","getRandomValues","floor","random","dest","Uint8Array","encode","number","done","loopCounter","pow","REDUCE_TIME","seconds","Date","getTime","marketplace","uri","routerUri","balancedMarketplacePath","socketIOUri","configure","every","TemplateEngine","templates","css","_templates","_css","join","registerTemplate","template","viewClosure","nodeType","Mustache","parse","arguments","markup","registerCss","isTemplateRegistered","isCssRegistered","ensureCss","id","elements","head","styleSheet","cssText","render","templateName","view","call","okanjoConfig","okanjoMetricUrl","now","blockClasses","formats","currency","decimals","decimalSeparator","thousandsSeparator","isNaN","abs","s","toFixed","j","slice","product","image_url","image_urls","escaped_buy_url","encodeURIComponent","buy_url","escaped_inline_buy_url","inline_buy_url","price_formatted","price","mvc","computedUrl","objectToURI","makeUniqueCallback","requestCounter","script","timeoutHandle","removeCallback","beforeSend","complete","timeout","callbackName","clearTimeout","_error","src","async","setTimeout","onerror","evt","event","onload","onreadystatechange","readyState","removeChild","getElementsByTagName","insertBefore","firstChild","makeUrl","hasDontEnumBug","propertyIsEnumerable","dontEnums","dontEnumsLength","TypeError","prop","result","arg","searchElement","fromIndex","O","len","n","Infinity","callbackfn","thisArg","T","kValue","testResult","filter","fun","t","Event","preventDefault","returnValue","stopPropagation","cancelBubble","Element","addEventListener","eventListeners","type","listener","wrapper","srcElement","currentTarget","handleEvent","wrapper2","attachEvent","object","removeEventListener","eventListener","detachEvent","splice","HTMLDocument","Window","method","con","dummy","properties","methods","pop","c","isLocalStorageNameSupported","testKey","storage","sessionStorage","setItem","removeItem","OkanjoCache","localStorage","_data","_updateLen","String","getItem","clear","index","Cache","cookie","Cookie","set","cookieName","expireDays","expireDate","setDate","getDate","cookieValue","encodeURI","toUTCString","get","idx","nameTest","cookieArray","decodeURI","JSON","f","quote","string","escapable","lastIndex","a","meta","holder","v","partial","mind","gap","toJSON","rep","isFinite","indent","apply","valueOf","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","Number","Boolean","cx","\b","\t","\n","\f","\r","\"","\\","stringify","space","","reviver","walk","eval","SyntaxError","definition","cache","classRegex","classCache","g","each","fn","l","ar","r","arrayLike","concat","arrayify","previous","previousSibling","q","chunker","interpret","whole","tag","idsAndClasses","wholeAttribute","attribute","qualifier","wholePseudo","pseudo","wholePseudoVal","pseudoVal","m","o","classes","tagName","toLowerCase","clas","className","pseudos","checkAttr","getAttr","clean","cleanCache","specialChars","qualify","actual","attrCache","_qwery","selector","_root","token","els","intr","item","ret","tokens","tokenCache","tokenizr","dividedTokens","dividers","idOnly","byId","nextSibling","byTag","ancestorMatch","is","isNode","selectors","crawl","p","walker","cand","isAncestor","uniq","normalizeRoot","getElementById","ownerDocument","select","easy","hasByClass","byClass","collectSelector","collector","oid","nid","splittable","getAttribute","removeAttribute","qSA","useNativeQSA","classOnly","tagOnly","tagAndOrClass","normalizr","splitters","splittersMore","simple","attr","RegExp"," ","node",">","contestant","~","+","p1","p2","compareDocumentPosition","hasQSA","querySelector","selectQSA","ss","ctx","selectNonNative","items","rewrite","onDomReady","ready","isReady","defer","callbacks","shift","completed","w3c","LOAD","READYSTATE","COMPLETE","detach","REMOVEEVENTLISTENER","DOMCONTENTLOADED","FALSE","DETACHEVENT","ONREADYSTATECHANGE","ONLOAD","wait","docElem","ATTACHEVENT","ADDEVENTLISTENER","frameElement","doScroll","doScrollCheck","global","mustache","isFunction","escapeRegExp","testRegExp","re","RegExp_test","isWhitespace","nonSpaceRe","escapeHtml","entityMap","parseTemplate","tags","stripSpace","hasTag","nonSpace","spaces","compileTags","spaceRe","openingTagRe","closingTagRe","closingCurlyRe","sections","start","chr","openSection","scanner","Scanner","eos","scanUntil","valueLength","charAt","scan","tagRe","whiteRe","equalsRe","curlyRe","nestTokens","squashTokens","lastToken","squashedTokens","numTokens","section","nestedTokens","tail","Context","parentContext",".","Writer","Object_toString","&","<","'","/","lookup","names","clearCache","partials","renderTokens","originalTemplate","symbol","buffer","_renderSection","_renderInverted","_renderPartial","_unescapedValue","_escapedValue","_rawValue","subRender","escape","defaultWriter","to_html","send","OkanjoMetrics","default_channel","channel","external","_queue","pageId","pageArgs","urlSid","msid_key","cookieSid","sourceContext","source_cx","sourceChannel","source_ch","object_type","metric_session","event_type","correlation","ch","_noProcess","msid_ttl","sid","sourceCh","sourceCx","_lastKey","strip_meta","impression","interaction","action","click","inline_click","thirdparty_ad","cart","page","widget","store","cause","order","order_item","user","product_widget","ad_widget","store_widget","environment","live","testing","href","track","normalizeEventData","ref_ch","ref_cx","pgid","ok_ver","referrer","ref","updateSid","_processQueue","_processTimeout","includeElementInfo","pw","ph","includeViewportInfo","vp","vx1","vy1","vx2","vy2","includeEventInfo","copy","base","truncate","haystack","needle","EventEmitter","events","on","removeListener","emit","listeners","args","once","_EventEmitter","WidgetBase","_Widget","instanceId","configMap","proto","widgetName","use_cache","cache_key_prefix","cache_ttl","cacheKeyAttributes","init","parseConfiguration","processTemplateOverrides","ensureTemplates","findWidgetKey","load","autoCleanCache","getCurrentPageUrl","candidatePos","stopPos","min","getCacheKey","parts","host","pathname","expireKeys","safeExpireKeys","expires","loadFromCache","cacheKey","saveInCache","$html","$body","$modalContainer","$modalWindow","$modalSkin","$modalOuter","$modalInner","$modalClose","$modalFrame","initialized","scrollY","createElements","bindEvents","addListener","handleReposition","closeModal","handler","addClass","removeClass","getWindowHeight","openModal","setContent","modal","show","hide","Product","mode","contentTypes","browse","nag","disable_popup","proxy_url","metrics_context","metrics_channel_context","disable_inline_buy","product_error","product_main","product_modal","url_category","marketplace_status","marketplace_id","pools","external_id","sku","sold_by","external_store_id","min_price","max_price","condition","manufacturer","upc","isbn","category","min_donation_percent","max_donation_percent","donation_to","suboptimal","backfill","skip","take","expandable","template_product_main","template_product_error","template_layout","template_theme","template_cta_style","template_cta_text","template_cta_color","no_init","makeClickThroughUrl","eventData","inline","proxy","pairs","joiner","u","sense","single","info","configNames","metricBase","wgid","loadProductsFromCache","fromCache","getProducts","showProducts","count","executeSearch","backfillADX","backfillAd","numFound","articleId","placementTest","shorted","aid","pten","enabled","ptid","seed","ptseed","product_id","handleInlineBuyOption","interactTile","trigger","disablePopup","buyUrl","proxyUrl","inlineParams","expanded","nativeBuy","doPopup","passThroughParams","modifiedBuyUrl","modifiedInlineBuyUrl","ea","popup","active_frame","open","frame","frameAttributes","class","frameborder","vspace","hspace","webkitallowfullscreen","mozallowfullscreen","allowfullscreen","scrolling","candidate","frame_height","frame_width","ad_size","bf","guessAdSize","sizeInstance","sizeInstanceWidth","sizeInstanceHeight","sizes","Ad","loadAd","adxframe","pubId","slotId","adxframeContent","contentWindow","write","close","ta_w","ta_h","ta_pubid","ta_slotid","ad_error","ad_main","template_ad_main","template_ad_error","creative","dynamic","types","billboard","button_2","half_page","leaderboard","medium_rectangle","micro_bar","portrait","rectangle","super_leaderboard","wide_skyscraper","large_mobile_banner","mobile_leaderboard","small_square","button_1","full_banner","half_banner","large_rectangle","pop_under","three_to_one_rectangle","skyscraper","square","square_button","vertical_banner","vertical_rectangle","hasCreativeContent","setElementSize","insertProductWidget","insertCreativeWidget","div","existingChildren","fit","childNodes","interact","links","productWidget","_waitingOnProductLoad","interval","setInterval","clearInterval","hidden","display","productWidgetConfig","overflow","childElementCount"],"mappings":"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","file":"okanjo.min.js","sourcesContent":["\n    //noinspection JSUnusedAssignment\n    /**\n     * index.js\n     * @type {okanjo|*}\n    */\n    var okanjo = (function(ok) {\n\n\n        //noinspection JSValidateTypes,JSUnusedGlobalSymbols\n        var supportPageOffset = window.pageXOffset !== undefined,\n            isCSS1Compatible = ((document.compatMode || \"\") === \"CSS1Compat\"),\n            agent = window.navigator.userAgent,\n            noop = function(){},\n            okanjo = ok || {};\n\n        // Override version with this version\n        okanjo.version = \"%%OKANJO_VERSION\";\n\n        // Override these later\n        okanjo.qwery = noop;\n\n\n        /**\n         * Placeholder, just in case okanjo-js is built without metrics\n         */\n        okanjo.metrics = {\n            trackEvent: noop,\n            trackPageView: noop\n        };\n\n        /**\n         * API route definitions\n         */\n        okanjo.routes = {\n            products: '/products',\n            products_id: '/products/:product_id',\n            products_sense: '/products/sense',\n            metrics: '/metrics/:object_type/:event_type'\n        };\n\n\n        /**\n         * Compiles a route and parameters into a final URL\n         * @param route – The route to use (e.g. okanjo.routes.products )\n         * @param [params] - Optional route parameters\n         * @returns {*}\n         */\n        okanjo.getRoute = function(route, params) {\n            if (params) {\n                for (var i in params) {\n                    if (params.hasOwnProperty(i)) {\n                        route = route.replace(\":\"+i, params[i] + \"\");\n                    }\n                }\n            }\n            return okanjo.config.ads.apiUri + route;\n        };\n\n\n        /**\n         * Execute a JSONP request\n         * @param {string} url – Request URL\n         * @param {*} data – Request data\n         * @param {function(err:*, res:*)} callback – Closure to fire when completed\n         */\n        okanjo.exec = function(url, data, callback) {\n            data = data || {};\n            //noinspection JSUnresolvedFunction\n            okanjo.JSONP({\n                url: url,\n                data: data,\n                error: function(data) {\n                    var err = { statusCode: 500, error: \"Communication Error\", message: data.message || \"JSONP communication failure.\" };\n                    okanjo.report(\"core-jsonp\", data.error || new Error(err.message));\n                    callback(err, null);\n                },\n                success: function(data) {\n                    var err, res;\n                    if (data) {\n                        if (data.error) {\n                            err = data;\n                        } else {\n                            res = data;\n                        }\n                    } else {\n                        err = { statusCode: 500, error: \"Invalid Response\", message: \"Could not interpret the JSONP response.\"};\n                        okanjo.report('core-jsonp', new Error(err.message));\n                    }\n\n                    callback(err, res);\n                }\n            });\n        };\n\n\n        /**\n         * Report a message or error back to Okanjo\n         * @param {string} context – What module is responsible for emitting the error (e.g. Product)\n         * @param {string|Error} mixed – The message or Error to report\n         */\n        okanjo.report = function(context, mixed) {\n            // REPORT THIS BACK TO OKANJO!\n            var error;\n            if (typeof mixed === \"string\") {\n                error = new Error('[Okanjo' + (context ? ' ' + context : '') + '] ' + mixed);\n            } else if (typeof mixed === \"object\" && mixed instanceof Error) {\n                error = mixed;\n            }\n\n            console.error(error);\n            //TODO - integrate with Raven\n        };\n\n        /**\n         * Utility functions\n         */\n        var util = okanjo.util = okanjo.util || {};\n\n\n        /**\n         * Trims leading and trailing whitespace on a string\n         * @param val\n         */\n        util.trim = function(val) {\n            return (val || \"\").replace(/^\\s+|\\s+$/g, '');\n        };\n\n\n        /**\n         * Function to test whether the given var has a value\n         * @param val - The var to check\n         * @returns {boolean} - True when the var has value, false when it does not\n         */\n        util.empty = function (val) {\n            return (val === null || val === undefined || (typeof val === \"string\" && util.trim(val) === \"\"));\n        };\n\n        /**\n         * Helper to shallow clone an object so we don't ruin the top-level object reference\n         * Note: If the shallow keys are objects, the references to the keyed objects will be maintained!\n         *\n         * @param {*} obj – Source object to copy\n         * @returns {{}} – Shallow clone of the object\n         */\n        util.clone = function (obj) {\n            var clone = {};\n            obj = obj || {};\n            for (var k in obj) {\n                if (obj.hasOwnProperty(k)) {\n                    clone[k] = obj[k];\n                }\n            }\n            return clone;\n        };\n\n\n        /**\n         * Super simple hashing algorithm\n         * @see http://jsperf.com/hashing-strings\n         * @param str - String to hash\n         * @returns {string}\n         */\n        util.hash = function(str) {\n            var hash = 0;\n            if (str.length === 0) return \"\"+hash;\n            for (var i = 0; i < str.length; i++) {\n                var char = str.charCodeAt(i);\n                hash = ((hash<<5)-hash)+char;\n            }\n\n            return hash.toString(16).replace(/^-/, 'n');\n\n        };\n\n\n        /**\n         * Instead of using HTML5 dataset, just rip through attributes and return data attributes\n         * @param element\n         * @returns {{}}\n         */\n        util.data = function (element) {\n            var data = {};\n            if (element) {\n                var attrs = element.attributes;\n                for(var i = attrs.length - 1; i >= 0; i--) {\n                    if (attrs[i].name.indexOf('data-') === 0) {\n                        data[attrs[i].name.substr(5)] = attrs[i].value;\n                    }\n                }\n            }\n            return data;\n        };\n\n\n        /**\n         * Copies a value to the target if the source contains it\n         * @param {*} target – The destination object\n         * @param {*} source – The source object\n         * @param {string} targetKey – The destination key name\n         * @param {string} [sourceKey] – The source key name, if different\n         * @param {{stripEmpty:boolean}} [options] – Copy options, e.g. strip empty values\n         */\n        util.copyIfSet = function(target, source, targetKey, sourceKey, options) {\n            sourceKey = sourceKey || targetKey;\n            options = options || { };\n\n            function doCopy(sourceKey) {\n                if (source && source[sourceKey] !== undefined && (!options.stripEmpty || !util.empty(source[sourceKey]))) {\n                    target[targetKey] = source[sourceKey];\n                }\n            }\n\n            if (typeof sourceKey === \"object\" && Array.isArray(sourceKey)) {\n                // Copy the first source key that is found\n                for(var k = 0; k < sourceKey.length; k++) {\n                    doCopy(sourceKey[k]);\n                }\n\n            } else {\n                doCopy(sourceKey);\n            }\n        };\n\n\n        /**\n         * Copies a mapping of target-source from source to target\n         * @param {*} target – The destination object\n         * @param {*} source – The source object\n         * @param {*} map – The mapping of targetKey => sourceKey (null if same)\n         * @param {{stripEmpty:boolean}} [options] – Copy options, e.g. strip empty values\n         */\n        util.copyIfSetMap = function(target, source, map, options) {\n            var keys = Object.keys(map);\n            for(var k = 0; k < keys.length; k++) {\n                util.copyIfSet(target, source, keys[k], map[keys[k]], options);\n            }\n        };\n\n\n        /*! https://github.com/isaacs/inherits/blob/master/inherits_browser.js */\n        /**\n         * Extends an object from another\n         * @param ctor – Child class\n         * @param superCtor – Parent class\n         */\n        util.inherits = function inherits(ctor, superCtor) {\n            if (typeof Object.create === 'function') {\n                // implementation from standard node.js 'util' module\n                ctor.super_ = superCtor;\n                ctor.prototype = Object.create(superCtor.prototype, {\n                    constructor: {\n                        value: ctor,\n                        enumerable: false,\n                        writable: true,\n                        configurable: true\n                    }\n                });\n            } else {\n                // old school shim for old browsers\n                ctor.super_ = superCtor;\n                var TempCtor = function () {};\n                TempCtor.prototype = superCtor.prototype;\n                ctor.prototype = new TempCtor();\n                ctor.prototype.constructor = ctor;\n            }\n        };\n\n\n        /**\n         * Gets the current page's scroll position\n         * @returns {{x: Number, y: Number}}\n         */\n        util.getScrollPosition = function() {\n            return {\n                x: supportPageOffset ? window.pageXOffset : isCSS1Compatible ? document.documentElement.scrollLeft : document.body.scrollLeft,\n                y: supportPageOffset ? window.pageYOffset : isCSS1Compatible ? document.documentElement.scrollTop : document.body.scrollTop\n            };\n        };\n\n\n        /**\n         * Gets the height and width of the given element\n         * @param {HTMLElement|Node} el – The DOM element to get the size of\n         * @param {boolean} [includeMargin] – Whether to include the margins of the element in the size\n         * @returns {{height: number, width: number}}\n         */\n        util.getElementSize = function(el, includeMargin) {\n\n            var size = {\n                height: el.offsetHeight,\n                width : el.offsetWidth\n            }, style;\n\n            if (includeMargin) {\n                style = el.currentStyle || getComputedStyle(el);\n                size.height += parseInt(style.marginTop) + parseInt(style.marginBottom);\n                size.width += parseInt(style.marginLeft) + parseInt(style.marginRight);\n            }\n\n            return size;\n        };\n\n\n        /**\n         * Gets the elements rectangle coordinates on the page\n         * @param el - DOM Element\n         * @return {{x1: *, y1: *, x2: *, y2: *}}\n         */\n        util.getElementPosition = function(el) {\n\n            // Wrapped in try-catch because IE is super strict about the\n            // element being on the DOM before you call this. Other browsers\n            // let it slide, but oh well.\n            var rect, pos, errMsg = '[Okanjo Core] Could not get position of element. Did you attach the element to the DOM before initializing?';\n            try {\n                rect = el.getBoundingClientRect();\n                pos = util.getScrollPosition();\n\n                if (!document.body.contains(el)) {\n                    console.warn(errMsg);\n                }\n\n                return {\n                    x1: rect.left + pos.x,\n                    y1: rect.top + pos.y,\n                    x2: rect.right + pos.x,\n                    y2: rect.bottom + pos.y\n                };\n            } catch (e) {\n                console.warn(errMsg, e);\n                return {\n                    x1: 0,\n                    y1: 0,\n                    x2: 0,\n                    y2: 0\n                };\n            }\n\n        };\n\n\n        /**\n         * Gets the current page size\n         * @return {{w: number, h: number}}\n         */\n        util.getPageSize = function() {\n            var body = okanjo.qwery('body')[0],\n                html = document.documentElement;\n\n            return {\n                w: Math.max( body.scrollWidth, body.offsetWidth,\n                    html.clientWidth, html.scrollWidth, html.offsetWidth ),\n\n                h: Math.max( body.scrollHeight, body.offsetHeight,\n                    html.clientHeight, html.scrollHeight, html.offsetHeight )\n            };\n        };\n\n\n        /**\n         * Gets the current viewport size\n         * @return {{vw: number, vh: number}}\n         */\n        util.getViewportSize = function() {\n            var doc = document,\n                win = window,\n                el = (doc.compatMode && doc.compatMode === 'CSS1Compat') ? doc.documentElement : doc.body,\n                width = el.clientWidth,\n                height = el.clientHeight,\n                inWidth = win.innerWidth || 0,\n                inHeight = win.innerHeight || 0,\n                mobileZoom = (inWidth && width > inWidth) || (inHeight && height > inHeight);\n\n            return {\n                vw: mobileZoom ? inWidth : width,\n                vh: mobileZoom ? inHeight : height\n            };\n        };\n\n\n        /**\n         * Gets the x, y location of the event relative to the page\n         * @param e – Event\n         * @return {{ex: number, ey: number}}\n         */\n        util.getEventPosition = function(e) {\n            var ex = e.pageX,\n                ey = e.pageY,\n                doc = document,\n                body = doc.body,\n                el = doc.documentElement,\n                scrollLeft = 'scrollLeft',\n                scrollTop = 'scrollTop';\n            return {\n                ex: ex === undefined ? e.clientX + body[scrollLeft] + el[scrollLeft] : ex,\n                ey: ey === undefined ? e.clientY + body[scrollTop] + el[scrollTop] : ey\n            };\n        };\n\n\n        /**\n         * Splits the text in the element to fit within the visible height of its container, and separates with an ellipses\n         * @param {HTMLElement|Node} element – The DOM element containing the text to fit\n         * @param {HTMLElement} [container] – Optional container to compute fit on. Defaults to the element's parent\n         */\n        util.ellipsify = function(element, container) {\n\n            // It's a sad day when you have to resort to JS because CSS kludges are too hacky to work down to IE8, programmatically\n            //noinspection JSValidateTypes\n            var parent = container || element.parentNode,\n                targetHeight = util.getElementSize(parent).height,\n                useTextContent = element.textContent !== undefined,\n                text = useTextContent ? element.textContent : element.innerText,\n                replacedText = \"\",\n                safety = 5000, // Safety switch to bust out of the loop in the event something goes terribly wrong\n                replacer = function(match) {\n                    replacedText = match.substr(0, match.length-3) + replacedText;\n                    return '...';\n                };\n\n            // Trim off characters until we can fit the text and ellipses\n            // If the text already fits, this loop is ignored\n            while (util.getElementSize(element).height > targetHeight && text.length > 0 && (safety-- > 0)) {\n                text = useTextContent ? element.textContent : element.innerText;\n\n                text = text.replace(/[\\s\\S](?:\\.\\.\\.)?$/, replacer);\n\n                if (useTextContent) {\n                    element.textContent = text;\n                } else {\n                    element.innerText = text;\n                }\n            }\n\n            // If there is work to do, split the content into two span tags\n            // Like so: [content]...[hidden content]\n            if (replacedText.length > 0) {\n\n                var content = document.createElement('span'),\n                    span = document.createElement('span');\n\n                content.setAttribute('class','okanjo-ellipses');\n                span.setAttribute('class','okanjo-visually-hidden');\n\n                if (useTextContent) {\n                    content.textContent = text.substr(0, text.length-3);\n                    span.textContent = replacedText;\n                } else {\n                    content.innerText = text.substr(0, text.length-3);\n                    span.innerText = replacedText;\n                }\n\n                element.innerHTML = '';\n                element.appendChild(content);\n                element.appendChild(span);\n            }\n\n        };\n\n\n        /**\n         * Return various browser detections\n         * @returns {Array}\n         */\n        util.detectClasses = function() {\n            var classDetects = [];\n            if (navigator.appVersion.indexOf(\"MSIE 9.\") != -1) {\n                classDetects.push('lt-ie10');\n            } else if (navigator.appVersion.indexOf(\"MSIE 8.\") != -1) {\n                classDetects.push('lt-ie9');\n            } else if (navigator.appVersion.indexOf(\"MSIE 7.\") != -1) {\n                classDetects.push('lt-ie8');\n            } else if (navigator.appVersion.indexOf(\"MSIE 6.\") != -1) {\n                classDetects.push('lt-ie7');\n            }\n            return classDetects;\n        };\n\n\n        /**\n         * Checks if we're executing this code inside a frame or not\n         * @returns {boolean}\n         */\n        util.isFramed = function() {\n            return window.top !== window.self;\n        };\n\n        /**\n         * Checks if the current user agent identifies as an iOS device\n         * @returns {boolean}\n         */\n        util.isiOS = function() {\n            return /(iPhone|iPad|iPod)/i.test(agent);\n        };\n\n\n        /**\n         * Checks if the current user agent identifies as Android device\n         * @returns {boolean}\n         */\n        util.isAndroid = function() {\n            return /Android/.test(agent);\n        };\n\n\n        /**\n         * Checks if the current user agent identifies as a mobile device\n         * @returns {boolean}\n         */\n        util.isMobile = function() {\n            return util.isiOS() || util.isAndroid();\n        };\n\n\n        /**\n         * Returns an object hashmap of query and hash parameters\n         * @param {boolean} includeHashArguments - Whether to include the hash arguments, if any\n         * @return {*}\n         */\n        util.getPageArguments = function(includeHashArguments) {\n\n            var queryArgs = splitArguments(window.location.search.substring(window.location.search.indexOf('?') + 1));\n\n            if (includeHashArguments) {\n                var hashArgs = splitArguments(window.location.hash.substring(Math.max(window.location.hash.indexOf('#') + 1, window.location.hash.indexOf('#!') + 2)));\n                for (var k in hashArgs) {\n                    if (hashArgs.hasOwnProperty(k)) {\n                        queryArgs[k] = hashArgs[k];\n                    }\n                }\n            }\n\n            return queryArgs;\n        };\n\n\n        /**\n         * Deep clones a thing\n         * @param mixed Something to clone\n         * @param [out] Optional object/array receiver if clone-merge is desirable. Just make sure the type matches the source\n         * @return {*}\n         */\n        util.deepClone = function(mixed, out) {\n            var i = 0, k;\n            if (Array.isArray(mixed)) {\n                out = out || [];\n                for ( ; i < mixed.length; i++) {\n                    out.push(util.deepClone(mixed[i]));\n                }\n            } else if (typeof mixed === \"object\") {\n                out = out || {};\n                for (k in mixed) {\n                    if (mixed.hasOwnProperty(k)) {\n                        out[k] = util.deepClone(mixed[k]);\n                    }\n                }\n            } else {\n                out = mixed;\n            }\n            return out;\n        };\n\n        /**\n         * Flattens a multi-dimensional object into a single object\n         * @param obj\n         * @return {{}}\n         */\n        util.flatten = function (obj) {\n            var toReturn = {}, flatObject, x, i;\n\n            for (i in obj) {\n                if (!obj.hasOwnProperty(i)) continue;\n\n                // Convert object ids to hex strings\n                if (Array.isArray(obj[i])) {\n                    toReturn[i] = obj[i];\n                } else if ((typeof obj[i]) == 'object') {\n                    flatObject = util.flatten(obj[i]);\n                    for (x in flatObject) {\n                        if (!flatObject.hasOwnProperty(x)) continue;\n                        toReturn[i + '_' + x] = flatObject[x];\n                    }\n                } else {\n                    toReturn[i] = obj[i];\n                }\n            }\n            return toReturn;\n        };\n\n        /*! based on shortid https://github.com/dylang/shortid */\n        util.shortid = (function(clusterWorkerId) {\n\n            var shuffled = 'ylZM7VHLvOFcohp01x-fXNr8P_tqin6RkgWGm4SIDdK5s2TAJebzQEBUwuY9j3aC',\n\n                crypto = typeof require !== 'undefined' ? require('crypto') : (window.crypto || window.msCrypto),\n\n                randomByte = function() {\n                    if (crypto && crypto.randomBytes) {\n                        return crypto.randomBytes(1)[0] & 0x30;\n                    } else if (!crypto || !crypto.getRandomValues) {\n                        return Math.floor(Math.random() * 256) & 0x30;\n                    }\n\n                    var dest = new Uint8Array(1);\n                    crypto.getRandomValues(dest);\n                    return dest[0] & 0x30;\n                },\n\n                encode = function(number) {\n                    var loopCounter = 0,\n                        done,\n                        str = '';\n\n                    while (!done) {\n                        str = str + shuffled[ ( (number >> (4 * loopCounter)) & 0x0f ) | randomByte() ];\n                        done = number < (Math.pow(16, loopCounter + 1 ) );\n                        loopCounter++;\n                    }\n                    return str;\n                },\n\n            // Ignore all milliseconds before a certain time to reduce the size of the date entropy without sacrificing uniqueness.\n            // This number should be updated every year or so to keep the generated id short.\n            // To regenerate `new Date() - 0` and bump the version. Always bump the version!\n\n                REDUCE_TIME = 1458848907498,\n                version = 6,\n                counter,\n                previousSeconds;\n            clusterWorkerId = clusterWorkerId || 0;\n\n            return function() {\n                var str = '',\n                    seconds = Math.floor(((new Date()).getTime() - REDUCE_TIME) * 0.001);\n\n                if (seconds === previousSeconds) {\n                    counter++;\n                } else {\n                    counter = 0;\n                    previousSeconds = seconds;\n                }\n\n                str = str + encode(version) + encode(clusterWorkerId);\n                if (counter > 0) {\n                    str = str + encode(counter);\n                }\n                str = str + encode(seconds);\n\n                return str;\n            };\n        })();\n\n\n        function splitArguments(query) {\n            var params = {},\n                ampSplit = query.split('&'),\n                i = 0,\n                temp, key, value, eqIndex;\n            for ( ; i < ampSplit.length; i++) {\n                try {\n                    temp = ampSplit[i];\n                    eqIndex = temp.indexOf('=');\n                    if (eqIndex < 0) {\n                        key = decodeURIComponent(temp);\n                        value = null;\n                    } else {\n                        key = decodeURIComponent(temp.substring(0, eqIndex));\n                        value = decodeURIComponent(temp.substring(eqIndex + 1));\n                    }\n                    if (key) {\n                        params[key] = value;\n                    }\n                } catch(e) {\n                    //noinspection JSUnusedAssignment\n                    console.error('[Okanjo] Failed to parse URL parameter:', temp, e);\n                }\n            }\n            return params;\n        }\n\n        return okanjo;\n\n    })(okanjo || window.okanjo);\n\n\n\n","\n    var config = okanjo.config = okanjo.config || {};\n\n    // okanjo-ads api key\n    config.key = config.key || undefined;\n\n        // Marketplace config\n    config.marketplace = {\n        uri: 'https://shop.okanjo.com',\n        apiUri: 'https://api.okanjo.com',\n        routerUri: 'https://shop.okanjo.com/widgets/router/',\n        balancedMarketplacePath: '/v1/marketplaces/MP6vnNdXY7izEEVPs1gl7jSy',\n        socketIOUri: 'https://mke-rt.okanjo.com:13443'\n    };\n\n        // Ads config\n    config.ads = {\n        apiUri: 'https://ads-api.okanjo.com'\n    };\n\n    /**\n     * Override the default production configuration\n     * @param options\n     */\n    okanjo.configure = function(options) {\n\n        // Merge keys\n        Object.keys(options).every(function(root) {\n            if (config[root] && typeof config[root] === \"object\" && typeof options[root] === \"object\") {\n                Object.keys(options[root]).every(function(key) {\n                    config[root][key] = options[root][options[key]];\n                    return true;\n                });\n            } else {\n                config[root] = options[root];\n            }\n            return true;\n        });\n\n\n    };","/*! okanjo-js v0.8.2 | (c) 2013 Okanjo Partners Inc | https://okanjo.com/ */\n(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define([], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory();\n  } else {\n    root.okanjo = factory();\n  }\n}(this, function() {\n\n    //noinspection JSUnusedAssignment\n    /**\n     * index.js\n     * @type {okanjo|*}\n    */\n    var okanjo = (function(ok) {\n\n\n        //noinspection JSValidateTypes,JSUnusedGlobalSymbols\n        var supportPageOffset = window.pageXOffset !== undefined,\n            isCSS1Compatible = ((document.compatMode || \"\") === \"CSS1Compat\"),\n            agent = window.navigator.userAgent,\n            noop = function(){},\n            okanjo = ok || {};\n\n        // Override version with this version\n        okanjo.version = \"0.8.2\";\n\n        // Override these later\n        okanjo.qwery = noop;\n\n\n        /**\n         * Placeholder, just in case okanjo-js is built without metrics\n         */\n        okanjo.metrics = {\n            trackEvent: noop,\n            trackPageView: noop\n        };\n\n        /**\n         * API route definitions\n         */\n        okanjo.routes = {\n            products: '/products',\n            products_id: '/products/:product_id',\n            products_sense: '/products/sense',\n            metrics: '/metrics/:object_type/:event_type'\n        };\n\n\n        /**\n         * Compiles a route and parameters into a final URL\n         * @param route – The route to use (e.g. okanjo.routes.products )\n         * @param [params] - Optional route parameters\n         * @returns {*}\n         */\n        okanjo.getRoute = function(route, params) {\n            if (params) {\n                for (var i in params) {\n                    if (params.hasOwnProperty(i)) {\n                        route = route.replace(\":\"+i, params[i] + \"\");\n                    }\n                }\n            }\n            return okanjo.config.ads.apiUri + route;\n        };\n\n\n        /**\n         * Execute a JSONP request\n         * @param {string} url – Request URL\n         * @param {*} data – Request data\n         * @param {function(err:*, res:*)} callback – Closure to fire when completed\n         */\n        okanjo.exec = function(url, data, callback) {\n            data = data || {};\n            //noinspection JSUnresolvedFunction\n            okanjo.JSONP({\n                url: url,\n                data: data,\n                error: function(data) {\n                    var err = { statusCode: 500, error: \"Communication Error\", message: data.message || \"JSONP communication failure.\" };\n                    okanjo.report(\"core-jsonp\", data.error || new Error(err.message));\n                    callback(err, null);\n                },\n                success: function(data) {\n                    var err, res;\n                    if (data) {\n                        if (data.error) {\n                            err = data;\n                        } else {\n                            res = data;\n                        }\n                    } else {\n                        err = { statusCode: 500, error: \"Invalid Response\", message: \"Could not interpret the JSONP response.\"};\n                        okanjo.report('core-jsonp', new Error(err.message));\n                    }\n\n                    callback(err, res);\n                }\n            });\n        };\n\n\n        /**\n         * Report a message or error back to Okanjo\n         * @param {string} context – What module is responsible for emitting the error (e.g. Product)\n         * @param {string|Error} mixed – The message or Error to report\n         */\n        okanjo.report = function(context, mixed) {\n            // REPORT THIS BACK TO OKANJO!\n            var error;\n            if (typeof mixed === \"string\") {\n                error = new Error('[Okanjo' + (context ? ' ' + context : '') + '] ' + mixed);\n            } else if (typeof mixed === \"object\" && mixed instanceof Error) {\n                error = mixed;\n            }\n\n            console.error(error);\n            //TODO - integrate with Raven\n        };\n\n        /**\n         * Utility functions\n         */\n        var util = okanjo.util = okanjo.util || {};\n\n\n        /**\n         * Trims leading and trailing whitespace on a string\n         * @param val\n         */\n        util.trim = function(val) {\n            return (val || \"\").replace(/^\\s+|\\s+$/g, '');\n        };\n\n\n        /**\n         * Function to test whether the given var has a value\n         * @param val - The var to check\n         * @returns {boolean} - True when the var has value, false when it does not\n         */\n        util.empty = function (val) {\n            return (val === null || val === undefined || (typeof val === \"string\" && util.trim(val) === \"\"));\n        };\n\n        /**\n         * Helper to shallow clone an object so we don't ruin the top-level object reference\n         * Note: If the shallow keys are objects, the references to the keyed objects will be maintained!\n         *\n         * @param {*} obj – Source object to copy\n         * @returns {{}} – Shallow clone of the object\n         */\n        util.clone = function (obj) {\n            var clone = {};\n            obj = obj || {};\n            for (var k in obj) {\n                if (obj.hasOwnProperty(k)) {\n                    clone[k] = obj[k];\n                }\n            }\n            return clone;\n        };\n\n\n        /**\n         * Super simple hashing algorithm\n         * @see http://jsperf.com/hashing-strings\n         * @param str - String to hash\n         * @returns {string}\n         */\n        util.hash = function(str) {\n            var hash = 0;\n            if (str.length === 0) return \"\"+hash;\n            for (var i = 0; i < str.length; i++) {\n                var char = str.charCodeAt(i);\n                hash = ((hash<<5)-hash)+char;\n            }\n\n            return hash.toString(16).replace(/^-/, 'n');\n\n        };\n\n\n        /**\n         * Instead of using HTML5 dataset, just rip through attributes and return data attributes\n         * @param element\n         * @returns {{}}\n         */\n        util.data = function (element) {\n            var data = {};\n            if (element) {\n                var attrs = element.attributes;\n                for(var i = attrs.length - 1; i >= 0; i--) {\n                    if (attrs[i].name.indexOf('data-') === 0) {\n                        data[attrs[i].name.substr(5)] = attrs[i].value;\n                    }\n                }\n            }\n            return data;\n        };\n\n\n        /**\n         * Copies a value to the target if the source contains it\n         * @param {*} target – The destination object\n         * @param {*} source – The source object\n         * @param {string} targetKey – The destination key name\n         * @param {string} [sourceKey] – The source key name, if different\n         * @param {{stripEmpty:boolean}} [options] – Copy options, e.g. strip empty values\n         */\n        util.copyIfSet = function(target, source, targetKey, sourceKey, options) {\n            sourceKey = sourceKey || targetKey;\n            options = options || { };\n\n            function doCopy(sourceKey) {\n                if (source && source[sourceKey] !== undefined && (!options.stripEmpty || !util.empty(source[sourceKey]))) {\n                    target[targetKey] = source[sourceKey];\n                }\n            }\n\n            if (typeof sourceKey === \"object\" && Array.isArray(sourceKey)) {\n                // Copy the first source key that is found\n                for(var k = 0; k < sourceKey.length; k++) {\n                    doCopy(sourceKey[k]);\n                }\n\n            } else {\n                doCopy(sourceKey);\n            }\n        };\n\n\n        /**\n         * Copies a mapping of target-source from source to target\n         * @param {*} target – The destination object\n         * @param {*} source – The source object\n         * @param {*} map – The mapping of targetKey => sourceKey (null if same)\n         * @param {{stripEmpty:boolean}} [options] – Copy options, e.g. strip empty values\n         */\n        util.copyIfSetMap = function(target, source, map, options) {\n            var keys = Object.keys(map);\n            for(var k = 0; k < keys.length; k++) {\n                util.copyIfSet(target, source, keys[k], map[keys[k]], options);\n            }\n        };\n\n\n        /*! https://github.com/isaacs/inherits/blob/master/inherits_browser.js */\n        /**\n         * Extends an object from another\n         * @param ctor – Child class\n         * @param superCtor – Parent class\n         */\n        util.inherits = function inherits(ctor, superCtor) {\n            if (typeof Object.create === 'function') {\n                // implementation from standard node.js 'util' module\n                ctor.super_ = superCtor;\n                ctor.prototype = Object.create(superCtor.prototype, {\n                    constructor: {\n                        value: ctor,\n                        enumerable: false,\n                        writable: true,\n                        configurable: true\n                    }\n                });\n            } else {\n                // old school shim for old browsers\n                ctor.super_ = superCtor;\n                var TempCtor = function () {};\n                TempCtor.prototype = superCtor.prototype;\n                ctor.prototype = new TempCtor();\n                ctor.prototype.constructor = ctor;\n            }\n        };\n\n\n        /**\n         * Gets the current page's scroll position\n         * @returns {{x: Number, y: Number}}\n         */\n        util.getScrollPosition = function() {\n            return {\n                x: supportPageOffset ? window.pageXOffset : isCSS1Compatible ? document.documentElement.scrollLeft : document.body.scrollLeft,\n                y: supportPageOffset ? window.pageYOffset : isCSS1Compatible ? document.documentElement.scrollTop : document.body.scrollTop\n            };\n        };\n\n\n        /**\n         * Gets the height and width of the given element\n         * @param {HTMLElement|Node} el – The DOM element to get the size of\n         * @param {boolean} [includeMargin] – Whether to include the margins of the element in the size\n         * @returns {{height: number, width: number}}\n         */\n        util.getElementSize = function(el, includeMargin) {\n\n            var size = {\n                height: el.offsetHeight,\n                width : el.offsetWidth\n            }, style;\n\n            if (includeMargin) {\n                style = el.currentStyle || getComputedStyle(el);\n                size.height += parseInt(style.marginTop) + parseInt(style.marginBottom);\n                size.width += parseInt(style.marginLeft) + parseInt(style.marginRight);\n            }\n\n            return size;\n        };\n\n\n        /**\n         * Gets the elements rectangle coordinates on the page\n         * @param el - DOM Element\n         * @return {{x1: *, y1: *, x2: *, y2: *}}\n         */\n        util.getElementPosition = function(el) {\n\n            // Wrapped in try-catch because IE is super strict about the\n            // element being on the DOM before you call this. Other browsers\n            // let it slide, but oh well.\n            var rect, pos, errMsg = '[Okanjo Core] Could not get position of element. Did you attach the element to the DOM before initializing?';\n            try {\n                rect = el.getBoundingClientRect();\n                pos = util.getScrollPosition();\n\n                if (!document.body.contains(el)) {\n                    console.warn(errMsg);\n                }\n\n                return {\n                    x1: rect.left + pos.x,\n                    y1: rect.top + pos.y,\n                    x2: rect.right + pos.x,\n                    y2: rect.bottom + pos.y\n                };\n            } catch (e) {\n                console.warn(errMsg, e);\n                return {\n                    x1: 0,\n                    y1: 0,\n                    x2: 0,\n                    y2: 0\n                };\n            }\n\n        };\n\n\n        /**\n         * Gets the current page size\n         * @return {{w: number, h: number}}\n         */\n        util.getPageSize = function() {\n            var body = okanjo.qwery('body')[0],\n                html = document.documentElement;\n\n            return {\n                w: Math.max( body.scrollWidth, body.offsetWidth,\n                    html.clientWidth, html.scrollWidth, html.offsetWidth ),\n\n                h: Math.max( body.scrollHeight, body.offsetHeight,\n                    html.clientHeight, html.scrollHeight, html.offsetHeight )\n            };\n        };\n\n\n        /**\n         * Gets the current viewport size\n         * @return {{vw: number, vh: number}}\n         */\n        util.getViewportSize = function() {\n            var doc = document,\n                win = window,\n                el = (doc.compatMode && doc.compatMode === 'CSS1Compat') ? doc.documentElement : doc.body,\n                width = el.clientWidth,\n                height = el.clientHeight,\n                inWidth = win.innerWidth || 0,\n                inHeight = win.innerHeight || 0,\n                mobileZoom = (inWidth && width > inWidth) || (inHeight && height > inHeight);\n\n            return {\n                vw: mobileZoom ? inWidth : width,\n                vh: mobileZoom ? inHeight : height\n            };\n        };\n\n\n        /**\n         * Gets the x, y location of the event relative to the page\n         * @param e – Event\n         * @return {{ex: number, ey: number}}\n         */\n        util.getEventPosition = function(e) {\n            var ex = e.pageX,\n                ey = e.pageY,\n                doc = document,\n                body = doc.body,\n                el = doc.documentElement,\n                scrollLeft = 'scrollLeft',\n                scrollTop = 'scrollTop';\n            return {\n                ex: ex === undefined ? e.clientX + body[scrollLeft] + el[scrollLeft] : ex,\n                ey: ey === undefined ? e.clientY + body[scrollTop] + el[scrollTop] : ey\n            };\n        };\n\n\n        /**\n         * Splits the text in the element to fit within the visible height of its container, and separates with an ellipses\n         * @param {HTMLElement|Node} element – The DOM element containing the text to fit\n         * @param {HTMLElement} [container] – Optional container to compute fit on. Defaults to the element's parent\n         */\n        util.ellipsify = function(element, container) {\n\n            // It's a sad day when you have to resort to JS because CSS kludges are too hacky to work down to IE8, programmatically\n            //noinspection JSValidateTypes\n            var parent = container || element.parentNode,\n                targetHeight = util.getElementSize(parent).height,\n                useTextContent = element.textContent !== undefined,\n                text = useTextContent ? element.textContent : element.innerText,\n                replacedText = \"\",\n                safety = 5000, // Safety switch to bust out of the loop in the event something goes terribly wrong\n                replacer = function(match) {\n                    replacedText = match.substr(0, match.length-3) + replacedText;\n                    return '...';\n                };\n\n            // Trim off characters until we can fit the text and ellipses\n            // If the text already fits, this loop is ignored\n            while (util.getElementSize(element).height > targetHeight && text.length > 0 && (safety-- > 0)) {\n                text = useTextContent ? element.textContent : element.innerText;\n\n                text = text.replace(/[\\s\\S](?:\\.\\.\\.)?$/, replacer);\n\n                if (useTextContent) {\n                    element.textContent = text;\n                } else {\n                    element.innerText = text;\n                }\n            }\n\n            // If there is work to do, split the content into two span tags\n            // Like so: [content]...[hidden content]\n            if (replacedText.length > 0) {\n\n                var content = document.createElement('span'),\n                    span = document.createElement('span');\n\n                content.setAttribute('class','okanjo-ellipses');\n                span.setAttribute('class','okanjo-visually-hidden');\n\n                if (useTextContent) {\n                    content.textContent = text.substr(0, text.length-3);\n                    span.textContent = replacedText;\n                } else {\n                    content.innerText = text.substr(0, text.length-3);\n                    span.innerText = replacedText;\n                }\n\n                element.innerHTML = '';\n                element.appendChild(content);\n                element.appendChild(span);\n            }\n\n        };\n\n\n        /**\n         * Return various browser detections\n         * @returns {Array}\n         */\n        util.detectClasses = function() {\n            var classDetects = [];\n            if (navigator.appVersion.indexOf(\"MSIE 9.\") != -1) {\n                classDetects.push('lt-ie10');\n            } else if (navigator.appVersion.indexOf(\"MSIE 8.\") != -1) {\n                classDetects.push('lt-ie9');\n            } else if (navigator.appVersion.indexOf(\"MSIE 7.\") != -1) {\n                classDetects.push('lt-ie8');\n            } else if (navigator.appVersion.indexOf(\"MSIE 6.\") != -1) {\n                classDetects.push('lt-ie7');\n            }\n            return classDetects;\n        };\n\n\n        /**\n         * Checks if we're executing this code inside a frame or not\n         * @returns {boolean}\n         */\n        util.isFramed = function() {\n            return window.top !== window.self;\n        };\n\n        /**\n         * Checks if the current user agent identifies as an iOS device\n         * @returns {boolean}\n         */\n        util.isiOS = function() {\n            return /(iPhone|iPad|iPod)/i.test(agent);\n        };\n\n\n        /**\n         * Checks if the current user agent identifies as Android device\n         * @returns {boolean}\n         */\n        util.isAndroid = function() {\n            return /Android/.test(agent);\n        };\n\n\n        /**\n         * Checks if the current user agent identifies as a mobile device\n         * @returns {boolean}\n         */\n        util.isMobile = function() {\n            return util.isiOS() || util.isAndroid();\n        };\n\n\n        /**\n         * Returns an object hashmap of query and hash parameters\n         * @param {boolean} includeHashArguments - Whether to include the hash arguments, if any\n         * @return {*}\n         */\n        util.getPageArguments = function(includeHashArguments) {\n\n            var queryArgs = splitArguments(window.location.search.substring(window.location.search.indexOf('?') + 1));\n\n            if (includeHashArguments) {\n                var hashArgs = splitArguments(window.location.hash.substring(Math.max(window.location.hash.indexOf('#') + 1, window.location.hash.indexOf('#!') + 2)));\n                for (var k in hashArgs) {\n                    if (hashArgs.hasOwnProperty(k)) {\n                        queryArgs[k] = hashArgs[k];\n                    }\n                }\n            }\n\n            return queryArgs;\n        };\n\n\n        /**\n         * Deep clones a thing\n         * @param mixed Something to clone\n         * @param [out] Optional object/array receiver if clone-merge is desirable. Just make sure the type matches the source\n         * @return {*}\n         */\n        util.deepClone = function(mixed, out) {\n            var i = 0, k;\n            if (Array.isArray(mixed)) {\n                out = out || [];\n                for ( ; i < mixed.length; i++) {\n                    out.push(util.deepClone(mixed[i]));\n                }\n            } else if (typeof mixed === \"object\") {\n                out = out || {};\n                for (k in mixed) {\n                    if (mixed.hasOwnProperty(k)) {\n                        out[k] = util.deepClone(mixed[k]);\n                    }\n                }\n            } else {\n                out = mixed;\n            }\n            return out;\n        };\n\n        /**\n         * Flattens a multi-dimensional object into a single object\n         * @param obj\n         * @return {{}}\n         */\n        util.flatten = function (obj) {\n            var toReturn = {}, flatObject, x, i;\n\n            for (i in obj) {\n                if (!obj.hasOwnProperty(i)) continue;\n\n                // Convert object ids to hex strings\n                if (Array.isArray(obj[i])) {\n                    toReturn[i] = obj[i];\n                } else if ((typeof obj[i]) == 'object') {\n                    flatObject = util.flatten(obj[i]);\n                    for (x in flatObject) {\n                        if (!flatObject.hasOwnProperty(x)) continue;\n                        toReturn[i + '_' + x] = flatObject[x];\n                    }\n                } else {\n                    toReturn[i] = obj[i];\n                }\n            }\n            return toReturn;\n        };\n\n        /*! based on shortid https://github.com/dylang/shortid */\n        util.shortid = (function(clusterWorkerId) {\n\n            var shuffled = 'ylZM7VHLvOFcohp01x-fXNr8P_tqin6RkgWGm4SIDdK5s2TAJebzQEBUwuY9j3aC',\n\n                crypto = typeof require !== 'undefined' ? require('crypto') : (window.crypto || window.msCrypto),\n\n                randomByte = function() {\n                    if (crypto && crypto.randomBytes) {\n                        return crypto.randomBytes(1)[0] & 0x30;\n                    } else if (!crypto || !crypto.getRandomValues) {\n                        return Math.floor(Math.random() * 256) & 0x30;\n                    }\n\n                    var dest = new Uint8Array(1);\n                    crypto.getRandomValues(dest);\n                    return dest[0] & 0x30;\n                },\n\n                encode = function(number) {\n                    var loopCounter = 0,\n                        done,\n                        str = '';\n\n                    while (!done) {\n                        str = str + shuffled[ ( (number >> (4 * loopCounter)) & 0x0f ) | randomByte() ];\n                        done = number < (Math.pow(16, loopCounter + 1 ) );\n                        loopCounter++;\n                    }\n                    return str;\n                },\n\n            // Ignore all milliseconds before a certain time to reduce the size of the date entropy without sacrificing uniqueness.\n            // This number should be updated every year or so to keep the generated id short.\n            // To regenerate `new Date() - 0` and bump the version. Always bump the version!\n\n                REDUCE_TIME = 1458848907498,\n                version = 6,\n                counter,\n                previousSeconds;\n            clusterWorkerId = clusterWorkerId || 0;\n\n            return function() {\n                var str = '',\n                    seconds = Math.floor(((new Date()).getTime() - REDUCE_TIME) * 0.001);\n\n                if (seconds === previousSeconds) {\n                    counter++;\n                } else {\n                    counter = 0;\n                    previousSeconds = seconds;\n                }\n\n                str = str + encode(version) + encode(clusterWorkerId);\n                if (counter > 0) {\n                    str = str + encode(counter);\n                }\n                str = str + encode(seconds);\n\n                return str;\n            };\n        })();\n\n\n        function splitArguments(query) {\n            var params = {},\n                ampSplit = query.split('&'),\n                i = 0,\n                temp, key, value, eqIndex;\n            for ( ; i < ampSplit.length; i++) {\n                try {\n                    temp = ampSplit[i];\n                    eqIndex = temp.indexOf('=');\n                    if (eqIndex < 0) {\n                        key = decodeURIComponent(temp);\n                        value = null;\n                    } else {\n                        key = decodeURIComponent(temp.substring(0, eqIndex));\n                        value = decodeURIComponent(temp.substring(eqIndex + 1));\n                    }\n                    if (key) {\n                        params[key] = value;\n                    }\n                } catch(e) {\n                    //noinspection JSUnusedAssignment\n                    console.error('[Okanjo] Failed to parse URL parameter:', temp, e);\n                }\n            }\n            return params;\n        }\n\n        return okanjo;\n\n    })(okanjo || window.okanjo);\n\n\n\n\n\n    var config = okanjo.config = okanjo.config || {};\n\n    // okanjo-ads api key\n    config.key = config.key || undefined;\n\n        // Marketplace config\n    config.marketplace = {\n        uri: 'https://shop.okanjo.com',\n        apiUri: 'https://api.okanjo.com',\n        routerUri: 'https://shop.okanjo.com/widgets/router/',\n        balancedMarketplacePath: '/v1/marketplaces/MP6vnNdXY7izEEVPs1gl7jSy',\n        socketIOUri: 'https://mke-rt.okanjo.com:13443'\n    };\n\n        // Ads config\n    config.ads = {\n        apiUri: 'https://ads-api.okanjo.com'\n    };\n\n    /**\n     * Override the default production configuration\n     * @param options\n     */\n    okanjo.configure = function(options) {\n\n        // Merge keys\n        Object.keys(options).every(function(root) {\n            if (config[root] && typeof config[root] === \"object\" && typeof options[root] === \"object\") {\n                Object.keys(options[root]).every(function(key) {\n                    config[root][key] = options[root][options[key]];\n                    return true;\n                });\n            } else {\n                config[root] = options[root];\n            }\n            return true;\n        });\n\n\n    };\n//noinspection JSUnusedLocalSymbols,ThisExpressionReferencesGlobalObjectJS\n(function(okanjo, window) {\n\n    var TemplateEngine = okanjo.TemplateEngine = function TemplateEngine(options) {\n        options = options || { templates: {}, css: {} };\n        this._templates = options.templates || {};\n        this._css = options.css || {};\n\n        // Add special styles for ie 7, 8, 9\n        this.classDetects = okanjo.util.detectClasses();\n        this.classDetects = this.classDetects.join(' ');\n    };\n\n    TemplateEngine.prototype = {\n\n        constructor: TemplateEngine,\n\n        /**\n         * Register a template\n         * @param {string} name – Template name\n         * @param {string|HTMLElement} template - Template markup string\n         * @param {function(data:*):*} [viewClosure] – Optional data manipulation closure\n         * @param {*} [options] – Optional hash of template options, e.g. css: [ 'name1', 'name2' ]\n         */\n        registerTemplate: function(name, template, viewClosure, options) {\n            // Example template:\n            // {{title}} spends {{calc}}\n\n            if (typeof template === \"object\") {\n                //noinspection JSValidateTypes\n                if (template.nodeType === undefined) {\n                    throw new Error('Parameter template must be a string or a DOM element');\n                } else {\n                    okanjo.Mustache.parse(template);\n                }\n            } else if (typeof template !== \"string\") {\n                throw new Error('Parameter template must be a string or a DOM element');\n            }\n\n            // Shift options if only have 3 params\n            if (arguments.length === 3 && typeof viewClosure === \"object\") {\n                options = viewClosure;\n                viewClosure = undefined;\n            } else {\n                options = options || {};\n            }\n\n            if (viewClosure !== undefined && typeof viewClosure !== \"function\") {\n                throw new Error('Parameter viewClosure must be a function');\n            }\n\n            // Assign the template\n            this._templates[name] = {\n                markup: template,\n                options: options,\n                viewClosure: viewClosure || null\n            };\n        },\n\n\n        /**\n         * Registers a CSS block\n         *\n         * @param {string} name – CSS block name\n         * @param {string|HTMLElement} css – The CSS markup or existing style element\n         * @param {undefined|{id:string}|null} [options] – Optional hash of KVP settings\n         */\n        registerCss: function(name, css, options) {\n            options = options || {};\n\n            if (typeof css === \"object\") {\n                //noinspection JSValidateTypes\n                if (css.nodeType === undefined) {\n                    throw new Error('Parameter css must be a string or a DOM element');\n                }\n            } else if (typeof css !== \"string\") {\n                throw new Error('Parameter css must be a string or a DOM element');\n            }\n\n            this._css[name] = {\n                markup: css,\n                options: options\n            };\n        },\n\n\n        /**\n         * Checks if a template was registered\n         * @param {string} name – The template name to look for\n         * @returns {boolean} – True if registered, False if not\n         */\n        isTemplateRegistered: function(name) {\n            return this._templates[name] ? true : false;\n        },\n\n\n        /**\n         * Checks if a CSS block was registered\n         * @param {string} name – The CSS block name to look for\n         * @returns {boolean} – True if registered, False if not\n         */\n        isCssRegistered: function(name) {\n            return this._css[name] ? true : false;\n        },\n\n\n        /**\n         * Ensures that the given CSS block name has been added to the page\n         * @param {string|HTMLElement} name - The CSS name that was registered through registerCss\n         */\n        ensureCss: function(name) {\n\n            if (this._css[name]) {\n                //noinspection JSValidateTypes\n                var css = this._css[name],\n                    id = css.markup.nodeType === undefined ? css.options.id || \"okanjo-css-\" + name : null; // If it's a DOM element, just forget it cuz it's already on the page\n\n                // Check for css element on page, if we have an ID to look for\n                if (id) {\n                    var elements = okanjo.qwery('#' + id);\n                    if (elements.length === 0) {\n                        var head = okanjo.qwery('head'),\n                            style = document.createElement('style');\n\n                        style.id = id;\n                        style.setAttribute('type', 'text/css');\n\n                        if (style.hasOwnProperty) { // old ie\n                            style.innerHTML = css.markup;\n                        } else {\n                            style.styleSheet.cssText = css.markup;\n                        }\n\n                        if (head.length > 0) {\n                            head[0].appendChild(style);\n                        } else {\n                            // NO HEAD, just prepend to body then\n                            var body = okanjo.qwery('body');\n                            if (body.length > 0) {\n                                body[0].appendChild(style);\n                            } // And if this doesn't work, just give up\n                        }\n                    }\n                }\n            } else {\n                console.warn('[Okanjo.Template] Attempted to add CSS template \"'+name+'\" to the DOM, however it does not appear to be registered?');\n            }\n\n        },\n\n\n        /**\n         * Renders a template with the given data\n         *\n         * @param {string} templateName – The template name to render\n         * @param {*} context – The context to execute the template under\n         * @param {*} data – Data to pass into the controller\n         * @param {*} [options] – Optional settings object to pass into the controller closure\n         * @returns {*}\n         */\n        render: function(templateName, context, data, options) {\n\n            options = options || {};\n            var template = this._templates[templateName],\n                view = data;\n\n            // If there's a data controller closure set, and if so, run the data through there\n            if (template.viewClosure) {\n                view = template.viewClosure.call(context, data, options);\n            }\n\n            // Attach globals\n            view.okanjoConfig = okanjo.config;\n            view.okanjoMetricUrl = okanjo.config.ads.apiUri.replace(/^https?:\\/\\//,''); // Url w/o scheme to prevent mixed-content warnings\n            view.now = function() { return (new Date()).getTime(); };\n            view.classDetects = this.classDetects;\n\n            //noinspection JSUnresolvedVariable\n            if (options.blockClasses && Array.isArray(options.blockClasses)) {\n                view.classDetects = view.classDetects += \" \" + options.blockClasses.join(' ');\n            }\n\n            // Add CSS unless we are told not to\n            if (options.css !== false) {\n                if (template.options.css && template.options.css.length > 0) {\n                    for(var i = 0; i < template.options.css.length; i++) {\n                        this.ensureCss(template.options.css[i]);\n                    }\n                }\n            }\n\n            // Render the template and return the result\n            return okanjo.Mustache.render(template.markup, view);\n        },\n\n        formats: {\n\n            /**\n             * Formats a number into a currency string (rounded, decimal points, thousands separators)\n             * See: http://stackoverflow.com/questions/149055/how-can-i-format-numbers-as-money-in-javascript\n             *\n             * @param value – the number to format\n             * @param [decimals] - The number of decimals to show\n             * @param [decimalSeparator] – The decimals separator, default: .\n             * @param [thousandsSeparator] – The thousands separator, default: ,\n             * @returns {string} – Formatted currency string\n             */\n            currency: function(value, decimals, decimalSeparator, thousandsSeparator){\n                decimals = isNaN(decimals = Math.abs(decimals)) ? 2 : decimals;\n                decimalSeparator = decimalSeparator === undefined ? \".\" : decimalSeparator;\n                thousandsSeparator = thousandsSeparator === undefined ? \",\" : thousandsSeparator;\n                var s = value < 0 ? \"-\" : \"\",\n                    i = parseInt(value = Math.abs(+value || 0).toFixed(decimals)) + \"\",\n                    j = i.length;\n                j = (j) > 3 ? j % 3 : 0;\n                return s + (j ? i.substr(0, j) + thousandsSeparator : \"\") + i.substr(j).replace(/(\\d{3})(?=\\d)/g, \"$1\" + thousandsSeparator) + (decimals ? decimalSeparator + Math.abs(value - i).toFixed(decimals).slice(2) : \"\");\n            },\n\n\n            /**\n             * Formats a product or an array of product objects for the view\n             * @param {*} mixed – Product or an array of product objects\n             * @returns {*} – Formatted product array or object\n             */\n            product: function(mixed) {\n                // If we got an array of products, handle each one\n                if (typeof mixed === \"object\" && Array.isArray(mixed)) {\n                    var products = [];\n                    for(var i = 0; i < mixed.length; i++) {\n                        products.push(this.product(mixed[i]));\n                    }\n                    return products;\n                } else if(typeof mixed === \"object\" ) { // Individual product\n                    // Set first image as the display image\n\n                    //noinspection JSUnresolvedVariable\n                    mixed.image_url = mixed.image_urls ? mixed.image_urls[0] : '' ;\n                    //noinspection JSUnresolvedVariable\n                    mixed.escaped_buy_url = encodeURIComponent(mixed.buy_url);\n                    mixed.escaped_inline_buy_url = okanjo.util.empty(mixed.inline_buy_url) ? '' : encodeURIComponent(mixed.inline_buy_url);\n                    mixed.price_formatted = this.currency(mixed.price);\n                    return mixed;\n                } else { // Unknown value\n                    return null;\n                }\n            }\n\n        }\n    };\n\n    // global template engine for all the widgets\n    okanjo.mvc = new TemplateEngine();\n\n\n})(okanjo, this);\n\n/*\n\n Adaptation based on https://github.com/larryosborn/JSONP\n\n The MIT License (MIT)\n\n Copyright (c) 2014 Larry Osborn <larry.osborn@gmail.com>\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n\n */\n(function() {\n    if(this.JSONP) { return; }\n    var JSONP, computedUrl, encode, noop, objectToURI, makeUniqueCallback, head;\n\n    encode = window.encodeURIComponent;\n\n    noop = function() {\n        return void 0;\n    };\n\n    computedUrl = function(params) {\n        var url;\n        url = params.url;\n        url += params.url.indexOf('?') < 0 ? '?' : '&';\n        url += objectToURI(params.data);\n        return url;\n    };\n\n    makeUniqueCallback = function() {\n        JSONP.requestCounter += 1;\n        return (new Date()).getTime() + \"_\" + JSONP.requestCounter;\n    };\n\n    objectToURI = function(obj) {\n        var data, key, value;\n        data = [];\n        for (key in obj) {\n            if (obj.hasOwnProperty(key)) {\n                value = obj[key];\n                if (Array.isArray(value)) {\n                    var i = 0;\n                    for( ; i < value.length; i++ ) {\n                        data.push(encode(key) + '[]=' + encode(value[i]));\n                    }\n                } else if (typeof value === \"object\") {\n                    // SINGLE DEPTH OBJECTS - no recursion\n                    for (var k in value) {\n                        if (value.hasOwnProperty(k)) {\n                            data.push(encode(key) + '['+encode(k)+']=' + encode(value[k]));\n                        }\n                    }\n                } else {\n                    data.push(encode(key) + '=' + encode(value));\n                }\n            }\n        }\n        return data.join('&');\n    };\n\n    JSONP = function(options) {\n        options = options ? options : {};\n        var callback, done, params, script, timeoutHandle, removeCallback;\n        params = {\n            data: options.data || {},\n            error: options.error || noop,\n            success: options.success || noop,\n            beforeSend: options.beforeSend || noop,\n            complete: options.complete || noop,\n            url: options.url || '',\n            timeout: options.timeout || 30000\n        };\n        params.computedUrl = computedUrl(params);\n        if (params.url.length === 0) {\n            throw new Error('MissingUrl');\n        }\n        done = false;\n        if (params.beforeSend({}, params) !== false) {\n            //noinspection JSUnresolvedVariable\n            callback = params.data[options.callbackName || 'callback'] = '_okanjo_jsonp_' + makeUniqueCallback();\n            window[callback] = function(data) {\n\n                if (timeoutHandle) { clearTimeout(timeoutHandle); }\n                timeoutHandle = null;\n\n                params.success(data, params);\n                params.complete(data, params);\n                removeCallback();\n            };\n\n            removeCallback = function() {\n                try {\n                    return delete window[callback];\n                } catch (_error) {\n                    window[callback] = void 0;\n                    return void 0;\n                }\n            };\n\n            script = window.document.createElement('script');\n            script.src = computedUrl(params);\n            script.async = true;\n\n            timeoutHandle = setTimeout(function() {\n                timeoutHandle = null;\n                var err = new Error(\"JSONP request did not respond in time!\");\n                err.url = (script && script.src) || null;\n                params.error(err);\n                removeCallback();\n                return params.complete(err, params);\n            }, params.timeout);\n\n            script.onerror = function(evt) {\n                if (timeoutHandle) { clearTimeout(timeoutHandle); }\n                params.error({\n                    url: script.src,\n                    event: evt\n                });\n                return params.complete({\n                    url: script.src,\n                    event: evt\n                }, params);\n            };\n\n            script.onload = script.onreadystatechange = function() {\n                if (!done && (!this.readyState || this.readyState === 'loaded' || this.readyState === 'complete')) {\n                    done = true;\n                    script.onload = script.onreadystatechange = null;\n                    if (script && script.parentNode) {\n                        script.parentNode.removeChild(script);\n                    }\n                    //jshint -W093\n                    return script = null;\n                    //jshint +W093\n                }\n            };\n\n            head = head || window.document.getElementsByTagName('head')[0] || window.document.documentElement;\n            return head.insertBefore(script, head.firstChild);\n        }\n    };\n\n    JSONP.requestCounter = 0;\n    JSONP.makeUrl = computedUrl;\n    JSONP.objectToURI = objectToURI;\n\n    if ((typeof define !== \"undefined\" && define !== null) && define.amd) {\n        define(function() {\n            return JSONP;\n        });\n    } else if ((typeof module !== \"undefined\" && module !== null) && module.exports) {\n        module.exports = JSONP;\n    } else {\n        this.JSONP = JSONP;\n    }\n\n}).call(okanjo);\n\n// From https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys\nif (!Object.keys) {\n    Object.keys = (function() {\n        'use strict';\n        var hasOwnProperty = Object.prototype.hasOwnProperty,\n            hasDontEnumBug = !({ toString: null }).propertyIsEnumerable('toString'),\n            dontEnums = [\n                'toString',\n                'toLocaleString',\n                'valueOf',\n                'hasOwnProperty',\n                'isPrototypeOf',\n                'propertyIsEnumerable',\n                'constructor'\n            ],\n            dontEnumsLength = dontEnums.length;\n\n        return function(obj) {\n            if (typeof obj !== 'object' && (typeof obj !== 'function' || obj === null)) {\n                throw new TypeError('Object.keys called on non-object');\n            }\n\n            var result = [], prop, i;\n\n            for (prop in obj) {\n                if (hasOwnProperty.call(obj, prop)) {\n                    result.push(prop);\n                }\n            }\n\n            if (hasDontEnumBug) {\n                for (i = 0; i < dontEnumsLength; i++) {\n                    if (hasOwnProperty.call(obj, dontEnums[i])) {\n                        result.push(dontEnums[i]);\n                    }\n                }\n            }\n            return result;\n        };\n    }());\n}\n\n//// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create\n//if (typeof Object.create != 'function') {\n//    Object.create = (function() {\n//        var Temp = function() {};\n//        return function (prototype) {\n//            if (arguments.length > 1) {\n//                throw new Error('Second argument not supported');\n//            }\n//            if (typeof prototype != 'object') {\n//                throw new TypeError('Argument must be an object');\n//            }\n//            Temp.prototype = prototype;\n//            var result = new Temp();\n//            Temp.prototype = null;\n//            return result;\n//        };\n//    })();\n//}\n\n// From: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray\nif (!Array.isArray) {\n    Array.isArray = function(arg) {\n        return Object.prototype.toString.call(arg) === '[object Array]';\n    };\n}\n\n// Production steps of ECMA-262, Edition 5, 15.4.4.14\n// From: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf\n// Reference: http://es5.github.io/#x15.4.4.14\nif (!Array.prototype.indexOf) {\n    Array.prototype.indexOf = function(searchElement, fromIndex) {\n\n        var k;\n\n        /* jshint ignore:start */\n        // 1. Let O be the result of calling ToObject passing\n        //    the this value as the argument.\n        if (this == null) { //\n            throw new TypeError('\"this\" is null or not defined');\n        }\n        /* jshint ignore:end */\n\n        var O = Object(this);\n\n        // 2. Let lenValue be the result of calling the Get\n        //    internal method of O with the argument \"length\".\n        // 3. Let len be ToUint32(lenValue).\n        var len = O.length >>> 0;\n\n        // 4. If len is 0, return -1.\n        if (len === 0) {\n            return -1;\n        }\n\n        // 5. If argument fromIndex was passed let n be\n        //    ToInteger(fromIndex); else let n be 0.\n        var n = +fromIndex || 0;\n\n        if (Math.abs(n) === Infinity) {\n            n = 0;\n        }\n\n        // 6. If n >= len, return -1.\n        if (n >= len) {\n            return -1;\n        }\n\n        // 7. If n >= 0, then Let k be n.\n        // 8. Else, n<0, Let k be len - abs(n).\n        //    If k is less than 0, then let k be 0.\n        k = Math.max(n >= 0 ? n : len - Math.abs(n), 0);\n\n        // 9. Repeat, while k < len\n        while (k < len) {\n            // a. Let Pk be ToString(k).\n            //   This is implicit for LHS operands of the in operator\n            // b. Let kPresent be the result of calling the\n            //    HasProperty internal method of O with argument Pk.\n            //   This step can be combined with c\n            // c. If kPresent is true, then\n            //    i.  Let elementK be the result of calling the Get\n            //        internal method of O with the argument ToString(k).\n            //   ii.  Let same be the result of applying the\n            //        Strict Equality Comparison Algorithm to\n            //        searchElement and elementK.\n            //  iii.  If same is true, return k.\n            if (k in O && O[k] === searchElement) {\n                return k;\n            }\n            k++;\n        }\n        return -1;\n    };\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/every\nif (!Array.prototype.every) {\n    Array.prototype.every = function(callbackfn, thisArg) {\n        'use strict';\n        var T, k;\n\n        // jshint -W041\n        if (this == null) {\n            throw new TypeError('this is null or not defined');\n        }\n        // jshint +W041\n\n        // 1. Let O be the result of calling ToObject passing the this\n        //    value as the argument.\n        var O = Object(this);\n\n        // 2. Let lenValue be the result of calling the Get internal method\n        //    of O with the argument \"length\".\n        // 3. Let len be ToUint32(lenValue).\n        var len = O.length >>> 0;\n\n        // 4. If IsCallable(callbackfn) is false, throw a TypeError exception.\n        if (typeof callbackfn !== 'function') {\n            throw new TypeError();\n        }\n\n        // 5. If thisArg was supplied, let T be thisArg; else let T be undefined.\n        if (arguments.length > 1) {\n            T = thisArg;\n        }\n\n        // 6. Let k be 0.\n        k = 0;\n\n        // 7. Repeat, while k < len\n        while (k < len) {\n\n            var kValue;\n\n            // a. Let Pk be ToString(k).\n            //   This is implicit for LHS operands of the in operator\n            // b. Let kPresent be the result of calling the HasProperty internal\n            //    method of O with argument Pk.\n            //   This step can be combined with c\n            // c. If kPresent is true, then\n            if (k in O) {\n\n                // i. Let kValue be the result of calling the Get internal method\n                //    of O with argument Pk.\n                kValue = O[k];\n\n                // ii. Let testResult be the result of calling the Call internal method\n                //     of callbackfn with T as the this value and argument list\n                //     containing kValue, k, and O.\n                var testResult = callbackfn.call(T, kValue, k, O);\n\n                // iii. If ToBoolean(testResult) is false, return false.\n                if (!testResult) {\n                    return false;\n                }\n            }\n            k++;\n        }\n        return true;\n    };\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter\nif (!Array.prototype.filter) {\n    Array.prototype.filter = function(fun/*, thisArg*/) {\n        'use strict';\n\n        if (this === void 0 || this === null) {\n            throw new TypeError();\n        }\n\n        var t = Object(this),\n            len = t.length >>> 0;\n\n        if (typeof fun !== 'function') {\n            throw new TypeError();\n        }\n\n        var res = [],\n            thisArg = arguments.length >= 2 ? arguments[1] : void 0;\n        for (var i = 0; i < len; i++) {\n            if (i in t) {\n                var val = t[i];\n\n                // NOTE: Technically this should Object.defineProperty at\n                //       the next index, as push can be affected by\n                //       properties on Object.prototype and Array.prototype.\n                //       But that method's new, and collisions should be\n                //       rare, so use the more-compatible alternative.\n                if (fun.call(thisArg, val, i, t)) {\n                    res.push(val);\n                }\n            }\n        }\n\n        return res;\n    };\n}\n\n// Doesn't work in IE7 so it's only here for reference\n//https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener\n(function() {\n    if (!Event.prototype.preventDefault) {\n        Event.prototype.preventDefault=function() {\n            //noinspection JSUnusedGlobalSymbols\n            this.returnValue=false;\n        };\n    }\n    if (!Event.prototype.stopPropagation) {\n        Event.prototype.stopPropagation=function() {\n            //noinspection JSUnusedGlobalSymbols\n            this.cancelBubble=true;\n        };\n    }\n    if (!Element.prototype.addEventListener) {\n        var eventListeners=[];\n\n        var addEventListener=function(type,listener /*, useCapture (will be ignored) */) {\n            var self=this;\n            var wrapper=function(e) {\n                e.target=e.srcElement;\n                e.currentTarget=self;\n                if (listener.handleEvent) {\n                    listener.handleEvent(e);\n                } else {\n                    listener.call(self,e);\n                }\n            };\n            if (type==\"DOMContentLoaded\") {\n                var wrapper2=function(e) {\n                    if (document.readyState==\"complete\") {\n                        wrapper(e);\n                    }\n                };\n                document.attachEvent(\"onreadystatechange\",wrapper2);\n                eventListeners.push({object:this,type:type,listener:listener,wrapper:wrapper2});\n\n                if (document.readyState==\"complete\") {\n                    //noinspection JSClosureCompilerSyntax\n                    var e=new Event();\n                    e.srcElement=window;\n                    wrapper2(e);\n                }\n            } else {\n                this.attachEvent(\"on\"+type,wrapper);\n                eventListeners.push({object:this,type:type,listener:listener,wrapper:wrapper});\n            }\n        };\n        var removeEventListener=function(type,listener /*, useCapture (will be ignored) */) {\n            var counter=0;\n            while (counter<eventListeners.length) {\n                var eventListener=eventListeners[counter];\n                if (eventListener.object==this && eventListener.type==type && eventListener.listener==listener) {\n                    if (type==\"DOMContentLoaded\") {\n                        this.detachEvent(\"onreadystatechange\",eventListener.wrapper);\n                    } else {\n                        this.detachEvent(\"on\"+type,eventListener.wrapper);\n                    }\n                    eventListeners.splice(counter, 1);\n                    break;\n                }\n                ++counter;\n            }\n        };\n        Element.prototype.addEventListener=addEventListener;\n        Element.prototype.removeEventListener=removeEventListener;\n        if (HTMLDocument) {\n            HTMLDocument.prototype.addEventListener=addEventListener;\n            HTMLDocument.prototype.removeEventListener=removeEventListener;\n        }\n        if (Window) {\n            //noinspection JSUnresolvedVariable\n            Window.prototype.addEventListener=addEventListener;\n            //noinspection JSUnresolvedVariable\n            Window.prototype.removeEventListener=removeEventListener;\n        }\n    }\n})();\n\n    // Make it safe to do console.log() always.\n    /*! Console-polyfill. | MIT license. | https://github.com/paulmillr/console-polyfill */\n    //noinspection ThisExpressionReferencesGlobalObjectJS\n    (function (win) {\n        'use strict';\n        var con = win.console || {},\n            prop, method,\n            empty = {},\n            dummy = function() {},\n            properties = 'memory'.split(','),\n            methods = ('assert,count,debug,dir,dirxml,error,exception,group,' +\n            'groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,' +\n            'time,timeEnd,trace,warn').split(',');\n        win.console = con;\n        // jshint -W084\n        while (prop = properties.pop()) {\n            if (con[prop] === undefined) {\n                con[prop] = con[prop] || empty;\n            }\n        }\n        while (method = methods.pop()) {\n            if(con[method] === undefined) {\n                con[method] = con[method] || dummy;\n            }\n        }\n        // jshint +W084\n    })(this || {});\n\n    /*! Okanjo Local Storage Polyfill v1.0.0 | (c) 2013 Okanjo Partners Inc | Based on https://gist.github.com/juliocesar/926500/ddb28fb72903be87cb9044a945c6edbe1aa28b3a */\n    //noinspection ThisExpressionReferencesGlobalObjectJS\n    (function(c, window) {\n        var OkanjoCache = null;\n        if ('localStorage' in window && window.localStorage !== null && isLocalStorageNameSupported()) {\n            OkanjoCache = window.localStorage;\n        } else {\n            OkanjoCache = {\n                _data       : {}, // jshint -W093\n                length      : 0,\n                _updateLen  : function() { this.length = this._data.length; },\n\n                setItem     : function(id, val) { var res = this._data[id] = String(val); this._updateLen(); return res; },\n                getItem     : function(id) { return this._data.hasOwnProperty(id) ? this._data[id] : undefined; },\n                removeItem  : function(id) { var res = delete this._data[id]; this._updateLen(); return res; },\n                clear       : function() { return this._data = {}; },\n                key         : function(index) { return Object.keys(this._data)[index]; } // jshint +W093\n            };\n        }\n        c.Cache = OkanjoCache;\n        return OkanjoCache;\n\n        // Make sure LocalStorage is usable.\n        // Thanks stackoverflow! http://stackoverflow.com/a/17604754/1373782\n        function isLocalStorageNameSupported() {\n            var testKey = 'test', storage = window.sessionStorage;\n            try {\n                storage.setItem(testKey, '1');\n                storage.removeItem(testKey);\n                return true;\n            } catch (error) {\n                return false;\n            }\n        }\n    })(okanjo || this, this);\n\n    /*! Okanjo Cookie Helper v1.0.0 | (c) 2013 Okanjo Partners Inc */\n    //noinspection ThisExpressionReferencesGlobalObjectJS\n    (function(c, w) {\n\n        var document = w.document || { cookie: '' };\n\n        c.Cookie = {\n            set: function(cookieName, value, expireDays) {\n                var expireDate = new Date();\n                expireDate.setDate(expireDate.getDate() + expireDays);\n                var cookieValue = encodeURI(value) + ((!expireDays) ? \"\" : \"; Expires=\" + expireDate.toUTCString() + \"; Path=/\");\n                document.cookie = cookieName + \"=\" + cookieValue;\n            },\n            get: function(cookieName) {\n                var idx, nameTest, value, cookieArray = document.cookie.split(\";\");\n                for (idx = 0; idx < cookieArray.length; idx++) {\n                    nameTest = cookieArray[idx].substr(0, cookieArray[idx].indexOf(\"=\"));\n                    value = cookieArray[idx].substr(cookieArray[idx].indexOf(\"=\") + 1);\n                    nameTest = nameTest.replace(/^\\s+|\\s+$/g, \"\");\n                    if (nameTest == cookieName) {\n                        return decodeURI(value);\n                    }\n                }\n                return null;\n            }\n        };\n\n        return c.Cookie;\n\n    })(okanjo || this, this);\n/* jshint ignore:start */\n\n/*\n json2.js\n 2013-05-26\n\n Public Domain.\n\n NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n\n See http://www.JSON.org/js.html\n\n\n This code should be minified before deployment.\n See http://javascript.crockford.com/jsmin.html\n\n USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO\n NOT CONTROL.\n\n\n This file creates a global JSON object containing two methods: stringify\n and parse.\n\n JSON.stringify(value, replacer, space)\n value       any JavaScript value, usually an object or array.\n\n replacer    an optional parameter that determines how object\n values are stringified for objects. It can be a\n function or an array of strings.\n\n space       an optional parameter that specifies the indentation\n of nested structures. If it is omitted, the text will\n be packed without extra whitespace. If it is a number,\n it will specify the number of spaces to indent at each\n level. If it is a string (such as '\\t' or '&nbsp;'),\n it contains the characters used to indent at each level.\n\n This method produces a JSON text from a JavaScript value.\n\n When an object value is found, if the object contains a toJSON\n method, its toJSON method will be called and the result will be\n stringified. A toJSON method does not serialize: it returns the\n value represented by the name/value pair that should be serialized,\n or undefined if nothing should be serialized. The toJSON method\n will be passed the key associated with the value, and this will be\n bound to the value\n\n*/\nif (typeof JSON !== 'object') {\n    JSON = {};\n\n    (function () {\n        'use strict';\n\n        function f(n) {\n            // Format integers to have at least two digits.\n            return n < 10 ? '0' + n : n;\n        }\n\n        if (typeof Date.prototype.toJSON !== 'function') {\n\n            Date.prototype.toJSON = function () {\n\n                return isFinite(this.valueOf())\n                    ? this.getUTCFullYear() + '-' +\n                f(this.getUTCMonth() + 1) + '-' +\n                f(this.getUTCDate()) + 'T' +\n                f(this.getUTCHours()) + ':' +\n                f(this.getUTCMinutes()) + ':' +\n                f(this.getUTCSeconds()) + 'Z'\n                    : null;\n            };\n\n            String.prototype.toJSON =\n                Number.prototype.toJSON =\n                    Boolean.prototype.toJSON = function () {\n                        return this.valueOf();\n                    };\n        }\n\n        var cx = /[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,\n            escapable = /[\\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,\n            gap,\n            indent,\n            meta = {    // table of character substitutions\n                '\\b': '\\\\b',\n                '\\t': '\\\\t',\n                '\\n': '\\\\n',\n                '\\f': '\\\\f',\n                '\\r': '\\\\r',\n                '\"': '\\\\\"',\n                '\\\\': '\\\\\\\\'\n            },\n            rep;\n\n\n        function quote(string) {\n\n// If the string contains no control characters, no quote characters, and no\n// backslash characters, then we can safely slap some quotes around it.\n// Otherwise we must also replace the offending characters with safe escape\n// sequences.\n\n            escapable.lastIndex = 0;\n            return escapable.test(string) ? '\"' + string.replace(escapable, function (a) {\n                var c = meta[a];\n                return typeof c === 'string'\n                    ? c\n                    : '\\\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n            }) + '\"' : '\"' + string + '\"';\n        }\n\n\n        function str(key, holder) {\n\n// Produce a string from holder[key].\n\n            var i,          // The loop counter.\n                k,          // The member key.\n                v,          // The member value.\n                length,\n                mind = gap,\n                partial,\n                value = holder[key];\n\n// If the value has a toJSON method, call it to obtain a replacement value.\n\n            if (value && typeof value === 'object' &&\n                typeof value.toJSON === 'function') {\n                value = value.toJSON(key);\n            }\n\n// If we were called with a replacer function, then call the replacer to\n// obtain a replacement value.\n\n            if (typeof rep === 'function') {\n                value = rep.call(holder, key, value);\n            }\n\n// What happens next depends on the value's type.\n\n            switch (typeof value) {\n                case 'string':\n                    return quote(value);\n\n                case 'number':\n\n// JSON numbers must be finite. Encode non-finite numbers as null.\n\n                    return isFinite(value) ? String(value) : 'null';\n\n                case 'boolean':\n                case 'null':\n\n// If the value is a boolean or null, convert it to a string. Note:\n// typeof null does not produce 'null'. The case is included here in\n// the remote chance that this gets fixed someday.\n\n                    return String(value);\n\n// If the type is 'object', we might be dealing with an object or an array or\n// null.\n\n                case 'object':\n\n// Due to a specification blunder in ECMAScript, typeof null is 'object',\n// so watch out for that case.\n\n                    if (!value) {\n                        return 'null';\n                    }\n\n// Make an array to hold the partial results of stringifying this object value.\n\n                    gap += indent;\n                    partial = [];\n\n// Is the value an array?\n\n                    if (Object.prototype.toString.apply(value) === '[object Array]') {\n\n// The value is an array. Stringify every element. Use null as a placeholder\n// for non-JSON values.\n\n                        length = value.length;\n                        for (i = 0; i < length; i += 1) {\n                            partial[i] = str(i, value) || 'null';\n                        }\n\n// Join all of the elements together, separated with commas, and wrap them in\n// brackets.\n\n                        v = partial.length === 0\n                            ? '[]'\n                            : gap\n                            ? '[\\n' + gap + partial.join(',\\n' + gap) + '\\n' + mind + ']'\n                            : '[' + partial.join(',') + ']';\n                        gap = mind;\n                        return v;\n                    }\n\n// If the replacer is an array, use it to select the members to be stringified.\n\n                    if (rep && typeof rep === 'object') {\n                        length = rep.length;\n                        for (i = 0; i < length; i += 1) {\n                            if (typeof rep[i] === 'string') {\n                                k = rep[i];\n                                v = str(k, value);\n                                if (v) {\n                                    partial.push(quote(k) + (gap ? ': ' : ':') + v);\n                                }\n                            }\n                        }\n                    } else {\n\n// Otherwise, iterate through all of the keys in the object.\n\n                        for (k in value) {\n                            if (Object.prototype.hasOwnProperty.call(value, k)) {\n                                v = str(k, value);\n                                if (v) {\n                                    partial.push(quote(k) + (gap ? ': ' : ':') + v);\n                                }\n                            }\n                        }\n                    }\n\n// Join all of the member texts together, separated with commas,\n// and wrap them in braces.\n\n                    v = partial.length === 0\n                        ? '{}'\n                        : gap\n                        ? '{\\n' + gap + partial.join(',\\n' + gap) + '\\n' + mind + '}'\n                        : '{' + partial.join(',') + '}';\n                    gap = mind;\n                    return v;\n            }\n        }\n\n// If the JSON object does not yet have a stringify method, give it one.\n\n        if (typeof JSON.stringify !== 'function') {\n            JSON.stringify = function (value, replacer, space) {\n\n// The stringify method takes a value and an optional replacer, and an optional\n// space parameter, and returns a JSON text. The replacer can be a function\n// that can replace values, or an array of strings that will select the keys.\n// A default replacer method can be provided. Use of the space parameter can\n// produce text that is more easily readable.\n\n                var i;\n                gap = '';\n                indent = '';\n\n// If the space parameter is a number, make an indent string containing that\n// many spaces.\n\n                if (typeof space === 'number') {\n                    for (i = 0; i < space; i += 1) {\n                        indent += ' ';\n                    }\n\n// If the space parameter is a string, it will be used as the indent string.\n\n                } else if (typeof space === 'string') {\n                    indent = space;\n                }\n\n// If there is a replacer, it must be a function or an array.\n// Otherwise, throw an error.\n\n                rep = replacer;\n                if (replacer && typeof replacer !== 'function' &&\n                    (typeof replacer !== 'object' ||\n                    typeof replacer.length !== 'number')) {\n                    throw new Error('JSON.stringify');\n                }\n\n// Make a fake root object containing our value under the key of ''.\n// Return the result of stringifying the value.\n\n                return str('', {'': value});\n            };\n        }\n\n\n// If the JSON object does not yet have a parse method, give it one.\n\n        if (typeof JSON.parse !== 'function') {\n            JSON.parse = function (text, reviver) {\n\n// The parse method takes a text and an optional reviver function, and returns\n// a JavaScript value if the text is a valid JSON text.\n\n                var j;\n\n                function walk(holder, key) {\n\n// The walk method is used to recursively walk the resulting structure so\n// that modifications can be made.\n\n                    var k, v, value = holder[key];\n                    if (value && typeof value === 'object') {\n                        for (k in value) {\n                            if (Object.prototype.hasOwnProperty.call(value, k)) {\n                                v = walk(value, k);\n                                if (v !== undefined) {\n                                    value[k] = v;\n                                } else {\n                                    delete value[k];\n                                }\n                            }\n                        }\n                    }\n                    return reviver.call(holder, key, value);\n                }\n\n\n// Parsing happens in four stages. In the first stage, we replace certain\n// Unicode characters with escape sequences. JavaScript handles many characters\n// incorrectly, either silently deleting them, or treating them as line endings.\n\n                text = String(text);\n                cx.lastIndex = 0;\n                if (cx.test(text)) {\n                    text = text.replace(cx, function (a) {\n                        return '\\\\u' +\n                            ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n                    });\n                }\n\n// In the second stage, we run the text against regular expressions that look\n// for non-JSON patterns. We are especially concerned with '()' and 'new'\n// because they can cause invocation, and '=' because it can cause mutation.\n// But just to be safe, we want to reject all unexpected forms.\n\n// We split the second stage into 4 regexp operations in order to work around\n// crippling inefficiencies in IE's and Safari's regexp engines. First we\n// replace the JSON backslash pairs with '@' (a non-JSON character). Second, we\n// replace all simple value tokens with ']' characters. Third, we delete all\n// open brackets that follow a colon or comma or that begin the text. Finally,\n// we look to see that the remaining characters are only whitespace or ']' or\n// ',' or ':' or '{' or '}'. If that is so, then the text is safe for eval.\n\n                if (/^[\\],:{}\\s]*$/\n                        .test(text.replace(/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@')\n                            .replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g, ']')\n                            .replace(/(?:^|:|,)(?:\\s*\\[)+/g, ''))) {\n\n// In the third stage we use the eval function to compile the text into a\n// JavaScript structure. The '{' operator is subject to a syntactic ambiguity\n// in JavaScript: it can begin a block or an object literal. We wrap the text\n// in parens to eliminate the ambiguity.\n\n                    j = eval('(' + text + ')');\n\n// In the optional fourth stage, we recursively walk the new structure, passing\n// each name/value pair to a reviver function for possible transformation.\n\n                    return typeof reviver === 'function'\n                        ? walk({'': j}, '')\n                        : j;\n                }\n\n// If the text is not JSON parseable, then a SyntaxError is thrown.\n\n                throw new SyntaxError('JSON.parse');\n            };\n        }\n    }());\n}\n/* jshint ignore:end */\n/* jshint ignore:start */\n\n(function() {\n\n/*!\n  * @preserve Qwery - A Blazing Fast query selector engine\n  * https://github.com/ded/qwery\n  * copyright Dustin Diaz 2012\n  * MIT License\n  */\n\n(function (name, context, definition) {\n  if (typeof module != 'undefined' && module.exports) module.exports = definition()\n  else if (typeof define == 'function' && define.amd) define(definition)\n  else context[name] = definition()\n})('qwery', this, function () {\n  var doc = document\n    , html = doc.documentElement\n    , byClass = 'getElementsByClassName'\n    , byTag = 'getElementsByTagName'\n    , qSA = 'querySelectorAll'\n    , useNativeQSA = 'useNativeQSA'\n    , tagName = 'tagName'\n    , nodeType = 'nodeType'\n    , select // main select() method, assign later\n\n    , id = /#([\\w\\-]+)/\n    , clas = /\\.[\\w\\-]+/g\n    , idOnly = /^#([\\w\\-]+)$/\n    , classOnly = /^\\.([\\w\\-]+)$/\n    , tagOnly = /^([\\w\\-]+)$/\n    , tagAndOrClass = /^([\\w]+)?\\.([\\w\\-]+)$/\n    , splittable = /(^|,)\\s*[>~+]/\n    , normalizr = /^\\s+|\\s*([,\\s\\+\\~>]|$)\\s*/g\n    , splitters = /[\\s\\>\\+\\~]/\n    , splittersMore = /(?![\\s\\w\\-\\/\\?\\&\\=\\:\\.\\(\\)\\!,@#%<>\\{\\}\\$\\*\\^'\"]*\\]|[\\s\\w\\+\\-]*\\))/\n    , specialChars = /([.*+?\\^=!:${}()|\\[\\]\\/\\\\])/g\n    , simple = /^(\\*|[a-z0-9]+)?(?:([\\.\\#]+[\\w\\-\\.#]+)?)/\n    , attr = /\\[([\\w\\-]+)(?:([\\|\\^\\$\\*\\~]?\\=)['\"]?([ \\w\\-\\/\\?\\&\\=\\:\\.\\(\\)\\!,@#%<>\\{\\}\\$\\*\\^]+)[\"']?)?\\]/\n    , pseudo = /:([\\w\\-]+)(\\(['\"]?([^()]+)['\"]?\\))?/\n    , easy = new RegExp(idOnly.source + '|' + tagOnly.source + '|' + classOnly.source)\n    , dividers = new RegExp('(' + splitters.source + ')' + splittersMore.source, 'g')\n    , tokenizr = new RegExp(splitters.source + splittersMore.source)\n    , chunker = new RegExp(simple.source + '(' + attr.source + ')?' + '(' + pseudo.source + ')?')\n\n  var walker = {\n      ' ': function (node) {\n        return node && node !== html && node.parentNode\n      }\n    , '>': function (node, contestant) {\n        return node && node.parentNode == contestant.parentNode && node.parentNode\n      }\n    , '~': function (node) {\n        return node && node.previousSibling\n      }\n    , '+': function (node, contestant, p1, p2) {\n        if (!node) return false\n        return (p1 = previous(node)) && (p2 = previous(contestant)) && p1 == p2 && p1\n      }\n    }\n\n  function cache() {\n    this.c = {}\n  }\n  cache.prototype = {\n    g: function (k) {\n      return this.c[k] || undefined\n    }\n  , s: function (k, v, r) {\n      v = r ? new RegExp(v) : v\n      return (this.c[k] = v)\n    }\n  }\n\n  var classCache = new cache()\n    , cleanCache = new cache()\n    , attrCache = new cache()\n    , tokenCache = new cache()\n\n  function classRegex(c) {\n    return classCache.g(c) || classCache.s(c, '(^|\\\\s+)' + c + '(\\\\s+|$)', 1)\n  }\n\n  // not quite as fast as inline loops in older browsers so don't use liberally\n  function each(a, fn) {\n    var i = 0, l = a.length\n    for (; i < l; i++) fn(a[i])\n  }\n\n  function flatten(ar) {\n    for (var r = [], i = 0, l = ar.length; i < l; ++i) arrayLike(ar[i]) ? (r = r.concat(ar[i])) : (r[r.length] = ar[i])\n    return r\n  }\n\n  function arrayify(ar) {\n    var i = 0, l = ar.length, r = []\n    for (; i < l; i++) r[i] = ar[i]\n    return r\n  }\n\n  function previous(n) {\n    while (n = n.previousSibling) if (n[nodeType] == 1) break;\n    return n\n  }\n\n  function q(query) {\n    return query.match(chunker)\n  }\n\n  // called using `this` as element and arguments from regex group results.\n  // given => div.hello[title=\"world\"]:foo('bar')\n  // div.hello[title=\"world\"]:foo('bar'), div, .hello, [title=\"world\"], title, =, world, :foo('bar'), foo, ('bar'), bar]\n  function interpret(whole, tag, idsAndClasses, wholeAttribute, attribute, qualifier, value, wholePseudo, pseudo, wholePseudoVal, pseudoVal) {\n    var i, m, k, o, classes\n    if (this[nodeType] !== 1) return false\n    if (tag && tag !== '*' && this[tagName] && this[tagName].toLowerCase() !== tag) return false\n    if (idsAndClasses && (m = idsAndClasses.match(id)) && m[1] !== this.id) return false\n    if (idsAndClasses && (classes = idsAndClasses.match(clas))) {\n      for (i = classes.length; i--;) if (!classRegex(classes[i].slice(1)).test(this.className)) return false\n    }\n    if (pseudo && qwery.pseudos[pseudo] && !qwery.pseudos[pseudo](this, pseudoVal)) return false\n    if (wholeAttribute && !value) { // select is just for existance of attrib\n      o = this.attributes\n      for (k in o) {\n        if (Object.prototype.hasOwnProperty.call(o, k) && (o[k].name || k) == attribute) {\n          return this\n        }\n      }\n    }\n    if (wholeAttribute && !checkAttr(qualifier, getAttr(this, attribute) || '', value)) {\n      // select is for attrib equality\n      return false\n    }\n    return this\n  }\n\n  function clean(s) {\n    return cleanCache.g(s) || cleanCache.s(s, s.replace(specialChars, '\\\\$1'))\n  }\n\n  function checkAttr(qualify, actual, val) {\n    switch (qualify) {\n    case '=':\n      return actual == val\n    case '^=':\n      return actual.match(attrCache.g('^=' + val) || attrCache.s('^=' + val, '^' + clean(val), 1))\n    case '$=':\n      return actual.match(attrCache.g('$=' + val) || attrCache.s('$=' + val, clean(val) + '$', 1))\n    case '*=':\n      return actual.match(attrCache.g(val) || attrCache.s(val, clean(val), 1))\n    case '~=':\n      return actual.match(attrCache.g('~=' + val) || attrCache.s('~=' + val, '(?:^|\\\\s+)' + clean(val) + '(?:\\\\s+|$)', 1))\n    case '|=':\n      return actual.match(attrCache.g('|=' + val) || attrCache.s('|=' + val, '^' + clean(val) + '(-|$)', 1))\n    }\n    return 0\n  }\n\n  // given a selector, first check for simple cases then collect all base candidate matches and filter\n  function _qwery(selector, _root) {\n    var r = [], ret = [], i, l, m, token, tag, els, intr, item, root = _root\n      , tokens = tokenCache.g(selector) || tokenCache.s(selector, selector.split(tokenizr))\n      , dividedTokens = selector.match(dividers)\n\n    if (!tokens.length) return r\n\n    token = (tokens = tokens.slice(0)).pop() // copy cached tokens, take the last one\n    if (tokens.length && (m = tokens[tokens.length - 1].match(idOnly))) root = byId(_root, m[1])\n    if (!root) return r\n\n    intr = q(token)\n    // collect base candidates to filter\n    els = root !== _root && root[nodeType] !== 9 && dividedTokens && /^[+~]$/.test(dividedTokens[dividedTokens.length - 1]) ?\n      function (r) {\n        while (root = root.nextSibling) {\n          root[nodeType] == 1 && (intr[1] ? intr[1] == root[tagName].toLowerCase() : 1) && (r[r.length] = root)\n        }\n        return r\n      }([]) :\n      root[byTag](intr[1] || '*')\n    // filter elements according to the right-most part of the selector\n    for (i = 0, l = els.length; i < l; i++) {\n      if (item = interpret.apply(els[i], intr)) r[r.length] = item\n    }\n    if (!tokens.length) return r\n\n    // filter further according to the rest of the selector (the left side)\n    each(r, function (e) { if (ancestorMatch(e, tokens, dividedTokens)) ret[ret.length] = e })\n    return ret\n  }\n\n  // compare element to a selector\n  function is(el, selector, root) {\n    if (isNode(selector)) return el == selector\n    if (arrayLike(selector)) return !!~flatten(selector).indexOf(el) // if selector is an array, is el a member?\n\n    var selectors = selector.split(','), tokens, dividedTokens\n    while (selector = selectors.pop()) {\n      tokens = tokenCache.g(selector) || tokenCache.s(selector, selector.split(tokenizr))\n      dividedTokens = selector.match(dividers)\n      tokens = tokens.slice(0) // copy array\n      if (interpret.apply(el, q(tokens.pop())) && (!tokens.length || ancestorMatch(el, tokens, dividedTokens, root))) {\n        return true\n      }\n    }\n    return false\n  }\n\n  // given elements matching the right-most part of a selector, filter out any that don't match the rest\n  function ancestorMatch(el, tokens, dividedTokens, root) {\n    var cand\n    // recursively work backwards through the tokens and up the dom, covering all options\n    function crawl(e, i, p) {\n      while (p = walker[dividedTokens[i]](p, e)) {\n        if (isNode(p) && (interpret.apply(p, q(tokens[i])))) {\n          if (i) {\n            if (cand = crawl(p, i - 1, p)) return cand\n          } else return p\n        }\n      }\n    }\n    return (cand = crawl(el, tokens.length - 1, el)) && (!root || isAncestor(cand, root))\n  }\n\n  function isNode(el, t) {\n    return el && typeof el === 'object' && (t = el[nodeType]) && (t == 1 || t == 9)\n  }\n\n  function uniq(ar) {\n    var a = [], i, j;\n    o:\n    for (i = 0; i < ar.length; ++i) {\n      for (j = 0; j < a.length; ++j) if (a[j] == ar[i]) continue o\n      a[a.length] = ar[i]\n    }\n    return a\n  }\n\n  function arrayLike(o) {\n    return (typeof o === 'object' && isFinite(o.length))\n  }\n\n  function normalizeRoot(root) {\n    if (!root) return doc\n    if (typeof root == 'string') return qwery(root)[0]\n    if (!root[nodeType] && arrayLike(root)) return root[0]\n    return root\n  }\n\n  function byId(root, id, el) {\n    // if doc, query on it, else query the parent doc or if a detached fragment rewrite the query and run on the fragment\n    return root[nodeType] === 9 ? root.getElementById(id) :\n      root.ownerDocument &&\n        (((el = root.ownerDocument.getElementById(id)) && isAncestor(el, root) && el) ||\n          (!isAncestor(root, root.ownerDocument) && select('[id=\"' + id + '\"]', root)[0]))\n  }\n\n  function qwery(selector, _root) {\n    var m, el, root = normalizeRoot(_root)\n\n    // easy, fast cases that we can dispatch with simple DOM calls\n    if (!root || !selector) return []\n    if (selector === window || isNode(selector)) {\n      return !_root || (selector !== window && isNode(root) && isAncestor(selector, root)) ? [selector] : []\n    }\n    if (selector && arrayLike(selector)) return flatten(selector)\n    if (m = selector.match(easy)) {\n      if (m[1]) return (el = byId(root, m[1])) ? [el] : []\n      if (m[2]) return arrayify(root[byTag](m[2]))\n      if (hasByClass && m[3]) return arrayify(root[byClass](m[3]))\n    }\n\n    return select(selector, root)\n  }\n\n  // where the root is not document and a relationship selector is first we have to\n  // do some awkward adjustments to get it to work, even with qSA\n  function collectSelector(root, collector) {\n    return function (s) {\n      var oid, nid\n      if (splittable.test(s)) {\n        if (root[nodeType] !== 9) {\n          // make sure the el has an id, rewrite the query, set root to doc and run it\n          if (!(nid = oid = root.getAttribute('id'))) root.setAttribute('id', nid = '__qwerymeupscotty')\n          s = '[id=\"' + nid + '\"]' + s // avoid byId and allow us to match context element\n          collector(root.parentNode || root, s, true)\n          oid || root.removeAttribute('id')\n        }\n        return;\n      }\n      s.length && collector(root, s, false)\n    }\n  }\n\n  var isAncestor = 'compareDocumentPosition' in html ?\n    function (element, container) {\n      return (container.compareDocumentPosition(element) & 16) == 16\n    } : 'contains' in html ?\n    function (element, container) {\n      container = container[nodeType] === 9 || container == window ? html : container\n      return container !== element && container.contains(element)\n    } :\n    function (element, container) {\n      while (element = element.parentNode) if (element === container) return 1\n      return 0\n    }\n  , getAttr = function () {\n      // detect buggy IE src/href getAttribute() call\n      var e = doc.createElement('p')\n      return ((e.innerHTML = '<a href=\"#x\">x</a>') && e.firstChild.getAttribute('href') != '#x') ?\n        function (e, a) {\n          return a === 'class' ? e.className : (a === 'href' || a === 'src') ?\n            e.getAttribute(a, 2) : e.getAttribute(a)\n        } :\n        function (e, a) { return e.getAttribute(a) }\n    }()\n  , hasByClass = !!doc[byClass]\n    // has native qSA support\n  , hasQSA = doc.querySelector && doc[qSA]\n    // use native qSA\n  , selectQSA = function (selector, root) {\n      var result = [], ss, e\n      try {\n        if (root[nodeType] === 9 || !splittable.test(selector)) {\n          // most work is done right here, defer to qSA\n          return arrayify(root[qSA](selector))\n        }\n        // special case where we need the services of `collectSelector()`\n        each(ss = selector.split(','), collectSelector(root, function (ctx, s) {\n          e = ctx[qSA](s)\n          if (e.length == 1) result[result.length] = e.item(0)\n          else if (e.length) result = result.concat(arrayify(e))\n        }))\n        return ss.length > 1 && result.length > 1 ? uniq(result) : result\n      } catch (ex) { }\n      return selectNonNative(selector, root)\n    }\n    // no native selector support\n  , selectNonNative = function (selector, root) {\n      var result = [], items, m, i, l, r, ss\n      selector = selector.replace(normalizr, '$1')\n      if (m = selector.match(tagAndOrClass)) {\n        r = classRegex(m[2])\n        items = root[byTag](m[1] || '*')\n        for (i = 0, l = items.length; i < l; i++) {\n          if (r.test(items[i].className)) result[result.length] = items[i]\n        }\n        return result\n      }\n      // more complex selector, get `_qwery()` to do the work for us\n      each(ss = selector.split(','), collectSelector(root, function (ctx, s, rewrite) {\n        r = _qwery(s, ctx)\n        for (i = 0, l = r.length; i < l; i++) {\n          if (ctx[nodeType] === 9 || rewrite || isAncestor(r[i], root)) result[result.length] = r[i]\n        }\n      }))\n      return ss.length > 1 && result.length > 1 ? uniq(result) : result\n    }\n  , configure = function (options) {\n      // configNativeQSA: use fully-internal selector or native qSA where present\n      if (typeof options[useNativeQSA] !== 'undefined')\n        select = !options[useNativeQSA] ? selectNonNative : hasQSA ? selectQSA : selectNonNative\n    }\n\n  configure({ useNativeQSA: true })\n\n  qwery.configure = configure\n  qwery.uniq = uniq\n  qwery.is = is\n  qwery.pseudos = {}\n\n  return qwery\n});\n\n/*! onDomReady.js 1.4.0 (c) 2013 Tubal Martin - MIT license | Wrapped in UMD by Okanjo */\n(function(root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        define([], factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory();\n    } else {\n        root.onDomReady = factory();\n    }\n}(this, function() {\n\n    'use strict';\n\n    var win = window,\n        doc = win.document,\n        docElem = doc.documentElement,\n\n        LOAD = \"load\",\n        FALSE = false,\n        ONLOAD = \"on\"+LOAD,\n        COMPLETE = \"complete\",\n        READYSTATE = \"readyState\",\n        ATTACHEVENT = \"attachEvent\",\n        DETACHEVENT = \"detachEvent\",\n        ADDEVENTLISTENER = \"addEventListener\",\n        DOMCONTENTLOADED = \"DOMContentLoaded\",\n        ONREADYSTATECHANGE = \"onreadystatechange\",\n        REMOVEEVENTLISTENER = \"removeEventListener\",\n\n    // W3C Event model\n        w3c = ADDEVENTLISTENER in doc,\n        top = FALSE,\n\n    // isReady: Is the DOM ready to be used? Set to true once it occurs.\n        isReady = FALSE,\n\n    // Callbacks pending execution until DOM is ready\n        callbacks = [];\n\n    // Handle when the DOM is ready\n    function ready( fn ) {\n        if ( !isReady ) {\n\n            // Make sure body exists, at least, in case IE gets a little overzealous (ticket #5443).\n            if ( !doc.body ) {\n                return defer( ready );\n            }\n\n            // Remember that the DOM is ready\n            isReady = true;\n\n            // Execute all callbacks\n            while ( fn = callbacks.shift() ) {\n                defer( fn );\n            }\n        }\n    }\n\n    // The ready event handler\n    function completed( event ) {\n        // readyState === \"complete\" is good enough for us to call the dom ready in oldIE\n        if ( w3c || event.type === LOAD || doc[READYSTATE] === COMPLETE ) {\n            detach();\n            ready();\n        }\n    }\n\n    // Clean-up method for dom ready events\n    function detach() {\n        if ( w3c ) {\n            doc[REMOVEEVENTLISTENER]( DOMCONTENTLOADED, completed, FALSE );\n            win[REMOVEEVENTLISTENER]( LOAD, completed, FALSE );\n        } else {\n            doc[DETACHEVENT]( ONREADYSTATECHANGE, completed );\n            win[DETACHEVENT]( ONLOAD, completed );\n        }\n    }\n\n    // Defers a function, scheduling it to run after the current call stack has cleared.\n    function defer( fn, wait ) {\n        // Allow 0 to be passed\n        setTimeout( fn, +wait >= 0 ? wait : 1 );\n    }\n\n    // Attach the listeners:\n\n    // Catch cases where onDomReady is called after the browser event has already occurred.\n    // we once tried to use readyState \"interactive\" here, but it caused issues like the one\n    // discovered by ChrisS here: http://bugs.jquery.com/ticket/12282#comment:15\n    if ( doc[READYSTATE] === COMPLETE ) {\n        // Handle it asynchronously to allow scripts the opportunity to delay ready\n        defer( ready );\n\n        // Standards-based browsers support DOMContentLoaded\n    } else if ( w3c ) {\n        // Use the handy event callback\n        doc[ADDEVENTLISTENER]( DOMCONTENTLOADED, completed, FALSE );\n\n        // A fallback to window.onload, that will always work\n        win[ADDEVENTLISTENER]( LOAD, completed, FALSE );\n\n        // If IE event model is used\n    } else {\n        // Ensure firing before onload, maybe late but safe also for iframes\n        doc[ATTACHEVENT]( ONREADYSTATECHANGE, completed );\n\n        // A fallback to window.onload, that will always work\n        win[ATTACHEVENT]( ONLOAD, completed );\n\n        // If IE and not a frame\n        // continually check to see if the document is ready\n        try {\n            top = win.frameElement == null && docElem;\n        } catch(e) {}\n\n        if ( top && top.doScroll ) {\n            (function doScrollCheck() {\n                if ( !isReady ) {\n                    try {\n                        // Use the trick by Diego Perini\n                        // http://javascript.nwbox.com/IEContentLoaded/\n                        top.doScroll(\"left\");\n                    } catch(e) {\n                        return defer( doScrollCheck, 50 );\n                    }\n\n                    // detach all dom ready events\n                    detach();\n\n                    // and execute any waiting functions\n                    ready();\n                }\n            })();\n        }\n    }\n\n    function onDomReady( fn ) {\n        // If DOM is ready, execute the function (async), otherwise wait\n        isReady ? defer( fn ) : callbacks.push( fn );\n    }\n\n    // Add version\n    onDomReady.version = \"1.4.0\";\n    // Add method to check if DOM is ready\n    onDomReady.isReady = function(){\n        return isReady;\n    };\n\n    return onDomReady;\n}));\n\n\n/*!\n * mustache.js - Logic-less {{mustache}} templates with JavaScript\n * http://github.com/janl/mustache.js\n */\n\n/*global define: false*/\n\n(function (global, factory) {\n  if (typeof exports === \"object\" && exports) {\n    factory(exports); // CommonJS\n  } else if (typeof define === \"function\" && define.amd) {\n    define(['exports'], factory); // AMD\n  } else {\n    factory(global.Mustache = {}); // <script>\n  }\n}(this, function (mustache) {\n\n  var Object_toString = Object.prototype.toString;\n  var isArray = Array.isArray || function (object) {\n    return Object_toString.call(object) === '[object Array]';\n  };\n\n  function isFunction(object) {\n    return typeof object === 'function';\n  }\n\n  function escapeRegExp(string) {\n    return string.replace(/[\\-\\[\\]{}()*+?.,\\\\\\^$|#\\s]/g, \"\\\\$&\");\n  }\n\n  // Workaround for https://issues.apache.org/jira/browse/COUCHDB-577\n  // See https://github.com/janl/mustache.js/issues/189\n  var RegExp_test = RegExp.prototype.test;\n  function testRegExp(re, string) {\n    return RegExp_test.call(re, string);\n  }\n\n  var nonSpaceRe = /\\S/;\n  function isWhitespace(string) {\n    return !testRegExp(nonSpaceRe, string);\n  }\n\n  var entityMap = {\n    \"&\": \"&amp;\",\n    \"<\": \"&lt;\",\n    \">\": \"&gt;\",\n    '\"': '&quot;',\n    \"'\": '&#39;',\n    \"/\": '&#x2F;'\n  };\n\n  function escapeHtml(string) {\n    return String(string).replace(/[&<>\"'\\/]/g, function (s) {\n      return entityMap[s];\n    });\n  }\n\n  var whiteRe = /\\s*/;\n  var spaceRe = /\\s+/;\n  var equalsRe = /\\s*=/;\n  var curlyRe = /\\s*\\}/;\n  var tagRe = /#|\\^|\\/|>|\\{|&|=|!/;\n\n  /**\n   * Breaks up the given `template` string into a tree of tokens. If the `tags`\n   * argument is given here it must be an array with two string values: the\n   * opening and closing tags used in the template (e.g. [ \"<%\", \"%>\" ]). Of\n   * course, the default is to use mustaches (i.e. mustache.tags).\n   *\n   * A token is an array with at least 4 elements. The first element is the\n   * mustache symbol that was used inside the tag, e.g. \"#\" or \"&\". If the tag\n   * did not contain a symbol (i.e. {{myValue}}) this element is \"name\". For\n   * all text that appears outside a symbol this element is \"text\".\n   *\n   * The second element of a token is its \"value\". For mustache tags this is\n   * whatever else was inside the tag besides the opening symbol. For text tokens\n   * this is the text itself.\n   *\n   * The third and fourth elements of the token are the start and end indices,\n   * respectively, of the token in the original template.\n   *\n   * Tokens that are the root node of a subtree contain two more elements: 1) an\n   * array of tokens in the subtree and 2) the index in the original template at\n   * which the closing tag for that section begins.\n   */\n  function parseTemplate(template, tags) {\n    if (!template)\n      return [];\n\n    var sections = [];     // Stack to hold section tokens\n    var tokens = [];       // Buffer to hold the tokens\n    var spaces = [];       // Indices of whitespace tokens on the current line\n    var hasTag = false;    // Is there a {{tag}} on the current line?\n    var nonSpace = false;  // Is there a non-space char on the current line?\n\n    // Strips all whitespace tokens array for the current line\n    // if there was a {{#tag}} on it and otherwise only space.\n    function stripSpace() {\n      if (hasTag && !nonSpace) {\n        while (spaces.length)\n          delete tokens[spaces.pop()];\n      } else {\n        spaces = [];\n      }\n\n      hasTag = false;\n      nonSpace = false;\n    }\n\n    var openingTagRe, closingTagRe, closingCurlyRe;\n    function compileTags(tags) {\n      if (typeof tags === 'string')\n        tags = tags.split(spaceRe, 2);\n\n      if (!isArray(tags) || tags.length !== 2)\n        throw new Error('Invalid tags: ' + tags);\n\n      openingTagRe = new RegExp(escapeRegExp(tags[0]) + '\\\\s*');\n      closingTagRe = new RegExp('\\\\s*' + escapeRegExp(tags[1]));\n      closingCurlyRe = new RegExp('\\\\s*' + escapeRegExp('}' + tags[1]));\n    }\n\n    compileTags(tags || mustache.tags);\n\n    var scanner = new Scanner(template);\n\n    var start, type, value, chr, token, openSection;\n    while (!scanner.eos()) {\n      start = scanner.pos;\n\n      // Match any text between tags.\n      value = scanner.scanUntil(openingTagRe);\n\n      if (value) {\n        for (var i = 0, valueLength = value.length; i < valueLength; ++i) {\n          chr = value.charAt(i);\n\n          if (isWhitespace(chr)) {\n            spaces.push(tokens.length);\n          } else {\n            nonSpace = true;\n          }\n\n          tokens.push([ 'text', chr, start, start + 1 ]);\n          start += 1;\n\n          // Check for whitespace on the current line.\n          if (chr === '\\n')\n            stripSpace();\n        }\n      }\n\n      // Match the opening tag.\n      if (!scanner.scan(openingTagRe))\n        break;\n\n      hasTag = true;\n\n      // Get the tag type.\n      type = scanner.scan(tagRe) || 'name';\n      scanner.scan(whiteRe);\n\n      // Get the tag value.\n      if (type === '=') {\n        value = scanner.scanUntil(equalsRe);\n        scanner.scan(equalsRe);\n        scanner.scanUntil(closingTagRe);\n      } else if (type === '{') {\n        value = scanner.scanUntil(closingCurlyRe);\n        scanner.scan(curlyRe);\n        scanner.scanUntil(closingTagRe);\n        type = '&';\n      } else {\n        value = scanner.scanUntil(closingTagRe);\n      }\n\n      // Match the closing tag.\n      if (!scanner.scan(closingTagRe))\n        throw new Error('Unclosed tag at ' + scanner.pos);\n\n      token = [ type, value, start, scanner.pos ];\n      tokens.push(token);\n\n      if (type === '#' || type === '^') {\n        sections.push(token);\n      } else if (type === '/') {\n        // Check section nesting.\n        openSection = sections.pop();\n\n        if (!openSection)\n          throw new Error('Unopened section \"' + value + '\" at ' + start);\n\n        if (openSection[1] !== value)\n          throw new Error('Unclosed section \"' + openSection[1] + '\" at ' + start);\n      } else if (type === 'name' || type === '{' || type === '&') {\n        nonSpace = true;\n      } else if (type === '=') {\n        // Set the tags for the next time around.\n        compileTags(value);\n      }\n    }\n\n    // Make sure there are no open sections when we're done.\n    openSection = sections.pop();\n\n    if (openSection)\n      throw new Error('Unclosed section \"' + openSection[1] + '\" at ' + scanner.pos);\n\n    return nestTokens(squashTokens(tokens));\n  }\n\n  /**\n   * Combines the values of consecutive text tokens in the given `tokens` array\n   * to a single token.\n   */\n  function squashTokens(tokens) {\n    var squashedTokens = [];\n\n    var token, lastToken;\n    for (var i = 0, numTokens = tokens.length; i < numTokens; ++i) {\n      token = tokens[i];\n\n      if (token) {\n        if (token[0] === 'text' && lastToken && lastToken[0] === 'text') {\n          lastToken[1] += token[1];\n          lastToken[3] = token[3];\n        } else {\n          squashedTokens.push(token);\n          lastToken = token;\n        }\n      }\n    }\n\n    return squashedTokens;\n  }\n\n  /**\n   * Forms the given array of `tokens` into a nested tree structure where\n   * tokens that represent a section have two additional items: 1) an array of\n   * all tokens that appear in that section and 2) the index in the original\n   * template that represents the end of that section.\n   */\n  function nestTokens(tokens) {\n    var nestedTokens = [];\n    var collector = nestedTokens;\n    var sections = [];\n\n    var token, section;\n    for (var i = 0, numTokens = tokens.length; i < numTokens; ++i) {\n      token = tokens[i];\n\n      switch (token[0]) {\n      case '#':\n      case '^':\n        collector.push(token);\n        sections.push(token);\n        collector = token[4] = [];\n        break;\n      case '/':\n        section = sections.pop();\n        section[5] = token[2];\n        collector = sections.length > 0 ? sections[sections.length - 1][4] : nestedTokens;\n        break;\n      default:\n        collector.push(token);\n      }\n    }\n\n    return nestedTokens;\n  }\n\n  /**\n   * A simple string scanner that is used by the template parser to find\n   * tokens in template strings.\n   */\n  function Scanner(string) {\n    this.string = string;\n    this.tail = string;\n    this.pos = 0;\n  }\n\n  /**\n   * Returns `true` if the tail is empty (end of string).\n   */\n  Scanner.prototype.eos = function () {\n    return this.tail === \"\";\n  };\n\n  /**\n   * Tries to match the given regular expression at the current position.\n   * Returns the matched text if it can match, the empty string otherwise.\n   */\n  Scanner.prototype.scan = function (re) {\n    var match = this.tail.match(re);\n\n    if (!match || match.index !== 0)\n      return '';\n\n    var string = match[0];\n\n    this.tail = this.tail.substring(string.length);\n    this.pos += string.length;\n\n    return string;\n  };\n\n  /**\n   * Skips all text until the given regular expression can be matched. Returns\n   * the skipped string, which is the entire tail if no match can be made.\n   */\n  Scanner.prototype.scanUntil = function (re) {\n    var index = this.tail.search(re), match;\n\n    switch (index) {\n    case -1:\n      match = this.tail;\n      this.tail = \"\";\n      break;\n    case 0:\n      match = \"\";\n      break;\n    default:\n      match = this.tail.substring(0, index);\n      this.tail = this.tail.substring(index);\n    }\n\n    this.pos += match.length;\n\n    return match;\n  };\n\n  /**\n   * Represents a rendering context by wrapping a view object and\n   * maintaining a reference to the parent context.\n   */\n  function Context(view, parentContext) {\n    this.view = view == null ? {} : view;\n    this.cache = { '.': this.view };\n    this.parent = parentContext;\n  }\n\n  /**\n   * Creates a new context using the given view with this context\n   * as the parent.\n   */\n  Context.prototype.push = function (view) {\n    return new Context(view, this);\n  };\n\n  /**\n   * Returns the value of the given name in this context, traversing\n   * up the context hierarchy if the value is absent in this context's view.\n   */\n  Context.prototype.lookup = function (name) {\n    var cache = this.cache;\n\n    var value;\n    if (name in cache) {\n      value = cache[name];\n    } else {\n      var context = this, names, index;\n\n      while (context) {\n        if (name.indexOf('.') > 0) {\n          value = context.view;\n          names = name.split('.');\n          index = 0;\n\n          while (value != null && index < names.length)\n            value = value[names[index++]];\n        } else if (typeof context.view == 'object') {\n          value = context.view[name];\n        }\n\n        if (value != null)\n          break;\n\n        context = context.parent;\n      }\n\n      cache[name] = value;\n    }\n\n    if (isFunction(value))\n      value = value.call(this.view);\n\n    return value;\n  };\n\n  /**\n   * A Writer knows how to take a stream of tokens and render them to a\n   * string, given a context. It also maintains a cache of templates to\n   * avoid the need to parse the same template twice.\n   */\n  function Writer() {\n    this.cache = {};\n  }\n\n  /**\n   * Clears all cached templates in this writer.\n   */\n  Writer.prototype.clearCache = function () {\n    this.cache = {};\n  };\n\n  /**\n   * Parses and caches the given `template` and returns the array of tokens\n   * that is generated from the parse.\n   */\n  Writer.prototype.parse = function (template, tags) {\n    var cache = this.cache;\n    var tokens = cache[template];\n\n    if (tokens == null)\n      tokens = cache[template] = parseTemplate(template, tags);\n\n    return tokens;\n  };\n\n  /**\n   * High-level method that is used to render the given `template` with\n   * the given `view`.\n   *\n   * The optional `partials` argument may be an object that contains the\n   * names and templates of partials that are used in the template. It may\n   * also be a function that is used to load partial templates on the fly\n   * that takes a single argument: the name of the partial.\n   */\n  Writer.prototype.render = function (template, view, partials) {\n    var tokens = this.parse(template);\n    var context = (view instanceof Context) ? view : new Context(view);\n    return this.renderTokens(tokens, context, partials, template);\n  };\n\n  /**\n   * Low-level method that renders the given array of `tokens` using\n   * the given `context` and `partials`.\n   *\n   * Note: The `originalTemplate` is only ever used to extract the portion\n   * of the original template that was contained in a higher-order section.\n   * If the template doesn't use higher-order sections, this argument may\n   * be omitted.\n   */\n  Writer.prototype.renderTokens = function (tokens, context, partials, originalTemplate) {\n    var buffer = '';\n\n    var token, symbol, value;\n    for (var i = 0, numTokens = tokens.length; i < numTokens; ++i) {\n      value = undefined;\n      token = tokens[i];\n      symbol = token[0];\n\n      if (symbol === '#') value = this._renderSection(token, context, partials, originalTemplate);\n      else if (symbol === '^') value = this._renderInverted(token, context, partials, originalTemplate);\n      else if (symbol === '>') value = this._renderPartial(token, context, partials, originalTemplate);\n      else if (symbol === '&') value = this._unescapedValue(token, context);\n      else if (symbol === 'name') value = this._escapedValue(token, context);\n      else if (symbol === 'text') value = this._rawValue(token);\n\n      if (value !== undefined)\n        buffer += value;\n    }\n\n    return buffer;\n  };\n\n  Writer.prototype._renderSection = function (token, context, partials, originalTemplate) {\n    var self = this;\n    var buffer = '';\n    var value = context.lookup(token[1]);\n\n    // This function is used to render an arbitrary template\n    // in the current context by higher-order sections.\n    function subRender(template) {\n      return self.render(template, context, partials);\n    }\n\n    if (!value) return;\n\n    if (isArray(value)) {\n      for (var j = 0, valueLength = value.length; j < valueLength; ++j) {\n        buffer += this.renderTokens(token[4], context.push(value[j]), partials, originalTemplate);\n      }\n    } else if (typeof value === 'object' || typeof value === 'string') {\n      buffer += this.renderTokens(token[4], context.push(value), partials, originalTemplate);\n    } else if (isFunction(value)) {\n      if (typeof originalTemplate !== 'string')\n        throw new Error('Cannot use higher-order sections without the original template');\n\n      // Extract the portion of the original template that the section contains.\n      value = value.call(context.view, originalTemplate.slice(token[3], token[5]), subRender);\n\n      if (value != null)\n        buffer += value;\n    } else {\n      buffer += this.renderTokens(token[4], context, partials, originalTemplate);\n    }\n    return buffer;\n  };\n\n  Writer.prototype._renderInverted = function(token, context, partials, originalTemplate) {\n    var value = context.lookup(token[1]);\n\n    // Use JavaScript's definition of falsy. Include empty arrays.\n    // See https://github.com/janl/mustache.js/issues/186\n    if (!value || (isArray(value) && value.length === 0))\n      return this.renderTokens(token[4], context, partials, originalTemplate);\n  };\n\n  Writer.prototype._renderPartial = function(token, context, partials) {\n    if (!partials) return;\n\n    var value = isFunction(partials) ? partials(token[1]) : partials[token[1]];\n    if (value != null)\n      return this.renderTokens(this.parse(value), context, partials, value);\n  };\n\n  Writer.prototype._unescapedValue = function(token, context) {\n    var value = context.lookup(token[1]);\n    if (value != null)\n      return value;\n  };\n\n  Writer.prototype._escapedValue = function(token, context) {\n    var value = context.lookup(token[1]);\n    if (value != null)\n      return mustache.escape(value);\n  };\n\n  Writer.prototype._rawValue = function(token) {\n    return token[1];\n  };\n\n  mustache.name = \"mustache.js\";\n  mustache.version = \"1.1.0\";\n  mustache.tags = [ \"{{\", \"}}\" ];\n\n  // All high-level mustache.* functions use this writer.\n  var defaultWriter = new Writer();\n\n  /**\n   * Clears all cached templates in the default writer.\n   */\n  mustache.clearCache = function () {\n    return defaultWriter.clearCache();\n  };\n\n  /**\n   * Parses and caches the given template in the default writer and returns the\n   * array of tokens it contains. Doing this ahead of time avoids the need to\n   * parse templates on the fly as they are rendered.\n   */\n  mustache.parse = function (template, tags) {\n    return defaultWriter.parse(template, tags);\n  };\n\n  /**\n   * Renders the `template` with the given `view` and `partials` using the\n   * default writer.\n   */\n  mustache.render = function (template, view, partials) {\n    return defaultWriter.render(template, view, partials);\n  };\n\n  // This is here for backwards compatibility with 0.4.x.\n  mustache.to_html = function (template, view, partials, send) {\n    var result = mustache.render(template, view, partials);\n\n    if (isFunction(send)) {\n      send(result);\n    } else {\n      return result;\n    }\n  };\n\n  // Export the escaping function so that the user may override it.\n  // See https://github.com/janl/mustache.js/issues/244\n  mustache.escape = escapeHtml;\n\n  // Export these mainly for testing, but also for advanced usage.\n  mustache.Scanner = Scanner;\n  mustache.Context = Context;\n  mustache.Writer = Writer;\n\n}));\n\n\n}).apply(okanjo);\n\n/* jshint ignore:end */\n//noinspection ThisExpressionReferencesGlobalObjectJS\n(function(okanjo, window) {\n\n\n    function OkanjoMetrics() {\n\n        this.default_channel = this.channel.external;\n\n        this._queue = [];\n\n        // Generate a page id\n        this.pageId = okanjo.util.shortid();\n\n        var pageArgs = okanjo.util.getPageArguments(true),\n            urlSid = pageArgs[this.msid_key],\n            cookieSid = okanjo.Cookie.get(this.msid_key),\n            sourceContext = pageArgs[this.source_cx],\n            sourceChannel = pageArgs[this.source_ch];\n\n        // If for some reason, both are set, replace the cookie with the uri value (# CORRELATION)\n        if (urlSid && cookieSid && urlSid != cookieSid) {\n            this.trackEvent(this.object_type.metric_session, this.event_type.correlation, {\n                id: urlSid+\"_\"+cookieSid,\n                ch: this.default_channel,\n                _noProcess: true\n            });\n            okanjo.Cookie.set(this.msid_key, urlSid, this.msid_ttl);\n        }\n\n        this.sid = urlSid || cookieSid || null;\n        this.sourceCh = sourceChannel || null;\n        this.sourceCx = sourceContext || null;\n\n        this._lastKey = undefined;\n    }\n\n    OkanjoMetrics.prototype = {\n\n        msid_key: \"ok_msid\",\n        source_cx: \"ok_cx\",\n        source_ch: \"ok_ch\",\n        msid_ttl: 1460,\n\n        strip_meta: ['key','callback','metrics_channel_context','metrics_context','mode'],\n\n        constructor: OkanjoMetrics,\n\n        event_type: {\n            view: 'vw',\n            impression: 'imp',\n            interaction: 'int',\n            correlation: 'cor'\n        },\n\n\n        action: {\n            click: \"click\",\n            inline_click: \"inline_click\"\n        },\n\n\n        object_type: {\n            thirdparty_ad: 'ta',\n            cart: 'ct',\n            page: 'pg',\n            widget: 'wg',\n            product: 'pr',\n            store: 'st',\n            cause: 'ca',\n            marketplace: 'mp',\n            order: 'or',\n            order_item: 'oi',\n            user: 'ur',\n            metric_session: 'mt'\n        },\n\n\n        channel: {\n            product_widget: 'pw',\n            ad_widget: 'aw',\n            store_widget: 'sw',\n            marketplace: 'mp',\n            external: 'ex'\n        },\n\n\n        environment: {\n            live: \"live\",\n            testing: \"testing\"\n        },\n\n\n        /**\n         * Reports an event\n         * @param {string} object_type\n         * @param {string} event_type\n         * @param {{key: string, ea: string, id: string, ch: string, cx: string, url: string, env: string, m: object }} data\n         * @param callback\n         */\n        trackEvent: function(object_type, event_type, data, callback) {\n\n            data = data || {};\n            data.object_type = object_type;\n            data.event_type = event_type;\n\n            // Make the key stick in case future events don't have an API key, we can get a fuzzy idea who's responsible for the event\n            // This is also useful for auto page load events, were there is no key defined at time the event was created\n            this._lastKey = data.key || data.key || (data.m && data.m.key) || okanjo.key || this._lastKey || undefined;\n\n            // Queue the event for publishing\n            this.push(data, callback);\n        },\n\n\n        /**\n         * Reports a page view\n         * @param {{key: string, ea: string, id: string, ch: string, cx: string, url: string, env: string, m: object }} [data]\n         * @param callback\n         */\n        trackPageView: function(data, callback) {\n\n            data = data || {};\n\n            // Set the current page URL as the object id\n            data.id = data.id || window.location.href;\n\n            // Set the context to external unless instructed otherwise\n            data.ch = data.ch || this.default_channel;\n\n            // Track the event\n            this.trackEvent(this.object_type.page, this.event_type.view, data, callback);\n        },\n\n\n        /**\n         * Sends an event\n         * @param event\n         * @param callback\n         */\n        track: function(event, callback) {\n\n            if (!event || typeof event !== \"object\") { console.warn('[Okanjo.Metrics] event object data required'); return; }\n            if (!event.object_type) { console.warn('[Okanjo.Metrics] object_type required'); return; }\n            if (!event.event_type) { console.warn('[Okanjo.Metrics] event_type required'); return; }\n\n            var object_type = event.object_type,\n                event_type = event.event_type;\n\n            delete event.object_type;\n            delete event.event_type;\n\n            this.normalizeEventData(event);\n\n            okanjo.exec(okanjo.getRoute(okanjo.routes.metrics, { object_type: object_type, event_type: event_type }), event, function(err, res) {\n                if (err) { console.warn('[Okanjo.Metrics] Reporting failed', err, res); }\n\n                /*jslint -W030 */\n                callback && (callback(err, res));\n            });\n\n        },\n\n        /**\n         * Normalizes event data for consistency and adds common information to the event\n         * @param event\n         */\n        normalizeEventData: function(event) {\n\n            // Stick the key in there, if not already set\n            event.key = event.key || (event.m && event.m.key) || okanjo.key || this._lastKey || undefined;\n\n            // Stick the publisher session token in there too, if present\n            if (this.sid) {\n                event.sid = this.sid;\n            }\n\n            // Clone the metadata, since it might be a direct reference to a widget property\n            // Deleting properties on the meta object could be very destructive\n            if (event.m) {\n                var meta = {};\n                for(var i in event.m) {\n                    if (event.m.hasOwnProperty(i) && this.strip_meta.indexOf(i) < 0) {\n                        meta[i] = event.m[i];\n                    }\n                }\n                event.m = meta;\n            } else {\n                event.m = {};\n            }\n\n\n            // If we were referred through a particular channel/context, then hold on to that for events emitted by this page\n            if (this.sourceCh || this.sourceCx) {\n                if (this.sourceCh) { event.m.ref_ch = this.sourceCh; }\n                if (this.sourceCx) { event.m.ref_cx = this.sourceCx; }\n            }\n\n            // Automatically attach page load id\n            event.m.pgid = this.pageId;\n\n            // Automatically attach JS build version\n            event.m.ok_ver = okanjo.version;\n\n            // Pass the page's source reference\n            if (document.referrer) {\n                event.ref = document.referrer;\n            }\n        },\n\n\n        ///**\n        // * Generates the full URL to execute to track the metric. Useful for page redirection instead of straight tracking\n        // * @param object_type\n        // * @param event_type\n        // * @param data\n        // * @return {*}\n        // */\n        //getMetricUrl: function(object_type, event_type, data) {\n        //    return okanjo.JSONP.makeUrl({\n        //        url: okanjo.getRoute(okanjo.routes.metrics, { object_type: object_type, event_type: event_type }),\n        //        data: data\n        //    });\n        //},\n\n\n        /**\n         * Update the metric sid to live for 4 years if not present\n         * @param sid\n         */\n        updateSid: function(sid) {\n            if (!this.sid && sid) {\n                this.sid = sid;\n                okanjo.Cookie.set(this.msid_key, sid, this.msid_ttl);\n            }\n        },\n\n\n        /**\n         * Queues an event for publishing\n         * @param event\n         * @param callback\n         */\n        push: function(event, callback) {\n            this._queue.push({ event: event, callback: callback });\n\n            // Start burning down the queue, unless the event says not to\n            if (event._noProcess) {\n                delete event._noProcess;\n            } else {\n                this._processQueue();\n            }\n        },\n\n\n        /**\n         * Processes the event queue\n         * @private\n         */\n        _processQueue: function() {\n            // If the queue is not already being processed, and there's stuff to process, continue sending them\n            if (!this._processTimeout && this._queue.length > 0) {\n                var self = this;\n                this._processTimeout = setTimeout(function() {\n\n                    var item = self._queue.shift();\n                    if (item === undefined) {\n                        // Nothing in the queue, get outta here\n                        self._processTimeout = null;\n                    } else {\n                        // Track the item\n                        self.track(item.event, function(err, res) {\n\n                            // Update / Set the metric sid on the publisher\n                            if (res && res.data && res.data.sid) self.updateSid(res.data.sid);\n\n                            // When the item is done being tracked, iterate to the next metric then fire it's callback if set\n                            self._processTimeout = null;\n                            self._processQueue();\n                            /*jslint -W030 */\n                            item.callback && item.callback(err, res);\n                        });\n                    }\n\n                }, 0);\n            }\n        },\n\n\n        /**\n         * Injects the elements box rectangle coordinates and page size into the given data object\n         * @param element\n         * @param [data]\n         * @return {*|{}}\n         */\n        includeElementInfo: function(element, data) {\n\n            var page = okanjo.util.getPageSize(),\n                size = okanjo.util.getElementPosition(element);\n\n            data = data || {};\n            data.pw = page.w;\n            data.ph = page.h;\n            data.x1 = size.x1;\n            data.y1 = size.y1;\n            data.x2 = size.x2;\n            data.y2 = size.y2;\n\n            return data;\n        },\n\n\n        /**\n         * Injects the viewport rectangle coordinates into the given data object\n         * @param data\n         * @return {*|{}}\n         */\n        includeViewportInfo: function(data) {\n\n            var vp = okanjo.util.getViewportSize(),\n                pos = okanjo.util.getScrollPosition();\n\n            data = data || {};\n\n            data.vx1 = pos.x;\n            data.vy1 = pos.y;\n            data.vx2 = data.vx1+vp.vw;\n            data.vy2 = data.vy1+vp.vh;\n\n            return data;\n        },\n\n        /**\n         * Injects the event information into the given data object\n         * @param event\n         * @param data\n         * @return {*|{}}\n         */\n        includeEventInfo: function(event, data) {\n            var pos = okanjo.util.getEventPosition(event);\n            data.ex = pos.ex;\n            data.ey = pos.ey;\n            return data;\n        },\n\n        /**\n         * Copies a config object and another thing and flattens it\n         * @param config\n         * @param base\n         * @return {{}|*}\n         */\n        copy: function(config, base) {\n            return okanjo.util.flatten(okanjo.util.deepClone(config, base));\n        },\n\n        /**\n         * Ensure that all parameters are less than the data limit\n         * @param data\n         * @return {*}\n         */\n        truncate: function(data) {\n            for(var i in data) {\n                if (data.hasOwnProperty(i) && typeof data[i] === \"string\") {\n                    data[i] = data[i].substr(0, 255);\n                }\n            }\n            return data;\n        }\n    };\n\n    okanjo.metrics = new OkanjoMetrics();\n\n})(okanjo, this);\n\n//noinspection ThisExpressionReferencesGlobalObjectJS,JSUnusedLocalSymbols\n(function(okanjo, window) {\n\n    // Track the page view, but don't send it right away.\n    // Send it in one full second unless something else pushes an event\n    // This way, we have a chance that the api key will be set globally\n    okanjo.metrics.trackPageView({_noProcess:true});\n    setTimeout(function() {\n        okanjo.metrics._processQueue();\n    }, 1000);\n\n})(okanjo || this);\n//noinspection ThisExpressionReferencesGlobalObjectJS,JSUnusedLocalSymbols\n/** Based on https://gist.github.com/mudge/5830382 **/\n(function(okanjo, window) {\n\n    var indexOf = function (haystack, needle) {\n            return haystack.indexOf(needle);\n        },\n\n        /* Polyfill indexOf. */\n        EventEmitter = function () {\n            this.events = {};\n        };\n\n    EventEmitter.prototype.on = function (event, listener) {\n        if (typeof this.events[event] !== 'object') {\n            this.events[event] = [];\n        }\n\n        this.events[event].push(listener);\n    };\n\n    EventEmitter.prototype.removeListener = function (event, listener) {\n        var idx;\n\n        if (typeof this.events[event] === 'object') {\n            idx = indexOf(this.events[event], listener);\n\n            if (idx > -1) {\n                this.events[event].splice(idx, 1);\n            }\n        }\n    };\n\n    EventEmitter.prototype.emit = function (event) {\n        var i, listeners, length, args = [].slice.call(arguments, 1);\n\n        if (typeof this.events[event] === 'object') {\n            listeners = this.events[event].slice();\n            length = listeners.length;\n\n            for (i = 0; i < length; i++) {\n                listeners[i].apply(this, args);\n            }\n        }\n    };\n\n    EventEmitter.prototype.once = function (event, listener) {\n        this.on(event, function g () {\n            this.removeListener(event, g);\n            listener.apply(this, arguments);\n        });\n    };\n\n    okanjo._EventEmitter = EventEmitter;\n    return EventEmitter;\n\n})(okanjo, this);\n//noinspection ThisExpressionReferencesGlobalObjectJS,JSUnusedLocalSymbols\n(function(okanjo, window) {\n\n    var cache = okanjo.Cache,\n\n        WidgetBase = okanjo._Widget = function Widget(element, config) {\n\n            okanjo._EventEmitter.call(this);\n\n            //noinspection JSValidateTypes\n            if (!element || typeof element !== 'object' || element.nodeType === undefined) {\n                throw new Error('Invalid element - must be a valid DOM element');\n            }\n\n            if ((typeof config !== \"undefined\") && (typeof config !== \"object\")) {\n                throw new Error('Invalid configuration, must be an object or nothing at all, got: ' + typeof config);\n            } else {\n                config = config || {};\n            }\n\n            // Generate widget instance id\n            this.instanceId = okanjo.util.shortid();\n\n            this.element = element;\n            this.config = config || { };\n\n            this.configMap = { };\n\n            this.templates = {\n                error: \"okanjo.error\"\n            };\n\n            this.css = { };\n        };\n\n    okanjo.util.inherits(WidgetBase, okanjo._EventEmitter);\n\n    var proto = WidgetBase.prototype;\n\n    proto.widgetName = \"BaseWidget\";\n\n    proto.config = null;\n    proto.use_cache = false;\n    proto.cache_key_prefix = 'ok_widget_';\n    proto.cache_ttl = 60000;\n    proto.cacheKeyAttributes = 'id'.split(','); // Parameters to compile to generate the cache key\n\n    /**\n     * Loads the widget\n     */\n    proto.init = function() {\n\n        // Parse the final widget instance configuration\n        this.parseConfiguration();\n\n        // Override template names if given as parameters\n        this.processTemplateOverrides();\n\n        // Make sure that the templates specified are present to render the widget\n        this.ensureTemplates();\n\n        // Ensure we have a widget key or bail out if we don't\n        if (!this.findWidgetKey()) return;\n\n        // Run the widget's main init logic, and  bail if needed\n        if (!this.load()) return;\n\n        // Async clean the cache, if needed\n        this.autoCleanCache();\n    };\n\n\n    /**\n     * Does some magic to try to track down the widget key to use for requests\n     * @returns {boolean}\n     */\n    proto.findWidgetKey = function() {\n\n        // Attempt to locate the proper widget key to use for this instance\n        if (!okanjo.util.empty(this.config.key)) {\n            // Use the key given in the widget instance configuration\n            this.key = this.config.key;\n            this.config.key = this.key;\n            return true;\n        } else if (!okanjo.util.empty(okanjo.key)) {\n            // Use the key on the okanjo instance if specified\n            this.key = okanjo.key;\n            this.config.key = this.key;\n            return true;\n        }\n\n        // Still no key?\n        if(!okanjo.util.empty(this.key)) {\n            this.element.innerHTML = okanjo.mvc.render(this.templates.error, this, { message: 'Missing Okanjo key.' });\n            okanjo.report(this.widgetName, 'Missing key. Define one using okanjo.configure or pass the key parameter as an option in the '+this.widgetName+' constructor');\n            return false;\n        } else {\n            this.config.key = this.key;\n            return true;\n        }\n    };\n\n\n    /**\n     * Check for configuration parameters that start with template_ and css_, and replace the template and css templates where specified.\n     */\n    proto.processTemplateOverrides = function() {\n\n        var m;\n        for (var i in this.config) {\n            if (this.config.hasOwnProperty(i)) {\n\n                // Check for template override\n                m = i.match(/^template_(.+)$/);\n                //noinspection JSUnresolvedFunction\n                if (m !== null && this.templates.hasOwnProperty(m[1])) {\n                    this.templates[m[1]] = this.config[i];\n                } else {\n                    // Check for css override\n                    m = i.match(/^css_(.+)$/);\n                    //noinspection JSUnresolvedFunction\n                    if (m !== null && this.css.hasOwnProperty(m[1])) {\n                        this.css[m[1]] = this.config[i];\n                    }\n                }\n\n            }\n        }\n\n    };\n\n\n    /**\n     * Make sure that a set of templates have been defined\n     */\n    proto.ensureTemplates = function() {\n        var templates = this.templates,\n            css = this.css,\n            key;\n        for (key in templates) {\n            //noinspection JSUnresolvedFunction\n            if (templates.hasOwnProperty(key)) {\n                if (!okanjo.mvc.isTemplateRegistered(templates[key])) throw new Error('[Okanjo.'+this.widgetName+'] Missing template: ' + templates[key] + \". Did you forget to include the template?\");\n            }\n        }\n        for (key in css) {\n            //noinspection JSUnresolvedFunction\n            if (css.hasOwnProperty(key)) {\n                if (!okanjo.mvc.isCssRegistered(css[key])) throw new Error('[Okanjo.'+this.widgetName+'] Missing css block: ' + css[key] + \". Did you forget to include the css template?\");\n            }\n        }\n    };\n\n\n    /**\n     * Parses the widget configuration by merging data attributes on top of the base configuration given in the constructor\n     */\n    proto.parseConfiguration = function() {\n        //noinspection JSUnresolvedVariable\n        var attributes = okanjo.util.data(this.element);\n\n        okanjo.util.copyIfSetMap(this.config, attributes, this.configMap, { stripEmpty: true });\n    };\n\n\n    /**\n     * Core widget loader. Override this!\n     * @returns {boolean}\n     */\n    proto.load = function() {\n\n        // TODO - override this on the actual wideget implementation\n\n        return true;\n    };\n\n\n    /**\n     * Async cleans the widget cache\n     */\n    proto.autoCleanCache = function() {\n        if (this.use_cache) {\n            var self = this;\n            setTimeout(function () {\n                self.cleanCache();\n            }, 2000);\n        }\n    };\n\n\n    /**\n     * If no canonical url or text was given in the configuration, this method will return the current page url to use\n     * It will not be very nice, and will just use the path. Query string and fragment will be stripped\n     * @returns {string} - The URL of the current page to have Okanjo analyze\n     */\n    proto.getCurrentPageUrl = function() {\n\n        // While we're at it, let's escape fragments too (#fun)\n        //var url = window.location.href,\n        //    hashBangIndex = url.indexOf('#!'),\n        //    hashIndex = hashBangIndex >= 0 ? hashBangIndex : url.indexOf('#');\n        //\n        //if (hashIndex >= 0) {\n        //    var uri = url.substring(0, hashIndex),\n        //        fragment = encodeURIComponent(url.substring(hashIndex + (hashBangIndex >= 0 ? 2 : 1)));\n        //    url = uri + (uri.indexOf('?') >= 0 ? '&' : '?') + '_escaped_fragment_=' + fragment;\n        //}\n\n        // On second thought, we're not so nice\n        var href = window.location.href,\n            candidatePos = [href.indexOf('?'), href.indexOf('#')].filter(function(pos) { return pos >= 0; }),\n            stopPos = candidatePos.length > 0 ? Math.min.apply(null, candidatePos) : -1;\n\n        return stopPos > 0 ? href.substr(0, stopPos) : href;\n    };\n\n\n    /**\n     * Generates a new cache key unique to the configuration of this widget instance\n     * @returns {string}\n     */\n    proto.getCacheKey = function() {\n        var parts = [window.location.host + window.location.pathname], keys = this.cacheKeyAttributes;\n        for(var i = 0; i < keys.length; i++) {\n            if (this.config[keys[i]] !== undefined) {\n                parts.push(keys[i], this.config[keys[i]]);\n            }\n        }\n        return this.cache_key_prefix+okanjo.util.hash(parts.join(';'));\n    };\n\n\n    /**\n     * Purges expired keys from the cache\n     */\n    proto.cleanCache = function() {\n        try {\n            var now = (new Date()).getTime(), expireKeys = [], safeExpireKeys = [];\n            for (var i = 0; i < cache.length; i++) {\n                var key = cache.key(i);\n                if (key.indexOf(this.cache_key_prefix) === 0 && key.indexOf('_expires') < 0) { // Ignore _expires keys\n\n                    // Look for an expirey\n                    var expires = cache.getItem(key+\"_expires\");\n                    if (expires !== null && now < parseInt(expires)) {\n                        // Save the key!\n                        safeExpireKeys.push(key+\"_expires\");\n                    } else {\n                        // Check if the expires\n                        cache.removeItem(key);\n                        cache.removeItem(key + \"_expires\");\n                    }\n                } else if (key.indexOf('_expires') >= 0) {\n                    expireKeys.push(key);\n                }\n            }\n\n            for (i = 0; i < expireKeys.length; i++) {\n                if (safeExpireKeys.indexOf(expireKeys[i]) < 0) {\n                    cache.removeItem(expireKeys[i]);\n                }\n            }\n\n        } catch (e) {\n            okanjo.report(this.widgetName, e);\n        }\n    };\n\n\n    /**\n     * Pull a key from the cache, if it has not expired yet\n     * @returns boolean – The value of what was cached, or null if nothing\n     */\n    proto.loadFromCache = function(cacheKey) {\n        // Check if items are cached, and if we should use them\n        try {\n            var val = cache.getItem(cacheKey),\n                expires = cache.getItem(cacheKey+\"_expires\"),\n                now = (new Date()).getTime();\n\n            // Make sure exists and has not expired\n            if (val !== null && expires !== null && now < parseInt(expires)) {\n                return JSON.parse(val);\n            } else {\n                // Purge if expired\n                cache.removeItem(cacheKey);\n                cache.removeItem(cacheKey + \"_expires\");\n            }\n        } catch (e) {\n            okanjo.report(this.widgetName, e);\n        }\n\n        return null;\n    };\n\n\n    /**\n     * Save a key to the cache\n     * @param cacheKey\n     * @param obj\n     */\n    proto.saveInCache = function(cacheKey, obj) {\n\n        // Async save it, don't block for stringify\n        var self = this;\n        setTimeout(function() {\n            cache.setItem(cacheKey, JSON.stringify(obj));\n            cache.setItem(cacheKey+\"_expires\", (new Date()).getTime() + self.cache_ttl);\n        }, 100);\n\n    };\n\n    return okanjo._Widget;\n\n})(okanjo, this);\n//noinspection ThisExpressionReferencesGlobalObjectJS,JSUnusedLocalSymbols\n(function(okanjo, window) {\n\n    /*\n\n     div .modal-container .fade-out .hidden\n     | div .modal-window .clearfix\n     | |\n     | | div .modal-window-skin\n     | | | div .modal-window-outer\n     | | | | div .modal-window-inner\n     | | | | | iframe .okanjo-inline-buy-frame\n     | | | | /div\n     | | | /div\n     | | /div\n     | |\n     | | div .close-button\n     | | | ×\n     | | /div\n     | |\n     | /div\n     /div\n\n     */\n\n    var initialized = false,\n        scrollY = null,\n        isMobile = !!navigator.userAgent.match(/iphone|android|blackberry/ig) || false,\n\n        // Selectors\n        $html, $body, $modalContainer, $modalWindow, $modalSkin, $modalOuter, $modalInner, $modalClose, $modalFrame,\n\n        createElements = function() {\n\n            // Page elements\n            //noinspection JSUnresolvedFunction\n            $html = okanjo.qwery('html')[0];\n            //noinspection JSUnresolvedFunction\n            $body = okanjo.qwery('body')[0] || document.body;\n\n            // Modal elements\n            $modalContainer = document.createElement('div');\n            $modalWindow = document.createElement('div');\n            $modalSkin = document.createElement('div');\n            $modalOuter = document.createElement('div');\n            $modalInner = document.createElement('div');\n            $modalClose = document.createElement('div');\n            $modalFrame = document.createElement('iframe');\n\n            $modalContainer.setAttribute('class', 'okanjo-modal-container okanjo-modal-hidden ' + okanjo.util.detectClasses().join(' '));\n            $modalWindow.setAttribute('class', 'okanjo-modal-window');\n            $modalSkin.setAttribute('class', 'okanjo-modal-window-skin');\n            $modalOuter.setAttribute('class', 'okanjo-modal-window-outer');\n            $modalInner.setAttribute('class', 'okanjo-modal-window-inner');\n            $modalClose.setAttribute('class', 'okanjo-modal-close-button');\n\n            $modalFrame.setAttribute('class', 'okanjo-inline-buy-frame');\n            $modalFrame.setAttribute('frameborder', '0');\n            $modalFrame.setAttribute('vspace', '0');\n            $modalFrame.setAttribute('hspace', '0');\n            $modalFrame.setAttribute('webkitallowfullscreen', '');\n            $modalFrame.setAttribute('mozallowfullscreen', '');\n            $modalFrame.setAttribute('allowfullscreen', '');\n            $modalFrame.setAttribute('scrolling', 'auto');\n\n            $modalClose.innerHTML = '×';\n\n            // Create the modal element tree\n            $modalInner.appendChild($modalFrame);\n            $modalOuter.appendChild($modalInner);\n            $modalSkin.appendChild($modalOuter);\n            $modalWindow.appendChild($modalSkin);\n            $modalWindow.appendChild($modalClose);\n            $modalContainer.appendChild($modalWindow);\n\n            // Add the modal stuff to the body\n            $body.appendChild($modalContainer);\n        },\n\n        bindEvents = function() {\n\n            // If the device orientation changes, adjust the modal view port\n            addListener(window, 'orientationchange', function() {\n                for (var t = 0; t < 2; t++) {\n                    setTimeout(handleReposition, 1000 * t + 10);\n                }\n            });\n\n            // If the window changes size, also adjust the modal view port\n            addListener(window, 'resize', function() {\n                setTimeout(handleReposition, 100);\n            });\n\n            // Click the overlay to close the modal\n            addListener($modalContainer, 'click', closeModal);\n\n            // If you click in the modal, don't close it!\n            addListener($modalWindow, 'click', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n            });\n\n            // Click the close button to close it\n            addListener($modalClose, 'click', function(e) {\n\n                // Don't close it twice\n                e.preventDefault();\n                e.stopPropagation();\n\n                closeModal();\n            });\n\n        },\n\n        addListener = function(el, event, handler) {\n            if (el.addEventListener) {\n                el.addEventListener(event, handler, false);\n            } else {\n                el.attachEvent(\"on\" + event, handler);\n            }\n        },\n\n        //removeListener = function(el, event, handler) {\n        //    if (el.removeEventListener) {\n        //        el.removeEventListener(event, handler);\n        //    } else {\n        //        el.detachEvent(\"on\" + event, handler);\n        //    }\n        //},\n\n        addClass = function(el, name) {\n            el.className += \" \" + name;\n        },\n\n        removeClass = function(el, name) {\n            el.className = el.className.replace(new RegExp(' *?'+name), '');\n        },\n\n        getWindowHeight = function() {\n            return window.innerHeight || document.documentElement.clientHeight;\n        },\n\n        handleReposition = function() {\n            scrollY = okanjo.util.getScrollPosition().y;\n            //$modalWindow.style.marginTop = scrollY + 40 + \"px\";\n            $modalWindow.style.height = (getWindowHeight() - 80) + \"px\";\n        },\n\n        openModal = function() {\n\n            scrollY = document.body.scrollTop;\n\n            removeClass($modalContainer, 'okanjo-modal-hidden');\n            addClass($modalContainer, 'okanjo-modal-fade-out');\n\n            handleReposition();\n\n            addClass($html, \"okanjo-modal-active\");\n\n            if (!isMobile) {\n                addClass($html, \"okanjo-modal-margin-fix\");\n            }\n\n            setTimeout(function() {\n                removeClass($modalContainer, 'okanjo-modal-fade-out');\n            }, 10);\n\n            // Click the overlay to close the modal\n            //addListener($body, 'click', closeModal);\n\n        },\n\n        closeModal = function() {\n            addClass($modalContainer, 'okanjo-modal-fade-out');\n\n            setTimeout(function() {\n                removeClass($modalContainer, 'okanjo-modal-fade-out');\n                addClass($modalContainer, \"okanjo-modal-hidden\");\n\n                removeClass($html, \"okanjo-modal-active\");\n                if (!isMobile) {\n                    removeClass($html, \"okanjo-modal-margin-fix\");\n                }\n            }, 210);\n\n            // Click the overlay to close the modal\n            //removeListener($body, 'click', closeModal);\n        },\n\n\n        /**\n         * Insert an element or markup into the modal\n         * @param content\n         */\n        setContent = function(content) {\n\n            // Remove existing content\n            $modalInner.innerHTML = \"\";\n\n            // Insert new content\n            if (typeof content === \"string\") {\n                $modalInner.innerHTML = content;\n            } else {\n                $modalInner.appendChild(content);\n            }\n        };\n\n\n    // Expose the modal functions\n    okanjo.modal = {\n\n        show: function(content) {\n\n            if (!initialized) {\n                initialized = true;\n                createElements();\n                bindEvents();\n            }\n\n            setContent(content);\n            openModal();\n        },\n\n        hide: function() {\n            closeModal();\n        }\n\n    };\n\n    return okanjo.modal;\n\n})(okanjo, this);\n//noinspection ThisExpressionReferencesGlobalObjectJS,JSUnusedLocalSymbols\n(function(okanjo, window) {\n\n\n    /**\n     * Okanjo Product\n     * @param element - DOM element to attach the output to\n     * @param {*} [config] - Optional base widget configuration object, element data attributes will override these\n     * @constructor\n     */\n    function Product(element, config) {\n        okanjo._Widget.call(this, element, config);\n\n        this.items = [];\n        this.config = config = config || {\n            mode: Product.contentTypes.browse, // Default to browse\n            use_cache: false,\n            cache_ttl: 60000\n        };\n\n        // Param to stop the URL nagging if none is given\n        this.config.nag = config.nag === undefined ? true : config.nag === true;\n\n        // Set default caching settings\n        this.config.use_cache = config.use_cache === undefined ? false : config.use_cache === true;\n        this.config.cache_ttl = config.cache_ttl === undefined ? 60000 : config.cache_ttl;\n        this.disable_popup = config.disable_popup === true;\n        this.use_cache = this.config.use_cache;\n        this.cache_ttl = this.config.cache_ttl;\n        this.proxy_url = null;\n\n        // Allow changing the metrics context, e.g. embedded in an Ad widget\n        this.config.metrics_context = config.metrics_context === undefined ? \"pw\" : config.metrics_context;\n        this.config.metrics_channel_context = config.metrics_channel_context === undefined ? null : config.metrics_channel_context;\n\n        // Option to ignore inline buy functionality\n        this.disable_inline_buy = this.config.disable_inline_buy === undefined ? false : config.disable_inline_buy === true;\n\n        this.cache_key_prefix = 'ok_product_block_';\n\n        this.templates = {\n            product_error: \"okanjo.error\",\n            product_main: \"product.block\"\n        };\n\n        this.css = {\n            product_main: \"product.block\",\n            product_modal: \"okanjo.modal\"\n        };\n\n        this.configMap = {\n\n            // Api Widget Key\n            key: \"key\",\n\n            // Widget mode\n            mode: \"mode\", // What provider to use to retrieve products, browse, sense or single, default: browse\n            disable_inline_buy: \"disable-inline-buy\", // Whether to disable inline buy functionality, default: false\n            proxy_url: \"proxy-url\", // 3rd party click through tracking url\n\n            // ProductSense Params\n            url: \"url\",  // The URL to digest\n            selectors: \"selectors\", // CSV of page element selectors, default: p,title,meta[name=\"description\"],meta[name=\"keywords\"]\n            url_category: \"url-category\", // Article taxonomy (e.g. news, sports, lifestyles, etc)\n\n            // Search Params (Filters)\n\n            id: \"id\", // The specific product ID to fetch (single mode), default: null\n\n            q: \"q\", // Search query text\n\n            marketplace_status: ['marketplace-status'], // Option to switch to testing product pool, default: live\n            marketplace_id: ['marketplace-id'], // Limit products listed under the given marketplace, default: null\n\n            pools: 'pools', // Limit products to one or more pools (CSV), default: global\n\n            external_id: \"external-id\", // Vendor-given ID\n            sku: \"sku\", // Vendor stock keeping unit\n\n            sold_by: 'sold-by', // Limit products listed by a certain store, default: null\n            external_store_id: \"external-store-id\", // Limit products to a vendor-given store ID\n\n            min_price: \"min-price\", // Products with price greater-than or equal to this amount\n            max_price: \"max-price\", // Products with price less-than or equal to this amount\n            condition: \"condition\", // Condition of the product (e.g. new, used, refurbished, unspecified)\n            manufacturer: \"manufacturer\", // Who made the product\n            upc: \"upc\", // UPC code\n            isbn: \"isbn\", // ISBN number\n            tags: \"tags\", // CSV list of tags\n            category: \"category\", // CSV list of categories (in order)\n\n            min_donation_percent: \"min-donation-percent\", // Minimum donation amount: default: 0 (between 0 and 1)\n            max_donation_percent: \"max-donation-percent\", // Maximum donation amount: default: 1 (between 0 and 1)\n            donation_to: \"donation-to\", // The name of the non-profit that benefits from the purchase\n\n            suboptimal: 'suboptimal', // Option to enable products labeled as suboptimal (e.g. products that have weak descriptions and could come back as false matches)\n            backfill: 'backfill', // Option to allow placing a display ad in the event no products are returned.\n\n            // Pagination\n            skip: ['skip', 'page-start'], // The index of the result set to start at, starting from 0. default: 0\n            take: ['take', 'page-size'], // The number of products to return, default: 5\n\n            expandable: 'expandable', // Indicates whether the inline_buy experience is allowed to expand outside the bounds of the widget. Default: true\n\n            // Override template names\n            template_product_main: 'template-product-main', // The product template to render, default: product.block\n            template_product_error: 'template-product-error', // The product error template to render, default: okanjo.error\n\n            // template customization options\n            size: \"size\", // the product container size\n            template_layout: \"template-layout\",  // Products displayed as grid or list, default grid, size can override this\n            template_theme: \"template-theme\", // Typographic theme, either newsprint or modern, default: modern\n            template_cta_style: \"template-cta-style\", // The CTA button visual style. Can be button or link, links will take less space.\n            template_cta_text: \"template-cta-text\", // The text within the CTA button, will be css-truncated if too long for given layout, default: Shop Now\n            template_cta_color: \"template-cta-color\" // The color of text of the CTA button or link, default: 0099ff.\n        };\n\n        // Initialize unless told not to\n        //noinspection JSUnresolvedVariable\n        if (!config.no_init) {\n            //noinspection JSUnresolvedFunction\n            this.init();\n        }\n    }\n\n    okanjo.util.inherits(Product, okanjo._Widget);\n\n\n    Product.contentTypes = {\n        browse: \"browse\",\n        sense: \"sense\",\n        single: \"single\"\n    };\n\n    var proto = Product.prototype;\n\n    proto.widgetName = \"Product\";\n\n    // Parameters to compile to generate the cache key\n    proto.cacheKeyAttributes = 'mode,url,selectors,text,id,q,marketplace_status,marketplace_id,external_id,sku,sold_by,min_price,max_price,condition,manufacturer,upc,isbn,tags,category,min_donation_percent,max_donation_percent,donation_to,suboptimal,skip,take'.split(',');\n\n    /**\n     * Loads the widget content onto the page\n     */\n    proto.load = function() {\n\n        // Check if the product ID is set or is running in single mode\n        if (this.config.id || this.config.mode == Product.contentTypes.single) {\n            // Override mode if the ID is set or not set\n            if (okanjo.util.empty(this.config.id)) {\n                this.config.mode = Product.contentTypes.browse;\n            } else {\n                this.config.mode = Product.contentTypes.single;\n            }\n\n            // If in sense mode, ensure the URL param is set\n        } else if (this.config.url || this.config.text || this.config.mode == Product.contentTypes.sense) {\n            // Require url or text attributes\n            if (okanjo.util.empty(this.config.url) && okanjo.util.empty(this.config.text)) {\n                this.config.url = this.getCurrentPageUrl();\n                // Nag since we had to derive a URL from the window\n                if (this.config.nag) {\n                    console.info('[Okanjo.'+this.widgetName+'] No canonical url given for ProductSense. We recommend using a canonical url to ensure page visibility by Okanjo. Using derived url:', this.config.url);\n                }\n            }\n            this.config.mode = Product.contentTypes.sense;\n            this.config.take = this.config.take || 5; // Default the take to ensure an upper-bound is set\n        } else {\n            // Make sure a mode is always set, and cannot be empty\n            this.config.mode = okanjo.util.empty(this.config.mode) ? Product.contentTypes.browse : this.config.mode;\n        }\n\n        // Check for CSV values and convert to an array\n        (function(configNames){\n            for(var i = 0; i < configNames.length; i++) {\n                //noinspection JSPotentiallyInvalidUsageOfThis\n                var val = this.config[configNames[i]];\n                if (val && typeof val === \"string\" /*&& val.indexOf(',') >= 0*/) {\n                    //noinspection JSPotentiallyInvalidUsageOfThis\n                    this.config[configNames[i]] = val.split(',');\n                }\n            }\n        }).call(this, ['pools','tags','category']);\n\n        // Set the metric context to the product mode, if not already set\n        if (this.config.metrics_channel_context === null) {\n            this.config.metrics_channel_context = this.config.mode;\n        }\n\n        // Set the proxy url, if present\n        if (this.config.proxy_url) {\n            this.proxy_url = this.config.proxy_url;\n\n            // Don't send this (probably gigantic) url on jsonp requests\n            delete this.config.proxy_url;\n        }\n\n        // Build the base metric data for events from this widget\n        // Generate metric url for this type\n        this.metricBase = {\n            // id: 'APPLIED IN TEMPLATE',\n            ch: this.config.metrics_context,\n            cx: this.config.metrics_channel_context || this.config.mode,\n            key: this.config.key,\n            m: {\n                //ok_ver: 'COMES FROM NORMALIZATION',\n                //pgid: 'COMES FROM NORMALIZATION',\n                //bf: 'APPLIED IN TEMPLATE',\n                wgid: this.instanceId\n            }\n        };\n\n        // Immediately show products from the local browser cache, if present, for immediate visual feedback\n        if (this.config.use_cache && this.loadProductsFromCache()) {\n            // Loaded from cache successfully!\n            // Notify integrations that the widget loaded\n            this.emit('load', { fromCache: true });\n        } else {\n            this.getProducts();\n        }\n\n        // Verify the disable param is not a string\n        if (this.config.disable_inline_buy && typeof this.config.disable_inline_buy === \"string\") {\n            this.disable_inline_buy = this.config.disable_inline_buy.toLowerCase() === \"true\";\n        }\n\n        // Track widget impression\n        if (this.config.metrics_context == okanjo.metrics.channel.product_widget) {\n            var eventData = okanjo.util.deepClone(this.metricBase, {});\n            eventData.m = okanjo.metrics.truncate(okanjo.metrics.copy(this.config, okanjo.metrics.includeElementInfo(this.element, eventData.m)));\n            okanjo.metrics.trackEvent(okanjo.metrics.object_type.widget, okanjo.metrics.event_type.impression, eventData);\n        }\n\n        return true;\n    };\n\n\n    /**\n     * Immediately show products from the local browser cache, if present\n     * @returns boolean – True if products were successfully loaded from the cache, false if not\n     */\n    proto.loadProductsFromCache = function() {\n\n        var items = this.loadFromCache(this.getCacheKey());\n        if (items !== null) {\n            this.items = items;\n            this.showProducts(this.items);\n            return true;\n        } else {\n            return false;\n        }\n\n    };\n\n\n    /**\n     * Execute the Product request to Okanjo to get some product tile markup\n     */\n    proto.getProducts = function() {\n        var self = this, count;\n        this.executeSearch(function(err, res) {\n            if (err) {\n                // Can't show anything, just render a generic error message\n                console.error('[Okanjo.'+self.widgetName+'] Failed to retrieve products.', err);\n                self.element.innerHTML = okanjo.mvc.render(self.templates.product_error, self, { message: 'Could not retrieve products.' });\n                self.emit('error', err);\n            } else {\n\n                // Hook on empty\n                count = (res.data||[]).length;\n                if (count === 0) self.emit('empty');\n\n                // Check for adx backfill scenario, if allowed\n                if (res.backfillADX) {\n\n                    // Replace content with backfill from adx\n                    self.backfillAd();\n\n                } else {\n\n                    // Store the products array locally\n                    self.items = res.data;\n                    self.numFound = res.numFound;\n                    self.articleId = res.articleId;\n                    self.placementTest = res.placementTest;\n                    self.shorted = self.config.mode == Product.contentTypes.sense && self.config.take > count;\n\n                    // Update the base metric data with new new information\n                    if (self.articleId) self.metricBase.m.aid = self.articleId;\n                    self.metricBase.m.pten = (self.placementTest && self.placementTest.enabled) ? '1' : '0';\n                    if (self.placementTest) {\n                        if (self.placementTest.id) self.metricBase.m.ptid = self.placementTest.id;\n                        if (self.placementTest.seed) self.metricBase.m.ptseed = self.placementTest.seed;\n                    }\n\n                    // Allow hooks when the response returns from the server\n                    self.emit('data', res);\n\n                    // Render the products\n                    self.showProducts(self.items);\n\n                    // If cache is enabled and placement testing is not applicable\n                    if (!self.shorted && self.use_cache && (!self.placementTest || (self.placementTest && !self.placementTest.enabled))) {\n                        // Cache the products for next page load so something loads up right away until refreshed\n                        var key = self.getCacheKey();\n                        self.saveInCache(key, self.items);\n                    }\n\n                    // Allow hooks when the product widget finishes initialization\n                    self.emit('load', {fromCache: false});\n                }\n            }\n        });\n    };\n\n\n    /**\n     * Performs a JSONP request to the API to get the desired products\n     * @param {function(err:*, res:*)} callback – Closure to fire when completed\n     */\n    proto.executeSearch = function(callback) {\n        var config = okanjo.util.deepClone(this.config);\n        if (this.config.mode === Product.contentTypes.sense) {\n            okanjo.exec(okanjo.getRoute(okanjo.routes.products_sense), config, callback);\n        } else if (this.config.mode === Product.contentTypes.single) {\n            okanjo.exec(okanjo.getRoute(okanjo.routes.products_id, { product_id: this.config.id }), config, function(err, res) {\n                if (!err && res && res.data) {\n                    res.data = [ res.data ];\n                }\n                if (callback) callback(err, res);\n            });\n        } else {\n            okanjo.exec(okanjo.getRoute(okanjo.routes.products), config, callback);\n        }\n    };\n\n\n    /**\n     * Manipulates the item data to keep or remove inline_buy URLs.\n     */\n    proto.handleInlineBuyOption = function() {\n        // If we should ignore the inline buy functionality, strip the data off the products\n        if (this.disable_inline_buy) {\n            for (var i = 0; i < this.items.length; i++) {\n                this.items[i].inline_buy_url = null;\n            }\n        }\n    };\n\n\n    /**\n     * Displays the products results\n     * @param {[*]} data - The array of products\n     */\n    proto.showProducts = function(data) {\n\n        // Handle the inline buy configuration option\n        this.handleInlineBuyOption();\n\n        // Render the product content!\n        this.element.innerHTML = okanjo.mvc.render(this.templates.product_main, this, {\n            products: data || this.items || [],\n            config: this.config\n        });\n\n        this.bindEvents();\n    };\n\n\n    /**\n     * Builds the final frame url to use, given the base, url, and params to tack on\n     * @param eventData – Metric event data\n     * @param inline – Inline buy URL\n     * @param proxy – The vendor given url to redirect to, after we've tracked the interaction, which should redirect to the buy_url\n     * @param params – Additional params to tack on to the inline buy URL\n     * @returns {string} – Final frame url\n     */\n    function makeClickThroughUrl(eventData, inline, proxy, params) {\n\n        var pairs = [],\n            i,\n            joiner = (inline.indexOf('?') < 0 ? '?' : '&'),\n            buy_url;\n\n        for (i in params) {\n            if (params.hasOwnProperty(i)) {\n                pairs.push(i+\"=\"+encodeURIComponent(params[i]));\n            }\n        }\n\n        // Normalize the event data\n        okanjo.metrics.normalizeEventData(eventData);\n\n        // Cache buster\n        eventData.n = (new Date()).getTime();\n\n        // Build buy url\n        buy_url = inline + (pairs.length > 0 ? (joiner + pairs.join('&')) : \"\");\n\n        // If we're relaying through a proxy tracker, then build the link accordingly\n        if (proxy) {\n            eventData.u = proxy + encodeURIComponent(buy_url);\n        } else {\n            eventData.u = buy_url;\n        }\n\n        // Convert event to url\n        return okanjo.JSONP.makeUrl({\n            url: okanjo.getRoute(okanjo.routes.metrics, {\n                object_type: okanjo.metrics.object_type.product,\n                event_type: okanjo.metrics.event_type.interaction\n            }),\n            data: eventData\n        });\n    }\n\n\n    /**\n     * Handle user interaction with the product tile\n     * @param e – User interaction DOM event\n     * @param trigger – Whether to trigger the click event or not on the link\n     */\n    Product.interactTile = function(e, trigger) {\n\n        var container = this.parentNode.parentNode,\n            eventData = JSON.parse(container.getAttribute('data-metric-json')),\n            expandable = container.getAttribute('data-expandable'),\n            disablePopup = container.getAttribute('data-disable-popup') || false,\n            backfill = this.getAttribute('data-backfill'),\n            buyUrl = this.getAttribute('data-buy-url'),\n            inline = this.getAttribute('data-inline-buy-url'),\n            proxyUrl = this.getAttribute('data-proxy-url'),\n            url,\n            inlineParams = {},\n            expanded = false,\n            nativeBuy = !okanjo.util.empty(inline),\n            doPopup = disablePopup ? false : (okanjo.util.isMobile() && nativeBuy),\n            passThroughParams = \"ok_msid=\" + okanjo.metrics.sid + '&ok_ch=' + eventData.ch + '&ok_cx=' + eventData.cx,\n            modifiedBuyUrl = buyUrl + (buyUrl.indexOf('?') < 0 ? '?' : '&') + passThroughParams,\n            modifiedInlineBuyUrl = inline + (inline.indexOf('?') < 0 ? '?' : '&') + passThroughParams;\n\n        // Add product / positional meta data\n        eventData.id = this.getAttribute('data-id');\n        eventData.m = okanjo.metrics.includeEventInfo(e, okanjo.metrics.includeViewportInfo(okanjo.metrics.includeElementInfo(this, eventData.m)));\n\n        // Show a new window on applicable devices instead of a native buy experience\n        if (doPopup) {\n\n            //\n            // Mobile devices (especially iOS) have real janky UX when interacting with iframes.\n            // So, we'll choose to popup a window with the native buy experience, so we can ensure\n            // a positive user experience. Nobody likes bouncy form fields and really weird zooming.\n            //\n\n            // Tell the buy experience that we're loading up in a popup, so they can render that nicely\n            eventData.ea = okanjo.metrics.action.inline_click;\n            eventData.m.popup = 'true';\n            url = makeClickThroughUrl(eventData, modifiedInlineBuyUrl, proxyUrl, { popup: 1 });\n\n            okanjo.active_frame = window.open(url, \"okanjo-inline-buy-frame\", \"width=400,height=400,location=yes,resizable=yes,scrollbars=yes\");\n            if (!okanjo.active_frame) {\n\n                console.error('Popup blocker prevented new inline-buy experience from being displayed');\n\n                // fallback to an anchor click using the inline buy url\n                this.href = url;\n\n            } else {\n                e.preventDefault();\n            }\n\n        } else if (nativeBuy) {\n\n            //\n            // Native/Inline Buy (buy on the page)\n            // All the conditions are right to embed the inline buy experience right here, right now.\n            // Whip up a new iframe with the target url and either show it as a modal or confine it to the widget space\n            //\n\n            e.preventDefault();\n\n            var frame = document.createElement('iframe'),\n                frameAttributes = {\n                    'class': 'okanjo-inline-buy-frame',\n                    frameborder: 0,\n                    vspace: 0,\n                    hspace: 0,\n                    webkitallowfullscreen: '',\n                    mozallowfullscreen: '',\n                    allowfullscreen: '',\n                    scrolling: 'auto'\n                };\n\n            for (var i in frameAttributes) {\n                if (frameAttributes.hasOwnProperty(i)) {\n                    frame.setAttribute(i, frameAttributes[i]);\n                }\n            }\n\n            // By default, we assume we're going to modal, which is an expandable\n            inlineParams.expandable = 1;\n\n            // Now check if we should not actually be expanding\n            if (expandable !== undefined && expandable.toLowerCase() === \"false\") {\n\n                //\n                // Non-expandable: Per IAB, we should not expand the ad content past the bounds of the ad unit\n                // So, confine the iframe to the bounds of the ad.\n                //\n\n                // Locate the parent ad container and attempt to shove the frame in there\n                // If it fails to do so, then resort to a modal, since expandable was set not on an ad, de72qw2227.\n                var candidate = this, parent = null;\n                while(candidate) {\n                    candidate = candidate.parentNode;\n                    if (candidate && candidate.className && candidate.className.indexOf('okanjo-expansion-root') >= 0) {\n                        parent = candidate;\n                    }\n                }\n\n                // If we have the parent ad unit container, then stick it in there, otherwise let it fallback to a modal\n                if (parent) {\n                    frame.className += \" okanjo-ad-in-unit\";\n                    frame.setAttribute('height', \"100%\");\n                    frame.setAttribute('width', \"100%\");\n\n                    parent.appendChild(frame);\n                    expanded = true;\n\n                    // Provide the buy experience some context information\n                    var size = okanjo.util.getElementSize(parent);\n                    inlineParams.expandable  = 0;\n                    inlineParams.frame_height = size.height;\n                    inlineParams.frame_width  = size.width;\n                    inlineParams.ad_size = parent.getAttribute('data-size') || \"undefined\";\n                }\n            }\n\n            eventData.ea = okanjo.metrics.action.inline_click;\n            eventData.m.expandable = (inlineParams.expandable === 1 ? 'true' : 'false');\n            url = makeClickThroughUrl(eventData, modifiedInlineBuyUrl, proxyUrl, inlineParams);\n\n            frame.src = url;\n\n            if (!expanded) {\n                okanjo.modal.show(frame);\n            }\n\n        } else if (trigger) {\n            eventData.ea = okanjo.metrics.action.click;\n            this.href = makeClickThroughUrl(eventData, modifiedBuyUrl, proxyUrl, {});\n            this.click();\n        } else {\n            eventData.ea = okanjo.metrics.action.click;\n            this.href = makeClickThroughUrl(eventData, modifiedBuyUrl, proxyUrl, {});\n        }\n    };\n\n\n    /**\n     * Binds event listeners to the anchor elements in the product widgets\n     */\n    proto.bindEvents = function() {\n\n        var self = this;\n\n        //noinspection JSUnresolvedFunction\n        okanjo.qwery('a', this.element).every(function(a) {\n            var id = a.getAttribute('data-id');\n            if (id) {\n                if (a.addEventListener) {\n                    a.addEventListener('click', Product.interactTile);\n                } else {\n                    a.attachEvent('onclick', function (e) {\n                        Product.interactTile.call(a, e);\n                    });\n                }\n\n                // Only stick metrics on the product widget if *not* embedded in another widget\n                if (self.config.metrics_context == okanjo.metrics.channel.product_widget) {\n\n                    // Gather the goods\n                    var backfill = a.getAttribute('data-backfill'),\n                        eventData = okanjo.util.deepClone(self.metricBase, {});\n\n                    // Was the product loaded as a last-ditch effort?\n                    eventData.id = a.getAttribute('data-id');\n                    eventData.m.bf = (backfill === \"true\") ? 1 : 0;\n\n                    // Update the event metadata\n                    eventData.m = okanjo.metrics.truncate(okanjo.metrics.copy(self.config, okanjo.metrics.includeElementInfo(a.parentNode, eventData.m)));\n\n                    // Track product impression event\n                    okanjo.metrics.trackEvent(okanjo.metrics.object_type.product, okanjo.metrics.event_type.impression, eventData);\n                }\n            }\n\n            return true;\n        });\n\n        // Show ellipses on title text that doesn't quite fit\n        okanjo.qwery('.okanjo-product-title', this.element).every(function(t) {\n            okanjo.util.ellipsify(t);\n            return true;\n        });\n    };\n\n\n    /**\n     * Fills the widget with empty products to best match an ad to the dimensions of the widget\n     * @return {{width:number,height:number}|null}\n     */\n    proto.guessAdSize = function() {\n        // Load the container with placeholders to see how big we expand to.\n        var size, items = [], i = 0,\n            //sizes = '980x120|980x90|970x250|970x90|970x66|960x90|950x90|930x180|750x300|750x200|750x100|728x90|580x400|468x60|336x280|320x100|320x50|300x1050|300x600|300x250|300x100|300x50|300x31|292x30|250x360|250x250|240x400|240x133|234x60|220x90|200x446|200x200|180x150|160x600|125x125|120x600|120x240|120x60|88x31'.split('|'),\n            sizes = '300x250|728x90|250x250|200x200|120x240|468x60|180x150|320x50|125x125|234x60'.split('|'),\n            sizeInstance, sizeInstanceWidth, sizeInstanceHeight;\n\n        for ( ; i < this.config.take; i++) {\n            items.push({});\n        }\n        this.showProducts(items);\n\n        // Get the actual size of the unit\n        size = okanjo.util.getElementSize(this.element);\n\n        // Drop the content\n        this.element.innerHTML = \"\";\n\n        // Avoid rounding errors in some browsers (looking at you, IE8)\n        size.width += 1;\n        size.height += 1;\n\n        // Best fit the size to an ad-size\n        for (i = 0; i < sizes.length; i++) {\n            sizeInstance = sizes[i].split('x');\n            sizeInstanceWidth = parseInt(sizeInstance[0]);\n            sizeInstanceHeight = parseInt(sizeInstance[1]);\n            if (sizeInstanceWidth <= size.width && sizeInstanceHeight <= size.height) {\n                return { width: sizeInstanceWidth, height: sizeInstanceHeight };\n            }\n        }\n\n        // No match, don't show an ad\n        return null;\n    };\n\n\n    /**\n     * Starts the backfill process to show an backup display ad\n     */\n    proto.backfillAd = function() {\n\n        var backfill = this.config.backfill,\n            match,\n            size = null;\n\n        if (typeof backfill === \"string\") {\n            // Check if the backfill target is a known ad unit size\n            if (okanjo.Ad) {\n                size = okanjo.Ad.sizes[backfill];\n            }\n\n            // Check if the string is a dimensional value\n            if (!size) {\n                /* jshint -W084 */\n                if (match = (/^([0-9]+)x([0-9]+)$/i).exec(backfill)) {\n                    size = {\n                        width: match[1],\n                        height: match[2]\n                    };\n                }\n                /* jshint +W084 */\n            }\n        }\n\n        // Do we have to guess the size?\n        if (!size) {\n            size = this.guessAdSize();\n        }\n\n        if (size) {\n            this.loadAd(size);\n        } else {\n            console.error('[Okanjo.'+this.widgetName+'] Failed to backfill ad: Unable to match ad size to widget dimensions');\n        }\n    };\n\n\n    /**\n     * Loads an ad from Google Adx of the given dimensions\n     * @param size\n     */\n    proto.loadAd = function(size) {\n        var adxframe = document.createElement('iframe'),\n            frameAttributes = {\n                'class': 'okanjo-inline-buy-frame',\n                frameborder: 0,\n                vspace: 0,\n                hspace: 0,\n                webkitallowfullscreen: '',\n                mozallowfullscreen: '',\n                allowfullscreen: '',\n                scrolling: 'auto'\n            },\n            pubId = 'ca-pub-9976681432228271',\n            slotId = '3992956792',\n            adxframeContent = '<html><head><style type=\"text/css\">html,body {margin: 0; padding: 0;}</style></head><body><'+'script type=\"text/javascript\">' +\n                'google_ad_client = \"'+pubId+'\";' +\n                'google_ad_slot = \"'+slotId+'\";' +\n                'google_ad_width = '+size.width+';' +\n                'google_ad_height = '+size.height+';' +\n                'google_page_url = \"'+window.location.href+'\";' +\n                //'google_adtest = \"on\";' +\n                '<'+'/script>' +\n                '<' +'script type=\"text/javascript\" src=\"//pagead2.googlesyndication.com/pagead/show_ads.js\"><'+'/script></body></html>';\n\n        this.element.innerHTML = \"\";\n        this.element.appendChild(adxframe);\n        adxframe.contentWindow.document.open();\n        adxframe.contentWindow.document.write(adxframeContent);\n        adxframe.contentWindow.document.close();\n\n        for (var i in frameAttributes) {\n            if (frameAttributes.hasOwnProperty(i)) {\n                adxframe.setAttribute(i, frameAttributes[i]);\n            }\n        }\n\n        adxframe.className = \"okanjo-ad-backfill\";\n        adxframe.setAttribute('width', size.width + \"px\");\n        adxframe.setAttribute('height', size.height + \"px\");\n\n        // Track backfill impression\n        var eventData = okanjo.util.deepClone(this.metricBase, {});\n        eventData.m.ta_w = size.width;\n        eventData.m.ta_h = size.height;\n        eventData.m.ta_pubid = pubId;\n        eventData.m.ta_slotid = slotId;\n        eventData.m = okanjo.metrics.truncate(okanjo.metrics.copy(this.config, okanjo.metrics.includeElementInfo(this.element, eventData.m)));\n        okanjo.metrics.trackEvent(okanjo.metrics.object_type.thirdparty_ad, okanjo.metrics.event_type.impression, eventData);\n    };\n\n    okanjo.Product = Product;\n    return Product;\n\n})(okanjo, this);\n//noinspection ThisExpressionReferencesGlobalObjectJS,JSUnusedLocalSymbols\n(function(okanjo, window) {\n\n    /**\n     * Okanjo Ad\n     * @param element - DOM element to attach the output to\n     * @param {*} [config] - Optional base widget configuration object, element data attributes will override these\n     * @constructor\n     */\n    function Ad(element, config) {\n\n        okanjo._Widget.call(this, element, config);\n\n        this.config = config = config || {};\n\n        this.templates = {\n            ad_error: \"okanjo.error\",\n            ad_main: \"ad.block\"\n        };\n\n        this.css = {\n            ad_main: \"ad.block\"\n        };\n\n        this.disable_inline_buy = this.config.disable_inline_buy === undefined ? false : config.disable_inline_buy === true;\n        this.proxy_url = null;\n\n        this.configMap = {\n\n            // Api Widget Key\n            key: \"key\",\n\n            proxy_url: \"proxy-url\", // 3rd party click through tracking url\n\n            // How should this thing look?\n            content: \"content\", // The content of the ad, creative or dynamic. Default: creative if element has markup, dynamic if not.\n            size: \"size\", // Hint as to the intended IAB display size, e.g. large_rectangle, leaderboard, skyscraper. Default: medium_rectangle\n            expandable: \"expandable\", // Indicates whether the inline_buy experience is allowed to expand outside the bounds of the widget. Default: true\n\n            // What should this thing point at?\n            type: \"type\", // The source type. Default: product\n            id: \"id\", // The source id. e.g. PRasdfMyProductId. Default: null\n\n            // Allow overriding of the ad templates\n            template_ad_main: 'template-ad-main',\n            template_ad_error: 'template-ad-error',\n\n            // Pass these params through to the underlying product widget\n            disable_inline_buy: \"disable-inline-buy\", // Whether to disable inline buy functionality, default: false\n            template_product_main: 'template-product-main', // The product template to render, default: product.block\n            template_product_error: 'template-product-error' // The product error template to render, default: okanjo.error\n        };\n\n\n        // Initialize unless told not to\n        //noinspection JSUnresolvedVariable\n        if (!config.no_init) {\n            //noinspection JSUnresolvedFunction\n            this.init();\n        }\n    }\n\n    // Extend the base widget\n    okanjo.util.inherits(Ad, okanjo._Widget);\n\n\n    /**\n     * Ad display types\n     * @type {{creative: string, dynamic: string}}\n     */\n    Ad.contentTypes = {\n        creative: \"creative\",\n        dynamic: \"dynamic\"\n    };\n\n\n    /**\n     * Ad display types (currently just product)\n     * @type {{product: string}}\n     */\n    Ad.types = {\n        product: \"product\"\n    };\n\n\n    /**\n     * Known Ad Dimensions\n     */\n    Ad.sizes = {\n\n        // IAB / Others\n        billboard:              { width: 970, height: 250 }, // aka: sidekick\n        button_2:               { width: 120, height:  60 },\n        half_page:              { width: 300, height: 600 }, // aka: filmstrip, sidekick\n        leaderboard:            { width: 728, height:  90 },\n        medium_rectangle:       { width: 300, height: 250 }, // aka: sidekick\n        micro_bar:              { width:  88, height:  31 },\n        portrait:               { width: 300, height:1050 },\n        rectangle:              { width: 180, height: 150 },\n        super_leaderboard:      { width: 970, height:  90 }, // aka: pushdown, slider, large_leaderboard\n        wide_skyscraper:        { width: 160, height: 600 },\n\n        // Google\n        large_mobile_banner:    { width: 320, height: 100 },\n        mobile_leaderboard:     { width: 320, height:  50 },\n        small_square:           { width: 200, height: 200 },\n\n        // Retired / Deprecated\n        button_1:               { width: 120, height:  90 },\n        full_banner:            { width: 468, height:  60 },\n        half_banner:            { width: 234, height:  60 },\n        large_rectangle:        { width: 336, height: 280 },\n        pop_under:              { width: 720, height: 300 },\n        three_to_one_rectangle: { width: 300, height: 100 },\n        skyscraper:             { width: 120, height: 600 },\n        square:                 { width: 250, height: 250 },\n        square_button:          { width: 125, height: 125 },\n        vertical_banner:        { width: 120, height: 240 },\n        vertical_rectangle:     { width: 240, height: 400 }\n    };\n\n    var proto = Ad.prototype;\n\n    /**\n     * Ad Widget!\n     * @type {string}\n     */\n    proto.widgetName = 'Ad';\n\n    /**\n     * Widget loader, sandwiched in the widget init\n     * @returns {boolean}\n     */\n    proto.load = function() {\n        //\n        // Ensure proper content\n        //\n\n        if (okanjo.util.empty(this.config.content)) {\n            if (this.hasCreativeContent()) {\n                this.config.content = Ad.contentTypes.creative;\n            } else {\n                this.config.content = Ad.contentTypes.dynamic;\n            }\n        } else if (this.config.content === Ad.contentTypes.creative && !this.hasCreativeContent()) {\n            // You say you want creative, but you don't really have any\n            console.warn('[Okanjo.Ad] Ad content is creative, but ad placement does not contain creative markup. Switching to dynamic!');\n            this.config.content = Ad.contentTypes.dynamic;\n        } else if (this.config.content === Ad.contentTypes.dynamic && this.hasCreativeContent()) {\n            console.warn('[Okanjo.Ad] Ad content is dynamic, but ad placement contains markup. Markup will be clobbered!');\n        } else if (!Ad.contentTypes.hasOwnProperty(this.config.content)){\n            this.element.innerHTML = okanjo.mvc.render(this.templates.ad_error, this, { message: 'Invalid ad content: ' + this.config.content });\n            okanjo.report(this.widgetName, 'Invalid ad content: ' + this.config.content);\n            return false;\n        }\n\n\n        //\n        // Ensure proper type\n        //\n\n        if (okanjo.util.empty(this.config.type)) {\n\n            // Default to product\n            this.config.type = Ad.types.product;\n\n            //if (okanjo.util.empty(this.config.size)) {\n            //    this.config.size = Ad.sizes.medium_rectangle; // Defaults to medium_rectangle\n            //}\n        } else if (!Ad.types.hasOwnProperty(this.config.type)) {\n            console.warn('[Okanjo.'+this.widgetName+'] Unknown type', this.config.type, 'given, using type `product` instead');\n            this.config.type = Ad.types.product;\n        }\n\n\n        //\n        // Ensure element size\n        //\n\n        // Check if we have known dimensions\n        if (!okanjo.util.empty(this.config.size) && Ad.sizes.hasOwnProperty(this.config.size)) {\n            // Set the placement's dimensions automagically\n            this.setElementSize(Ad.sizes[this.config.size]);\n        }\n\n        // Verify the disable param is not a string\n        if (this.config.disable_inline_buy && typeof this.config.disable_inline_buy === \"string\") {\n            this.disable_inline_buy = this.config.disable_inline_buy.toLowerCase() === \"true\";\n        }\n\n        // Set the proxy url, if present\n        if (this.config.proxy_url) {\n            this.proxy_url = this.config.proxy_url;\n\n            // Don't send this (probably gigantic) url on jsonp requests\n            delete this.config.proxy_url;\n        }\n\n        // Track ad widget load\n        okanjo.metrics.trackEvent(okanjo.metrics.object_type.widget, okanjo.metrics.event_type.impression, {\n            ch: okanjo.metrics.channel.ad_widget,\n            cx: this.config.content,\n            m: okanjo.metrics.copy(this.config, okanjo.metrics.includeElementInfo(this.element, { wgid: this.instanceId }))\n        });\n\n        //\n        // Ensure target id, and RENDER IT!\n        //\n\n        if (this.config.type === Ad.types.product) {\n\n            // Make sure an ID is set\n            if (okanjo.util.empty(this.config.id)) {\n                this.element.innerHTML = okanjo.mvc.render(this.templates.ad_error, this, { message: 'Missing ad product id' });\n                okanjo.report(this.widgetName, 'Missing ad product id');\n                return false;\n            }\n\n            // Get the product\n            if (this.config.content == Ad.contentTypes.dynamic) {\n                // If dynamic, render in a product block\n                this.insertProductWidget();\n            } else if (this.config.content == Ad.contentTypes.creative) {\n                // If creative, don't mess with the markup, just bind up the click / modal\n                this.insertCreativeWidget();\n            } else {\n                this.element.innerHTML = okanjo.mvc.render(this.templates.ad_error, this, { message: 'Cannot render ad in content: ' + this.config.content });\n                okanjo.report(this.widgetName, 'Cannot render ad in content: ' + this.config.content);\n                return false;\n            }\n\n        }\n\n        return true;\n\n    };\n\n\n    /**\n     * Renders the ad and moves existing content into the spot it should be\n     */\n    proto.render = function() {\n\n        var div = document.createElement('div'),\n            existingChildren = [],\n            i,\n            fit = this.config.content == Ad.contentTypes.dynamic && !okanjo.util.empty(this.config.size);\n\n        div.innerHTML = okanjo.mvc.render(this.templates.ad_main, this, {\n            //products: data || this.items || [],\n            config: this.config\n        }, {\n            blockClasses: fit ? ['okanjo-ad-fit'] : []\n        });\n\n\n        // Get all children in the current element\n        for( i = 0; i < this.element.childNodes.length; i++) {\n            if (this.element.childNodes[i].nodeType === 1 /*Node.ELEMENT_NODE*/) {\n                existingChildren.push(this.element.childNodes[i]);\n            }\n        }\n\n\n        // Attach markup to the element\n        for( i = 0; i < div.childNodes.length; i++) {\n            if (div.childNodes[i].nodeType === 1 /*Node.ELEMENT_NODE*/) {\n                this.element.appendChild(div.childNodes[i]);\n            }\n        }\n\n        // Get the new container element\n        //noinspection JSUnresolvedFunction\n        var container = okanjo.qwery('.okanjo-ad-container', this.element)[0];\n\n\n        // Move children to the new container\n        for( i = 0; i < existingChildren.length; i++ ) {\n            container.appendChild(existingChildren[i]);\n        }\n\n        // Track product impression\n        okanjo.metrics.trackEvent(okanjo.metrics.object_type.product, okanjo.metrics.event_type.impression, {\n            id: this.config.id,\n            ch: okanjo.metrics.channel.ad_widget, // pw or aw\n            cx: this.config.content, // single, browse, sense | creative, dynamic\n            m: okanjo.metrics.copy(this.config, okanjo.metrics.includeElementInfo(this.element, { wgid: this.instanceId }))\n        });\n\n    };\n\n\n    /**\n     * When a creative ad is clicked, funnel the event to the nearest product\n     * @param e\n     */\n    proto.interact = function(e) {\n        //noinspection JSUnresolvedFunction\n        var links = okanjo.qwery('a', this.productWidget.element);\n        if (links.length > 0) {\n            this._waitingOnProductLoad = false;\n            okanjo.Product.interactTile.call(links[0], e, true);\n        } else {\n            if (!this._waitingOnProductLoad) {\n                this._waitingOnProductLoad = true;\n                var self = this,\n                    interval = setInterval(function() {\n                        if (!self._waitingOnProductLoad) {\n                            clearInterval(interval);\n                        } else {\n                            self.interact(e);\n                        }\n                    }, 250);\n                console.warn('Waiting for Okanjo Product widget to load...');\n            }\n        }\n    };\n\n\n    /**\n     * Formats the creative content and adds a product widget in the ad space\n     */\n    proto.insertCreativeWidget = function() {\n        this.insertProductWidget({ hidden: true });\n\n        // Bind a click handler\n        var self = this;\n        if (this.element.addEventListener) {\n            this.element.addEventListener('click', function(e) { self.interact(e); });\n        } else {\n            this.element.attachEvent('onclick', function(e) { self.interact(e); });\n        }\n    };\n\n\n    /**\n     * Inserts a product widget into the ad space\n     * @param [options]\n     * @returns {okanjo.Product|*}\n     */\n    proto.insertProductWidget = function(options) {\n        options = options || {};\n\n        // Create a non-conflicting container for the ad block\n        var el = document.createElement('div');\n        el.className = 'okanjo-ad-dynamic-product';\n\n        if (options.hidden) {\n            el.style.display = \"none\";\n        }\n\n        this.element.appendChild(el);\n\n        this.render();\n\n        var productWidgetConfig = {\n            id: this.config.id,\n            key: this.key,\n            mode: okanjo.Product.contentTypes.single,\n            disable_inline_buy: this.disable_inline_buy,\n            disable_popup: this.config.disable_popup === true,\n            proxy_url: this.proxy_url,\n            expandable: this.config.expandable === undefined || (typeof this.config.expandable === \"boolean\" ? this.config.expandable : (\"\"+this.config.expandable).toLowerCase() === \"true\"),\n            metrics_context: okanjo.metrics.channel.ad_widget, // Set the context of the click to the Ad widget please!\n            metrics_channel_context: this.config.content, // Set the channel context to this widget's mode of operation (creative, dynamic)\n            template_product_main: \"product.single\"\n        };\n\n        // Copy parameters through from the ad config, to the product config, if set\n        if (this.config.template_product_main) productWidgetConfig.template_product_main = this.config.template_product_main;\n        if (this.config.template_product_error) productWidgetConfig.template_product_error = this.config.template_product_error;\n\n        // Instantiate the widget\n        this.productWidget = new okanjo.Product(el, productWidgetConfig);\n\n        return this.productWidget;\n    };\n\n\n    /**\n     * Updates the placement element's dimensions based on given size\n     * @param size\n     */\n    proto.setElementSize = function(size) {\n        this.element.style.display = \"block\";\n        this.element.style.overflow = \"hidden\";\n        this.element.style.width = size.width + \"px\";\n        this.element.style.height = size.height + \"px\";\n    };\n\n\n    /**\n     * Check if the element has predefined content to show\n     * @returns {boolean}\n     */\n    proto.hasCreativeContent = function() {\n        if (this.element.childElementCount && this.element.childElementCount > 0) {\n            return true;\n        } else {\n            for (var i = 0; i < this.element.childNodes.length; i++) {\n                if (this.element.childNodes[i].nodeType === 1/*Node.ELEMENT_NODE*/) {\n                    return true;\n                }\n            }\n        }\n    };\n\n\n    okanjo.Ad = Ad;\n    return Ad;\n\n})(okanjo, this);\nreturn okanjo;\n}));\n","//noinspection JSUnusedLocalSymbols,ThisExpressionReferencesGlobalObjectJS\n(function(okanjo, window) {\n\n    var TemplateEngine = okanjo.TemplateEngine = function TemplateEngine(options) {\n        options = options || { templates: {}, css: {} };\n        this._templates = options.templates || {};\n        this._css = options.css || {};\n\n        // Add special styles for ie 7, 8, 9\n        this.classDetects = okanjo.util.detectClasses();\n        this.classDetects = this.classDetects.join(' ');\n    };\n\n    TemplateEngine.prototype = {\n\n        constructor: TemplateEngine,\n\n        /**\n         * Register a template\n         * @param {string} name – Template name\n         * @param {string|HTMLElement} template - Template markup string\n         * @param {function(data:*):*} [viewClosure] – Optional data manipulation closure\n         * @param {*} [options] – Optional hash of template options, e.g. css: [ 'name1', 'name2' ]\n         */\n        registerTemplate: function(name, template, viewClosure, options) {\n            // Example template:\n            // {{title}} spends {{calc}}\n\n            if (typeof template === \"object\") {\n                //noinspection JSValidateTypes\n                if (template.nodeType === undefined) {\n                    throw new Error('Parameter template must be a string or a DOM element');\n                } else {\n                    okanjo.Mustache.parse(template);\n                }\n            } else if (typeof template !== \"string\") {\n                throw new Error('Parameter template must be a string or a DOM element');\n            }\n\n            // Shift options if only have 3 params\n            if (arguments.length === 3 && typeof viewClosure === \"object\") {\n                options = viewClosure;\n                viewClosure = undefined;\n            } else {\n                options = options || {};\n            }\n\n            if (viewClosure !== undefined && typeof viewClosure !== \"function\") {\n                throw new Error('Parameter viewClosure must be a function');\n            }\n\n            // Assign the template\n            this._templates[name] = {\n                markup: template,\n                options: options,\n                viewClosure: viewClosure || null\n            };\n        },\n\n\n        /**\n         * Registers a CSS block\n         *\n         * @param {string} name – CSS block name\n         * @param {string|HTMLElement} css – The CSS markup or existing style element\n         * @param {undefined|{id:string}|null} [options] – Optional hash of KVP settings\n         */\n        registerCss: function(name, css, options) {\n            options = options || {};\n\n            if (typeof css === \"object\") {\n                //noinspection JSValidateTypes\n                if (css.nodeType === undefined) {\n                    throw new Error('Parameter css must be a string or a DOM element');\n                }\n            } else if (typeof css !== \"string\") {\n                throw new Error('Parameter css must be a string or a DOM element');\n            }\n\n            this._css[name] = {\n                markup: css,\n                options: options\n            };\n        },\n\n\n        /**\n         * Checks if a template was registered\n         * @param {string} name – The template name to look for\n         * @returns {boolean} – True if registered, False if not\n         */\n        isTemplateRegistered: function(name) {\n            return this._templates[name] ? true : false;\n        },\n\n\n        /**\n         * Checks if a CSS block was registered\n         * @param {string} name – The CSS block name to look for\n         * @returns {boolean} – True if registered, False if not\n         */\n        isCssRegistered: function(name) {\n            return this._css[name] ? true : false;\n        },\n\n\n        /**\n         * Ensures that the given CSS block name has been added to the page\n         * @param {string|HTMLElement} name - The CSS name that was registered through registerCss\n         */\n        ensureCss: function(name) {\n\n            if (this._css[name]) {\n                //noinspection JSValidateTypes\n                var css = this._css[name],\n                    id = css.markup.nodeType === undefined ? css.options.id || \"okanjo-css-\" + name : null; // If it's a DOM element, just forget it cuz it's already on the page\n\n                // Check for css element on page, if we have an ID to look for\n                if (id) {\n                    var elements = okanjo.qwery('#' + id);\n                    if (elements.length === 0) {\n                        var head = okanjo.qwery('head'),\n                            style = document.createElement('style');\n\n                        style.id = id;\n                        style.setAttribute('type', 'text/css');\n\n                        if (style.hasOwnProperty) { // old ie\n                            style.innerHTML = css.markup;\n                        } else {\n                            style.styleSheet.cssText = css.markup;\n                        }\n\n                        if (head.length > 0) {\n                            head[0].appendChild(style);\n                        } else {\n                            // NO HEAD, just prepend to body then\n                            var body = okanjo.qwery('body');\n                            if (body.length > 0) {\n                                body[0].appendChild(style);\n                            } // And if this doesn't work, just give up\n                        }\n                    }\n                }\n            } else {\n                console.warn('[Okanjo.Template] Attempted to add CSS template \"'+name+'\" to the DOM, however it does not appear to be registered?');\n            }\n\n        },\n\n\n        /**\n         * Renders a template with the given data\n         *\n         * @param {string} templateName – The template name to render\n         * @param {*} context – The context to execute the template under\n         * @param {*} data – Data to pass into the controller\n         * @param {*} [options] – Optional settings object to pass into the controller closure\n         * @returns {*}\n         */\n        render: function(templateName, context, data, options) {\n\n            options = options || {};\n            var template = this._templates[templateName],\n                view = data;\n\n            // If there's a data controller closure set, and if so, run the data through there\n            if (template.viewClosure) {\n                view = template.viewClosure.call(context, data, options);\n            }\n\n            // Attach globals\n            view.okanjoConfig = okanjo.config;\n            view.okanjoMetricUrl = okanjo.config.ads.apiUri.replace(/^https?:\\/\\//,''); // Url w/o scheme to prevent mixed-content warnings\n            view.now = function() { return (new Date()).getTime(); };\n            view.classDetects = this.classDetects;\n\n            //noinspection JSUnresolvedVariable\n            if (options.blockClasses && Array.isArray(options.blockClasses)) {\n                view.classDetects = view.classDetects += \" \" + options.blockClasses.join(' ');\n            }\n\n            // Add CSS unless we are told not to\n            if (options.css !== false) {\n                if (template.options.css && template.options.css.length > 0) {\n                    for(var i = 0; i < template.options.css.length; i++) {\n                        this.ensureCss(template.options.css[i]);\n                    }\n                }\n            }\n\n            // Render the template and return the result\n            return okanjo.Mustache.render(template.markup, view);\n        },\n\n        formats: {\n\n            /**\n             * Formats a number into a currency string (rounded, decimal points, thousands separators)\n             * See: http://stackoverflow.com/questions/149055/how-can-i-format-numbers-as-money-in-javascript\n             *\n             * @param value – the number to format\n             * @param [decimals] - The number of decimals to show\n             * @param [decimalSeparator] – The decimals separator, default: .\n             * @param [thousandsSeparator] – The thousands separator, default: ,\n             * @returns {string} – Formatted currency string\n             */\n            currency: function(value, decimals, decimalSeparator, thousandsSeparator){\n                decimals = isNaN(decimals = Math.abs(decimals)) ? 2 : decimals;\n                decimalSeparator = decimalSeparator === undefined ? \".\" : decimalSeparator;\n                thousandsSeparator = thousandsSeparator === undefined ? \",\" : thousandsSeparator;\n                var s = value < 0 ? \"-\" : \"\",\n                    i = parseInt(value = Math.abs(+value || 0).toFixed(decimals)) + \"\",\n                    j = i.length;\n                j = (j) > 3 ? j % 3 : 0;\n                return s + (j ? i.substr(0, j) + thousandsSeparator : \"\") + i.substr(j).replace(/(\\d{3})(?=\\d)/g, \"$1\" + thousandsSeparator) + (decimals ? decimalSeparator + Math.abs(value - i).toFixed(decimals).slice(2) : \"\");\n            },\n\n\n            /**\n             * Formats a product or an array of product objects for the view\n             * @param {*} mixed – Product or an array of product objects\n             * @returns {*} – Formatted product array or object\n             */\n            product: function(mixed) {\n                // If we got an array of products, handle each one\n                if (typeof mixed === \"object\" && Array.isArray(mixed)) {\n                    var products = [];\n                    for(var i = 0; i < mixed.length; i++) {\n                        products.push(this.product(mixed[i]));\n                    }\n                    return products;\n                } else if(typeof mixed === \"object\" ) { // Individual product\n                    // Set first image as the display image\n\n                    //noinspection JSUnresolvedVariable\n                    mixed.image_url = mixed.image_urls ? mixed.image_urls[0] : '' ;\n                    //noinspection JSUnresolvedVariable\n                    mixed.escaped_buy_url = encodeURIComponent(mixed.buy_url);\n                    mixed.escaped_inline_buy_url = okanjo.util.empty(mixed.inline_buy_url) ? '' : encodeURIComponent(mixed.inline_buy_url);\n                    mixed.price_formatted = this.currency(mixed.price);\n                    return mixed;\n                } else { // Unknown value\n                    return null;\n                }\n            }\n\n        }\n    };\n\n    // global template engine for all the widgets\n    okanjo.mvc = new TemplateEngine();\n\n\n})(okanjo, this);\n","/*\n\n Adaptation based on https://github.com/larryosborn/JSONP\n\n The MIT License (MIT)\n\n Copyright (c) 2014 Larry Osborn <larry.osborn@gmail.com>\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n\n */\n(function() {\n    if(this.JSONP) { return; }\n    var JSONP, computedUrl, encode, noop, objectToURI, makeUniqueCallback, head;\n\n    encode = window.encodeURIComponent;\n\n    noop = function() {\n        return void 0;\n    };\n\n    computedUrl = function(params) {\n        var url;\n        url = params.url;\n        url += params.url.indexOf('?') < 0 ? '?' : '&';\n        url += objectToURI(params.data);\n        return url;\n    };\n\n    makeUniqueCallback = function() {\n        JSONP.requestCounter += 1;\n        return (new Date()).getTime() + \"_\" + JSONP.requestCounter;\n    };\n\n    objectToURI = function(obj) {\n        var data, key, value;\n        data = [];\n        for (key in obj) {\n            if (obj.hasOwnProperty(key)) {\n                value = obj[key];\n                if (Array.isArray(value)) {\n                    var i = 0;\n                    for( ; i < value.length; i++ ) {\n                        data.push(encode(key) + '[]=' + encode(value[i]));\n                    }\n                } else if (typeof value === \"object\") {\n                    // SINGLE DEPTH OBJECTS - no recursion\n                    for (var k in value) {\n                        if (value.hasOwnProperty(k)) {\n                            data.push(encode(key) + '['+encode(k)+']=' + encode(value[k]));\n                        }\n                    }\n                } else {\n                    data.push(encode(key) + '=' + encode(value));\n                }\n            }\n        }\n        return data.join('&');\n    };\n\n    JSONP = function(options) {\n        options = options ? options : {};\n        var callback, done, params, script, timeoutHandle, removeCallback;\n        params = {\n            data: options.data || {},\n            error: options.error || noop,\n            success: options.success || noop,\n            beforeSend: options.beforeSend || noop,\n            complete: options.complete || noop,\n            url: options.url || '',\n            timeout: options.timeout || 30000\n        };\n        params.computedUrl = computedUrl(params);\n        if (params.url.length === 0) {\n            throw new Error('MissingUrl');\n        }\n        done = false;\n        if (params.beforeSend({}, params) !== false) {\n            //noinspection JSUnresolvedVariable\n            callback = params.data[options.callbackName || 'callback'] = '_okanjo_jsonp_' + makeUniqueCallback();\n            window[callback] = function(data) {\n\n                if (timeoutHandle) { clearTimeout(timeoutHandle); }\n                timeoutHandle = null;\n\n                params.success(data, params);\n                params.complete(data, params);\n                removeCallback();\n            };\n\n            removeCallback = function() {\n                try {\n                    return delete window[callback];\n                } catch (_error) {\n                    window[callback] = void 0;\n                    return void 0;\n                }\n            };\n\n            script = window.document.createElement('script');\n            script.src = computedUrl(params);\n            script.async = true;\n\n            timeoutHandle = setTimeout(function() {\n                timeoutHandle = null;\n                var err = new Error(\"JSONP request did not respond in time!\");\n                err.url = (script && script.src) || null;\n                params.error(err);\n                removeCallback();\n                return params.complete(err, params);\n            }, params.timeout);\n\n            script.onerror = function(evt) {\n                if (timeoutHandle) { clearTimeout(timeoutHandle); }\n                params.error({\n                    url: script.src,\n                    event: evt\n                });\n                return params.complete({\n                    url: script.src,\n                    event: evt\n                }, params);\n            };\n\n            script.onload = script.onreadystatechange = function() {\n                if (!done && (!this.readyState || this.readyState === 'loaded' || this.readyState === 'complete')) {\n                    done = true;\n                    script.onload = script.onreadystatechange = null;\n                    if (script && script.parentNode) {\n                        script.parentNode.removeChild(script);\n                    }\n                    //jshint -W093\n                    return script = null;\n                    //jshint +W093\n                }\n            };\n\n            head = head || window.document.getElementsByTagName('head')[0] || window.document.documentElement;\n            return head.insertBefore(script, head.firstChild);\n        }\n    };\n\n    JSONP.requestCounter = 0;\n    JSONP.makeUrl = computedUrl;\n    JSONP.objectToURI = objectToURI;\n\n    if ((typeof define !== \"undefined\" && define !== null) && define.amd) {\n        define(function() {\n            return JSONP;\n        });\n    } else if ((typeof module !== \"undefined\" && module !== null) && module.exports) {\n        module.exports = JSONP;\n    } else {\n        this.JSONP = JSONP;\n    }\n\n}).call(okanjo);\n","// From https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys\nif (!Object.keys) {\n    Object.keys = (function() {\n        'use strict';\n        var hasOwnProperty = Object.prototype.hasOwnProperty,\n            hasDontEnumBug = !({ toString: null }).propertyIsEnumerable('toString'),\n            dontEnums = [\n                'toString',\n                'toLocaleString',\n                'valueOf',\n                'hasOwnProperty',\n                'isPrototypeOf',\n                'propertyIsEnumerable',\n                'constructor'\n            ],\n            dontEnumsLength = dontEnums.length;\n\n        return function(obj) {\n            if (typeof obj !== 'object' && (typeof obj !== 'function' || obj === null)) {\n                throw new TypeError('Object.keys called on non-object');\n            }\n\n            var result = [], prop, i;\n\n            for (prop in obj) {\n                if (hasOwnProperty.call(obj, prop)) {\n                    result.push(prop);\n                }\n            }\n\n            if (hasDontEnumBug) {\n                for (i = 0; i < dontEnumsLength; i++) {\n                    if (hasOwnProperty.call(obj, dontEnums[i])) {\n                        result.push(dontEnums[i]);\n                    }\n                }\n            }\n            return result;\n        };\n    }());\n}\n\n//// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create\n//if (typeof Object.create != 'function') {\n//    Object.create = (function() {\n//        var Temp = function() {};\n//        return function (prototype) {\n//            if (arguments.length > 1) {\n//                throw new Error('Second argument not supported');\n//            }\n//            if (typeof prototype != 'object') {\n//                throw new TypeError('Argument must be an object');\n//            }\n//            Temp.prototype = prototype;\n//            var result = new Temp();\n//            Temp.prototype = null;\n//            return result;\n//        };\n//    })();\n//}\n\n// From: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray\nif (!Array.isArray) {\n    Array.isArray = function(arg) {\n        return Object.prototype.toString.call(arg) === '[object Array]';\n    };\n}\n\n// Production steps of ECMA-262, Edition 5, 15.4.4.14\n// From: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf\n// Reference: http://es5.github.io/#x15.4.4.14\nif (!Array.prototype.indexOf) {\n    Array.prototype.indexOf = function(searchElement, fromIndex) {\n\n        var k;\n\n        /* jshint ignore:start */\n        // 1. Let O be the result of calling ToObject passing\n        //    the this value as the argument.\n        if (this == null) { //\n            throw new TypeError('\"this\" is null or not defined');\n        }\n        /* jshint ignore:end */\n\n        var O = Object(this);\n\n        // 2. Let lenValue be the result of calling the Get\n        //    internal method of O with the argument \"length\".\n        // 3. Let len be ToUint32(lenValue).\n        var len = O.length >>> 0;\n\n        // 4. If len is 0, return -1.\n        if (len === 0) {\n            return -1;\n        }\n\n        // 5. If argument fromIndex was passed let n be\n        //    ToInteger(fromIndex); else let n be 0.\n        var n = +fromIndex || 0;\n\n        if (Math.abs(n) === Infinity) {\n            n = 0;\n        }\n\n        // 6. If n >= len, return -1.\n        if (n >= len) {\n            return -1;\n        }\n\n        // 7. If n >= 0, then Let k be n.\n        // 8. Else, n<0, Let k be len - abs(n).\n        //    If k is less than 0, then let k be 0.\n        k = Math.max(n >= 0 ? n : len - Math.abs(n), 0);\n\n        // 9. Repeat, while k < len\n        while (k < len) {\n            // a. Let Pk be ToString(k).\n            //   This is implicit for LHS operands of the in operator\n            // b. Let kPresent be the result of calling the\n            //    HasProperty internal method of O with argument Pk.\n            //   This step can be combined with c\n            // c. If kPresent is true, then\n            //    i.  Let elementK be the result of calling the Get\n            //        internal method of O with the argument ToString(k).\n            //   ii.  Let same be the result of applying the\n            //        Strict Equality Comparison Algorithm to\n            //        searchElement and elementK.\n            //  iii.  If same is true, return k.\n            if (k in O && O[k] === searchElement) {\n                return k;\n            }\n            k++;\n        }\n        return -1;\n    };\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/every\nif (!Array.prototype.every) {\n    Array.prototype.every = function(callbackfn, thisArg) {\n        'use strict';\n        var T, k;\n\n        // jshint -W041\n        if (this == null) {\n            throw new TypeError('this is null or not defined');\n        }\n        // jshint +W041\n\n        // 1. Let O be the result of calling ToObject passing the this\n        //    value as the argument.\n        var O = Object(this);\n\n        // 2. Let lenValue be the result of calling the Get internal method\n        //    of O with the argument \"length\".\n        // 3. Let len be ToUint32(lenValue).\n        var len = O.length >>> 0;\n\n        // 4. If IsCallable(callbackfn) is false, throw a TypeError exception.\n        if (typeof callbackfn !== 'function') {\n            throw new TypeError();\n        }\n\n        // 5. If thisArg was supplied, let T be thisArg; else let T be undefined.\n        if (arguments.length > 1) {\n            T = thisArg;\n        }\n\n        // 6. Let k be 0.\n        k = 0;\n\n        // 7. Repeat, while k < len\n        while (k < len) {\n\n            var kValue;\n\n            // a. Let Pk be ToString(k).\n            //   This is implicit for LHS operands of the in operator\n            // b. Let kPresent be the result of calling the HasProperty internal\n            //    method of O with argument Pk.\n            //   This step can be combined with c\n            // c. If kPresent is true, then\n            if (k in O) {\n\n                // i. Let kValue be the result of calling the Get internal method\n                //    of O with argument Pk.\n                kValue = O[k];\n\n                // ii. Let testResult be the result of calling the Call internal method\n                //     of callbackfn with T as the this value and argument list\n                //     containing kValue, k, and O.\n                var testResult = callbackfn.call(T, kValue, k, O);\n\n                // iii. If ToBoolean(testResult) is false, return false.\n                if (!testResult) {\n                    return false;\n                }\n            }\n            k++;\n        }\n        return true;\n    };\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter\nif (!Array.prototype.filter) {\n    Array.prototype.filter = function(fun/*, thisArg*/) {\n        'use strict';\n\n        if (this === void 0 || this === null) {\n            throw new TypeError();\n        }\n\n        var t = Object(this),\n            len = t.length >>> 0;\n\n        if (typeof fun !== 'function') {\n            throw new TypeError();\n        }\n\n        var res = [],\n            thisArg = arguments.length >= 2 ? arguments[1] : void 0;\n        for (var i = 0; i < len; i++) {\n            if (i in t) {\n                var val = t[i];\n\n                // NOTE: Technically this should Object.defineProperty at\n                //       the next index, as push can be affected by\n                //       properties on Object.prototype and Array.prototype.\n                //       But that method's new, and collisions should be\n                //       rare, so use the more-compatible alternative.\n                if (fun.call(thisArg, val, i, t)) {\n                    res.push(val);\n                }\n            }\n        }\n\n        return res;\n    };\n}\n\n// Doesn't work in IE7 so it's only here for reference\n//https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener\n(function() {\n    if (!Event.prototype.preventDefault) {\n        Event.prototype.preventDefault=function() {\n            //noinspection JSUnusedGlobalSymbols\n            this.returnValue=false;\n        };\n    }\n    if (!Event.prototype.stopPropagation) {\n        Event.prototype.stopPropagation=function() {\n            //noinspection JSUnusedGlobalSymbols\n            this.cancelBubble=true;\n        };\n    }\n    if (!Element.prototype.addEventListener) {\n        var eventListeners=[];\n\n        var addEventListener=function(type,listener /*, useCapture (will be ignored) */) {\n            var self=this;\n            var wrapper=function(e) {\n                e.target=e.srcElement;\n                e.currentTarget=self;\n                if (listener.handleEvent) {\n                    listener.handleEvent(e);\n                } else {\n                    listener.call(self,e);\n                }\n            };\n            if (type==\"DOMContentLoaded\") {\n                var wrapper2=function(e) {\n                    if (document.readyState==\"complete\") {\n                        wrapper(e);\n                    }\n                };\n                document.attachEvent(\"onreadystatechange\",wrapper2);\n                eventListeners.push({object:this,type:type,listener:listener,wrapper:wrapper2});\n\n                if (document.readyState==\"complete\") {\n                    //noinspection JSClosureCompilerSyntax\n                    var e=new Event();\n                    e.srcElement=window;\n                    wrapper2(e);\n                }\n            } else {\n                this.attachEvent(\"on\"+type,wrapper);\n                eventListeners.push({object:this,type:type,listener:listener,wrapper:wrapper});\n            }\n        };\n        var removeEventListener=function(type,listener /*, useCapture (will be ignored) */) {\n            var counter=0;\n            while (counter<eventListeners.length) {\n                var eventListener=eventListeners[counter];\n                if (eventListener.object==this && eventListener.type==type && eventListener.listener==listener) {\n                    if (type==\"DOMContentLoaded\") {\n                        this.detachEvent(\"onreadystatechange\",eventListener.wrapper);\n                    } else {\n                        this.detachEvent(\"on\"+type,eventListener.wrapper);\n                    }\n                    eventListeners.splice(counter, 1);\n                    break;\n                }\n                ++counter;\n            }\n        };\n        Element.prototype.addEventListener=addEventListener;\n        Element.prototype.removeEventListener=removeEventListener;\n        if (HTMLDocument) {\n            HTMLDocument.prototype.addEventListener=addEventListener;\n            HTMLDocument.prototype.removeEventListener=removeEventListener;\n        }\n        if (Window) {\n            //noinspection JSUnresolvedVariable\n            Window.prototype.addEventListener=addEventListener;\n            //noinspection JSUnresolvedVariable\n            Window.prototype.removeEventListener=removeEventListener;\n        }\n    }\n})();","\n    // Make it safe to do console.log() always.\n    /*! Console-polyfill. | MIT license. | https://github.com/paulmillr/console-polyfill */\n    //noinspection ThisExpressionReferencesGlobalObjectJS\n    (function (win) {\n        'use strict';\n        var con = win.console || {},\n            prop, method,\n            empty = {},\n            dummy = function() {},\n            properties = 'memory'.split(','),\n            methods = ('assert,count,debug,dir,dirxml,error,exception,group,' +\n            'groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,' +\n            'time,timeEnd,trace,warn').split(',');\n        win.console = con;\n        // jshint -W084\n        while (prop = properties.pop()) {\n            if (con[prop] === undefined) {\n                con[prop] = con[prop] || empty;\n            }\n        }\n        while (method = methods.pop()) {\n            if(con[method] === undefined) {\n                con[method] = con[method] || dummy;\n            }\n        }\n        // jshint +W084\n    })(this || {});","\n    /*! Okanjo Local Storage Polyfill v1.0.0 | (c) 2013 Okanjo Partners Inc | Based on https://gist.github.com/juliocesar/926500/ddb28fb72903be87cb9044a945c6edbe1aa28b3a */\n    //noinspection ThisExpressionReferencesGlobalObjectJS\n    (function(c, window) {\n        var OkanjoCache = null;\n        if ('localStorage' in window && window.localStorage !== null && isLocalStorageNameSupported()) {\n            OkanjoCache = window.localStorage;\n        } else {\n            OkanjoCache = {\n                _data       : {}, // jshint -W093\n                length      : 0,\n                _updateLen  : function() { this.length = this._data.length; },\n\n                setItem     : function(id, val) { var res = this._data[id] = String(val); this._updateLen(); return res; },\n                getItem     : function(id) { return this._data.hasOwnProperty(id) ? this._data[id] : undefined; },\n                removeItem  : function(id) { var res = delete this._data[id]; this._updateLen(); return res; },\n                clear       : function() { return this._data = {}; },\n                key         : function(index) { return Object.keys(this._data)[index]; } // jshint +W093\n            };\n        }\n        c.Cache = OkanjoCache;\n        return OkanjoCache;\n\n        // Make sure LocalStorage is usable.\n        // Thanks stackoverflow! http://stackoverflow.com/a/17604754/1373782\n        function isLocalStorageNameSupported() {\n            var testKey = 'test', storage = window.sessionStorage;\n            try {\n                storage.setItem(testKey, '1');\n                storage.removeItem(testKey);\n                return true;\n            } catch (error) {\n                return false;\n            }\n        }\n    })(okanjo || this, this);","\n    /*! Okanjo Cookie Helper v1.0.0 | (c) 2013 Okanjo Partners Inc */\n    //noinspection ThisExpressionReferencesGlobalObjectJS\n    (function(c, w) {\n\n        var document = w.document || { cookie: '' };\n\n        c.Cookie = {\n            set: function(cookieName, value, expireDays) {\n                var expireDate = new Date();\n                expireDate.setDate(expireDate.getDate() + expireDays);\n                var cookieValue = encodeURI(value) + ((!expireDays) ? \"\" : \"; Expires=\" + expireDate.toUTCString() + \"; Path=/\");\n                document.cookie = cookieName + \"=\" + cookieValue;\n            },\n            get: function(cookieName) {\n                var idx, nameTest, value, cookieArray = document.cookie.split(\";\");\n                for (idx = 0; idx < cookieArray.length; idx++) {\n                    nameTest = cookieArray[idx].substr(0, cookieArray[idx].indexOf(\"=\"));\n                    value = cookieArray[idx].substr(cookieArray[idx].indexOf(\"=\") + 1);\n                    nameTest = nameTest.replace(/^\\s+|\\s+$/g, \"\");\n                    if (nameTest == cookieName) {\n                        return decodeURI(value);\n                    }\n                }\n                return null;\n            }\n        };\n\n        return c.Cookie;\n\n    })(okanjo || this, this);","/* jshint ignore:start */\n\n/*\n json2.js\n 2013-05-26\n\n Public Domain.\n\n NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n\n See http://www.JSON.org/js.html\n\n\n This code should be minified before deployment.\n See http://javascript.crockford.com/jsmin.html\n\n USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO\n NOT CONTROL.\n\n\n This file creates a global JSON object containing two methods: stringify\n and parse.\n\n JSON.stringify(value, replacer, space)\n value       any JavaScript value, usually an object or array.\n\n replacer    an optional parameter that determines how object\n values are stringified for objects. It can be a\n function or an array of strings.\n\n space       an optional parameter that specifies the indentation\n of nested structures. If it is omitted, the text will\n be packed without extra whitespace. If it is a number,\n it will specify the number of spaces to indent at each\n level. If it is a string (such as '\\t' or '&nbsp;'),\n it contains the characters used to indent at each level.\n\n This method produces a JSON text from a JavaScript value.\n\n When an object value is found, if the object contains a toJSON\n method, its toJSON method will be called and the result will be\n stringified. A toJSON method does not serialize: it returns the\n value represented by the name/value pair that should be serialized,\n or undefined if nothing should be serialized. The toJSON method\n will be passed the key associated with the value, and this will be\n bound to the value\n\n*/\nif (typeof JSON !== 'object') {\n    JSON = {};\n\n    (function () {\n        'use strict';\n\n        function f(n) {\n            // Format integers to have at least two digits.\n            return n < 10 ? '0' + n : n;\n        }\n\n        if (typeof Date.prototype.toJSON !== 'function') {\n\n            Date.prototype.toJSON = function () {\n\n                return isFinite(this.valueOf())\n                    ? this.getUTCFullYear() + '-' +\n                f(this.getUTCMonth() + 1) + '-' +\n                f(this.getUTCDate()) + 'T' +\n                f(this.getUTCHours()) + ':' +\n                f(this.getUTCMinutes()) + ':' +\n                f(this.getUTCSeconds()) + 'Z'\n                    : null;\n            };\n\n            String.prototype.toJSON =\n                Number.prototype.toJSON =\n                    Boolean.prototype.toJSON = function () {\n                        return this.valueOf();\n                    };\n        }\n\n        var cx = /[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,\n            escapable = /[\\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,\n            gap,\n            indent,\n            meta = {    // table of character substitutions\n                '\\b': '\\\\b',\n                '\\t': '\\\\t',\n                '\\n': '\\\\n',\n                '\\f': '\\\\f',\n                '\\r': '\\\\r',\n                '\"': '\\\\\"',\n                '\\\\': '\\\\\\\\'\n            },\n            rep;\n\n\n        function quote(string) {\n\n// If the string contains no control characters, no quote characters, and no\n// backslash characters, then we can safely slap some quotes around it.\n// Otherwise we must also replace the offending characters with safe escape\n// sequences.\n\n            escapable.lastIndex = 0;\n            return escapable.test(string) ? '\"' + string.replace(escapable, function (a) {\n                var c = meta[a];\n                return typeof c === 'string'\n                    ? c\n                    : '\\\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n            }) + '\"' : '\"' + string + '\"';\n        }\n\n\n        function str(key, holder) {\n\n// Produce a string from holder[key].\n\n            var i,          // The loop counter.\n                k,          // The member key.\n                v,          // The member value.\n                length,\n                mind = gap,\n                partial,\n                value = holder[key];\n\n// If the value has a toJSON method, call it to obtain a replacement value.\n\n            if (value && typeof value === 'object' &&\n                typeof value.toJSON === 'function') {\n                value = value.toJSON(key);\n            }\n\n// If we were called with a replacer function, then call the replacer to\n// obtain a replacement value.\n\n            if (typeof rep === 'function') {\n                value = rep.call(holder, key, value);\n            }\n\n// What happens next depends on the value's type.\n\n            switch (typeof value) {\n                case 'string':\n                    return quote(value);\n\n                case 'number':\n\n// JSON numbers must be finite. Encode non-finite numbers as null.\n\n                    return isFinite(value) ? String(value) : 'null';\n\n                case 'boolean':\n                case 'null':\n\n// If the value is a boolean or null, convert it to a string. Note:\n// typeof null does not produce 'null'. The case is included here in\n// the remote chance that this gets fixed someday.\n\n                    return String(value);\n\n// If the type is 'object', we might be dealing with an object or an array or\n// null.\n\n                case 'object':\n\n// Due to a specification blunder in ECMAScript, typeof null is 'object',\n// so watch out for that case.\n\n                    if (!value) {\n                        return 'null';\n                    }\n\n// Make an array to hold the partial results of stringifying this object value.\n\n                    gap += indent;\n                    partial = [];\n\n// Is the value an array?\n\n                    if (Object.prototype.toString.apply(value) === '[object Array]') {\n\n// The value is an array. Stringify every element. Use null as a placeholder\n// for non-JSON values.\n\n                        length = value.length;\n                        for (i = 0; i < length; i += 1) {\n                            partial[i] = str(i, value) || 'null';\n                        }\n\n// Join all of the elements together, separated with commas, and wrap them in\n// brackets.\n\n                        v = partial.length === 0\n                            ? '[]'\n                            : gap\n                            ? '[\\n' + gap + partial.join(',\\n' + gap) + '\\n' + mind + ']'\n                            : '[' + partial.join(',') + ']';\n                        gap = mind;\n                        return v;\n                    }\n\n// If the replacer is an array, use it to select the members to be stringified.\n\n                    if (rep && typeof rep === 'object') {\n                        length = rep.length;\n                        for (i = 0; i < length; i += 1) {\n                            if (typeof rep[i] === 'string') {\n                                k = rep[i];\n                                v = str(k, value);\n                                if (v) {\n                                    partial.push(quote(k) + (gap ? ': ' : ':') + v);\n                                }\n                            }\n                        }\n                    } else {\n\n// Otherwise, iterate through all of the keys in the object.\n\n                        for (k in value) {\n                            if (Object.prototype.hasOwnProperty.call(value, k)) {\n                                v = str(k, value);\n                                if (v) {\n                                    partial.push(quote(k) + (gap ? ': ' : ':') + v);\n                                }\n                            }\n                        }\n                    }\n\n// Join all of the member texts together, separated with commas,\n// and wrap them in braces.\n\n                    v = partial.length === 0\n                        ? '{}'\n                        : gap\n                        ? '{\\n' + gap + partial.join(',\\n' + gap) + '\\n' + mind + '}'\n                        : '{' + partial.join(',') + '}';\n                    gap = mind;\n                    return v;\n            }\n        }\n\n// If the JSON object does not yet have a stringify method, give it one.\n\n        if (typeof JSON.stringify !== 'function') {\n            JSON.stringify = function (value, replacer, space) {\n\n// The stringify method takes a value and an optional replacer, and an optional\n// space parameter, and returns a JSON text. The replacer can be a function\n// that can replace values, or an array of strings that will select the keys.\n// A default replacer method can be provided. Use of the space parameter can\n// produce text that is more easily readable.\n\n                var i;\n                gap = '';\n                indent = '';\n\n// If the space parameter is a number, make an indent string containing that\n// many spaces.\n\n                if (typeof space === 'number') {\n                    for (i = 0; i < space; i += 1) {\n                        indent += ' ';\n                    }\n\n// If the space parameter is a string, it will be used as the indent string.\n\n                } else if (typeof space === 'string') {\n                    indent = space;\n                }\n\n// If there is a replacer, it must be a function or an array.\n// Otherwise, throw an error.\n\n                rep = replacer;\n                if (replacer && typeof replacer !== 'function' &&\n                    (typeof replacer !== 'object' ||\n                    typeof replacer.length !== 'number')) {\n                    throw new Error('JSON.stringify');\n                }\n\n// Make a fake root object containing our value under the key of ''.\n// Return the result of stringifying the value.\n\n                return str('', {'': value});\n            };\n        }\n\n\n// If the JSON object does not yet have a parse method, give it one.\n\n        if (typeof JSON.parse !== 'function') {\n            JSON.parse = function (text, reviver) {\n\n// The parse method takes a text and an optional reviver function, and returns\n// a JavaScript value if the text is a valid JSON text.\n\n                var j;\n\n                function walk(holder, key) {\n\n// The walk method is used to recursively walk the resulting structure so\n// that modifications can be made.\n\n                    var k, v, value = holder[key];\n                    if (value && typeof value === 'object') {\n                        for (k in value) {\n                            if (Object.prototype.hasOwnProperty.call(value, k)) {\n                                v = walk(value, k);\n                                if (v !== undefined) {\n                                    value[k] = v;\n                                } else {\n                                    delete value[k];\n                                }\n                            }\n                        }\n                    }\n                    return reviver.call(holder, key, value);\n                }\n\n\n// Parsing happens in four stages. In the first stage, we replace certain\n// Unicode characters with escape sequences. JavaScript handles many characters\n// incorrectly, either silently deleting them, or treating them as line endings.\n\n                text = String(text);\n                cx.lastIndex = 0;\n                if (cx.test(text)) {\n                    text = text.replace(cx, function (a) {\n                        return '\\\\u' +\n                            ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n                    });\n                }\n\n// In the second stage, we run the text against regular expressions that look\n// for non-JSON patterns. We are especially concerned with '()' and 'new'\n// because they can cause invocation, and '=' because it can cause mutation.\n// But just to be safe, we want to reject all unexpected forms.\n\n// We split the second stage into 4 regexp operations in order to work around\n// crippling inefficiencies in IE's and Safari's regexp engines. First we\n// replace the JSON backslash pairs with '@' (a non-JSON character). Second, we\n// replace all simple value tokens with ']' characters. Third, we delete all\n// open brackets that follow a colon or comma or that begin the text. Finally,\n// we look to see that the remaining characters are only whitespace or ']' or\n// ',' or ':' or '{' or '}'. If that is so, then the text is safe for eval.\n\n                if (/^[\\],:{}\\s]*$/\n                        .test(text.replace(/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@')\n                            .replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g, ']')\n                            .replace(/(?:^|:|,)(?:\\s*\\[)+/g, ''))) {\n\n// In the third stage we use the eval function to compile the text into a\n// JavaScript structure. The '{' operator is subject to a syntactic ambiguity\n// in JavaScript: it can begin a block or an object literal. We wrap the text\n// in parens to eliminate the ambiguity.\n\n                    j = eval('(' + text + ')');\n\n// In the optional fourth stage, we recursively walk the new structure, passing\n// each name/value pair to a reviver function for possible transformation.\n\n                    return typeof reviver === 'function'\n                        ? walk({'': j}, '')\n                        : j;\n                }\n\n// If the text is not JSON parseable, then a SyntaxError is thrown.\n\n                throw new SyntaxError('JSON.parse');\n            };\n        }\n    }());\n}\n/* jshint ignore:end */","/* jshint ignore:start */\n\n(function() {\n\n/*!\n  * @preserve Qwery - A Blazing Fast query selector engine\n  * https://github.com/ded/qwery\n  * copyright Dustin Diaz 2012\n  * MIT License\n  */\n\n(function (name, context, definition) {\n  if (typeof module != 'undefined' && module.exports) module.exports = definition()\n  else if (typeof define == 'function' && define.amd) define(definition)\n  else context[name] = definition()\n})('qwery', this, function () {\n  var doc = document\n    , html = doc.documentElement\n    , byClass = 'getElementsByClassName'\n    , byTag = 'getElementsByTagName'\n    , qSA = 'querySelectorAll'\n    , useNativeQSA = 'useNativeQSA'\n    , tagName = 'tagName'\n    , nodeType = 'nodeType'\n    , select // main select() method, assign later\n\n    , id = /#([\\w\\-]+)/\n    , clas = /\\.[\\w\\-]+/g\n    , idOnly = /^#([\\w\\-]+)$/\n    , classOnly = /^\\.([\\w\\-]+)$/\n    , tagOnly = /^([\\w\\-]+)$/\n    , tagAndOrClass = /^([\\w]+)?\\.([\\w\\-]+)$/\n    , splittable = /(^|,)\\s*[>~+]/\n    , normalizr = /^\\s+|\\s*([,\\s\\+\\~>]|$)\\s*/g\n    , splitters = /[\\s\\>\\+\\~]/\n    , splittersMore = /(?![\\s\\w\\-\\/\\?\\&\\=\\:\\.\\(\\)\\!,@#%<>\\{\\}\\$\\*\\^'\"]*\\]|[\\s\\w\\+\\-]*\\))/\n    , specialChars = /([.*+?\\^=!:${}()|\\[\\]\\/\\\\])/g\n    , simple = /^(\\*|[a-z0-9]+)?(?:([\\.\\#]+[\\w\\-\\.#]+)?)/\n    , attr = /\\[([\\w\\-]+)(?:([\\|\\^\\$\\*\\~]?\\=)['\"]?([ \\w\\-\\/\\?\\&\\=\\:\\.\\(\\)\\!,@#%<>\\{\\}\\$\\*\\^]+)[\"']?)?\\]/\n    , pseudo = /:([\\w\\-]+)(\\(['\"]?([^()]+)['\"]?\\))?/\n    , easy = new RegExp(idOnly.source + '|' + tagOnly.source + '|' + classOnly.source)\n    , dividers = new RegExp('(' + splitters.source + ')' + splittersMore.source, 'g')\n    , tokenizr = new RegExp(splitters.source + splittersMore.source)\n    , chunker = new RegExp(simple.source + '(' + attr.source + ')?' + '(' + pseudo.source + ')?')\n\n  var walker = {\n      ' ': function (node) {\n        return node && node !== html && node.parentNode\n      }\n    , '>': function (node, contestant) {\n        return node && node.parentNode == contestant.parentNode && node.parentNode\n      }\n    , '~': function (node) {\n        return node && node.previousSibling\n      }\n    , '+': function (node, contestant, p1, p2) {\n        if (!node) return false\n        return (p1 = previous(node)) && (p2 = previous(contestant)) && p1 == p2 && p1\n      }\n    }\n\n  function cache() {\n    this.c = {}\n  }\n  cache.prototype = {\n    g: function (k) {\n      return this.c[k] || undefined\n    }\n  , s: function (k, v, r) {\n      v = r ? new RegExp(v) : v\n      return (this.c[k] = v)\n    }\n  }\n\n  var classCache = new cache()\n    , cleanCache = new cache()\n    , attrCache = new cache()\n    , tokenCache = new cache()\n\n  function classRegex(c) {\n    return classCache.g(c) || classCache.s(c, '(^|\\\\s+)' + c + '(\\\\s+|$)', 1)\n  }\n\n  // not quite as fast as inline loops in older browsers so don't use liberally\n  function each(a, fn) {\n    var i = 0, l = a.length\n    for (; i < l; i++) fn(a[i])\n  }\n\n  function flatten(ar) {\n    for (var r = [], i = 0, l = ar.length; i < l; ++i) arrayLike(ar[i]) ? (r = r.concat(ar[i])) : (r[r.length] = ar[i])\n    return r\n  }\n\n  function arrayify(ar) {\n    var i = 0, l = ar.length, r = []\n    for (; i < l; i++) r[i] = ar[i]\n    return r\n  }\n\n  function previous(n) {\n    while (n = n.previousSibling) if (n[nodeType] == 1) break;\n    return n\n  }\n\n  function q(query) {\n    return query.match(chunker)\n  }\n\n  // called using `this` as element and arguments from regex group results.\n  // given => div.hello[title=\"world\"]:foo('bar')\n  // div.hello[title=\"world\"]:foo('bar'), div, .hello, [title=\"world\"], title, =, world, :foo('bar'), foo, ('bar'), bar]\n  function interpret(whole, tag, idsAndClasses, wholeAttribute, attribute, qualifier, value, wholePseudo, pseudo, wholePseudoVal, pseudoVal) {\n    var i, m, k, o, classes\n    if (this[nodeType] !== 1) return false\n    if (tag && tag !== '*' && this[tagName] && this[tagName].toLowerCase() !== tag) return false\n    if (idsAndClasses && (m = idsAndClasses.match(id)) && m[1] !== this.id) return false\n    if (idsAndClasses && (classes = idsAndClasses.match(clas))) {\n      for (i = classes.length; i--;) if (!classRegex(classes[i].slice(1)).test(this.className)) return false\n    }\n    if (pseudo && qwery.pseudos[pseudo] && !qwery.pseudos[pseudo](this, pseudoVal)) return false\n    if (wholeAttribute && !value) { // select is just for existance of attrib\n      o = this.attributes\n      for (k in o) {\n        if (Object.prototype.hasOwnProperty.call(o, k) && (o[k].name || k) == attribute) {\n          return this\n        }\n      }\n    }\n    if (wholeAttribute && !checkAttr(qualifier, getAttr(this, attribute) || '', value)) {\n      // select is for attrib equality\n      return false\n    }\n    return this\n  }\n\n  function clean(s) {\n    return cleanCache.g(s) || cleanCache.s(s, s.replace(specialChars, '\\\\$1'))\n  }\n\n  function checkAttr(qualify, actual, val) {\n    switch (qualify) {\n    case '=':\n      return actual == val\n    case '^=':\n      return actual.match(attrCache.g('^=' + val) || attrCache.s('^=' + val, '^' + clean(val), 1))\n    case '$=':\n      return actual.match(attrCache.g('$=' + val) || attrCache.s('$=' + val, clean(val) + '$', 1))\n    case '*=':\n      return actual.match(attrCache.g(val) || attrCache.s(val, clean(val), 1))\n    case '~=':\n      return actual.match(attrCache.g('~=' + val) || attrCache.s('~=' + val, '(?:^|\\\\s+)' + clean(val) + '(?:\\\\s+|$)', 1))\n    case '|=':\n      return actual.match(attrCache.g('|=' + val) || attrCache.s('|=' + val, '^' + clean(val) + '(-|$)', 1))\n    }\n    return 0\n  }\n\n  // given a selector, first check for simple cases then collect all base candidate matches and filter\n  function _qwery(selector, _root) {\n    var r = [], ret = [], i, l, m, token, tag, els, intr, item, root = _root\n      , tokens = tokenCache.g(selector) || tokenCache.s(selector, selector.split(tokenizr))\n      , dividedTokens = selector.match(dividers)\n\n    if (!tokens.length) return r\n\n    token = (tokens = tokens.slice(0)).pop() // copy cached tokens, take the last one\n    if (tokens.length && (m = tokens[tokens.length - 1].match(idOnly))) root = byId(_root, m[1])\n    if (!root) return r\n\n    intr = q(token)\n    // collect base candidates to filter\n    els = root !== _root && root[nodeType] !== 9 && dividedTokens && /^[+~]$/.test(dividedTokens[dividedTokens.length - 1]) ?\n      function (r) {\n        while (root = root.nextSibling) {\n          root[nodeType] == 1 && (intr[1] ? intr[1] == root[tagName].toLowerCase() : 1) && (r[r.length] = root)\n        }\n        return r\n      }([]) :\n      root[byTag](intr[1] || '*')\n    // filter elements according to the right-most part of the selector\n    for (i = 0, l = els.length; i < l; i++) {\n      if (item = interpret.apply(els[i], intr)) r[r.length] = item\n    }\n    if (!tokens.length) return r\n\n    // filter further according to the rest of the selector (the left side)\n    each(r, function (e) { if (ancestorMatch(e, tokens, dividedTokens)) ret[ret.length] = e })\n    return ret\n  }\n\n  // compare element to a selector\n  function is(el, selector, root) {\n    if (isNode(selector)) return el == selector\n    if (arrayLike(selector)) return !!~flatten(selector).indexOf(el) // if selector is an array, is el a member?\n\n    var selectors = selector.split(','), tokens, dividedTokens\n    while (selector = selectors.pop()) {\n      tokens = tokenCache.g(selector) || tokenCache.s(selector, selector.split(tokenizr))\n      dividedTokens = selector.match(dividers)\n      tokens = tokens.slice(0) // copy array\n      if (interpret.apply(el, q(tokens.pop())) && (!tokens.length || ancestorMatch(el, tokens, dividedTokens, root))) {\n        return true\n      }\n    }\n    return false\n  }\n\n  // given elements matching the right-most part of a selector, filter out any that don't match the rest\n  function ancestorMatch(el, tokens, dividedTokens, root) {\n    var cand\n    // recursively work backwards through the tokens and up the dom, covering all options\n    function crawl(e, i, p) {\n      while (p = walker[dividedTokens[i]](p, e)) {\n        if (isNode(p) && (interpret.apply(p, q(tokens[i])))) {\n          if (i) {\n            if (cand = crawl(p, i - 1, p)) return cand\n          } else return p\n        }\n      }\n    }\n    return (cand = crawl(el, tokens.length - 1, el)) && (!root || isAncestor(cand, root))\n  }\n\n  function isNode(el, t) {\n    return el && typeof el === 'object' && (t = el[nodeType]) && (t == 1 || t == 9)\n  }\n\n  function uniq(ar) {\n    var a = [], i, j;\n    o:\n    for (i = 0; i < ar.length; ++i) {\n      for (j = 0; j < a.length; ++j) if (a[j] == ar[i]) continue o\n      a[a.length] = ar[i]\n    }\n    return a\n  }\n\n  function arrayLike(o) {\n    return (typeof o === 'object' && isFinite(o.length))\n  }\n\n  function normalizeRoot(root) {\n    if (!root) return doc\n    if (typeof root == 'string') return qwery(root)[0]\n    if (!root[nodeType] && arrayLike(root)) return root[0]\n    return root\n  }\n\n  function byId(root, id, el) {\n    // if doc, query on it, else query the parent doc or if a detached fragment rewrite the query and run on the fragment\n    return root[nodeType] === 9 ? root.getElementById(id) :\n      root.ownerDocument &&\n        (((el = root.ownerDocument.getElementById(id)) && isAncestor(el, root) && el) ||\n          (!isAncestor(root, root.ownerDocument) && select('[id=\"' + id + '\"]', root)[0]))\n  }\n\n  function qwery(selector, _root) {\n    var m, el, root = normalizeRoot(_root)\n\n    // easy, fast cases that we can dispatch with simple DOM calls\n    if (!root || !selector) return []\n    if (selector === window || isNode(selector)) {\n      return !_root || (selector !== window && isNode(root) && isAncestor(selector, root)) ? [selector] : []\n    }\n    if (selector && arrayLike(selector)) return flatten(selector)\n    if (m = selector.match(easy)) {\n      if (m[1]) return (el = byId(root, m[1])) ? [el] : []\n      if (m[2]) return arrayify(root[byTag](m[2]))\n      if (hasByClass && m[3]) return arrayify(root[byClass](m[3]))\n    }\n\n    return select(selector, root)\n  }\n\n  // where the root is not document and a relationship selector is first we have to\n  // do some awkward adjustments to get it to work, even with qSA\n  function collectSelector(root, collector) {\n    return function (s) {\n      var oid, nid\n      if (splittable.test(s)) {\n        if (root[nodeType] !== 9) {\n          // make sure the el has an id, rewrite the query, set root to doc and run it\n          if (!(nid = oid = root.getAttribute('id'))) root.setAttribute('id', nid = '__qwerymeupscotty')\n          s = '[id=\"' + nid + '\"]' + s // avoid byId and allow us to match context element\n          collector(root.parentNode || root, s, true)\n          oid || root.removeAttribute('id')\n        }\n        return;\n      }\n      s.length && collector(root, s, false)\n    }\n  }\n\n  var isAncestor = 'compareDocumentPosition' in html ?\n    function (element, container) {\n      return (container.compareDocumentPosition(element) & 16) == 16\n    } : 'contains' in html ?\n    function (element, container) {\n      container = container[nodeType] === 9 || container == window ? html : container\n      return container !== element && container.contains(element)\n    } :\n    function (element, container) {\n      while (element = element.parentNode) if (element === container) return 1\n      return 0\n    }\n  , getAttr = function () {\n      // detect buggy IE src/href getAttribute() call\n      var e = doc.createElement('p')\n      return ((e.innerHTML = '<a href=\"#x\">x</a>') && e.firstChild.getAttribute('href') != '#x') ?\n        function (e, a) {\n          return a === 'class' ? e.className : (a === 'href' || a === 'src') ?\n            e.getAttribute(a, 2) : e.getAttribute(a)\n        } :\n        function (e, a) { return e.getAttribute(a) }\n    }()\n  , hasByClass = !!doc[byClass]\n    // has native qSA support\n  , hasQSA = doc.querySelector && doc[qSA]\n    // use native qSA\n  , selectQSA = function (selector, root) {\n      var result = [], ss, e\n      try {\n        if (root[nodeType] === 9 || !splittable.test(selector)) {\n          // most work is done right here, defer to qSA\n          return arrayify(root[qSA](selector))\n        }\n        // special case where we need the services of `collectSelector()`\n        each(ss = selector.split(','), collectSelector(root, function (ctx, s) {\n          e = ctx[qSA](s)\n          if (e.length == 1) result[result.length] = e.item(0)\n          else if (e.length) result = result.concat(arrayify(e))\n        }))\n        return ss.length > 1 && result.length > 1 ? uniq(result) : result\n      } catch (ex) { }\n      return selectNonNative(selector, root)\n    }\n    // no native selector support\n  , selectNonNative = function (selector, root) {\n      var result = [], items, m, i, l, r, ss\n      selector = selector.replace(normalizr, '$1')\n      if (m = selector.match(tagAndOrClass)) {\n        r = classRegex(m[2])\n        items = root[byTag](m[1] || '*')\n        for (i = 0, l = items.length; i < l; i++) {\n          if (r.test(items[i].className)) result[result.length] = items[i]\n        }\n        return result\n      }\n      // more complex selector, get `_qwery()` to do the work for us\n      each(ss = selector.split(','), collectSelector(root, function (ctx, s, rewrite) {\n        r = _qwery(s, ctx)\n        for (i = 0, l = r.length; i < l; i++) {\n          if (ctx[nodeType] === 9 || rewrite || isAncestor(r[i], root)) result[result.length] = r[i]\n        }\n      }))\n      return ss.length > 1 && result.length > 1 ? uniq(result) : result\n    }\n  , configure = function (options) {\n      // configNativeQSA: use fully-internal selector or native qSA where present\n      if (typeof options[useNativeQSA] !== 'undefined')\n        select = !options[useNativeQSA] ? selectNonNative : hasQSA ? selectQSA : selectNonNative\n    }\n\n  configure({ useNativeQSA: true })\n\n  qwery.configure = configure\n  qwery.uniq = uniq\n  qwery.is = is\n  qwery.pseudos = {}\n\n  return qwery\n});\n\n/*! onDomReady.js 1.4.0 (c) 2013 Tubal Martin - MIT license | Wrapped in UMD by Okanjo */\n(function(root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        define([], factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory();\n    } else {\n        root.onDomReady = factory();\n    }\n}(this, function() {\n\n    'use strict';\n\n    var win = window,\n        doc = win.document,\n        docElem = doc.documentElement,\n\n        LOAD = \"load\",\n        FALSE = false,\n        ONLOAD = \"on\"+LOAD,\n        COMPLETE = \"complete\",\n        READYSTATE = \"readyState\",\n        ATTACHEVENT = \"attachEvent\",\n        DETACHEVENT = \"detachEvent\",\n        ADDEVENTLISTENER = \"addEventListener\",\n        DOMCONTENTLOADED = \"DOMContentLoaded\",\n        ONREADYSTATECHANGE = \"onreadystatechange\",\n        REMOVEEVENTLISTENER = \"removeEventListener\",\n\n    // W3C Event model\n        w3c = ADDEVENTLISTENER in doc,\n        top = FALSE,\n\n    // isReady: Is the DOM ready to be used? Set to true once it occurs.\n        isReady = FALSE,\n\n    // Callbacks pending execution until DOM is ready\n        callbacks = [];\n\n    // Handle when the DOM is ready\n    function ready( fn ) {\n        if ( !isReady ) {\n\n            // Make sure body exists, at least, in case IE gets a little overzealous (ticket #5443).\n            if ( !doc.body ) {\n                return defer( ready );\n            }\n\n            // Remember that the DOM is ready\n            isReady = true;\n\n            // Execute all callbacks\n            while ( fn = callbacks.shift() ) {\n                defer( fn );\n            }\n        }\n    }\n\n    // The ready event handler\n    function completed( event ) {\n        // readyState === \"complete\" is good enough for us to call the dom ready in oldIE\n        if ( w3c || event.type === LOAD || doc[READYSTATE] === COMPLETE ) {\n            detach();\n            ready();\n        }\n    }\n\n    // Clean-up method for dom ready events\n    function detach() {\n        if ( w3c ) {\n            doc[REMOVEEVENTLISTENER]( DOMCONTENTLOADED, completed, FALSE );\n            win[REMOVEEVENTLISTENER]( LOAD, completed, FALSE );\n        } else {\n            doc[DETACHEVENT]( ONREADYSTATECHANGE, completed );\n            win[DETACHEVENT]( ONLOAD, completed );\n        }\n    }\n\n    // Defers a function, scheduling it to run after the current call stack has cleared.\n    function defer( fn, wait ) {\n        // Allow 0 to be passed\n        setTimeout( fn, +wait >= 0 ? wait : 1 );\n    }\n\n    // Attach the listeners:\n\n    // Catch cases where onDomReady is called after the browser event has already occurred.\n    // we once tried to use readyState \"interactive\" here, but it caused issues like the one\n    // discovered by ChrisS here: http://bugs.jquery.com/ticket/12282#comment:15\n    if ( doc[READYSTATE] === COMPLETE ) {\n        // Handle it asynchronously to allow scripts the opportunity to delay ready\n        defer( ready );\n\n        // Standards-based browsers support DOMContentLoaded\n    } else if ( w3c ) {\n        // Use the handy event callback\n        doc[ADDEVENTLISTENER]( DOMCONTENTLOADED, completed, FALSE );\n\n        // A fallback to window.onload, that will always work\n        win[ADDEVENTLISTENER]( LOAD, completed, FALSE );\n\n        // If IE event model is used\n    } else {\n        // Ensure firing before onload, maybe late but safe also for iframes\n        doc[ATTACHEVENT]( ONREADYSTATECHANGE, completed );\n\n        // A fallback to window.onload, that will always work\n        win[ATTACHEVENT]( ONLOAD, completed );\n\n        // If IE and not a frame\n        // continually check to see if the document is ready\n        try {\n            top = win.frameElement == null && docElem;\n        } catch(e) {}\n\n        if ( top && top.doScroll ) {\n            (function doScrollCheck() {\n                if ( !isReady ) {\n                    try {\n                        // Use the trick by Diego Perini\n                        // http://javascript.nwbox.com/IEContentLoaded/\n                        top.doScroll(\"left\");\n                    } catch(e) {\n                        return defer( doScrollCheck, 50 );\n                    }\n\n                    // detach all dom ready events\n                    detach();\n\n                    // and execute any waiting functions\n                    ready();\n                }\n            })();\n        }\n    }\n\n    function onDomReady( fn ) {\n        // If DOM is ready, execute the function (async), otherwise wait\n        isReady ? defer( fn ) : callbacks.push( fn );\n    }\n\n    // Add version\n    onDomReady.version = \"1.4.0\";\n    // Add method to check if DOM is ready\n    onDomReady.isReady = function(){\n        return isReady;\n    };\n\n    return onDomReady;\n}));\n\n\n/*!\n * mustache.js - Logic-less {{mustache}} templates with JavaScript\n * http://github.com/janl/mustache.js\n */\n\n/*global define: false*/\n\n(function (global, factory) {\n  if (typeof exports === \"object\" && exports) {\n    factory(exports); // CommonJS\n  } else if (typeof define === \"function\" && define.amd) {\n    define(['exports'], factory); // AMD\n  } else {\n    factory(global.Mustache = {}); // <script>\n  }\n}(this, function (mustache) {\n\n  var Object_toString = Object.prototype.toString;\n  var isArray = Array.isArray || function (object) {\n    return Object_toString.call(object) === '[object Array]';\n  };\n\n  function isFunction(object) {\n    return typeof object === 'function';\n  }\n\n  function escapeRegExp(string) {\n    return string.replace(/[\\-\\[\\]{}()*+?.,\\\\\\^$|#\\s]/g, \"\\\\$&\");\n  }\n\n  // Workaround for https://issues.apache.org/jira/browse/COUCHDB-577\n  // See https://github.com/janl/mustache.js/issues/189\n  var RegExp_test = RegExp.prototype.test;\n  function testRegExp(re, string) {\n    return RegExp_test.call(re, string);\n  }\n\n  var nonSpaceRe = /\\S/;\n  function isWhitespace(string) {\n    return !testRegExp(nonSpaceRe, string);\n  }\n\n  var entityMap = {\n    \"&\": \"&amp;\",\n    \"<\": \"&lt;\",\n    \">\": \"&gt;\",\n    '\"': '&quot;',\n    \"'\": '&#39;',\n    \"/\": '&#x2F;'\n  };\n\n  function escapeHtml(string) {\n    return String(string).replace(/[&<>\"'\\/]/g, function (s) {\n      return entityMap[s];\n    });\n  }\n\n  var whiteRe = /\\s*/;\n  var spaceRe = /\\s+/;\n  var equalsRe = /\\s*=/;\n  var curlyRe = /\\s*\\}/;\n  var tagRe = /#|\\^|\\/|>|\\{|&|=|!/;\n\n  /**\n   * Breaks up the given `template` string into a tree of tokens. If the `tags`\n   * argument is given here it must be an array with two string values: the\n   * opening and closing tags used in the template (e.g. [ \"<%\", \"%>\" ]). Of\n   * course, the default is to use mustaches (i.e. mustache.tags).\n   *\n   * A token is an array with at least 4 elements. The first element is the\n   * mustache symbol that was used inside the tag, e.g. \"#\" or \"&\". If the tag\n   * did not contain a symbol (i.e. {{myValue}}) this element is \"name\". For\n   * all text that appears outside a symbol this element is \"text\".\n   *\n   * The second element of a token is its \"value\". For mustache tags this is\n   * whatever else was inside the tag besides the opening symbol. For text tokens\n   * this is the text itself.\n   *\n   * The third and fourth elements of the token are the start and end indices,\n   * respectively, of the token in the original template.\n   *\n   * Tokens that are the root node of a subtree contain two more elements: 1) an\n   * array of tokens in the subtree and 2) the index in the original template at\n   * which the closing tag for that section begins.\n   */\n  function parseTemplate(template, tags) {\n    if (!template)\n      return [];\n\n    var sections = [];     // Stack to hold section tokens\n    var tokens = [];       // Buffer to hold the tokens\n    var spaces = [];       // Indices of whitespace tokens on the current line\n    var hasTag = false;    // Is there a {{tag}} on the current line?\n    var nonSpace = false;  // Is there a non-space char on the current line?\n\n    // Strips all whitespace tokens array for the current line\n    // if there was a {{#tag}} on it and otherwise only space.\n    function stripSpace() {\n      if (hasTag && !nonSpace) {\n        while (spaces.length)\n          delete tokens[spaces.pop()];\n      } else {\n        spaces = [];\n      }\n\n      hasTag = false;\n      nonSpace = false;\n    }\n\n    var openingTagRe, closingTagRe, closingCurlyRe;\n    function compileTags(tags) {\n      if (typeof tags === 'string')\n        tags = tags.split(spaceRe, 2);\n\n      if (!isArray(tags) || tags.length !== 2)\n        throw new Error('Invalid tags: ' + tags);\n\n      openingTagRe = new RegExp(escapeRegExp(tags[0]) + '\\\\s*');\n      closingTagRe = new RegExp('\\\\s*' + escapeRegExp(tags[1]));\n      closingCurlyRe = new RegExp('\\\\s*' + escapeRegExp('}' + tags[1]));\n    }\n\n    compileTags(tags || mustache.tags);\n\n    var scanner = new Scanner(template);\n\n    var start, type, value, chr, token, openSection;\n    while (!scanner.eos()) {\n      start = scanner.pos;\n\n      // Match any text between tags.\n      value = scanner.scanUntil(openingTagRe);\n\n      if (value) {\n        for (var i = 0, valueLength = value.length; i < valueLength; ++i) {\n          chr = value.charAt(i);\n\n          if (isWhitespace(chr)) {\n            spaces.push(tokens.length);\n          } else {\n            nonSpace = true;\n          }\n\n          tokens.push([ 'text', chr, start, start + 1 ]);\n          start += 1;\n\n          // Check for whitespace on the current line.\n          if (chr === '\\n')\n            stripSpace();\n        }\n      }\n\n      // Match the opening tag.\n      if (!scanner.scan(openingTagRe))\n        break;\n\n      hasTag = true;\n\n      // Get the tag type.\n      type = scanner.scan(tagRe) || 'name';\n      scanner.scan(whiteRe);\n\n      // Get the tag value.\n      if (type === '=') {\n        value = scanner.scanUntil(equalsRe);\n        scanner.scan(equalsRe);\n        scanner.scanUntil(closingTagRe);\n      } else if (type === '{') {\n        value = scanner.scanUntil(closingCurlyRe);\n        scanner.scan(curlyRe);\n        scanner.scanUntil(closingTagRe);\n        type = '&';\n      } else {\n        value = scanner.scanUntil(closingTagRe);\n      }\n\n      // Match the closing tag.\n      if (!scanner.scan(closingTagRe))\n        throw new Error('Unclosed tag at ' + scanner.pos);\n\n      token = [ type, value, start, scanner.pos ];\n      tokens.push(token);\n\n      if (type === '#' || type === '^') {\n        sections.push(token);\n      } else if (type === '/') {\n        // Check section nesting.\n        openSection = sections.pop();\n\n        if (!openSection)\n          throw new Error('Unopened section \"' + value + '\" at ' + start);\n\n        if (openSection[1] !== value)\n          throw new Error('Unclosed section \"' + openSection[1] + '\" at ' + start);\n      } else if (type === 'name' || type === '{' || type === '&') {\n        nonSpace = true;\n      } else if (type === '=') {\n        // Set the tags for the next time around.\n        compileTags(value);\n      }\n    }\n\n    // Make sure there are no open sections when we're done.\n    openSection = sections.pop();\n\n    if (openSection)\n      throw new Error('Unclosed section \"' + openSection[1] + '\" at ' + scanner.pos);\n\n    return nestTokens(squashTokens(tokens));\n  }\n\n  /**\n   * Combines the values of consecutive text tokens in the given `tokens` array\n   * to a single token.\n   */\n  function squashTokens(tokens) {\n    var squashedTokens = [];\n\n    var token, lastToken;\n    for (var i = 0, numTokens = tokens.length; i < numTokens; ++i) {\n      token = tokens[i];\n\n      if (token) {\n        if (token[0] === 'text' && lastToken && lastToken[0] === 'text') {\n          lastToken[1] += token[1];\n          lastToken[3] = token[3];\n        } else {\n          squashedTokens.push(token);\n          lastToken = token;\n        }\n      }\n    }\n\n    return squashedTokens;\n  }\n\n  /**\n   * Forms the given array of `tokens` into a nested tree structure where\n   * tokens that represent a section have two additional items: 1) an array of\n   * all tokens that appear in that section and 2) the index in the original\n   * template that represents the end of that section.\n   */\n  function nestTokens(tokens) {\n    var nestedTokens = [];\n    var collector = nestedTokens;\n    var sections = [];\n\n    var token, section;\n    for (var i = 0, numTokens = tokens.length; i < numTokens; ++i) {\n      token = tokens[i];\n\n      switch (token[0]) {\n      case '#':\n      case '^':\n        collector.push(token);\n        sections.push(token);\n        collector = token[4] = [];\n        break;\n      case '/':\n        section = sections.pop();\n        section[5] = token[2];\n        collector = sections.length > 0 ? sections[sections.length - 1][4] : nestedTokens;\n        break;\n      default:\n        collector.push(token);\n      }\n    }\n\n    return nestedTokens;\n  }\n\n  /**\n   * A simple string scanner that is used by the template parser to find\n   * tokens in template strings.\n   */\n  function Scanner(string) {\n    this.string = string;\n    this.tail = string;\n    this.pos = 0;\n  }\n\n  /**\n   * Returns `true` if the tail is empty (end of string).\n   */\n  Scanner.prototype.eos = function () {\n    return this.tail === \"\";\n  };\n\n  /**\n   * Tries to match the given regular expression at the current position.\n   * Returns the matched text if it can match, the empty string otherwise.\n   */\n  Scanner.prototype.scan = function (re) {\n    var match = this.tail.match(re);\n\n    if (!match || match.index !== 0)\n      return '';\n\n    var string = match[0];\n\n    this.tail = this.tail.substring(string.length);\n    this.pos += string.length;\n\n    return string;\n  };\n\n  /**\n   * Skips all text until the given regular expression can be matched. Returns\n   * the skipped string, which is the entire tail if no match can be made.\n   */\n  Scanner.prototype.scanUntil = function (re) {\n    var index = this.tail.search(re), match;\n\n    switch (index) {\n    case -1:\n      match = this.tail;\n      this.tail = \"\";\n      break;\n    case 0:\n      match = \"\";\n      break;\n    default:\n      match = this.tail.substring(0, index);\n      this.tail = this.tail.substring(index);\n    }\n\n    this.pos += match.length;\n\n    return match;\n  };\n\n  /**\n   * Represents a rendering context by wrapping a view object and\n   * maintaining a reference to the parent context.\n   */\n  function Context(view, parentContext) {\n    this.view = view == null ? {} : view;\n    this.cache = { '.': this.view };\n    this.parent = parentContext;\n  }\n\n  /**\n   * Creates a new context using the given view with this context\n   * as the parent.\n   */\n  Context.prototype.push = function (view) {\n    return new Context(view, this);\n  };\n\n  /**\n   * Returns the value of the given name in this context, traversing\n   * up the context hierarchy if the value is absent in this context's view.\n   */\n  Context.prototype.lookup = function (name) {\n    var cache = this.cache;\n\n    var value;\n    if (name in cache) {\n      value = cache[name];\n    } else {\n      var context = this, names, index;\n\n      while (context) {\n        if (name.indexOf('.') > 0) {\n          value = context.view;\n          names = name.split('.');\n          index = 0;\n\n          while (value != null && index < names.length)\n            value = value[names[index++]];\n        } else if (typeof context.view == 'object') {\n          value = context.view[name];\n        }\n\n        if (value != null)\n          break;\n\n        context = context.parent;\n      }\n\n      cache[name] = value;\n    }\n\n    if (isFunction(value))\n      value = value.call(this.view);\n\n    return value;\n  };\n\n  /**\n   * A Writer knows how to take a stream of tokens and render them to a\n   * string, given a context. It also maintains a cache of templates to\n   * avoid the need to parse the same template twice.\n   */\n  function Writer() {\n    this.cache = {};\n  }\n\n  /**\n   * Clears all cached templates in this writer.\n   */\n  Writer.prototype.clearCache = function () {\n    this.cache = {};\n  };\n\n  /**\n   * Parses and caches the given `template` and returns the array of tokens\n   * that is generated from the parse.\n   */\n  Writer.prototype.parse = function (template, tags) {\n    var cache = this.cache;\n    var tokens = cache[template];\n\n    if (tokens == null)\n      tokens = cache[template] = parseTemplate(template, tags);\n\n    return tokens;\n  };\n\n  /**\n   * High-level method that is used to render the given `template` with\n   * the given `view`.\n   *\n   * The optional `partials` argument may be an object that contains the\n   * names and templates of partials that are used in the template. It may\n   * also be a function that is used to load partial templates on the fly\n   * that takes a single argument: the name of the partial.\n   */\n  Writer.prototype.render = function (template, view, partials) {\n    var tokens = this.parse(template);\n    var context = (view instanceof Context) ? view : new Context(view);\n    return this.renderTokens(tokens, context, partials, template);\n  };\n\n  /**\n   * Low-level method that renders the given array of `tokens` using\n   * the given `context` and `partials`.\n   *\n   * Note: The `originalTemplate` is only ever used to extract the portion\n   * of the original template that was contained in a higher-order section.\n   * If the template doesn't use higher-order sections, this argument may\n   * be omitted.\n   */\n  Writer.prototype.renderTokens = function (tokens, context, partials, originalTemplate) {\n    var buffer = '';\n\n    var token, symbol, value;\n    for (var i = 0, numTokens = tokens.length; i < numTokens; ++i) {\n      value = undefined;\n      token = tokens[i];\n      symbol = token[0];\n\n      if (symbol === '#') value = this._renderSection(token, context, partials, originalTemplate);\n      else if (symbol === '^') value = this._renderInverted(token, context, partials, originalTemplate);\n      else if (symbol === '>') value = this._renderPartial(token, context, partials, originalTemplate);\n      else if (symbol === '&') value = this._unescapedValue(token, context);\n      else if (symbol === 'name') value = this._escapedValue(token, context);\n      else if (symbol === 'text') value = this._rawValue(token);\n\n      if (value !== undefined)\n        buffer += value;\n    }\n\n    return buffer;\n  };\n\n  Writer.prototype._renderSection = function (token, context, partials, originalTemplate) {\n    var self = this;\n    var buffer = '';\n    var value = context.lookup(token[1]);\n\n    // This function is used to render an arbitrary template\n    // in the current context by higher-order sections.\n    function subRender(template) {\n      return self.render(template, context, partials);\n    }\n\n    if (!value) return;\n\n    if (isArray(value)) {\n      for (var j = 0, valueLength = value.length; j < valueLength; ++j) {\n        buffer += this.renderTokens(token[4], context.push(value[j]), partials, originalTemplate);\n      }\n    } else if (typeof value === 'object' || typeof value === 'string') {\n      buffer += this.renderTokens(token[4], context.push(value), partials, originalTemplate);\n    } else if (isFunction(value)) {\n      if (typeof originalTemplate !== 'string')\n        throw new Error('Cannot use higher-order sections without the original template');\n\n      // Extract the portion of the original template that the section contains.\n      value = value.call(context.view, originalTemplate.slice(token[3], token[5]), subRender);\n\n      if (value != null)\n        buffer += value;\n    } else {\n      buffer += this.renderTokens(token[4], context, partials, originalTemplate);\n    }\n    return buffer;\n  };\n\n  Writer.prototype._renderInverted = function(token, context, partials, originalTemplate) {\n    var value = context.lookup(token[1]);\n\n    // Use JavaScript's definition of falsy. Include empty arrays.\n    // See https://github.com/janl/mustache.js/issues/186\n    if (!value || (isArray(value) && value.length === 0))\n      return this.renderTokens(token[4], context, partials, originalTemplate);\n  };\n\n  Writer.prototype._renderPartial = function(token, context, partials) {\n    if (!partials) return;\n\n    var value = isFunction(partials) ? partials(token[1]) : partials[token[1]];\n    if (value != null)\n      return this.renderTokens(this.parse(value), context, partials, value);\n  };\n\n  Writer.prototype._unescapedValue = function(token, context) {\n    var value = context.lookup(token[1]);\n    if (value != null)\n      return value;\n  };\n\n  Writer.prototype._escapedValue = function(token, context) {\n    var value = context.lookup(token[1]);\n    if (value != null)\n      return mustache.escape(value);\n  };\n\n  Writer.prototype._rawValue = function(token) {\n    return token[1];\n  };\n\n  mustache.name = \"mustache.js\";\n  mustache.version = \"1.1.0\";\n  mustache.tags = [ \"{{\", \"}}\" ];\n\n  // All high-level mustache.* functions use this writer.\n  var defaultWriter = new Writer();\n\n  /**\n   * Clears all cached templates in the default writer.\n   */\n  mustache.clearCache = function () {\n    return defaultWriter.clearCache();\n  };\n\n  /**\n   * Parses and caches the given template in the default writer and returns the\n   * array of tokens it contains. Doing this ahead of time avoids the need to\n   * parse templates on the fly as they are rendered.\n   */\n  mustache.parse = function (template, tags) {\n    return defaultWriter.parse(template, tags);\n  };\n\n  /**\n   * Renders the `template` with the given `view` and `partials` using the\n   * default writer.\n   */\n  mustache.render = function (template, view, partials) {\n    return defaultWriter.render(template, view, partials);\n  };\n\n  // This is here for backwards compatibility with 0.4.x.\n  mustache.to_html = function (template, view, partials, send) {\n    var result = mustache.render(template, view, partials);\n\n    if (isFunction(send)) {\n      send(result);\n    } else {\n      return result;\n    }\n  };\n\n  // Export the escaping function so that the user may override it.\n  // See https://github.com/janl/mustache.js/issues/244\n  mustache.escape = escapeHtml;\n\n  // Export these mainly for testing, but also for advanced usage.\n  mustache.Scanner = Scanner;\n  mustache.Context = Context;\n  mustache.Writer = Writer;\n\n}));\n\n\n}).apply(okanjo);\n\n/* jshint ignore:end */","//noinspection ThisExpressionReferencesGlobalObjectJS\n(function(okanjo, window) {\n\n\n    function OkanjoMetrics() {\n\n        this.default_channel = this.channel.external;\n\n        this._queue = [];\n\n        // Generate a page id\n        this.pageId = okanjo.util.shortid();\n\n        var pageArgs = okanjo.util.getPageArguments(true),\n            urlSid = pageArgs[this.msid_key],\n            cookieSid = okanjo.Cookie.get(this.msid_key),\n            sourceContext = pageArgs[this.source_cx],\n            sourceChannel = pageArgs[this.source_ch];\n\n        // If for some reason, both are set, replace the cookie with the uri value (# CORRELATION)\n        if (urlSid && cookieSid && urlSid != cookieSid) {\n            this.trackEvent(this.object_type.metric_session, this.event_type.correlation, {\n                id: urlSid+\"_\"+cookieSid,\n                ch: this.default_channel,\n                _noProcess: true\n            });\n            okanjo.Cookie.set(this.msid_key, urlSid, this.msid_ttl);\n        }\n\n        this.sid = urlSid || cookieSid || null;\n        this.sourceCh = sourceChannel || null;\n        this.sourceCx = sourceContext || null;\n\n        this._lastKey = undefined;\n    }\n\n    OkanjoMetrics.prototype = {\n\n        msid_key: \"ok_msid\",\n        source_cx: \"ok_cx\",\n        source_ch: \"ok_ch\",\n        msid_ttl: 1460,\n\n        strip_meta: ['key','callback','metrics_channel_context','metrics_context','mode'],\n\n        constructor: OkanjoMetrics,\n\n        event_type: {\n            view: 'vw',\n            impression: 'imp',\n            interaction: 'int',\n            correlation: 'cor'\n        },\n\n\n        action: {\n            click: \"click\",\n            inline_click: \"inline_click\"\n        },\n\n\n        object_type: {\n            thirdparty_ad: 'ta',\n            cart: 'ct',\n            page: 'pg',\n            widget: 'wg',\n            product: 'pr',\n            store: 'st',\n            cause: 'ca',\n            marketplace: 'mp',\n            order: 'or',\n            order_item: 'oi',\n            user: 'ur',\n            metric_session: 'mt'\n        },\n\n\n        channel: {\n            product_widget: 'pw',\n            ad_widget: 'aw',\n            store_widget: 'sw',\n            marketplace: 'mp',\n            external: 'ex'\n        },\n\n\n        environment: {\n            live: \"live\",\n            testing: \"testing\"\n        },\n\n\n        /**\n         * Reports an event\n         * @param {string} object_type\n         * @param {string} event_type\n         * @param {{key: string, ea: string, id: string, ch: string, cx: string, url: string, env: string, m: object }} data\n         * @param callback\n         */\n        trackEvent: function(object_type, event_type, data, callback) {\n\n            data = data || {};\n            data.object_type = object_type;\n            data.event_type = event_type;\n\n            // Make the key stick in case future events don't have an API key, we can get a fuzzy idea who's responsible for the event\n            // This is also useful for auto page load events, were there is no key defined at time the event was created\n            this._lastKey = data.key || data.key || (data.m && data.m.key) || okanjo.key || this._lastKey || undefined;\n\n            // Queue the event for publishing\n            this.push(data, callback);\n        },\n\n\n        /**\n         * Reports a page view\n         * @param {{key: string, ea: string, id: string, ch: string, cx: string, url: string, env: string, m: object }} [data]\n         * @param callback\n         */\n        trackPageView: function(data, callback) {\n\n            data = data || {};\n\n            // Set the current page URL as the object id\n            data.id = data.id || window.location.href;\n\n            // Set the context to external unless instructed otherwise\n            data.ch = data.ch || this.default_channel;\n\n            // Track the event\n            this.trackEvent(this.object_type.page, this.event_type.view, data, callback);\n        },\n\n\n        /**\n         * Sends an event\n         * @param event\n         * @param callback\n         */\n        track: function(event, callback) {\n\n            if (!event || typeof event !== \"object\") { console.warn('[Okanjo.Metrics] event object data required'); return; }\n            if (!event.object_type) { console.warn('[Okanjo.Metrics] object_type required'); return; }\n            if (!event.event_type) { console.warn('[Okanjo.Metrics] event_type required'); return; }\n\n            var object_type = event.object_type,\n                event_type = event.event_type;\n\n            delete event.object_type;\n            delete event.event_type;\n\n            this.normalizeEventData(event);\n\n            okanjo.exec(okanjo.getRoute(okanjo.routes.metrics, { object_type: object_type, event_type: event_type }), event, function(err, res) {\n                if (err) { console.warn('[Okanjo.Metrics] Reporting failed', err, res); }\n\n                /*jslint -W030 */\n                callback && (callback(err, res));\n            });\n\n        },\n\n        /**\n         * Normalizes event data for consistency and adds common information to the event\n         * @param event\n         */\n        normalizeEventData: function(event) {\n\n            // Stick the key in there, if not already set\n            event.key = event.key || (event.m && event.m.key) || okanjo.key || this._lastKey || undefined;\n\n            // Stick the publisher session token in there too, if present\n            if (this.sid) {\n                event.sid = this.sid;\n            }\n\n            // Clone the metadata, since it might be a direct reference to a widget property\n            // Deleting properties on the meta object could be very destructive\n            if (event.m) {\n                var meta = {};\n                for(var i in event.m) {\n                    if (event.m.hasOwnProperty(i) && this.strip_meta.indexOf(i) < 0) {\n                        meta[i] = event.m[i];\n                    }\n                }\n                event.m = meta;\n            } else {\n                event.m = {};\n            }\n\n\n            // If we were referred through a particular channel/context, then hold on to that for events emitted by this page\n            if (this.sourceCh || this.sourceCx) {\n                if (this.sourceCh) { event.m.ref_ch = this.sourceCh; }\n                if (this.sourceCx) { event.m.ref_cx = this.sourceCx; }\n            }\n\n            // Automatically attach page load id\n            event.m.pgid = this.pageId;\n\n            // Automatically attach JS build version\n            event.m.ok_ver = okanjo.version;\n\n            // Pass the page's source reference\n            if (document.referrer) {\n                event.ref = document.referrer;\n            }\n        },\n\n\n        ///**\n        // * Generates the full URL to execute to track the metric. Useful for page redirection instead of straight tracking\n        // * @param object_type\n        // * @param event_type\n        // * @param data\n        // * @return {*}\n        // */\n        //getMetricUrl: function(object_type, event_type, data) {\n        //    return okanjo.JSONP.makeUrl({\n        //        url: okanjo.getRoute(okanjo.routes.metrics, { object_type: object_type, event_type: event_type }),\n        //        data: data\n        //    });\n        //},\n\n\n        /**\n         * Update the metric sid to live for 4 years if not present\n         * @param sid\n         */\n        updateSid: function(sid) {\n            if (!this.sid && sid) {\n                this.sid = sid;\n                okanjo.Cookie.set(this.msid_key, sid, this.msid_ttl);\n            }\n        },\n\n\n        /**\n         * Queues an event for publishing\n         * @param event\n         * @param callback\n         */\n        push: function(event, callback) {\n            this._queue.push({ event: event, callback: callback });\n\n            // Start burning down the queue, unless the event says not to\n            if (event._noProcess) {\n                delete event._noProcess;\n            } else {\n                this._processQueue();\n            }\n        },\n\n\n        /**\n         * Processes the event queue\n         * @private\n         */\n        _processQueue: function() {\n            // If the queue is not already being processed, and there's stuff to process, continue sending them\n            if (!this._processTimeout && this._queue.length > 0) {\n                var self = this;\n                this._processTimeout = setTimeout(function() {\n\n                    var item = self._queue.shift();\n                    if (item === undefined) {\n                        // Nothing in the queue, get outta here\n                        self._processTimeout = null;\n                    } else {\n                        // Track the item\n                        self.track(item.event, function(err, res) {\n\n                            // Update / Set the metric sid on the publisher\n                            if (res && res.data && res.data.sid) self.updateSid(res.data.sid);\n\n                            // When the item is done being tracked, iterate to the next metric then fire it's callback if set\n                            self._processTimeout = null;\n                            self._processQueue();\n                            /*jslint -W030 */\n                            item.callback && item.callback(err, res);\n                        });\n                    }\n\n                }, 0);\n            }\n        },\n\n\n        /**\n         * Injects the elements box rectangle coordinates and page size into the given data object\n         * @param element\n         * @param [data]\n         * @return {*|{}}\n         */\n        includeElementInfo: function(element, data) {\n\n            var page = okanjo.util.getPageSize(),\n                size = okanjo.util.getElementPosition(element);\n\n            data = data || {};\n            data.pw = page.w;\n            data.ph = page.h;\n            data.x1 = size.x1;\n            data.y1 = size.y1;\n            data.x2 = size.x2;\n            data.y2 = size.y2;\n\n            return data;\n        },\n\n\n        /**\n         * Injects the viewport rectangle coordinates into the given data object\n         * @param data\n         * @return {*|{}}\n         */\n        includeViewportInfo: function(data) {\n\n            var vp = okanjo.util.getViewportSize(),\n                pos = okanjo.util.getScrollPosition();\n\n            data = data || {};\n\n            data.vx1 = pos.x;\n            data.vy1 = pos.y;\n            data.vx2 = data.vx1+vp.vw;\n            data.vy2 = data.vy1+vp.vh;\n\n            return data;\n        },\n\n        /**\n         * Injects the event information into the given data object\n         * @param event\n         * @param data\n         * @return {*|{}}\n         */\n        includeEventInfo: function(event, data) {\n            var pos = okanjo.util.getEventPosition(event);\n            data.ex = pos.ex;\n            data.ey = pos.ey;\n            return data;\n        },\n\n        /**\n         * Copies a config object and another thing and flattens it\n         * @param config\n         * @param base\n         * @return {{}|*}\n         */\n        copy: function(config, base) {\n            return okanjo.util.flatten(okanjo.util.deepClone(config, base));\n        },\n\n        /**\n         * Ensure that all parameters are less than the data limit\n         * @param data\n         * @return {*}\n         */\n        truncate: function(data) {\n            for(var i in data) {\n                if (data.hasOwnProperty(i) && typeof data[i] === \"string\") {\n                    data[i] = data[i].substr(0, 255);\n                }\n            }\n            return data;\n        }\n    };\n\n    okanjo.metrics = new OkanjoMetrics();\n\n})(okanjo, this);\n","//noinspection ThisExpressionReferencesGlobalObjectJS,JSUnusedLocalSymbols\n(function(okanjo, window) {\n\n    // Track the page view, but don't send it right away.\n    // Send it in one full second unless something else pushes an event\n    // This way, we have a chance that the api key will be set globally\n    okanjo.metrics.trackPageView({_noProcess:true});\n    setTimeout(function() {\n        okanjo.metrics._processQueue();\n    }, 1000);\n\n})(okanjo || this);","//noinspection ThisExpressionReferencesGlobalObjectJS,JSUnusedLocalSymbols\n/** Based on https://gist.github.com/mudge/5830382 **/\n(function(okanjo, window) {\n\n    var indexOf = function (haystack, needle) {\n            return haystack.indexOf(needle);\n        },\n\n        /* Polyfill indexOf. */\n        EventEmitter = function () {\n            this.events = {};\n        };\n\n    EventEmitter.prototype.on = function (event, listener) {\n        if (typeof this.events[event] !== 'object') {\n            this.events[event] = [];\n        }\n\n        this.events[event].push(listener);\n    };\n\n    EventEmitter.prototype.removeListener = function (event, listener) {\n        var idx;\n\n        if (typeof this.events[event] === 'object') {\n            idx = indexOf(this.events[event], listener);\n\n            if (idx > -1) {\n                this.events[event].splice(idx, 1);\n            }\n        }\n    };\n\n    EventEmitter.prototype.emit = function (event) {\n        var i, listeners, length, args = [].slice.call(arguments, 1);\n\n        if (typeof this.events[event] === 'object') {\n            listeners = this.events[event].slice();\n            length = listeners.length;\n\n            for (i = 0; i < length; i++) {\n                listeners[i].apply(this, args);\n            }\n        }\n    };\n\n    EventEmitter.prototype.once = function (event, listener) {\n        this.on(event, function g () {\n            this.removeListener(event, g);\n            listener.apply(this, arguments);\n        });\n    };\n\n    okanjo._EventEmitter = EventEmitter;\n    return EventEmitter;\n\n})(okanjo, this);","//noinspection ThisExpressionReferencesGlobalObjectJS,JSUnusedLocalSymbols\n(function(okanjo, window) {\n\n    var cache = okanjo.Cache,\n\n        WidgetBase = okanjo._Widget = function Widget(element, config) {\n\n            okanjo._EventEmitter.call(this);\n\n            //noinspection JSValidateTypes\n            if (!element || typeof element !== 'object' || element.nodeType === undefined) {\n                throw new Error('Invalid element - must be a valid DOM element');\n            }\n\n            if ((typeof config !== \"undefined\") && (typeof config !== \"object\")) {\n                throw new Error('Invalid configuration, must be an object or nothing at all, got: ' + typeof config);\n            } else {\n                config = config || {};\n            }\n\n            // Generate widget instance id\n            this.instanceId = okanjo.util.shortid();\n\n            this.element = element;\n            this.config = config || { };\n\n            this.configMap = { };\n\n            this.templates = {\n                error: \"okanjo.error\"\n            };\n\n            this.css = { };\n        };\n\n    okanjo.util.inherits(WidgetBase, okanjo._EventEmitter);\n\n    var proto = WidgetBase.prototype;\n\n    proto.widgetName = \"BaseWidget\";\n\n    proto.config = null;\n    proto.use_cache = false;\n    proto.cache_key_prefix = 'ok_widget_';\n    proto.cache_ttl = 60000;\n    proto.cacheKeyAttributes = 'id'.split(','); // Parameters to compile to generate the cache key\n\n    /**\n     * Loads the widget\n     */\n    proto.init = function() {\n\n        // Parse the final widget instance configuration\n        this.parseConfiguration();\n\n        // Override template names if given as parameters\n        this.processTemplateOverrides();\n\n        // Make sure that the templates specified are present to render the widget\n        this.ensureTemplates();\n\n        // Ensure we have a widget key or bail out if we don't\n        if (!this.findWidgetKey()) return;\n\n        // Run the widget's main init logic, and  bail if needed\n        if (!this.load()) return;\n\n        // Async clean the cache, if needed\n        this.autoCleanCache();\n    };\n\n\n    /**\n     * Does some magic to try to track down the widget key to use for requests\n     * @returns {boolean}\n     */\n    proto.findWidgetKey = function() {\n\n        // Attempt to locate the proper widget key to use for this instance\n        if (!okanjo.util.empty(this.config.key)) {\n            // Use the key given in the widget instance configuration\n            this.key = this.config.key;\n            this.config.key = this.key;\n            return true;\n        } else if (!okanjo.util.empty(okanjo.key)) {\n            // Use the key on the okanjo instance if specified\n            this.key = okanjo.key;\n            this.config.key = this.key;\n            return true;\n        }\n\n        // Still no key?\n        if(!okanjo.util.empty(this.key)) {\n            this.element.innerHTML = okanjo.mvc.render(this.templates.error, this, { message: 'Missing Okanjo key.' });\n            okanjo.report(this.widgetName, 'Missing key. Define one using okanjo.configure or pass the key parameter as an option in the '+this.widgetName+' constructor');\n            return false;\n        } else {\n            this.config.key = this.key;\n            return true;\n        }\n    };\n\n\n    /**\n     * Check for configuration parameters that start with template_ and css_, and replace the template and css templates where specified.\n     */\n    proto.processTemplateOverrides = function() {\n\n        var m;\n        for (var i in this.config) {\n            if (this.config.hasOwnProperty(i)) {\n\n                // Check for template override\n                m = i.match(/^template_(.+)$/);\n                //noinspection JSUnresolvedFunction\n                if (m !== null && this.templates.hasOwnProperty(m[1])) {\n                    this.templates[m[1]] = this.config[i];\n                } else {\n                    // Check for css override\n                    m = i.match(/^css_(.+)$/);\n                    //noinspection JSUnresolvedFunction\n                    if (m !== null && this.css.hasOwnProperty(m[1])) {\n                        this.css[m[1]] = this.config[i];\n                    }\n                }\n\n            }\n        }\n\n    };\n\n\n    /**\n     * Make sure that a set of templates have been defined\n     */\n    proto.ensureTemplates = function() {\n        var templates = this.templates,\n            css = this.css,\n            key;\n        for (key in templates) {\n            //noinspection JSUnresolvedFunction\n            if (templates.hasOwnProperty(key)) {\n                if (!okanjo.mvc.isTemplateRegistered(templates[key])) throw new Error('[Okanjo.'+this.widgetName+'] Missing template: ' + templates[key] + \". Did you forget to include the template?\");\n            }\n        }\n        for (key in css) {\n            //noinspection JSUnresolvedFunction\n            if (css.hasOwnProperty(key)) {\n                if (!okanjo.mvc.isCssRegistered(css[key])) throw new Error('[Okanjo.'+this.widgetName+'] Missing css block: ' + css[key] + \". Did you forget to include the css template?\");\n            }\n        }\n    };\n\n\n    /**\n     * Parses the widget configuration by merging data attributes on top of the base configuration given in the constructor\n     */\n    proto.parseConfiguration = function() {\n        //noinspection JSUnresolvedVariable\n        var attributes = okanjo.util.data(this.element);\n\n        okanjo.util.copyIfSetMap(this.config, attributes, this.configMap, { stripEmpty: true });\n    };\n\n\n    /**\n     * Core widget loader. Override this!\n     * @returns {boolean}\n     */\n    proto.load = function() {\n\n        // TODO - override this on the actual wideget implementation\n\n        return true;\n    };\n\n\n    /**\n     * Async cleans the widget cache\n     */\n    proto.autoCleanCache = function() {\n        if (this.use_cache) {\n            var self = this;\n            setTimeout(function () {\n                self.cleanCache();\n            }, 2000);\n        }\n    };\n\n\n    /**\n     * If no canonical url or text was given in the configuration, this method will return the current page url to use\n     * It will not be very nice, and will just use the path. Query string and fragment will be stripped\n     * @returns {string} - The URL of the current page to have Okanjo analyze\n     */\n    proto.getCurrentPageUrl = function() {\n\n        // While we're at it, let's escape fragments too (#fun)\n        //var url = window.location.href,\n        //    hashBangIndex = url.indexOf('#!'),\n        //    hashIndex = hashBangIndex >= 0 ? hashBangIndex : url.indexOf('#');\n        //\n        //if (hashIndex >= 0) {\n        //    var uri = url.substring(0, hashIndex),\n        //        fragment = encodeURIComponent(url.substring(hashIndex + (hashBangIndex >= 0 ? 2 : 1)));\n        //    url = uri + (uri.indexOf('?') >= 0 ? '&' : '?') + '_escaped_fragment_=' + fragment;\n        //}\n\n        // On second thought, we're not so nice\n        var href = window.location.href,\n            candidatePos = [href.indexOf('?'), href.indexOf('#')].filter(function(pos) { return pos >= 0; }),\n            stopPos = candidatePos.length > 0 ? Math.min.apply(null, candidatePos) : -1;\n\n        return stopPos > 0 ? href.substr(0, stopPos) : href;\n    };\n\n\n    /**\n     * Generates a new cache key unique to the configuration of this widget instance\n     * @returns {string}\n     */\n    proto.getCacheKey = function() {\n        var parts = [window.location.host + window.location.pathname], keys = this.cacheKeyAttributes;\n        for(var i = 0; i < keys.length; i++) {\n            if (this.config[keys[i]] !== undefined) {\n                parts.push(keys[i], this.config[keys[i]]);\n            }\n        }\n        return this.cache_key_prefix+okanjo.util.hash(parts.join(';'));\n    };\n\n\n    /**\n     * Purges expired keys from the cache\n     */\n    proto.cleanCache = function() {\n        try {\n            var now = (new Date()).getTime(), expireKeys = [], safeExpireKeys = [];\n            for (var i = 0; i < cache.length; i++) {\n                var key = cache.key(i);\n                if (key.indexOf(this.cache_key_prefix) === 0 && key.indexOf('_expires') < 0) { // Ignore _expires keys\n\n                    // Look for an expirey\n                    var expires = cache.getItem(key+\"_expires\");\n                    if (expires !== null && now < parseInt(expires)) {\n                        // Save the key!\n                        safeExpireKeys.push(key+\"_expires\");\n                    } else {\n                        // Check if the expires\n                        cache.removeItem(key);\n                        cache.removeItem(key + \"_expires\");\n                    }\n                } else if (key.indexOf('_expires') >= 0) {\n                    expireKeys.push(key);\n                }\n            }\n\n            for (i = 0; i < expireKeys.length; i++) {\n                if (safeExpireKeys.indexOf(expireKeys[i]) < 0) {\n                    cache.removeItem(expireKeys[i]);\n                }\n            }\n\n        } catch (e) {\n            okanjo.report(this.widgetName, e);\n        }\n    };\n\n\n    /**\n     * Pull a key from the cache, if it has not expired yet\n     * @returns boolean – The value of what was cached, or null if nothing\n     */\n    proto.loadFromCache = function(cacheKey) {\n        // Check if items are cached, and if we should use them\n        try {\n            var val = cache.getItem(cacheKey),\n                expires = cache.getItem(cacheKey+\"_expires\"),\n                now = (new Date()).getTime();\n\n            // Make sure exists and has not expired\n            if (val !== null && expires !== null && now < parseInt(expires)) {\n                return JSON.parse(val);\n            } else {\n                // Purge if expired\n                cache.removeItem(cacheKey);\n                cache.removeItem(cacheKey + \"_expires\");\n            }\n        } catch (e) {\n            okanjo.report(this.widgetName, e);\n        }\n\n        return null;\n    };\n\n\n    /**\n     * Save a key to the cache\n     * @param cacheKey\n     * @param obj\n     */\n    proto.saveInCache = function(cacheKey, obj) {\n\n        // Async save it, don't block for stringify\n        var self = this;\n        setTimeout(function() {\n            cache.setItem(cacheKey, JSON.stringify(obj));\n            cache.setItem(cacheKey+\"_expires\", (new Date()).getTime() + self.cache_ttl);\n        }, 100);\n\n    };\n\n    return okanjo._Widget;\n\n})(okanjo, this);","//noinspection ThisExpressionReferencesGlobalObjectJS,JSUnusedLocalSymbols\n(function(okanjo, window) {\n\n    /*\n\n     div .modal-container .fade-out .hidden\n     | div .modal-window .clearfix\n     | |\n     | | div .modal-window-skin\n     | | | div .modal-window-outer\n     | | | | div .modal-window-inner\n     | | | | | iframe .okanjo-inline-buy-frame\n     | | | | /div\n     | | | /div\n     | | /div\n     | |\n     | | div .close-button\n     | | | ×\n     | | /div\n     | |\n     | /div\n     /div\n\n     */\n\n    var initialized = false,\n        scrollY = null,\n        isMobile = !!navigator.userAgent.match(/iphone|android|blackberry/ig) || false,\n\n        // Selectors\n        $html, $body, $modalContainer, $modalWindow, $modalSkin, $modalOuter, $modalInner, $modalClose, $modalFrame,\n\n        createElements = function() {\n\n            // Page elements\n            //noinspection JSUnresolvedFunction\n            $html = okanjo.qwery('html')[0];\n            //noinspection JSUnresolvedFunction\n            $body = okanjo.qwery('body')[0] || document.body;\n\n            // Modal elements\n            $modalContainer = document.createElement('div');\n            $modalWindow = document.createElement('div');\n            $modalSkin = document.createElement('div');\n            $modalOuter = document.createElement('div');\n            $modalInner = document.createElement('div');\n            $modalClose = document.createElement('div');\n            $modalFrame = document.createElement('iframe');\n\n            $modalContainer.setAttribute('class', 'okanjo-modal-container okanjo-modal-hidden ' + okanjo.util.detectClasses().join(' '));\n            $modalWindow.setAttribute('class', 'okanjo-modal-window');\n            $modalSkin.setAttribute('class', 'okanjo-modal-window-skin');\n            $modalOuter.setAttribute('class', 'okanjo-modal-window-outer');\n            $modalInner.setAttribute('class', 'okanjo-modal-window-inner');\n            $modalClose.setAttribute('class', 'okanjo-modal-close-button');\n\n            $modalFrame.setAttribute('class', 'okanjo-inline-buy-frame');\n            $modalFrame.setAttribute('frameborder', '0');\n            $modalFrame.setAttribute('vspace', '0');\n            $modalFrame.setAttribute('hspace', '0');\n            $modalFrame.setAttribute('webkitallowfullscreen', '');\n            $modalFrame.setAttribute('mozallowfullscreen', '');\n            $modalFrame.setAttribute('allowfullscreen', '');\n            $modalFrame.setAttribute('scrolling', 'auto');\n\n            $modalClose.innerHTML = '×';\n\n            // Create the modal element tree\n            $modalInner.appendChild($modalFrame);\n            $modalOuter.appendChild($modalInner);\n            $modalSkin.appendChild($modalOuter);\n            $modalWindow.appendChild($modalSkin);\n            $modalWindow.appendChild($modalClose);\n            $modalContainer.appendChild($modalWindow);\n\n            // Add the modal stuff to the body\n            $body.appendChild($modalContainer);\n        },\n\n        bindEvents = function() {\n\n            // If the device orientation changes, adjust the modal view port\n            addListener(window, 'orientationchange', function() {\n                for (var t = 0; t < 2; t++) {\n                    setTimeout(handleReposition, 1000 * t + 10);\n                }\n            });\n\n            // If the window changes size, also adjust the modal view port\n            addListener(window, 'resize', function() {\n                setTimeout(handleReposition, 100);\n            });\n\n            // Click the overlay to close the modal\n            addListener($modalContainer, 'click', closeModal);\n\n            // If you click in the modal, don't close it!\n            addListener($modalWindow, 'click', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n            });\n\n            // Click the close button to close it\n            addListener($modalClose, 'click', function(e) {\n\n                // Don't close it twice\n                e.preventDefault();\n                e.stopPropagation();\n\n                closeModal();\n            });\n\n        },\n\n        addListener = function(el, event, handler) {\n            if (el.addEventListener) {\n                el.addEventListener(event, handler, false);\n            } else {\n                el.attachEvent(\"on\" + event, handler);\n            }\n        },\n\n        //removeListener = function(el, event, handler) {\n        //    if (el.removeEventListener) {\n        //        el.removeEventListener(event, handler);\n        //    } else {\n        //        el.detachEvent(\"on\" + event, handler);\n        //    }\n        //},\n\n        addClass = function(el, name) {\n            el.className += \" \" + name;\n        },\n\n        removeClass = function(el, name) {\n            el.className = el.className.replace(new RegExp(' *?'+name), '');\n        },\n\n        getWindowHeight = function() {\n            return window.innerHeight || document.documentElement.clientHeight;\n        },\n\n        handleReposition = function() {\n            scrollY = okanjo.util.getScrollPosition().y;\n            //$modalWindow.style.marginTop = scrollY + 40 + \"px\";\n            $modalWindow.style.height = (getWindowHeight() - 80) + \"px\";\n        },\n\n        openModal = function() {\n\n            scrollY = document.body.scrollTop;\n\n            removeClass($modalContainer, 'okanjo-modal-hidden');\n            addClass($modalContainer, 'okanjo-modal-fade-out');\n\n            handleReposition();\n\n            addClass($html, \"okanjo-modal-active\");\n\n            if (!isMobile) {\n                addClass($html, \"okanjo-modal-margin-fix\");\n            }\n\n            setTimeout(function() {\n                removeClass($modalContainer, 'okanjo-modal-fade-out');\n            }, 10);\n\n            // Click the overlay to close the modal\n            //addListener($body, 'click', closeModal);\n\n        },\n\n        closeModal = function() {\n            addClass($modalContainer, 'okanjo-modal-fade-out');\n\n            setTimeout(function() {\n                removeClass($modalContainer, 'okanjo-modal-fade-out');\n                addClass($modalContainer, \"okanjo-modal-hidden\");\n\n                removeClass($html, \"okanjo-modal-active\");\n                if (!isMobile) {\n                    removeClass($html, \"okanjo-modal-margin-fix\");\n                }\n            }, 210);\n\n            // Click the overlay to close the modal\n            //removeListener($body, 'click', closeModal);\n        },\n\n\n        /**\n         * Insert an element or markup into the modal\n         * @param content\n         */\n        setContent = function(content) {\n\n            // Remove existing content\n            $modalInner.innerHTML = \"\";\n\n            // Insert new content\n            if (typeof content === \"string\") {\n                $modalInner.innerHTML = content;\n            } else {\n                $modalInner.appendChild(content);\n            }\n        };\n\n\n    // Expose the modal functions\n    okanjo.modal = {\n\n        show: function(content) {\n\n            if (!initialized) {\n                initialized = true;\n                createElements();\n                bindEvents();\n            }\n\n            setContent(content);\n            openModal();\n        },\n\n        hide: function() {\n            closeModal();\n        }\n\n    };\n\n    return okanjo.modal;\n\n})(okanjo, this);","//noinspection ThisExpressionReferencesGlobalObjectJS,JSUnusedLocalSymbols\n(function(okanjo, window) {\n\n\n    /**\n     * Okanjo Product\n     * @param element - DOM element to attach the output to\n     * @param {*} [config] - Optional base widget configuration object, element data attributes will override these\n     * @constructor\n     */\n    function Product(element, config) {\n        okanjo._Widget.call(this, element, config);\n\n        this.items = [];\n        this.config = config = config || {\n            mode: Product.contentTypes.browse, // Default to browse\n            use_cache: false,\n            cache_ttl: 60000\n        };\n\n        // Param to stop the URL nagging if none is given\n        this.config.nag = config.nag === undefined ? true : config.nag === true;\n\n        // Set default caching settings\n        this.config.use_cache = config.use_cache === undefined ? false : config.use_cache === true;\n        this.config.cache_ttl = config.cache_ttl === undefined ? 60000 : config.cache_ttl;\n        this.disable_popup = config.disable_popup === true;\n        this.use_cache = this.config.use_cache;\n        this.cache_ttl = this.config.cache_ttl;\n        this.proxy_url = null;\n\n        // Allow changing the metrics context, e.g. embedded in an Ad widget\n        this.config.metrics_context = config.metrics_context === undefined ? \"pw\" : config.metrics_context;\n        this.config.metrics_channel_context = config.metrics_channel_context === undefined ? null : config.metrics_channel_context;\n\n        // Option to ignore inline buy functionality\n        this.disable_inline_buy = this.config.disable_inline_buy === undefined ? false : config.disable_inline_buy === true;\n\n        this.cache_key_prefix = 'ok_product_block_';\n\n        this.templates = {\n            product_error: \"okanjo.error\",\n            product_main: \"product.block\"\n        };\n\n        this.css = {\n            product_main: \"product.block\",\n            product_modal: \"okanjo.modal\"\n        };\n\n        this.configMap = {\n\n            // Api Widget Key\n            key: \"key\",\n\n            // Widget mode\n            mode: \"mode\", // What provider to use to retrieve products, browse, sense or single, default: browse\n            disable_inline_buy: \"disable-inline-buy\", // Whether to disable inline buy functionality, default: false\n            proxy_url: \"proxy-url\", // 3rd party click through tracking url\n\n            // ProductSense Params\n            url: \"url\",  // The URL to digest\n            selectors: \"selectors\", // CSV of page element selectors, default: p,title,meta[name=\"description\"],meta[name=\"keywords\"]\n            url_category: \"url-category\", // Article taxonomy (e.g. news, sports, lifestyles, etc)\n\n            // Search Params (Filters)\n\n            id: \"id\", // The specific product ID to fetch (single mode), default: null\n\n            q: \"q\", // Search query text\n\n            marketplace_status: ['marketplace-status'], // Option to switch to testing product pool, default: live\n            marketplace_id: ['marketplace-id'], // Limit products listed under the given marketplace, default: null\n\n            pools: 'pools', // Limit products to one or more pools (CSV), default: global\n\n            external_id: \"external-id\", // Vendor-given ID\n            sku: \"sku\", // Vendor stock keeping unit\n\n            sold_by: 'sold-by', // Limit products listed by a certain store, default: null\n            external_store_id: \"external-store-id\", // Limit products to a vendor-given store ID\n\n            min_price: \"min-price\", // Products with price greater-than or equal to this amount\n            max_price: \"max-price\", // Products with price less-than or equal to this amount\n            condition: \"condition\", // Condition of the product (e.g. new, used, refurbished, unspecified)\n            manufacturer: \"manufacturer\", // Who made the product\n            upc: \"upc\", // UPC code\n            isbn: \"isbn\", // ISBN number\n            tags: \"tags\", // CSV list of tags\n            category: \"category\", // CSV list of categories (in order)\n\n            min_donation_percent: \"min-donation-percent\", // Minimum donation amount: default: 0 (between 0 and 1)\n            max_donation_percent: \"max-donation-percent\", // Maximum donation amount: default: 1 (between 0 and 1)\n            donation_to: \"donation-to\", // The name of the non-profit that benefits from the purchase\n\n            suboptimal: 'suboptimal', // Option to enable products labeled as suboptimal (e.g. products that have weak descriptions and could come back as false matches)\n            backfill: 'backfill', // Option to allow placing a display ad in the event no products are returned.\n\n            // Pagination\n            skip: ['skip', 'page-start'], // The index of the result set to start at, starting from 0. default: 0\n            take: ['take', 'page-size'], // The number of products to return, default: 5\n\n            expandable: 'expandable', // Indicates whether the inline_buy experience is allowed to expand outside the bounds of the widget. Default: true\n\n            // Override template names\n            template_product_main: 'template-product-main', // The product template to render, default: product.block\n            template_product_error: 'template-product-error', // The product error template to render, default: okanjo.error\n\n            // template customization options\n            size: \"size\", // the product container size\n            template_layout: \"template-layout\",  // Products displayed as grid or list, default grid, size can override this\n            template_theme: \"template-theme\", // Typographic theme, either newsprint or modern, default: modern\n            template_cta_style: \"template-cta-style\", // The CTA button visual style. Can be button or link, links will take less space.\n            template_cta_text: \"template-cta-text\", // The text within the CTA button, will be css-truncated if too long for given layout, default: Shop Now\n            template_cta_color: \"template-cta-color\" // The color of text of the CTA button or link, default: 0099ff.\n        };\n\n        // Initialize unless told not to\n        //noinspection JSUnresolvedVariable\n        if (!config.no_init) {\n            //noinspection JSUnresolvedFunction\n            this.init();\n        }\n    }\n\n    okanjo.util.inherits(Product, okanjo._Widget);\n\n\n    Product.contentTypes = {\n        browse: \"browse\",\n        sense: \"sense\",\n        single: \"single\"\n    };\n\n    var proto = Product.prototype;\n\n    proto.widgetName = \"Product\";\n\n    // Parameters to compile to generate the cache key\n    proto.cacheKeyAttributes = 'mode,url,selectors,text,id,q,marketplace_status,marketplace_id,external_id,sku,sold_by,min_price,max_price,condition,manufacturer,upc,isbn,tags,category,min_donation_percent,max_donation_percent,donation_to,suboptimal,skip,take'.split(',');\n\n    /**\n     * Loads the widget content onto the page\n     */\n    proto.load = function() {\n\n        // Check if the product ID is set or is running in single mode\n        if (this.config.id || this.config.mode == Product.contentTypes.single) {\n            // Override mode if the ID is set or not set\n            if (okanjo.util.empty(this.config.id)) {\n                this.config.mode = Product.contentTypes.browse;\n            } else {\n                this.config.mode = Product.contentTypes.single;\n            }\n\n            // If in sense mode, ensure the URL param is set\n        } else if (this.config.url || this.config.text || this.config.mode == Product.contentTypes.sense) {\n            // Require url or text attributes\n            if (okanjo.util.empty(this.config.url) && okanjo.util.empty(this.config.text)) {\n                this.config.url = this.getCurrentPageUrl();\n                // Nag since we had to derive a URL from the window\n                if (this.config.nag) {\n                    console.info('[Okanjo.'+this.widgetName+'] No canonical url given for ProductSense. We recommend using a canonical url to ensure page visibility by Okanjo. Using derived url:', this.config.url);\n                }\n            }\n            this.config.mode = Product.contentTypes.sense;\n            this.config.take = this.config.take || 5; // Default the take to ensure an upper-bound is set\n        } else {\n            // Make sure a mode is always set, and cannot be empty\n            this.config.mode = okanjo.util.empty(this.config.mode) ? Product.contentTypes.browse : this.config.mode;\n        }\n\n        // Check for CSV values and convert to an array\n        (function(configNames){\n            for(var i = 0; i < configNames.length; i++) {\n                //noinspection JSPotentiallyInvalidUsageOfThis\n                var val = this.config[configNames[i]];\n                if (val && typeof val === \"string\" /*&& val.indexOf(',') >= 0*/) {\n                    //noinspection JSPotentiallyInvalidUsageOfThis\n                    this.config[configNames[i]] = val.split(',');\n                }\n            }\n        }).call(this, ['pools','tags','category']);\n\n        // Set the metric context to the product mode, if not already set\n        if (this.config.metrics_channel_context === null) {\n            this.config.metrics_channel_context = this.config.mode;\n        }\n\n        // Set the proxy url, if present\n        if (this.config.proxy_url) {\n            this.proxy_url = this.config.proxy_url;\n\n            // Don't send this (probably gigantic) url on jsonp requests\n            delete this.config.proxy_url;\n        }\n\n        // Build the base metric data for events from this widget\n        // Generate metric url for this type\n        this.metricBase = {\n            // id: 'APPLIED IN TEMPLATE',\n            ch: this.config.metrics_context,\n            cx: this.config.metrics_channel_context || this.config.mode,\n            key: this.config.key,\n            m: {\n                //ok_ver: 'COMES FROM NORMALIZATION',\n                //pgid: 'COMES FROM NORMALIZATION',\n                //bf: 'APPLIED IN TEMPLATE',\n                wgid: this.instanceId\n            }\n        };\n\n        // Immediately show products from the local browser cache, if present, for immediate visual feedback\n        if (this.config.use_cache && this.loadProductsFromCache()) {\n            // Loaded from cache successfully!\n            // Notify integrations that the widget loaded\n            this.emit('load', { fromCache: true });\n        } else {\n            this.getProducts();\n        }\n\n        // Verify the disable param is not a string\n        if (this.config.disable_inline_buy && typeof this.config.disable_inline_buy === \"string\") {\n            this.disable_inline_buy = this.config.disable_inline_buy.toLowerCase() === \"true\";\n        }\n\n        // Track widget impression\n        if (this.config.metrics_context == okanjo.metrics.channel.product_widget) {\n            var eventData = okanjo.util.deepClone(this.metricBase, {});\n            eventData.m = okanjo.metrics.truncate(okanjo.metrics.copy(this.config, okanjo.metrics.includeElementInfo(this.element, eventData.m)));\n            okanjo.metrics.trackEvent(okanjo.metrics.object_type.widget, okanjo.metrics.event_type.impression, eventData);\n        }\n\n        return true;\n    };\n\n\n    /**\n     * Immediately show products from the local browser cache, if present\n     * @returns boolean – True if products were successfully loaded from the cache, false if not\n     */\n    proto.loadProductsFromCache = function() {\n\n        var items = this.loadFromCache(this.getCacheKey());\n        if (items !== null) {\n            this.items = items;\n            this.showProducts(this.items);\n            return true;\n        } else {\n            return false;\n        }\n\n    };\n\n\n    /**\n     * Execute the Product request to Okanjo to get some product tile markup\n     */\n    proto.getProducts = function() {\n        var self = this, count;\n        this.executeSearch(function(err, res) {\n            if (err) {\n                // Can't show anything, just render a generic error message\n                console.error('[Okanjo.'+self.widgetName+'] Failed to retrieve products.', err);\n                self.element.innerHTML = okanjo.mvc.render(self.templates.product_error, self, { message: 'Could not retrieve products.' });\n                self.emit('error', err);\n            } else {\n\n                // Hook on empty\n                count = (res.data||[]).length;\n                if (count === 0) self.emit('empty');\n\n                // Check for adx backfill scenario, if allowed\n                if (res.backfillADX) {\n\n                    // Replace content with backfill from adx\n                    self.backfillAd();\n\n                } else {\n\n                    // Store the products array locally\n                    self.items = res.data;\n                    self.numFound = res.numFound;\n                    self.articleId = res.articleId;\n                    self.placementTest = res.placementTest;\n                    self.shorted = self.config.mode == Product.contentTypes.sense && self.config.take > count;\n\n                    // Update the base metric data with new new information\n                    if (self.articleId) self.metricBase.m.aid = self.articleId;\n                    self.metricBase.m.pten = (self.placementTest && self.placementTest.enabled) ? '1' : '0';\n                    if (self.placementTest) {\n                        if (self.placementTest.id) self.metricBase.m.ptid = self.placementTest.id;\n                        if (self.placementTest.seed) self.metricBase.m.ptseed = self.placementTest.seed;\n                    }\n\n                    // Allow hooks when the response returns from the server\n                    self.emit('data', res);\n\n                    // Render the products\n                    self.showProducts(self.items);\n\n                    // If cache is enabled and placement testing is not applicable\n                    if (!self.shorted && self.use_cache && (!self.placementTest || (self.placementTest && !self.placementTest.enabled))) {\n                        // Cache the products for next page load so something loads up right away until refreshed\n                        var key = self.getCacheKey();\n                        self.saveInCache(key, self.items);\n                    }\n\n                    // Allow hooks when the product widget finishes initialization\n                    self.emit('load', {fromCache: false});\n                }\n            }\n        });\n    };\n\n\n    /**\n     * Performs a JSONP request to the API to get the desired products\n     * @param {function(err:*, res:*)} callback – Closure to fire when completed\n     */\n    proto.executeSearch = function(callback) {\n        var config = okanjo.util.deepClone(this.config);\n        if (this.config.mode === Product.contentTypes.sense) {\n            okanjo.exec(okanjo.getRoute(okanjo.routes.products_sense), config, callback);\n        } else if (this.config.mode === Product.contentTypes.single) {\n            okanjo.exec(okanjo.getRoute(okanjo.routes.products_id, { product_id: this.config.id }), config, function(err, res) {\n                if (!err && res && res.data) {\n                    res.data = [ res.data ];\n                }\n                if (callback) callback(err, res);\n            });\n        } else {\n            okanjo.exec(okanjo.getRoute(okanjo.routes.products), config, callback);\n        }\n    };\n\n\n    /**\n     * Manipulates the item data to keep or remove inline_buy URLs.\n     */\n    proto.handleInlineBuyOption = function() {\n        // If we should ignore the inline buy functionality, strip the data off the products\n        if (this.disable_inline_buy) {\n            for (var i = 0; i < this.items.length; i++) {\n                this.items[i].inline_buy_url = null;\n            }\n        }\n    };\n\n\n    /**\n     * Displays the products results\n     * @param {[*]} data - The array of products\n     */\n    proto.showProducts = function(data) {\n\n        // Handle the inline buy configuration option\n        this.handleInlineBuyOption();\n\n        // Render the product content!\n        this.element.innerHTML = okanjo.mvc.render(this.templates.product_main, this, {\n            products: data || this.items || [],\n            config: this.config\n        });\n\n        this.bindEvents();\n    };\n\n\n    /**\n     * Builds the final frame url to use, given the base, url, and params to tack on\n     * @param eventData – Metric event data\n     * @param inline – Inline buy URL\n     * @param proxy – The vendor given url to redirect to, after we've tracked the interaction, which should redirect to the buy_url\n     * @param params – Additional params to tack on to the inline buy URL\n     * @returns {string} – Final frame url\n     */\n    function makeClickThroughUrl(eventData, inline, proxy, params) {\n\n        var pairs = [],\n            i,\n            joiner = (inline.indexOf('?') < 0 ? '?' : '&'),\n            buy_url;\n\n        for (i in params) {\n            if (params.hasOwnProperty(i)) {\n                pairs.push(i+\"=\"+encodeURIComponent(params[i]));\n            }\n        }\n\n        // Normalize the event data\n        okanjo.metrics.normalizeEventData(eventData);\n\n        // Cache buster\n        eventData.n = (new Date()).getTime();\n\n        // Build buy url\n        buy_url = inline + (pairs.length > 0 ? (joiner + pairs.join('&')) : \"\");\n\n        // If we're relaying through a proxy tracker, then build the link accordingly\n        if (proxy) {\n            eventData.u = proxy + encodeURIComponent(buy_url);\n        } else {\n            eventData.u = buy_url;\n        }\n\n        // Convert event to url\n        return okanjo.JSONP.makeUrl({\n            url: okanjo.getRoute(okanjo.routes.metrics, {\n                object_type: okanjo.metrics.object_type.product,\n                event_type: okanjo.metrics.event_type.interaction\n            }),\n            data: eventData\n        });\n    }\n\n\n    /**\n     * Handle user interaction with the product tile\n     * @param e – User interaction DOM event\n     * @param trigger – Whether to trigger the click event or not on the link\n     */\n    Product.interactTile = function(e, trigger) {\n\n        var container = this.parentNode.parentNode,\n            eventData = JSON.parse(container.getAttribute('data-metric-json')),\n            expandable = container.getAttribute('data-expandable'),\n            disablePopup = container.getAttribute('data-disable-popup') || false,\n            backfill = this.getAttribute('data-backfill'),\n            buyUrl = this.getAttribute('data-buy-url'),\n            inline = this.getAttribute('data-inline-buy-url'),\n            proxyUrl = this.getAttribute('data-proxy-url'),\n            url,\n            inlineParams = {},\n            expanded = false,\n            nativeBuy = !okanjo.util.empty(inline),\n            doPopup = disablePopup ? false : (okanjo.util.isMobile() && nativeBuy),\n            passThroughParams = \"ok_msid=\" + okanjo.metrics.sid + '&ok_ch=' + eventData.ch + '&ok_cx=' + eventData.cx,\n            modifiedBuyUrl = buyUrl + (buyUrl.indexOf('?') < 0 ? '?' : '&') + passThroughParams,\n            modifiedInlineBuyUrl = inline + (inline.indexOf('?') < 0 ? '?' : '&') + passThroughParams;\n\n        // Add product / positional meta data\n        eventData.id = this.getAttribute('data-id');\n        eventData.m = okanjo.metrics.includeEventInfo(e, okanjo.metrics.includeViewportInfo(okanjo.metrics.includeElementInfo(this, eventData.m)));\n\n        // Show a new window on applicable devices instead of a native buy experience\n        if (doPopup) {\n\n            //\n            // Mobile devices (especially iOS) have real janky UX when interacting with iframes.\n            // So, we'll choose to popup a window with the native buy experience, so we can ensure\n            // a positive user experience. Nobody likes bouncy form fields and really weird zooming.\n            //\n\n            // Tell the buy experience that we're loading up in a popup, so they can render that nicely\n            eventData.ea = okanjo.metrics.action.inline_click;\n            eventData.m.popup = 'true';\n            url = makeClickThroughUrl(eventData, modifiedInlineBuyUrl, proxyUrl, { popup: 1 });\n\n            okanjo.active_frame = window.open(url, \"okanjo-inline-buy-frame\", \"width=400,height=400,location=yes,resizable=yes,scrollbars=yes\");\n            if (!okanjo.active_frame) {\n\n                console.error('Popup blocker prevented new inline-buy experience from being displayed');\n\n                // fallback to an anchor click using the inline buy url\n                this.href = url;\n\n            } else {\n                e.preventDefault();\n            }\n\n        } else if (nativeBuy) {\n\n            //\n            // Native/Inline Buy (buy on the page)\n            // All the conditions are right to embed the inline buy experience right here, right now.\n            // Whip up a new iframe with the target url and either show it as a modal or confine it to the widget space\n            //\n\n            e.preventDefault();\n\n            var frame = document.createElement('iframe'),\n                frameAttributes = {\n                    'class': 'okanjo-inline-buy-frame',\n                    frameborder: 0,\n                    vspace: 0,\n                    hspace: 0,\n                    webkitallowfullscreen: '',\n                    mozallowfullscreen: '',\n                    allowfullscreen: '',\n                    scrolling: 'auto'\n                };\n\n            for (var i in frameAttributes) {\n                if (frameAttributes.hasOwnProperty(i)) {\n                    frame.setAttribute(i, frameAttributes[i]);\n                }\n            }\n\n            // By default, we assume we're going to modal, which is an expandable\n            inlineParams.expandable = 1;\n\n            // Now check if we should not actually be expanding\n            if (expandable !== undefined && expandable.toLowerCase() === \"false\") {\n\n                //\n                // Non-expandable: Per IAB, we should not expand the ad content past the bounds of the ad unit\n                // So, confine the iframe to the bounds of the ad.\n                //\n\n                // Locate the parent ad container and attempt to shove the frame in there\n                // If it fails to do so, then resort to a modal, since expandable was set not on an ad, de72qw2227.\n                var candidate = this, parent = null;\n                while(candidate) {\n                    candidate = candidate.parentNode;\n                    if (candidate && candidate.className && candidate.className.indexOf('okanjo-expansion-root') >= 0) {\n                        parent = candidate;\n                    }\n                }\n\n                // If we have the parent ad unit container, then stick it in there, otherwise let it fallback to a modal\n                if (parent) {\n                    frame.className += \" okanjo-ad-in-unit\";\n                    frame.setAttribute('height', \"100%\");\n                    frame.setAttribute('width', \"100%\");\n\n                    parent.appendChild(frame);\n                    expanded = true;\n\n                    // Provide the buy experience some context information\n                    var size = okanjo.util.getElementSize(parent);\n                    inlineParams.expandable  = 0;\n                    inlineParams.frame_height = size.height;\n                    inlineParams.frame_width  = size.width;\n                    inlineParams.ad_size = parent.getAttribute('data-size') || \"undefined\";\n                }\n            }\n\n            eventData.ea = okanjo.metrics.action.inline_click;\n            eventData.m.expandable = (inlineParams.expandable === 1 ? 'true' : 'false');\n            url = makeClickThroughUrl(eventData, modifiedInlineBuyUrl, proxyUrl, inlineParams);\n\n            frame.src = url;\n\n            if (!expanded) {\n                okanjo.modal.show(frame);\n            }\n\n        } else if (trigger) {\n            eventData.ea = okanjo.metrics.action.click;\n            this.href = makeClickThroughUrl(eventData, modifiedBuyUrl, proxyUrl, {});\n            this.click();\n        } else {\n            eventData.ea = okanjo.metrics.action.click;\n            this.href = makeClickThroughUrl(eventData, modifiedBuyUrl, proxyUrl, {});\n        }\n    };\n\n\n    /**\n     * Binds event listeners to the anchor elements in the product widgets\n     */\n    proto.bindEvents = function() {\n\n        var self = this;\n\n        //noinspection JSUnresolvedFunction\n        okanjo.qwery('a', this.element).every(function(a) {\n            var id = a.getAttribute('data-id');\n            if (id) {\n                if (a.addEventListener) {\n                    a.addEventListener('click', Product.interactTile);\n                } else {\n                    a.attachEvent('onclick', function (e) {\n                        Product.interactTile.call(a, e);\n                    });\n                }\n\n                // Only stick metrics on the product widget if *not* embedded in another widget\n                if (self.config.metrics_context == okanjo.metrics.channel.product_widget) {\n\n                    // Gather the goods\n                    var backfill = a.getAttribute('data-backfill'),\n                        eventData = okanjo.util.deepClone(self.metricBase, {});\n\n                    // Was the product loaded as a last-ditch effort?\n                    eventData.id = a.getAttribute('data-id');\n                    eventData.m.bf = (backfill === \"true\") ? 1 : 0;\n\n                    // Update the event metadata\n                    eventData.m = okanjo.metrics.truncate(okanjo.metrics.copy(self.config, okanjo.metrics.includeElementInfo(a.parentNode, eventData.m)));\n\n                    // Track product impression event\n                    okanjo.metrics.trackEvent(okanjo.metrics.object_type.product, okanjo.metrics.event_type.impression, eventData);\n                }\n            }\n\n            return true;\n        });\n\n        // Show ellipses on title text that doesn't quite fit\n        okanjo.qwery('.okanjo-product-title', this.element).every(function(t) {\n            okanjo.util.ellipsify(t);\n            return true;\n        });\n    };\n\n\n    /**\n     * Fills the widget with empty products to best match an ad to the dimensions of the widget\n     * @return {{width:number,height:number}|null}\n     */\n    proto.guessAdSize = function() {\n        // Load the container with placeholders to see how big we expand to.\n        var size, items = [], i = 0,\n            //sizes = '980x120|980x90|970x250|970x90|970x66|960x90|950x90|930x180|750x300|750x200|750x100|728x90|580x400|468x60|336x280|320x100|320x50|300x1050|300x600|300x250|300x100|300x50|300x31|292x30|250x360|250x250|240x400|240x133|234x60|220x90|200x446|200x200|180x150|160x600|125x125|120x600|120x240|120x60|88x31'.split('|'),\n            sizes = '300x250|728x90|250x250|200x200|120x240|468x60|180x150|320x50|125x125|234x60'.split('|'),\n            sizeInstance, sizeInstanceWidth, sizeInstanceHeight;\n\n        for ( ; i < this.config.take; i++) {\n            items.push({});\n        }\n        this.showProducts(items);\n\n        // Get the actual size of the unit\n        size = okanjo.util.getElementSize(this.element);\n\n        // Drop the content\n        this.element.innerHTML = \"\";\n\n        // Avoid rounding errors in some browsers (looking at you, IE8)\n        size.width += 1;\n        size.height += 1;\n\n        // Best fit the size to an ad-size\n        for (i = 0; i < sizes.length; i++) {\n            sizeInstance = sizes[i].split('x');\n            sizeInstanceWidth = parseInt(sizeInstance[0]);\n            sizeInstanceHeight = parseInt(sizeInstance[1]);\n            if (sizeInstanceWidth <= size.width && sizeInstanceHeight <= size.height) {\n                return { width: sizeInstanceWidth, height: sizeInstanceHeight };\n            }\n        }\n\n        // No match, don't show an ad\n        return null;\n    };\n\n\n    /**\n     * Starts the backfill process to show an backup display ad\n     */\n    proto.backfillAd = function() {\n\n        var backfill = this.config.backfill,\n            match,\n            size = null;\n\n        if (typeof backfill === \"string\") {\n            // Check if the backfill target is a known ad unit size\n            if (okanjo.Ad) {\n                size = okanjo.Ad.sizes[backfill];\n            }\n\n            // Check if the string is a dimensional value\n            if (!size) {\n                /* jshint -W084 */\n                if (match = (/^([0-9]+)x([0-9]+)$/i).exec(backfill)) {\n                    size = {\n                        width: match[1],\n                        height: match[2]\n                    };\n                }\n                /* jshint +W084 */\n            }\n        }\n\n        // Do we have to guess the size?\n        if (!size) {\n            size = this.guessAdSize();\n        }\n\n        if (size) {\n            this.loadAd(size);\n        } else {\n            console.error('[Okanjo.'+this.widgetName+'] Failed to backfill ad: Unable to match ad size to widget dimensions');\n        }\n    };\n\n\n    /**\n     * Loads an ad from Google Adx of the given dimensions\n     * @param size\n     */\n    proto.loadAd = function(size) {\n        var adxframe = document.createElement('iframe'),\n            frameAttributes = {\n                'class': 'okanjo-inline-buy-frame',\n                frameborder: 0,\n                vspace: 0,\n                hspace: 0,\n                webkitallowfullscreen: '',\n                mozallowfullscreen: '',\n                allowfullscreen: '',\n                scrolling: 'auto'\n            },\n            pubId = 'ca-pub-9976681432228271',\n            slotId = '3992956792',\n            adxframeContent = '<html><head><style type=\"text/css\">html,body {margin: 0; padding: 0;}</style></head><body><'+'script type=\"text/javascript\">' +\n                'google_ad_client = \"'+pubId+'\";' +\n                'google_ad_slot = \"'+slotId+'\";' +\n                'google_ad_width = '+size.width+';' +\n                'google_ad_height = '+size.height+';' +\n                'google_page_url = \"'+window.location.href+'\";' +\n                //'google_adtest = \"on\";' +\n                '<'+'/script>' +\n                '<' +'script type=\"text/javascript\" src=\"//pagead2.googlesyndication.com/pagead/show_ads.js\"><'+'/script></body></html>';\n\n        this.element.innerHTML = \"\";\n        this.element.appendChild(adxframe);\n        adxframe.contentWindow.document.open();\n        adxframe.contentWindow.document.write(adxframeContent);\n        adxframe.contentWindow.document.close();\n\n        for (var i in frameAttributes) {\n            if (frameAttributes.hasOwnProperty(i)) {\n                adxframe.setAttribute(i, frameAttributes[i]);\n            }\n        }\n\n        adxframe.className = \"okanjo-ad-backfill\";\n        adxframe.setAttribute('width', size.width + \"px\");\n        adxframe.setAttribute('height', size.height + \"px\");\n\n        // Track backfill impression\n        var eventData = okanjo.util.deepClone(this.metricBase, {});\n        eventData.m.ta_w = size.width;\n        eventData.m.ta_h = size.height;\n        eventData.m.ta_pubid = pubId;\n        eventData.m.ta_slotid = slotId;\n        eventData.m = okanjo.metrics.truncate(okanjo.metrics.copy(this.config, okanjo.metrics.includeElementInfo(this.element, eventData.m)));\n        okanjo.metrics.trackEvent(okanjo.metrics.object_type.thirdparty_ad, okanjo.metrics.event_type.impression, eventData);\n    };\n\n    okanjo.Product = Product;\n    return Product;\n\n})(okanjo, this);","//noinspection ThisExpressionReferencesGlobalObjectJS,JSUnusedLocalSymbols\n(function(okanjo, window) {\n\n    /**\n     * Okanjo Ad\n     * @param element - DOM element to attach the output to\n     * @param {*} [config] - Optional base widget configuration object, element data attributes will override these\n     * @constructor\n     */\n    function Ad(element, config) {\n\n        okanjo._Widget.call(this, element, config);\n\n        this.config = config = config || {};\n\n        this.templates = {\n            ad_error: \"okanjo.error\",\n            ad_main: \"ad.block\"\n        };\n\n        this.css = {\n            ad_main: \"ad.block\"\n        };\n\n        this.disable_inline_buy = this.config.disable_inline_buy === undefined ? false : config.disable_inline_buy === true;\n        this.proxy_url = null;\n\n        this.configMap = {\n\n            // Api Widget Key\n            key: \"key\",\n\n            proxy_url: \"proxy-url\", // 3rd party click through tracking url\n\n            // How should this thing look?\n            content: \"content\", // The content of the ad, creative or dynamic. Default: creative if element has markup, dynamic if not.\n            size: \"size\", // Hint as to the intended IAB display size, e.g. large_rectangle, leaderboard, skyscraper. Default: medium_rectangle\n            expandable: \"expandable\", // Indicates whether the inline_buy experience is allowed to expand outside the bounds of the widget. Default: true\n\n            // What should this thing point at?\n            type: \"type\", // The source type. Default: product\n            id: \"id\", // The source id. e.g. PRasdfMyProductId. Default: null\n\n            // Allow overriding of the ad templates\n            template_ad_main: 'template-ad-main',\n            template_ad_error: 'template-ad-error',\n\n            // Pass these params through to the underlying product widget\n            disable_inline_buy: \"disable-inline-buy\", // Whether to disable inline buy functionality, default: false\n            template_product_main: 'template-product-main', // The product template to render, default: product.block\n            template_product_error: 'template-product-error' // The product error template to render, default: okanjo.error\n        };\n\n\n        // Initialize unless told not to\n        //noinspection JSUnresolvedVariable\n        if (!config.no_init) {\n            //noinspection JSUnresolvedFunction\n            this.init();\n        }\n    }\n\n    // Extend the base widget\n    okanjo.util.inherits(Ad, okanjo._Widget);\n\n\n    /**\n     * Ad display types\n     * @type {{creative: string, dynamic: string}}\n     */\n    Ad.contentTypes = {\n        creative: \"creative\",\n        dynamic: \"dynamic\"\n    };\n\n\n    /**\n     * Ad display types (currently just product)\n     * @type {{product: string}}\n     */\n    Ad.types = {\n        product: \"product\"\n    };\n\n\n    /**\n     * Known Ad Dimensions\n     */\n    Ad.sizes = {\n\n        // IAB / Others\n        billboard:              { width: 970, height: 250 }, // aka: sidekick\n        button_2:               { width: 120, height:  60 },\n        half_page:              { width: 300, height: 600 }, // aka: filmstrip, sidekick\n        leaderboard:            { width: 728, height:  90 },\n        medium_rectangle:       { width: 300, height: 250 }, // aka: sidekick\n        micro_bar:              { width:  88, height:  31 },\n        portrait:               { width: 300, height:1050 },\n        rectangle:              { width: 180, height: 150 },\n        super_leaderboard:      { width: 970, height:  90 }, // aka: pushdown, slider, large_leaderboard\n        wide_skyscraper:        { width: 160, height: 600 },\n\n        // Google\n        large_mobile_banner:    { width: 320, height: 100 },\n        mobile_leaderboard:     { width: 320, height:  50 },\n        small_square:           { width: 200, height: 200 },\n\n        // Retired / Deprecated\n        button_1:               { width: 120, height:  90 },\n        full_banner:            { width: 468, height:  60 },\n        half_banner:            { width: 234, height:  60 },\n        large_rectangle:        { width: 336, height: 280 },\n        pop_under:              { width: 720, height: 300 },\n        three_to_one_rectangle: { width: 300, height: 100 },\n        skyscraper:             { width: 120, height: 600 },\n        square:                 { width: 250, height: 250 },\n        square_button:          { width: 125, height: 125 },\n        vertical_banner:        { width: 120, height: 240 },\n        vertical_rectangle:     { width: 240, height: 400 }\n    };\n\n    var proto = Ad.prototype;\n\n    /**\n     * Ad Widget!\n     * @type {string}\n     */\n    proto.widgetName = 'Ad';\n\n    /**\n     * Widget loader, sandwiched in the widget init\n     * @returns {boolean}\n     */\n    proto.load = function() {\n        //\n        // Ensure proper content\n        //\n\n        if (okanjo.util.empty(this.config.content)) {\n            if (this.hasCreativeContent()) {\n                this.config.content = Ad.contentTypes.creative;\n            } else {\n                this.config.content = Ad.contentTypes.dynamic;\n            }\n        } else if (this.config.content === Ad.contentTypes.creative && !this.hasCreativeContent()) {\n            // You say you want creative, but you don't really have any\n            console.warn('[Okanjo.Ad] Ad content is creative, but ad placement does not contain creative markup. Switching to dynamic!');\n            this.config.content = Ad.contentTypes.dynamic;\n        } else if (this.config.content === Ad.contentTypes.dynamic && this.hasCreativeContent()) {\n            console.warn('[Okanjo.Ad] Ad content is dynamic, but ad placement contains markup. Markup will be clobbered!');\n        } else if (!Ad.contentTypes.hasOwnProperty(this.config.content)){\n            this.element.innerHTML = okanjo.mvc.render(this.templates.ad_error, this, { message: 'Invalid ad content: ' + this.config.content });\n            okanjo.report(this.widgetName, 'Invalid ad content: ' + this.config.content);\n            return false;\n        }\n\n\n        //\n        // Ensure proper type\n        //\n\n        if (okanjo.util.empty(this.config.type)) {\n\n            // Default to product\n            this.config.type = Ad.types.product;\n\n            //if (okanjo.util.empty(this.config.size)) {\n            //    this.config.size = Ad.sizes.medium_rectangle; // Defaults to medium_rectangle\n            //}\n        } else if (!Ad.types.hasOwnProperty(this.config.type)) {\n            console.warn('[Okanjo.'+this.widgetName+'] Unknown type', this.config.type, 'given, using type `product` instead');\n            this.config.type = Ad.types.product;\n        }\n\n\n        //\n        // Ensure element size\n        //\n\n        // Check if we have known dimensions\n        if (!okanjo.util.empty(this.config.size) && Ad.sizes.hasOwnProperty(this.config.size)) {\n            // Set the placement's dimensions automagically\n            this.setElementSize(Ad.sizes[this.config.size]);\n        }\n\n        // Verify the disable param is not a string\n        if (this.config.disable_inline_buy && typeof this.config.disable_inline_buy === \"string\") {\n            this.disable_inline_buy = this.config.disable_inline_buy.toLowerCase() === \"true\";\n        }\n\n        // Set the proxy url, if present\n        if (this.config.proxy_url) {\n            this.proxy_url = this.config.proxy_url;\n\n            // Don't send this (probably gigantic) url on jsonp requests\n            delete this.config.proxy_url;\n        }\n\n        // Track ad widget load\n        okanjo.metrics.trackEvent(okanjo.metrics.object_type.widget, okanjo.metrics.event_type.impression, {\n            ch: okanjo.metrics.channel.ad_widget,\n            cx: this.config.content,\n            m: okanjo.metrics.copy(this.config, okanjo.metrics.includeElementInfo(this.element, { wgid: this.instanceId }))\n        });\n\n        //\n        // Ensure target id, and RENDER IT!\n        //\n\n        if (this.config.type === Ad.types.product) {\n\n            // Make sure an ID is set\n            if (okanjo.util.empty(this.config.id)) {\n                this.element.innerHTML = okanjo.mvc.render(this.templates.ad_error, this, { message: 'Missing ad product id' });\n                okanjo.report(this.widgetName, 'Missing ad product id');\n                return false;\n            }\n\n            // Get the product\n            if (this.config.content == Ad.contentTypes.dynamic) {\n                // If dynamic, render in a product block\n                this.insertProductWidget();\n            } else if (this.config.content == Ad.contentTypes.creative) {\n                // If creative, don't mess with the markup, just bind up the click / modal\n                this.insertCreativeWidget();\n            } else {\n                this.element.innerHTML = okanjo.mvc.render(this.templates.ad_error, this, { message: 'Cannot render ad in content: ' + this.config.content });\n                okanjo.report(this.widgetName, 'Cannot render ad in content: ' + this.config.content);\n                return false;\n            }\n\n        }\n\n        return true;\n\n    };\n\n\n    /**\n     * Renders the ad and moves existing content into the spot it should be\n     */\n    proto.render = function() {\n\n        var div = document.createElement('div'),\n            existingChildren = [],\n            i,\n            fit = this.config.content == Ad.contentTypes.dynamic && !okanjo.util.empty(this.config.size);\n\n        div.innerHTML = okanjo.mvc.render(this.templates.ad_main, this, {\n            //products: data || this.items || [],\n            config: this.config\n        }, {\n            blockClasses: fit ? ['okanjo-ad-fit'] : []\n        });\n\n\n        // Get all children in the current element\n        for( i = 0; i < this.element.childNodes.length; i++) {\n            if (this.element.childNodes[i].nodeType === 1 /*Node.ELEMENT_NODE*/) {\n                existingChildren.push(this.element.childNodes[i]);\n            }\n        }\n\n\n        // Attach markup to the element\n        for( i = 0; i < div.childNodes.length; i++) {\n            if (div.childNodes[i].nodeType === 1 /*Node.ELEMENT_NODE*/) {\n                this.element.appendChild(div.childNodes[i]);\n            }\n        }\n\n        // Get the new container element\n        //noinspection JSUnresolvedFunction\n        var container = okanjo.qwery('.okanjo-ad-container', this.element)[0];\n\n\n        // Move children to the new container\n        for( i = 0; i < existingChildren.length; i++ ) {\n            container.appendChild(existingChildren[i]);\n        }\n\n        // Track product impression\n        okanjo.metrics.trackEvent(okanjo.metrics.object_type.product, okanjo.metrics.event_type.impression, {\n            id: this.config.id,\n            ch: okanjo.metrics.channel.ad_widget, // pw or aw\n            cx: this.config.content, // single, browse, sense | creative, dynamic\n            m: okanjo.metrics.copy(this.config, okanjo.metrics.includeElementInfo(this.element, { wgid: this.instanceId }))\n        });\n\n    };\n\n\n    /**\n     * When a creative ad is clicked, funnel the event to the nearest product\n     * @param e\n     */\n    proto.interact = function(e) {\n        //noinspection JSUnresolvedFunction\n        var links = okanjo.qwery('a', this.productWidget.element);\n        if (links.length > 0) {\n            this._waitingOnProductLoad = false;\n            okanjo.Product.interactTile.call(links[0], e, true);\n        } else {\n            if (!this._waitingOnProductLoad) {\n                this._waitingOnProductLoad = true;\n                var self = this,\n                    interval = setInterval(function() {\n                        if (!self._waitingOnProductLoad) {\n                            clearInterval(interval);\n                        } else {\n                            self.interact(e);\n                        }\n                    }, 250);\n                console.warn('Waiting for Okanjo Product widget to load...');\n            }\n        }\n    };\n\n\n    /**\n     * Formats the creative content and adds a product widget in the ad space\n     */\n    proto.insertCreativeWidget = function() {\n        this.insertProductWidget({ hidden: true });\n\n        // Bind a click handler\n        var self = this;\n        if (this.element.addEventListener) {\n            this.element.addEventListener('click', function(e) { self.interact(e); });\n        } else {\n            this.element.attachEvent('onclick', function(e) { self.interact(e); });\n        }\n    };\n\n\n    /**\n     * Inserts a product widget into the ad space\n     * @param [options]\n     * @returns {okanjo.Product|*}\n     */\n    proto.insertProductWidget = function(options) {\n        options = options || {};\n\n        // Create a non-conflicting container for the ad block\n        var el = document.createElement('div');\n        el.className = 'okanjo-ad-dynamic-product';\n\n        if (options.hidden) {\n            el.style.display = \"none\";\n        }\n\n        this.element.appendChild(el);\n\n        this.render();\n\n        var productWidgetConfig = {\n            id: this.config.id,\n            key: this.key,\n            mode: okanjo.Product.contentTypes.single,\n            disable_inline_buy: this.disable_inline_buy,\n            disable_popup: this.config.disable_popup === true,\n            proxy_url: this.proxy_url,\n            expandable: this.config.expandable === undefined || (typeof this.config.expandable === \"boolean\" ? this.config.expandable : (\"\"+this.config.expandable).toLowerCase() === \"true\"),\n            metrics_context: okanjo.metrics.channel.ad_widget, // Set the context of the click to the Ad widget please!\n            metrics_channel_context: this.config.content, // Set the channel context to this widget's mode of operation (creative, dynamic)\n            template_product_main: \"product.single\"\n        };\n\n        // Copy parameters through from the ad config, to the product config, if set\n        if (this.config.template_product_main) productWidgetConfig.template_product_main = this.config.template_product_main;\n        if (this.config.template_product_error) productWidgetConfig.template_product_error = this.config.template_product_error;\n\n        // Instantiate the widget\n        this.productWidget = new okanjo.Product(el, productWidgetConfig);\n\n        return this.productWidget;\n    };\n\n\n    /**\n     * Updates the placement element's dimensions based on given size\n     * @param size\n     */\n    proto.setElementSize = function(size) {\n        this.element.style.display = \"block\";\n        this.element.style.overflow = \"hidden\";\n        this.element.style.width = size.width + \"px\";\n        this.element.style.height = size.height + \"px\";\n    };\n\n\n    /**\n     * Check if the element has predefined content to show\n     * @returns {boolean}\n     */\n    proto.hasCreativeContent = function() {\n        if (this.element.childElementCount && this.element.childElementCount > 0) {\n            return true;\n        } else {\n            for (var i = 0; i < this.element.childNodes.length; i++) {\n                if (this.element.childNodes[i].nodeType === 1/*Node.ELEMENT_NODE*/) {\n                    return true;\n                }\n            }\n        }\n    };\n\n\n    okanjo.Ad = Ad;\n    return Ad;\n\n})(okanjo, this);"],"sourceRoot":"./"}